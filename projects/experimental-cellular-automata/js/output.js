(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),n=Object.values(t).reduce(((t,n,r)=>[...t,n/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=n.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[44,44];function n(t,e,n,r,i){for(var o=-1;o<=1;o++)for(var a=-1;a<=1;a++){if(0==o&&0==a)continue;i[0]=(Math.abs(o)+Math.abs(a))%2,i[t.time%4+1]=-1==o?1:0,i[(1+t.time)%4+1]=-1==a?1:0,i[(2+t.time)%4+1]=1==o?1:0,i[(3+t.time)%4+1]=1==a?1:0;let u=t.t(t,e,n,o,a),l=u[0],h=u[1],c=t.grid.get(l,h),f=c%4,d=Math.floor(c%16/4);if(1==f){r[0][0]+=1;for(var s=0;s<i.length;s++)r[0][4+8*s]+=i[s],r[0][8*(s+1)]+=1-i[s]}else if(2==f){r[0][2]+=1;for(s=0;s<i.length;s++)r[0][4+8*s+2]+=i[s],r[0][8*(s+1)+2]+=1-i[s]}else if(3==f){r[0][3]+=1;for(s=0;s<i.length;s++)r[0][4+8*s+3]+=i[s],r[0][8*(s+1)+3]+=1-i[s]}if(Math.floor(0==d)){r[1][0]+=1;for(s=0;s<i.length;s++)r[1][4+8*s]+=i[s],r[1][8*(s+1)]+=1-i[s]}else if(Math.floor(1==d)){r[1][1]+=1;for(s=0;s<i.length;s++)r[1][4+8*s+1]+=i[s],r[1][8*(s+1)+1]+=1-i[s]}else if(Math.floor(2==d)){r[1][2]+=1;for(s=0;s<i.length;s++)r[1][4+8*s+2]+=i[s],r[1][8*(s+1)+2]+=1-i[s]}else if(Math.floor(3==d)){r[1][3]+=1;for(s=0;s<i.length;s++)r[1][4+8*s+3]+=i[s],r[1][8*(s+1)+3]+=1-i[s]}}r[0][1]=r[0][0]+r[0][3];for(s=0;s<i.length+1;s++)r[0][4*s+1]+=r[0][4*s]+r[0][4*s+3];return r}const r="mix",i="isotropic",o="xcross",a="vcross",s="xvcross",u="directional1",l="directional2",h="directional3",c="directional2b",f="directional",d={[r]:.3,[i]:.3,[o]:.05,[a]:.05,[s]:.05,[u]:.05,[l]:.05,[h]:.05,[c]:.05,[f]:.05};const M="Abs",m="Cond",g="None",v="Eq",p="Bigger";class b{constructor(t,e,n,r,i,o=null){this.type=t,this.threshold=e,this.i=n,this.o=r,this.u=i,this.l=o,this.h=function(t,e){return t==m?function(t){return 0==t}:t==M?function(t){return t%e==0}:function(t){return!0}}(this.o,this.u),this.M=function(t,e,n){return e==v?function(e){return e[n[0]][n[1]]==t}:e==p?function(e){return e[n[0]][n[1]]>t}:void 0}(this.threshold,this.type,this.i),this.m=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(o)}test(t,e,n){var r=this.m(n);return this.M(t)&&this.h(e)&&r}name(){var t="";return null!=this.l&&(t=this.l.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.o}NT${this.i[0]}|${this.i[1]}P${t}`}static v(t,e=4){var n=null;t.startsWith(v)?n=v:t.startsWith(p)&&(n=p);var r=t.substring(n.length),i=parseInt(r.substring(0,1)),o=null;(r=r.substring(1)).startsWith(m)?o=m:r.startsWith(M)?o=M:r.startsWith(g)&&(o=g);var a=(r=r.substring(o.length+2)).split("P")[0].split("|").map(Number),s=null;return r.split("P").length>0&&r.split("P")[1].length>0&&(s=(r=r.split("P")[1]).split("").map((t=>"1"==t))),new b(n,i,a,o,e,s)}static p(n=null,d=4,w=r,S=null){const R=[v,p],k=R[Math.floor(Math.random()*R.length)];var C=0;C=k===p?Math.floor(8*Math.random())+1:Math.floor(9*Math.random());const x=[m,M,g],N=x[Math.floor(Math.random()*x.length)];null===n&&(n={0:2/3,1:1/3});const F=t(n)(),P=function(t,n){var d=n;if(d==r){var M=Math.random();return d=M<.5?i:M<.7?o:M<.9?a:f,Math.floor(Math.random()*e[t])}if(d==i)return Math.floor(4*Math.random());if(d==a)return Math.floor(4*Math.random()+4);if(d==o)return Math.floor(4*Math.random()+8);if(d==s)return Math.floor(8*Math.random()+4);if(d==u)return Math.floor(4*Math.random()+12);if(d==l)return Math.floor(8*Math.random()+12);if(d==h)return Math.floor(12*Math.random()+12);if(d==c){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return d==f?Math.floor(16*Math.random()+12):void 0}(F,w),y=[F,P];if(Math.random()<.5)A=null;else{var A;null==S&&(S=Math.floor(4*Math.random())+2);do{A=new Array(S).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new b(k,C,y,N,d,A)}}class w{constructor(){this.S}R(t,e,n,r){throw new Error("Must override method")}}class S extends w{constructor(){super(),this.S=4}R(t,e,n,r){var i=t%4;return 1==i||3==i?e=2:2==i?e=0:0==i&&2==n[0][0]?e=1:0==i&&n[0][0]>2&&(e=3),e}}class R extends w{constructor(t,e,n,r,i){super(),this.k=e,this.C=t,this.S=this.k,this.N=n,this.F=r,this.P=i}R(t,e,n,r){e=0;for(let i=0;i<this.C.length;i++)if(this.C[i].test(n,t,r)){e=(i+1)%this.k;break}return e}A(){return this.C.map((t=>t.name())).join(", ")}static G(e=null,n=null,r=4,i=4){var o=[];null==e&&(e=Math.floor(8*Math.random())+2);var a=t(d)(),s=this.I();for(let t=0;t<e;t++)o.push(b.p(n,r,a,s));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+a+": "+o.map((t=>t.name())).join(", ")),new R(o,i,n,a,s)}static I(){var t=Math.random();return t<.3?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(5*Math.random())+5}static X(t){var e=t.split(", ").map((t=>b.v(t)));return new R(e,nColors,null,r,null)}Y(t=null){var e,n=this.C.length;null==t&&(t=this.N),0==(e=2==n?Math.floor(2*Math.random())+1:10==n?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.T():1==e?this.j(t):this.O(t)}O(t){var e=this.C.slice();e.push(b.p(t,4,this.F,this.P)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.F+": "+e.map((t=>t.name())).join(", ")),this.C=e}T(){var t=this.C.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join(", ")),this.C=t}j(t){var e=this.C.slice(),n=Math.floor(Math.random()*e.length);e[n]=b.p(t,4,this.F,this.P),console.log((new Date).toLocaleTimeString()+" Changing condition "+n+" to "+this.F+": "+e.map((t=>t.name())).join(", ")),this.C=e}}class k extends w{constructor(t,e){super(),this.k=e,this.C=t,this.S=this.k}R(t,e,n,r){e=0;var i=this.C[t%4];for(let r=0;r<i.length;r++)if(i[r].test(n,t)){e=(r+1)%this.k;break}return e}A(){return this.C.map((t=>t.map((t=>t.name())).join(", "))).join(" || ")}static G(t=null,e=null,n=4,r=4){var i=[];for(let r=0;r<4;r++){i.push([]),null==t&&(t=Math.floor(8*Math.random())+2);for(let o=0;o<t;o++)i[r].push(b.p(e,n))}return console.log("Sampling sparse four state rule: "+i.map((t=>t.map((t=>t.name())).join(", "))).join(" || ")),new k(i,r)}static X(t,e=4){var n=[],r=t.split(" || ");for(let t=0;t<r.length;t++){n.push([]);var i=r[t].split(", ");n[t]=i.map((t=>b.v(t)))}return new k(n,e)}}const C="safe",x="mix",N="general";class F{V(){throw new Error("Must override method")}L(){return function(t,e,n,r){e=this.B[0].R(t%this.B[0].S,e,n,r);var i=this.B[0].S;for(let o=1;o<this.B.length;o++)e+=i*this.B[o].R(Math.floor(t/i)%this.B[o].S,e,n,r),e%=i*=this.B[o].S;return e%i}}H(){throw new Error("Must override method")}}class P extends F{constructor(t,e){super(),this.$=t,this.N=e,null==e&&(this.N=t==C?{0:1,1:0}:t==x?{0:.8,1:.2}:{0:.5,1:.5}),this.U=4,this.B=this.V(),this.R=this.L()}V(){var t=[];return t.push(new S),t.push(R.G(null,this.N)),t}H(){var t=this.N;this.B[1].Y(t)}}class y extends F{constructor(t){super(),this.N=t,null==t&&(this.N={0:.5,1:.5}),this.U=1,this.B=this.V(),this.R=this.L()}V(){var t=[];return t.push(k.G(4,this.N)),t}H(){}}function A(t,e=!1){Math.random()<Math.exp(t.D)||e||t.W?("VariableGR"==t.q?(t.Z=new P(C),t.J=new P(C)):"Variable"==t.q?t.Z=new P(C):"VariableMix"==t.q?t.Z=new P(x):"VariableUnsafe"==t.q?t.Z=new P(N):"SparseFourStates"==t.q&&(t.Z=new y),t.D=-25,t.K=-25,t.W=!1):(Math.random()<Math.exp(t.K)||t._)&&(t.Z.H(),t.K=-25,t._=!1),t.D=t.D+t.tt,t.D>0&&(t.D=0),t.K=t.K+t.et,t.K>0&&(t.K=0)}function G(t){let e={};for(let n in t){let r=Math.floor(3*Math.random())-1,i=t[n]+r;i=Math.max(0,Math.min(255,i)),e[n]=i}return e}function I(t){var e={r:247,g:255,b:28},n={r:13,g:112,b:255},r={r:240,g:239,b:239},i={r:0,g:0,b:0},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};"yellow"==t.nt?(t.backgroundColor=e,t.rt=i,t.it=n,t.ot=r):"blue"==t.nt?(t.backgroundColor=n,t.rt=r,t.it=i,t.ot=e):"blue2"==t.nt?(t.backgroundColor=n,t.rt=e,t.it=i,t.ot=r):"grey"==t.nt?(t.backgroundColor=r,t.rt=i,t.it=n,t.ot=e):"grey2"==t.nt?(t.backgroundColor=r,t.rt=e,t.it=i,t.ot=n):"black"==t.nt?(t.backgroundColor=i,t.rt=n,t.it=e,t.ot=r):"black2"==t.nt?(t.backgroundColor=i,t.rt=n,t.it=r,t.ot=e):"blackTrace"==t.nt?(t.backgroundColor=i,t.rt=r,t.it=i,t.ot=r):"blackTrace2"==t.nt?(t.backgroundColor=i,t.rt=i,t.it=i,t.ot=r):"blackTrace3"==t.nt?(t.backgroundColor=i,t.rt=i,t.it=r,t.ot=r):"variable"==t.nt&&(t.backgroundColor=i,t.rt={r:240,g:240,b:240},t.it=o,t.ot=a)}function X(t,e,n,r,i){let o=(e+r+t.st)%t.st,a=(n+i+t.ut)%t.ut,s=o,u=a;return(o-e-r>0||o-e-r<0)&&(u=(t.ut-a-t.lt+t.ut)%t.ut),(a-n-i>0||a-n-i<0)&&(s=(t.st-o-t.ht+t.st)%t.st),[s,u]}function Y(t,e,n,r,i){let o=(e+r+t.st)%t.st,a=(n+i+t.ut)%t.ut,s=o,u=a;return(o-e-r>0||o-e-r<0)&&(u=(t.ut-a-t.lt+t.ut)%t.ut),a-n-i>0?s=(o+t.ht+t.st)%t.st:a-n-i<0&&(s=(o-t.ht+t.st)%t.st),[s,u]}function E(t,e,n,r,i){let o=(e+r+t.st)%t.st,a=(n+i+t.ut)%t.ut,s=o,u=a;return o-e-r>0?u=(a+t.lt+t.ut)%t.ut:o-e-r<0&&(u=(a-t.lt+t.ut)%t.ut),(a-n-i>0||a-n-i<0)&&(s=(t.st-o-t.ht+t.st)%t.st),[s,u]}function T(t,e,n,r,i){let o=(e+r+t.st)%t.st,a=(n+i+t.ut)%t.ut,s=o,u=a;return o-e-r>0?u=(a+t.lt+t.ut)%t.ut:o-e-r<0&&(u=(a-t.lt+t.ut)%t.ut),a-n-i>0?s=(o+t.ht+t.st)%t.st:a-n-i<0&&(s=(o-t.ht+t.st)%t.st),[s,u]}function j(t){t.ct&&t.ft?t.t=X:t.ct?t.t=Y:t.ft?t.t=E:t.t=T}function O(t){A(t,!0)}function V(t,e){if(t.dt){var n={...t.Mt};delete n.gt,delete n.C;var r={...n,event:e},i=Object.keys(r).join(",")+"\n";i+=Object.values(r).join(",");var o=new Blob([i],{type:"text/csv"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download="dataAutomata.csv",s.click()}}class L{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e),this.rows=new Array(e)}get(t,e){return this.data[t*this.width+e]}set(t,e,n){this.data[t*this.width+e]=n}}let B={vt:{bt:2,mask:[[1,1],[1,1]]},wt:{bt:1,mask:[[1,0,1],[0,0,0],[1,0,1]]},St:{bt:40,mask:null}},H=Object.keys(B).map((t=>B[t].mask)),$=t(Object.keys(B).map((t=>B[t].bt)));function U(t,e,n,r,i){for(var o=function(t){var e=Math.exp(-t),n=1,r=0;do{r++,n*=Math.random()}while(n>e);return r-1}(10**t.Rt),a=0;a<o;a++){e=Math.floor(Math.random()*t.st),n=Math.floor(Math.random()*t.ut);D(r,t,H[$()],e,n,i)}return{kt:e,Ct:n}}function D(t,e,n,r,i,o){null===n&&(n=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,n=[];for(let r=0;r<t;r++){n.push([]);for(let t=0;t<e;t++)n[r].push(Math.floor(4*Math.random()))}return n}());let a=n.length,s=n[0].length;for(let u=0;u<a;u++)for(let l=0;l<s;l++){let h=o(e,r,i,u-Math.floor(a/2),l-Math.floor(s/2));t.set(h[0],h[1],n[u][l])}}function W(t){!function(t){let e=t.xt,n=t.Nt;for(var r=0,i=0;i<t.st;i++)for(var o=0;o<t.ut;o++){if(0==t.Ft.get(i,o))continue;r+=1;var a=Math.floor(t.grid.get(i,o)/t.Z.U)%4;let e;if(0==a)e=t.backgroundColor;else if(1==a)e=t.rt;else if(2==a)e=t.it;else{if(3!=a)continue;e=t.ot}let s=4*(i*t.ut+o);n.data[s+0]=e.r,n.data[s+1]=e.g,n.data[s+2]=e.b,n.data[s+3]=255}if(t.Pt=.01*r+.99*t.Pt,t.Pt>.5*t.st*t.ut){t.W=!0;var s=t.Pt/(t.st*t.ut);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+s.toFixed(1)+")."),t.Pt=15,V(t,"oscillation")}t.Pt<3&&(t.W=!0,console.log("Changing rule because not enough cells changed ("+t.Pt+")."),t.Pt=20,V(t,"blackout")),e.putImageData(n,t.yt,t.At)}(t),function(t){for(var r=[new Array(e[0]).fill(0),new Array(e[1]).fill(0)],i=[0,0,0,0,0],o=new L(t.ut,t.st),a=0;a<t.st;a++)for(var s=0;s<t.ut;s++){var u=n(t,a,s,r,i);let e=t.grid.get(a,s);var l=e;l="VariableGR"!=t.q||0==t.mask.get(a,s)?t.Z.R(e,l,u,t.time):t.J.R(e,l,u,t.time),Math.floor(l/t.Z.U)%4!=Math.floor(e/t.Z.U)%4?t.Ft.set(a,s,1):t.Ft.set(a,s,0),o.set(a,s,l);for(let t=0;t<r.length;t++)r[t].fill(0);i.fill(0)}if(t.Gt)var{kt:a,Ct:s}=U(t,a,s,o,t.t);t.grid=o}(t),A(t),t.time=(t.time+1)%166320,function(t){Math.random()<1e-4&&(t.lt=Math.floor(Math.random()*t.ut),console.log("Periodicity shift X: "+t.lt)),Math.random()<1e-4&&(t.ht=Math.floor(Math.random()*t.st),console.log("Periodicity shift Y: "+t.ht)),Math.random()<1e-4&&(t.ct=!t.ct,j(t),console.log("Flip X: "+t.ct)),Math.random()<1e-4&&(t.ft=!t.ft,j(t),console.log("Flip Y: "+t.ft))}(t),"variable"==t.nt&&function(t){Math.random()<1&&(t.ot=G(t.ot),t.it=G(t.it))}(t),setTimeout((function(){requestAnimationFrame((()=>W(t)))}),t.timeout)}function q(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const r=new Image;r.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const o=i.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<r.height;t++){const e=[];for(let n=0;n<r.width;n++){const i=4*(t*r.width+n),a=(o[i]+o[i+1]+o[i+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},r.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},r.src=n}))).then((e=>{new L(t.ut,t.st);const n=new L(t.ut,t.st),r=e[0].length/t.ut,i=e.length/t.st,o=Math.max(r,i),a=Math.floor((t.ut-e[0].length/o)/2),s=Math.floor((t.st-e.length/o)/2);for(let r=0;r<t.st;r++)for(let i=0;i<t.ut;i++){if(r<s||(r-s)*o>=e.length){n.set(r,i,1);continue}let t=Math.floor((i-a)*o);0===e[Math.floor((r-s)*o)][t]?n.set(r,i,0):n.set(r,i,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new L(t.ut,t.st)}));var n}async function z(t,e){return await q(t),function(t,e=64){return Promise.resolve().then((()=>{t.grid=new L(t.ut,t.st),t.Ft=new L(t.ut,t.st);for(var n=0;n<t.st;n++)for(var r=0;r<t.ut;r++)if("gr"!=t.It||1!==t.mask.get(n,r)){for(var i=Math.random(),o=0;o<e;o++)if(i<(o+1)/(e+1)){t.grid.set(n,r,o);break}t.Ft.set(n,r,1)}else t.grid.set(n,r,0)}))}(t)}function Z(t){document.getElementById("submitButton").addEventListener("click",(function(){var t,e,n,r,i,o,a,s,u,l,h;t=document.getElementById("userGridHeight").value,e=document.getElementById("userGridWidth").value,n=document.getElementById("userTimeout").value,r=document.getElementById("userXShift").value,i=document.getElementById("userYShift").value,o=document.getElementById("userFlipX").checked,a=document.getElementById("userFlipY").checked,s=document.getElementById("userColorPalette").value,u=document.getElementById("randomnessCheckbox").checked,l=document.getElementById("randomnessSlider").value,h=document.getElementById("userRule").value,localStorage.setItem("userGridHeight",t),localStorage.setItem("userGridWidth",e),localStorage.setItem("userTimeout",n),localStorage.setItem("userXShift",r),localStorage.setItem("userYShift",i),localStorage.setItem("userFlipX",o),localStorage.setItem("userFlipY",a),localStorage.setItem("userColorPalette",s),localStorage.setItem("userRandomnessOn",u),localStorage.setItem("userRandomnessAmount",l),localStorage.setItem("userRule",h),location.reload()}))}function J(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.Rt=e,document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var K=document.getElementById("gameCanvas"),Q=K.getContext("2d"),_=192,tt=192,et=30,nt=!0,rt=-1.5,it=0,ot=0,at=!1,st=!1,ut="variable",lt="Variable",ht="random",ct=8,ft=2e4,dt=2e3,Mt=new class{constructor(t,e,n=200,r=200,i=20,o=!0,a=-2,s=0,u=0,l=!1,h=!1,c="black2",f="VariableGR",d="random",M=6,m=2e4,g=2e3){this.st=n,this.ut=r,this.yt=0,this.At=0,this.timeout=i,this.grid=null,this.Ft=null,this.Nt=null,this.canvas=t,this.xt=e,this.Gt=o,this.Rt=a,this.lt=s,this.ht=u,this.ct=l,this.ft=h,this.nt=c,this.q=f,this.It=d,this.Xt=M,this.Yt=null,this.Et=null,this.t=null,this.mask=null,this.Tt=m,this.jt=g,this.D=-25,this.K=-25,this.tt=25/this.Tt,this.et=25/this.jt,this.canvas.width=this.ut,this.canvas.height=this.st,this.Nt=e.createImageData(t.width,t.height),this.W=!0,this._=!1,this.Pt=0,this.dt=!1,this.time=0}}(K,Q,_,tt,et,nt,rt,it,ot,at,st,ut,lt,ht,ct,ft,dt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.Gt=this.checked}))}(Mt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(Mt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,o=n.width/t.ut,a=n.height/t.st,s=Math.floor(r/o),u=Math.floor(i/a);t.grid.set(u,s,1)}}))}(Mt),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,o=n.width/t.ut,a=n.height/t.st,s=Math.floor(r/o),u=Math.floor(i/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(u,(s+1)%t.ut,1),t.grid.set(u,s,1),t.grid.set((u+1)%t.st,s,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(u,s,1),t.grid.set((u+1)%t.st,s,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(u,s,1),t.grid.set(u,(s+1)%t.ut,1)):(t.grid.set((u+1)%t.st,(s+1)%t.ut,1),t.grid.set((u-1+t.st)%t.st,(s+1)%t.ut,1),t.grid.set((u-1+t.st)%t.st,(s-1+t.ut)%t.ut,1),t.grid.set((u+1)%t.st,(s-1+t.ut)%t.ut,1))}))}(Mt),Z(),J(Mt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.lt=e,j(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.ht=e,j(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.ct=this.checked,j(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.ft=this.checked,j(t)}))}(Mt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(Mt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.nt=this.value,I(t)}))}(Mt),function(t){document.getElementById("userRule").addEventListener("change",(async function(){t.q=this.value,O(t)}))}(Mt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.W=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t._=!0}))}(Mt),function(t){document.getElementById("changeColor").addEventListener("click",(function(){I(t)}))}(Mt),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.dt=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){V(t,"like")})),document.getElementById("dislikeButton").addEventListener("click",(function(){V(t,"dislike")}))}(Mt),function(t){null!==localStorage.getItem("userGridHeight")?(t.st=parseInt(localStorage.getItem("userGridHeight")),t.ut=parseInt(localStorage.getItem("userGridWidth")),t.st>1e3&&(t.st=1e3),t.ut>1e3&&(t.ut=1e3),t.Nt=t.xt.createImageData(t.ut,t.st),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.lt=parseInt(localStorage.getItem("userXShift")),isNaN(t.lt)&&(t.lt=0),isNaN(t.ht)&&(t.ht=0),t.ht=parseInt(localStorage.getItem("userYShift")),t.ct="true"===localStorage.getItem("userFlipX"),t.ft="true"===localStorage.getItem("userFlipY"),t.nt=localStorage.getItem("userColorPalette"),t.Gt="true"===localStorage.getItem("userRandomnessOn"),t.Rt=parseFloat(localStorage.getItem("userRandomnessAmount")),t.q=localStorage.getItem("userRule"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.st,document.getElementById("userGridWidth").value=t.ut,document.getElementById("userTimeout").value=t.timeout,document.getElementById("userXShift").value=t.lt,document.getElementById("userYShift").value=t.ht,document.getElementById("userFlipX").checked=t.ct,document.getElementById("userFlipY").checked=t.ft,document.getElementById("userColorPalette").value=t.nt,document.getElementById("randomnessCheckbox").checked=t.Gt,document.getElementById("randomnessSlider").value=t.Rt,document.getElementById("userRule").value=t.q,t.canvas.width=Math.max(t.st,t.ut),t.canvas.height=Math.max(t.st,t.ut),t.yt=0,t.At=0;var e=document.getElementById("gameCanvas");if(t.st>t.ut){var n=Math.floor(t.ut/t.st*800);e.style.width=n+"px",e.style.height="800px",e.width=n*t.st/800,e.height=t.st}else{var r=Math.floor(t.st/t.ut*800);e.style.width="800px",e.style.height=r+"px",e.width=t.ut,e.height=r*t.ut/800}}(Mt),I(Mt),j(Mt),O(Mt);let t=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==t&&""!==window.location.hostname||z(Mt).then((()=>{W(Mt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),n=Object.values(t).reduce(((t,n,i)=>[...t,n/e+(t[i-1]||0)]),[]);return function(){let e=Math.random(),i=n.findIndex((t=>e<t));return Object.keys(t)[i]}}const e=[44,44];function n(t,e,n,i,r,s,a){const o=i.height-1,u=i.width-1,l=i.data,h=i.width;for(var c=r[0],f=r[1],d=-1;d<=1;d++)for(var m=-1;m<=1;m++){if(0==d&&0==m)continue;if(s[0]=((-1===d?1:d)+(-1===m?1:m))%2,s[1+(3&a)]=-1==d?1:0,s[1+(1+a&3)]=-1==m?1:0,s[1+(2+a&3)]=1==d?1:0,s[1+(3+a&3)]=1==m?1:0,0==e||0==n||e==o||n==u)var[M,g]=t.t(t,e,n,d,m);else var M=e+d,g=n+m;const i=l[M*h+g],r=3&i,w=(15&i)>>2;if(1==r){c[0]+=1;for(var v=0;v<s.length;v++)c[4+8*v]+=s[v],c[8*(v+1)]+=1-s[v]}else if(2==r){c[2]+=1;for(v=0;v<s.length;v++)c[4+8*v+2]+=s[v],c[8*(v+1)+2]+=1-s[v]}else if(3==r){c[3]+=1;for(v=0;v<s.length;v++)c[4+8*v+3]+=s[v],c[8*(v+1)+3]+=1-s[v]}if(0==w){f[0]+=1;for(v=0;v<s.length;v++)f[4+8*v]+=s[v],f[8*(v+1)]+=1-s[v]}else if(1==w){f[1]+=1;for(v=0;v<s.length;v++)f[4+8*v+1]+=s[v],f[8*(v+1)+1]+=1-s[v]}else if(2==w){f[2]+=1;for(v=0;v<s.length;v++)f[4+8*v+2]+=s[v],f[8*(v+1)+2]+=1-s[v]}else if(3==w){f[3]+=1;for(v=0;v<s.length;v++)f[4+8*v+3]+=s[v],f[8*(v+1)+3]+=1-s[v]}}c[1]=c[0]+c[3];for(v=0;v<s.length+1;v++)c[4*v+1]+=c[4*v]+c[4*v+3];return r}const i="mix",r="isotropic",s="xcross",a="vcross",o="xvcross",u="directional1",l="directional2",h="directional3",c="directional2b",f="directional",d={[i]:.2,[r]:.4,[s]:.05,[a]:.05,[o]:.05,[u]:.05,[l]:.05,[h]:.05,[c]:.05,[f]:.05};const m="A",M="C",g="E",v="B";class w{constructor(t,e,n,i,r,s=null){this.type=t,this.threshold=e,this.i=n,this.o=i,this.u=r,this.l=s,this.h=function(t,e){return t==M?function(t){return 0==t}:t==m?function(t){return t%e==0}:function(t){return!0}}(this.o,this.u),this.m=function(t,e,n){return e==g?function(e){return e[n[0]][n[1]]==t}:e==v?function(e){return e[n[0]][n[1]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(s)}test(t,e,n){var i=this.M(n);return this.m(t)&&this.h(e)&&i}name(){var t="";return null!=this.l&&(t=this.l.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.o}[${this.i[0]}|${this.i[1]}]${t}`}static v(t,e=4){var n=null;t.startsWith(g)?n=g:t.startsWith(v)&&(n=v);var i=t.substring(n.length),r=parseInt(i.substring(0,1)),s=null;(i=i.substring(1)).startsWith(M)?s=M:i.startsWith(m)?s=m:i.startsWith("N")&&(s="N");var a=(i=i.substring(s.length)).split("[")[1].split("]")[0].split("|").map(Number),o=null;return(i=i.split("]")[1]).length>0&&(o=i.split("").map((t=>"1"===t))),new w(n,r,a,s,e,o)}static p(e=null,n=4,d=i,p=null){const b=[g,v],S=b[Math.floor(Math.random()*b.length)],R=[M,m,"N"],C=R[Math.floor(Math.random()*R.length)];null===e&&(e={0:2/3,1:1/3});const k=t(e)(),N=function(t,e){var n=e;if(n==i){var d=Math.random();n=d<.5?r:d<.7?s:d<.9?a:f}if(n==r)return Math.floor(4*Math.random());if(n==a)return Math.floor(4*Math.random()+4);if(n==s)return Math.floor(4*Math.random()+8);if(n==o)return Math.floor(8*Math.random()+4);if(n==u)return Math.floor(4*Math.random()+12);if(n==l)return Math.floor(8*Math.random()+12);if(n==h)return Math.floor(12*Math.random()+12);if(n==c){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return n==f?Math.floor(16*Math.random()+12):void 0}(0,d),x=[k,N];var B=0,F=8;if(0==x[0]&&x[1]%4!=1?F=5:x[1]>4&&x[1]<=16?F=4:x[1]>16&&(F=3),B=S===v?Math.floor(Math.random()*F):Math.floor(Math.random()*F)+1,Math.random()<.2)y=null;else{var y;null==p&&(p=Math.floor(20*Math.random())+2);do{y=new Array(p).fill(0).map((()=>Math.random()<.5))}while(!y.includes(!0))}return new w(S,B,x,C,n,y)}}class p{constructor(){this.S}R(t,e,n,i){throw new Error("Must override method")}}class b extends p{constructor(){super(),this.S=4}R(t,e,n,i){var r=t%4;return 1==r||3==r?e=2:2==r?e=0:0==r&&2==n[0][0]?e=1:0==r&&n[0][0]>2&&(e=3),e}C(){return"BB"}}class S extends p{constructor(){super(),this.S=4}R(t,e,n,i){var r=t%4;return 1==r?e=2:2==r||3==r?e=0:0!=r&&3!=r||2!=n[0][0]?0==r&&n[0][0]>2&&(e=3):e=1,e}C(){return"TBB"}}class R extends p{constructor(){super(),this.S=4}R(t,e,n,i){var r=t%4;return 1==r&&(n[0][0]<3||n[0][0]>5)?e=2:2==r?e=3:3==r?e=0:0==r&&2==n[0][0]&&(e=1),e}C(){return"SW"}}class C extends p{constructor(t){super(),this.k=t;const e=this.k.split("/");this.N=new Uint8Array(e[0].substring(1).split("").map(Number)),this.B=new Uint8Array(e[1].substring(1).split("").map(Number)),this.S=Number(e[2])}R(t,e,n,i){var r=t%this.S;return 1==r&&this.B.includes(n[0][0])?e=1:r>0&&r<this.S-1?e+=1:r==this.S-1?e=0:0==r&&this.N.includes(n[0][0])&&(e=1),e}C(){return this.k}}class k extends p{constructor(t,e,n,i,r){super(),this.F=e,this.A=t,this.S=this.F,this.G=n,this.I=i,this.O=r}R(t,e,n,i){e=0;for(let r=0;r<this.A.length;r++)if(this.A[r].test(n,t,i)){e=(r+1)%this.F;break}return e}C(){return this.A.map((t=>t.name())).join("||")}static T(e=null,n=null,i=null,r=4,s=4,a=null){var o=[];null==e&&(e=Math.floor(8*Math.random())+2),null==i&&(i=t(d)()),null==a&&(a=this.U());for(let t=0;t<e;t++)o.push(w.p(n,r,i,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+i+": "+o.map((t=>t.name())).join(", ")),new k(o,s,n,i,a)}static U(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static X(t,e=4){var n=t.split("||").map((t=>w.v(t)));return new k(n,e,null,i,null)}Y(t=null){var e,n=this.A.length;null==t&&(t=this.G),0==(e=2==n?Math.floor(2*Math.random())+1:10==n?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.V():1==e?this.j(t):this.P(t)}P(t){var e=this.A.slice();e.push(w.p(t,4,this.I,this.O)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.I+": "+e.map((t=>t.name())).join("||")),this.A=e}V(){var t=this.A.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.A=t}j(t){var e=this.A.slice(),n=Math.floor(Math.random()*e.length);e[n]=w.p(t,4,this.I,this.O),console.log((new Date).toLocaleTimeString()+" Changing condition "+n+" to "+this.I+": "+e.map((t=>t.name())).join("||")),this.A=e}}class N extends p{constructor(t,e){super(),this.F=e,this.A=t,this.S=this.F}R(t,e,n,i){e=0;var r=this.A[t%4];for(let i=0;i<r.length;i++)if(r[i].test(n,t)){e=(i+1)%this.F;break}return e}C(){return this.A.map((t=>t.map((t=>t.name())).join(", "))).join(" || ")}static T(t=null,e=null,n=4,i=4){var r=[];for(let i=0;i<4;i++){r.push([]),null==t&&(t=Math.floor(8*Math.random())+2);for(let s=0;s<t;s++)r[i].push(w.p(e,n))}return console.log("Sampling sparse four state rule: "+r.map((t=>t.map((t=>t.name())).join(", "))).join("||")),new N(r,i)}static X(t,e=4){var n=[],i=t.split(" || ");for(let t=0;t<i.length;t++){n.push([]);var r=i[t].split(", ");n[t]=r.map((t=>w.v(t)))}return new N(n,e)}}const x="safe",B="mix",F="general";class y{W;L;R;H(){throw new Error("Must override method")}$(){return function(t,e,n,i){e=this.L[0].R(t%this.L[0].S,e,n,i);var r=this.L[0].S;for(let s=1;s<this.L.length;s++)e+=r*this.L[s].R(Math.floor(t/r)%this.L[s].S,e,n,i),e%=r*=this.L[s].S;return e%r}}D(){throw new Error("Must override method")}C(){return this.L.map((t=>t.C())).join("-")}}class A extends y{constructor(t){super(),this.q=t,this.W=1,this.L=this.H(),this.R=this.$()}H(){var t=[];return"Original"==this.q?t.push(new S):"StarWars"==this.q?t.push(new R):"Modified"==this.q?t.push(new b):t.push(new C(this.q)),t}D(){}}class G extends y{constructor(t,e,n=null){super(),this.q=t,this.G=e,this.O=null,this.Z=null,null==e&&(t==x?this.G={0:1,1:0}:t==B?(Math.random()<.5?this.G={0:.8,1:.2}:this.G={0:1,1:0},this.G={0:.8,1:.2}):this.G={0:.5,1:.5}),this.W=4,this.L=null==n?this.H():this.J(n),this.R=this.$()}H(){var t=[],e=Math.random();return e<.3?t.push(new b):e<.5?t.push(new S):e<.8&&this.q!=x?t.push(new R):e<.9&&this.q!=x?t.push(new C("B3/S123/4")):this.q!=x?t.push(new C("B378/S124567/4")):t.push(new b),t.push(k.T(null,this.G,this.Z,4,4,this.O)),t}D(){this.L[1].Y(this.G)}J(t){var e=[],[n,i]=t.split("-");return"BB"==n?e.push(new b):"TBB"==n?e.push(new S):"SW"==n&&e.push(new R),e.push(new R),e.push(k.X(i)),e}}class I extends y{constructor(t,e,n=null){super(),this.q=t,this.G=e,this.O=null,this.Z=null,null==e&&(t==x?this.G={0:1,1:0}:t==B?(Math.random()<.5?this.G={0:.8,1:.2}:this.G={0:1,1:0},this.G={0:.8,1:.2}):this.G={0:.5,1:.5}),this.W=16,this.L=null==n?this.H():this.J(n),this.R=this.$()}H(){var t=[];return t.push(new b),t.push(k.T(null,this.G,this.Z,4,4,this.l)),t.push(k.T(null,this.G,this.Z,16,4,this.l)),t}D(){this.L[1].Y(this.G),this.L[2].Y(this.G)}J(t){var e=[],n=t.split("-")[1];return e.push(new b),e.push(k.X(n)),e}}class O extends y{constructor(t){super(),this.G=t,null==t&&(this.G={0:.5,1:.5}),this.W=1,this.L=this.H(),this.R=this.$()}H(){var t=[];return t.push(N.T(4,this.G)),t}D(){}}function T(t,e=!1){Math.random()<Math.exp(t.K)||e||t._?("VariableGR"==t.tt?(t.et=new G(x),t.nt=new G(x)):"Variable"==t.tt?t.et=new G(x):"VariableMix"==t.tt?t.et=new G(B):"VariableUnsafe"==t.tt?t.et=new G(F):"Variable2Unsafe"==t.tt?t.et=new I(F):"CustomRule"==t.tt?t.et=new G(null,null,t.it):"OriginalBB"==t.tt?t.et=new A("Original"):"ModifiedBB"==t.tt?t.et=new A("Modified"):"StarWars"==t.tt?t.et=new A("StarWars"):"SparseFourStates"==t.tt&&(t.et=new O),t.K=-25,t.rt=-25,t._=!1,U(t)):(Math.random()<Math.exp(t.rt)||t.st)&&"CustomRule"!=t.tt&&(t.et.D(),"VariableGR"==t.tt&&t.nt.D(),t.rt=-25,t.st=!1,U(t)),t.K=t.K+t.ot,t.K>0&&(t.K=0),t.rt=t.rt+t.ut,t.rt>0&&(t.rt=0)}function U(t){var e=document.getElementById("currentRule");e&&(e.value=t.et.C())}function X(t){let e={};for(let n in t){let i=Math.floor(3*Math.random())-1,r=t[n]+i;r=Math.max(0,Math.min(255,r)),e[n]=r}return e}function Y(t){var e={r:247,g:255,b:28},n={r:13,g:112,b:255},i={r:240,g:239,b:239},r={r:0,g:0,b:0},s={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};"yellow"==t.lt?(t.backgroundColor=e,t.ht=r,t.ct=n,t.ft=i):"blue"==t.lt?(t.backgroundColor=n,t.ht=i,t.ct=r,t.ft=e):"blue2"==t.lt?(t.backgroundColor=n,t.ht=e,t.ct=r,t.ft=i):"grey"==t.lt?(t.backgroundColor=i,t.ht=r,t.ct=n,t.ft=e):"grey2"==t.lt?(t.backgroundColor=i,t.ht=e,t.ct=r,t.ft=n):"black"==t.lt?(t.backgroundColor=r,t.ht=n,t.ct=e,t.ft=i):"black2"==t.lt?(t.backgroundColor=r,t.ht=n,t.ct=i,t.ft=e):"blackTrace"==t.lt?(t.backgroundColor=r,t.ht=i,t.ct=r,t.ft=i):"blackTrace2"==t.lt?(t.backgroundColor=r,t.ht=r,t.ct=r,t.ft=i):"blackTrace3"==t.lt?(t.backgroundColor=r,t.ht=r,t.ct=i,t.ft=i):"variable"==t.lt&&(t.backgroundColor=r,t.ht={r:240,g:240,b:240},t.ct=s,t.ft=a)}function E(t,e,n,i,r){let s=(e+i+t.dt)%t.dt,a=(n+r+t.Mt)%t.Mt,o=s,u=a;return(s-e-i>0||s-e-i<0)&&(u=(t.Mt-a-t.gt+t.Mt)%t.Mt),(a-n-r>0||a-n-r<0)&&(o=(t.dt-s-t.vt+t.dt)%t.dt),[o,u]}function V(t,e,n,i,r){let s=(e+i+t.dt)%t.dt,a=(n+r+t.Mt)%t.Mt,o=s,u=a;return(s-e-i>0||s-e-i<0)&&(u=(t.Mt-a-t.gt+t.Mt)%t.Mt),a-n-r>0?o=(s+t.vt+t.dt)%t.dt:a-n-r<0&&(o=(s-t.vt+t.dt)%t.dt),[o,u]}function j(t,e,n,i,r){let s=(e+i+t.dt)%t.dt,a=(n+r+t.Mt)%t.Mt,o=s,u=a;return s-e-i>0?u=(a+t.gt+t.Mt)%t.Mt:s-e-i<0&&(u=(a-t.gt+t.Mt)%t.Mt),(a-n-r>0||a-n-r<0)&&(o=(t.dt-s-t.vt+t.dt)%t.dt),[o,u]}function P(t,e,n,i,r){let s=(e+i+t.dt)%t.dt,a=(n+r+t.Mt)%t.Mt,o=s,u=a;return s-e-i>0?u=(a+t.gt+t.Mt)%t.Mt:s-e-i<0&&(u=(a-t.gt+t.Mt)%t.Mt),a-n-r>0?o=(s+t.vt+t.dt)%t.dt:a-n-r<0&&(o=(s-t.vt+t.dt)%t.dt),[o,u]}function W(t){t.wt&&t.bt?t.t=E:t.wt?t.t=V:t.bt?t.t=j:t.t=P}function L(t){T(t,!0)}function H(t,e){if(t.St){var n={...t.Rt};delete n.Ct,delete n.A;var i={...n,event:e},r=Object.keys(i).join(",")+"\n";r+=Object.values(i).join(",");var s=new Blob([r],{type:"text/csv"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download="dataAutomata.csv",o.click()}}class ${constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e),this.rows=new Array(e)}get(t,e){return this.data[t*this.width+e]}set(t,e,n){this.data[t*this.width+e]=n}}let D={kt:{Nt:2,mask:[[1,0],[0,1]]},xt:{Nt:2,mask:[[0,1],[1,0]]},Bt:{Nt:2,mask:[[1,0],[0,1]]},Ft:{Nt:2,mask:[[1,1],[1,1]]},yt:{Nt:4,mask:[[1,0,1],[0,0,0],[1,0,1]]},At:{Nt:4,mask:[[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]]},Gt:{Nt:30,mask:null}},q=Object.keys(D).map((t=>D[t].mask)),z=t(Object.keys(D).map((t=>D[t].Nt)));function Z(t,e,n,i,r){for(var s=function(t){var e=Math.exp(-t),n=1,i=0;do{i++,n*=Math.random()}while(n>e);return i-1}(10**t.It),a=0;a<s;a++){e=Math.floor(Math.random()*t.dt),n=Math.floor(Math.random()*t.Mt);J(i,t,q[z()],e,n,r)}return{Ot:e,Tt:n}}function J(t,e,n,i,r,s){null===n&&(n=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,n=[];for(let i=0;i<t;i++){n.push([]);for(let t=0;t<e;t++)n[i].push(Math.floor(4*Math.random()))}return n}());let a=n.length,o=n[0].length;for(let u=0;u<a;u++)for(let l=0;l<o;l++){let h=s(e,i,r,u-Math.floor(a/2),l-Math.floor(o/2));t.set(h[0],h[1],n[u][l])}}function K(t){!function(t){let e=t.Ut,n=t.Xt;for(var i=0,r=0;r<t.dt;r++)for(var s=0;s<t.Mt;s++){if(0==t.Yt.get(r,s))continue;i+=1;var a=Math.floor(t.grid.get(r,s)/t.et.W)%4;let e;if(0==a)e=t.backgroundColor;else if(1==a)e=t.ht;else if(2==a)e=t.ct;else{if(3!=a)continue;e=t.ft}let o=4*(r*t.Mt+s);n.data[o+0]=e.r,n.data[o+1]=e.g,n.data[o+2]=e.b,n.data[o+3]=255}if(t.Et=.01*i+.99*t.Et,t.Et>.5*t.dt*t.Mt){t._=!0;var o=t.Et/(t.dt*t.Mt);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+o.toFixed(1)+")."),t.Et=15,H(t,"oscillation")}t.Et<3&&(t._=!0,console.log("Changing rule because not enough cells changed ("+t.Et+")."),t.Et=20,H(t,"blackout")),e.putImageData(n,t.Vt,t.jt)}(t),function(t){var i=[new Uint8Array(e[0]).fill(0),new Uint8Array(e[1]).fill(0)],r=new Uint8Array(5).fill(0),s=new $(t.Mt,t.dt),a=t.grid;const o=t.time;for(var u=0;u<t.dt;u++)for(var l=0;l<t.Mt;l++){var h=n(t,u,l,a,i,r,o);const e=t.grid.get(u,l);var c=e;c="VariableGR"!=t.tt||0==t.mask.get(u,l)?t.et.R(e,c,h,t.time):t.nt.R(e,c,h,t.time),Math.floor(c/t.et.W)%4!=Math.floor(e/t.et.W)%4?t.Yt.set(u,l,1):t.Yt.set(u,l,0),s.set(u,l,c);for(let t=0;t<i.length;t++)i[t].fill(0);r.fill(0)}if(t.Pt)var{Ot:u,Tt:l}=Z(t,u,l,s,t.t);t.grid=s}(t),T(t),t.time=(t.time+1)%166320,function(t){Math.random()<1e-4&&(t.gt=Math.floor(Math.random()*t.Mt),console.log("Periodicity shift X: "+t.gt)),Math.random()<1e-4&&(t.vt=Math.floor(Math.random()*t.dt),console.log("Periodicity shift Y: "+t.vt)),Math.random()<1e-4&&(t.wt=!t.wt,W(t),console.log("Flip X: "+t.wt)),Math.random()<1e-4&&(t.bt=!t.bt,W(t),console.log("Flip Y: "+t.bt))}(t),"variable"==t.lt&&function(t){Math.random()<1&&(t.ft=X(t.ft),t.ct=X(t.ct))}(t),setTimeout((function(){requestAnimationFrame((()=>K(t)))}),t.timeout)}function Q(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const i=new Image;i.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=i.width,e.height=i.height;const r=e.getContext("2d");r.drawImage(i,0,0,i.width,i.height);const s=r.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<i.height;t++){const e=[];for(let n=0;n<i.width;n++){const r=4*(t*i.width+n),a=(s[r]+s[r+1]+s[r+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},i.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},i.src=n}))).then((e=>{new $(t.Mt,t.dt);const n=new $(t.Mt,t.dt),i=e[0].length/t.Mt,r=e.length/t.dt,s=Math.max(i,r),a=Math.floor((t.Mt-e[0].length/s)/2),o=Math.floor((t.dt-e.length/s)/2);for(let i=0;i<t.dt;i++)for(let r=0;r<t.Mt;r++){if(i<o||(i-o)*s>=e.length){n.set(i,r,1);continue}let t=Math.floor((r-a)*s);0===e[Math.floor((i-o)*s)][t]?n.set(i,r,0):n.set(i,r,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new $(t.Mt,t.dt)}));var n}async function _(t,e){return await Q(t),function(t,e=64){return Promise.resolve().then((()=>{t.grid=new $(t.Mt,t.dt),t.Yt=new $(t.Mt,t.dt);for(var n=0;n<t.dt;n++)for(var i=0;i<t.Mt;i++)if("gr"!=t.Wt||1!==t.mask.get(n,i)){for(var r=Math.random(),s=0;s<e;s++)if(r<(s+1)/(e+1)){t.grid.set(n,i,s);break}t.Yt.set(n,i,1)}else t.grid.set(n,i,0)}))}(t)}function tt(t){document.getElementById("submitButton").addEventListener("click",(function(){var t,e,n,i,r,s,a,o,u,l,h,c;t=document.getElementById("userGridHeight").value,e=document.getElementById("userGridWidth").value,n=document.getElementById("userTimeout").value,i=document.getElementById("userXShift").value,r=document.getElementById("userYShift").value,s=document.getElementById("userFlipX").checked,a=document.getElementById("userFlipY").checked,o=document.getElementById("userColorPalette").value,u=document.getElementById("randomnessCheckbox").checked,l=document.getElementById("randomnessSlider").value,h=document.getElementById("metaRule").value,c=null,document.getElementById("currentRule")&&(c=document.getElementById("currentRule").value),localStorage.setItem("userGridHeight",t),localStorage.setItem("userGridWidth",e),localStorage.setItem("userTimeout",n),localStorage.setItem("userXShift",i),localStorage.setItem("userYShift",r),localStorage.setItem("userFlipX",s),localStorage.setItem("userFlipY",a),localStorage.setItem("userColorPalette",o),localStorage.setItem("userRandomnessOn",u),localStorage.setItem("userRandomnessAmount",l),localStorage.setItem("metaRule",h),localStorage.setItem("currentRule",c),location.reload()}))}function et(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.It=e,document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var nt=document.getElementById("gameCanvas"),it=nt.getContext("2d"),rt=192,st=192,at=30,ot=!0,ut=-1.5,lt=0,ht=0,ct=!1,ft=!1,dt="variable",mt="Variable",Mt="random",gt=8,vt=2e4,wt=2e3,pt=new class{constructor(t,e,n=200,i=200,r=20,s=!0,a=-2,o=0,u=0,l=!1,h=!1,c="black2",f="VariableGR",d="random",m=6,M=2e4,g=2e3){this.dt=n,this.Mt=i,this.Vt=0,this.jt=0,this.timeout=r,this.grid=null,this.Yt=null,this.Xt=null,this.canvas=t,this.Ut=e,this.Pt=s,this.It=a,this.gt=o,this.vt=u,this.wt=l,this.bt=h,this.lt=c,this.tt=f,this.Wt=d,this.Lt=m,this.Ht=null,this.$t=null,this.t=null,this.mask=null,this.Dt=M,this.qt=g,this.K=-25,this.rt=-25,this.ot=25/this.Dt,this.ut=25/this.qt,this.canvas.width=this.Mt,this.canvas.height=this.dt,this.Xt=e.createImageData(t.width,t.height),this._=!0,this.st=!1,this.Et=0,this.St=!1,this.time=0}}(nt,it,rt,st,at,ot,ut,lt,ht,ct,ft,dt,mt,Mt,gt,vt,wt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.Pt=this.checked}))}(pt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(pt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,s=n.width/t.Mt,a=n.height/t.dt,o=Math.floor(i/s),u=Math.floor(r/a);t.grid.set(u,o,1)}}))}(pt),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,s=n.width/t.Mt,a=n.height/t.dt,o=Math.floor(i/s),u=Math.floor(r/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(u,(o+1)%t.Mt,1),t.grid.set(u,o,1),t.grid.set((u+1)%t.dt,o,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(u,o,1),t.grid.set((u+1)%t.dt,o,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(u,o,1),t.grid.set(u,(o+1)%t.Mt,1)):(t.grid.set((u+1)%t.dt,(o+1)%t.Mt,1),t.grid.set((u-1+t.dt)%t.dt,(o+1)%t.Mt,1),t.grid.set((u-1+t.dt)%t.dt,(o-1+t.Mt)%t.Mt,1),t.grid.set((u+1)%t.dt,(o-1+t.Mt)%t.Mt,1))}))}(pt),tt(),et(pt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.gt=e,W(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.vt=e,W(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.wt=this.checked,W(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.bt=this.checked,W(t)}))}(pt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(pt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.lt=this.value,Y(t)}))}(pt),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.tt=this.value,L(t)}))}(pt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t._=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.st=!0}))}(pt),function(t){document.getElementById("changeColor").addEventListener("click",(function(){Y(t)}))}(pt),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.St=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){H(t,"like")})),document.getElementById("dislikeButton").addEventListener("click",(function(){H(t,"dislike")}))}(pt),function(t){null!==localStorage.getItem("userGridHeight")?(t.dt=parseInt(localStorage.getItem("userGridHeight")),t.Mt=parseInt(localStorage.getItem("userGridWidth")),t.dt>1e3&&(t.dt=1e3),t.Mt>1e3&&(t.Mt=1e3),t.Xt=t.Ut.createImageData(t.Mt,t.dt),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.gt=parseInt(localStorage.getItem("userXShift")),isNaN(t.gt)&&(t.gt=0),isNaN(t.vt)&&(t.vt=0),t.vt=parseInt(localStorage.getItem("userYShift")),t.wt="true"===localStorage.getItem("userFlipX"),t.bt="true"===localStorage.getItem("userFlipY"),t.lt=localStorage.getItem("userColorPalette"),t.Pt="true"===localStorage.getItem("userRandomnessOn"),t.It=parseFloat(localStorage.getItem("userRandomnessAmount")),t.tt=localStorage.getItem("metaRule"),t.it=localStorage.getItem("currentRule"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.dt,document.getElementById("userGridWidth").value=t.Mt,document.getElementById("userTimeout").value=t.timeout,document.getElementById("userXShift").value=t.gt,document.getElementById("userYShift").value=t.vt,document.getElementById("userFlipX").checked=t.wt,document.getElementById("userFlipY").checked=t.bt,document.getElementById("userColorPalette").value=t.lt,document.getElementById("randomnessCheckbox").checked=t.Pt,document.getElementById("randomnessSlider").value=t.It,document.getElementById("metaRule").value=t.tt,t.canvas.width=Math.max(t.dt,t.Mt),t.canvas.height=Math.max(t.dt,t.Mt),t.Vt=0,t.jt=0;var e=document.getElementById("gameCanvas");if(t.dt>t.Mt){var n=Math.floor(t.Mt/t.dt*800);e.style.width=n+"px",e.style.height="800px",e.width=n*t.dt/800,e.height=t.dt}else{var i=Math.floor(t.dt/t.Mt*800);e.style.width="800px",e.style.height=i+"px",e.width=t.Mt,e.height=i*t.Mt/800}}(pt),Y(pt),W(pt),L(pt);let t=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==t&&""!==window.location.hostname||_(pt).then((()=>{K(pt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
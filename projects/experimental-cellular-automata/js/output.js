(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),n=Object.values(t).reduce(((t,n,r)=>[...t,n/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=n.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[11,44];function n(t,e,n,r,s,i,a,o,h){const u=r.height-1,l=r.width-1,c=r.data,m=r.width;var f=s[0],d=s[1];let M;for(var g=-1;g<=1;g++)for(var p=-1;p<=1;p++){if(0==g&&0==p)continue;if(i[0]=((-1===g?1:g)+(-1===p?1:p))%2,i[2+(3&a)]=-1==g?1:0,i[(1+a)%4+1]=-1==p?1:0,i[(2+a)%4+1]=1==g?1:0,i[(3+a)%4+1]=1==p?1:0,0==e||0==n||e==u||n==l)var[b,w]=t.t(t,e,n,g,p);else var b=e+g,w=n+p;const r=c[b*m+w],s=r%o,S=Math.floor(r/o)%h;M=o;for(var v=0;v<o-1;v++)s==v+1&&(f[v]+=1,f[M+v]+=i[0],M+=o,f[M+v]+=1-i[0],f[o+M+v]+=i[1],M+=o,f[M+v]+=1-i[1],f[o+M+v]+=i[2],M+=o,f[M+v]+=1-i[2],f[o+M+v]+=i[3],M+=o,f[M+v]+=1-i[3],f[o+M+v]+=i[4],M+=o,f[M+v]+=1-i[4]),M=o;M=h;for(v=0;v<h;v++)d[v]+=1,S==v&&(d[h+v]+=i[0],M+=h,d[M+v]+=1-i[0],d[h+M+v]+=i[1],M+=h,d[M+v]+=1-i[1],d[h+M+v]+=i[2],M+=h,d[M+v]+=1-i[2],d[h+M+v]+=i[3],M+=h,d[M+v]+=1-i[3],d[h+M+v]+=i[4],M+=h,d[M+v]+=1-i[4]),M=h}return[f,d]}const r="mix",s="isotropic",i="xcross",a="vcross",o="xvcross",h="directional1",u="directional2",l="directional3",c="directional2b",m="directional",f={[r]:.2,[s]:.4,[i]:.05,[a]:.05,[o]:.05,[h]:.05,[u]:.05,[l]:.05,[c]:.05,[m]:.05};const d="A",M="C",g="E",p="B";class b{constructor(t,e,n,r,s,i=null){this.type=t,this.threshold=e,this.i=n,this.o=r,this.h=s,this.u=i,this.l=function(t,e){return t==M?function(t){return 0==t}:t==d?function(t){return t%e==0}:function(t){return!0}}(this.o,this.h),this.m=function(t,e,n){return e==g&&2==n.length?function(e){return e[n[0]][n[1]]==t}:e==p&&2==n.length?function(e){return e[n[0]][n[1]]>t}:e==g&&3==n.length?function(e){return e[n[0]][n[1]]+e[n[0]][n[2]]==t}:e==p&&3==n.length?function(e){return e[n[0]][n[1]]+e[n[0]][n[2]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(i)}test(t,e,n){var r=this.M(n);return this.m(t)&&this.l(e)&&r}name(){var t="";null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join(""));var e=this.i.join("|");return`${this.type}${this.threshold}${this.o}[${e}]${t}`}static p(t,e=4){var n=null;t.startsWith(g)?n=g:t.startsWith(p)&&(n=p);var r=t.substring(n.length),s=parseInt(r.substring(0,1)),i=null;(r=r.substring(1)).startsWith(M)?i=M:r.startsWith(d)?i=d:r.startsWith("N")&&(i="N");var a=(r=r.substring(i.length)).split("[")[1].split("]")[0].split("|").map(Number),o=null;return(r=r.split("]")[1]).length>0&&(o=r.split("").map((t=>"1"===t))),new b(n,s,a,i,e,o)}static v(e=null,n=4,f=r,w=null){const v=[g,p],S=v[Math.floor(Math.random()*v.length)],k=[M,d,"N"],N=k[Math.floor(Math.random()*k.length)];null===e&&(e={0:2/3,1:1/3});const B=t(e)(),I=function(t,e){var n=e;if(n==r){var f=Math.random();n=f<.5?s:f<.7?i:f<.9?a:m}if(n==s)return Math.floor(4*Math.random());if(n==a)return Math.floor(4*Math.random()+4);if(n==i)return Math.floor(4*Math.random()+8);if(n==o)return Math.floor(8*Math.random()+4);if(n==h)return Math.floor(4*Math.random()+12);if(n==u)return Math.floor(8*Math.random()+12);if(n==l)return Math.floor(12*Math.random()+12);if(n==c){var d=Math.floor(8*Math.random()+12);return d>=16&&(d+=4),d}return n==m?Math.floor(16*Math.random()+12):void 0}(0,f);var R=void 0;if(Math.random()<.5){R=[B,I,function(t){for(var e=4*Math.floor(t/4),n=t;n==t;)n=e+Math.floor(4*Math.random());return n}(I)]}else R=[B,I];var C=0,y=8;if(0==R[0]&&R[1]%4!=1?y=5:R[1]>4&&R[1]<=16?y=4:R[1]>16&&(y=3),C=S===p?Math.floor(Math.random()*y):Math.floor(Math.random()*y)+1,Math.random()<.2)x=null;else{var x;null==w&&(w=Math.floor(20*Math.random())+2);do{x=new Array(w).fill(0).map((()=>Math.random()<.5))}while(!x.includes(!0))}return new b(S,C,R,N,n,x)}}class w{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.S=!1,this.get=this.k,this.set=this.N}static B(t,e=!1,n=!1,r=!1){const s=t.length,i=t[0].length,a=new w(i,s);for(let e=0;e<s;e++){r&&(e=s-e-1);for(let r=0;r<i;r++)n&&(r=i-r-1),a.set(e,r,t[e][r])}return e&&a.I(),a}I(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.S?[this.k,this.N]:[this.R,this.C],this.S=!this.S}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const n=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,n)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const n=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,n)}}k(t,e){return this.data[t*this.width+e]}N(t,e,n){this.data[t*this.width+e]=n}R(t,e){return this.data[e*this.height+t]}C(t,e,n){this.data[e*this.height+t]=n}}class v{constructor(){this.F=void 0}A(t,e,n,r){throw new Error("Must override method")}P(){throw new Error("Must override method")}}class S extends v{constructor(){super(),this.G=this.T(),this.V(),this.U=0}T(){throw new Error("Must override method")}V(){this.X=Object.keys(this.G).map((t=>this.G[t].mask));let e=Object.keys(this.G).map((t=>this.G[t].Y));this.W=t(e)}}class k extends S{constructor(){super(),this.F=4}A(t,e,n,r){var s=t%4;return 1==s||3==s?e=2:2==s?e=0:0==s&&2==n[0][0]?e=1:0==s&&n[0][0]>2&&(e=3),e}P(){return"BB"}T(){return{random:{Y:15,mask:null},O:{Y:4,mask:w.B([[1,1],[1,1]])},$:{Y:4,mask:new w([[1,0,1],[0,0,0],[1,0,1]])},H:{Y:2,mask:w.B([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{Y:2,mask:w.B([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},j:{Y:2,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},D:{Y:2,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class N extends S{constructor(){super(),this.F=4,this.U=-1}A(t,e,n,r){var s=t%4;return 3==s&&(s=0),1==s?e=2:2==s||3==s?e=0:0!=s&&3!=s||2!=n[0][0]?0==s&&n[0][0]>2&&(e=3):e=1,e}P(){return"TBB"}T(){return{random:{Y:15,mask:null},j:{Y:1,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},H:{Y:2,mask:w.B([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{Y:2,mask:w.B([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},O:{Y:4,mask:w.B([[1,1],[1,1]])},q:{Y:1e4,mask:w.B([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class B extends S{constructor(){super(),this.F=4,this.U=-1}A(t,e,n,r){var s=t%4;return 1==s&&(n[0][0]<3||n[0][0]>5)?e=2:2==s?e=3:3==s?e=0:0==s&&2==n[0][0]&&(e=1),e}P(){return"SW"}T(){let t=.2;return{random:{Y:6,mask:null},Z:{Y:1,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},J:{Y:t,mask:w.B([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},K:{Y:t,mask:w.B([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},_:{Y:t,mask:w.B([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{Y:t,mask:w.B([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{Y:t,mask:w.B([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},nt:{Y:t,mask:w.B([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},rt:{Y:t,mask:w.B([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},st:{Y:t,mask:w.B([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},it:{Y:t,mask:w.B([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ot:{Y:t,mask:w.B([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ht:{Y:t,mask:w.B([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{Y:t,mask:w.B([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{Y:t,mask:w.B([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{Y:t,mask:w.B([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{Y:t,mask:w.B([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},dt:{Y:t,mask:w.B([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},$:{Y:2,mask:w.B([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class I extends S{constructor(t){super(),this.Mt=t;const e=this.Mt.split("/");for(var n of(this.gt=0,this.bt=[],e))"N"==n[0]?this.gt=Number(e[0].substring(1)):"B"==n[0]?this.wt=new Uint8Array(n.substring(1).split("").map(Number)):"S"==n[0]?this.vt=new Uint8Array(n.substring(1).split("").map(Number)):"I"==n[0]?this.bt=new Uint8Array(e[2].substring(1).split("").map(Number)):this.F=Number(n)}A(t,e,n,r){var s=t%this.F;return 1==s&&this.vt.includes(n[0][this.gt])?e=1:s>0&&s<this.F-1?e+=1:s==this.F-1?e=0:0==s&&this.wt.includes(n[0][this.gt])?e=1:0==s&&this.bt.includes(n[0][this.gt])&&(e=this.F-1),e}P(){return this.Mt}T(){return{random:{Y:1,mask:null}}}}class R extends I{constructor(t=!0){t?super(R.St()):(super(R.kt()),this.U=0)}static St(){let e=t({"N0/B2/S2/I13":5,"N0/B2/S24/I36/7":1,"N0/B2/S24/I36/8":1,"N0/B2/S24/I36/9":1,"N0/B2/S24/I36/10":1,"N0/B2/S24/I36/11":1,"N1/B2/S3/I/11":1,"B234568/S2458/I1/6":1,"B234568/S2458/I1/7":1,"B234568/S2458/I1/8":1,"B234568/S2458/I1/9":1,"B234568/S2458/I1/10":1,"B234568/S2458/I1/11":1,"B234568/S2458/I1/12":1,"B234568/S2458/I1/13":1,"B234568/S2458/I1/14":1,"B234568/S4568/I1/4":1,"B234568/S4568/I1/5":1,"B234568/S458/I1/4":1,"B234568/S458/I1/5":1,"N1/B23468/S146/I5/12":1,"N19/B248/S457/I1/6":1,"N30/B24/S23/I1/7":1,"N30/B24/S23/I1/9":1,"N30/B24/S23/I1/10":1,"N30/B24/S23/I1/11":1,"N33/B23/S3/I/11":1,"N42/B234/S345/I1/10":1,"N47/B2/S25/I/11":1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}static kt(){let t=Math.floor(10*Math.random())+3,e=Math.floor(5*Math.random()*t),n=Math.floor(e/t)%5;var r=8;[1,2].includes(n)?r=4:3==n?r=3:4==n&&(r=5);let s=R.Nt(3,r),i=R.Nt(2,r),a=R.Nt(1,r);return a=a.filter((t=>!s.includes(t)&&!i.includes(t)&&2!=t)),`N${e}/B2${s.join("")}/S${i.join("")}/I${a.join("")}/${t}`}static Nt(t,e){let n=[];for(let r=t;r<=e;r++)Math.random()<.5&&n.push(r);return n}T(){return{random:{Y:1,mask:null}}}}class C extends I{constructor(){super("B24/S34/I15678/4"),this.U=0}P(){return"FS"}T(){let t=.2;return{random:{Y:20,mask:null},Bt:{Y:1,mask:w.B([[1,1],[1,1]])},It:{Y:t,mask:w.B([[1,1]])},Rt:{Y:1,mask:w.B([[1,0],[1,1]])},Ct:{Y:t,mask:w.B([[1,1],[2,2]])},yt:{Y:1,mask:w.B([[0,1,0],[1,1,1],[0,1,0]])},xt:{Y:1,mask:w.B([[1,0,1],[0,0,0],[1,0,1]])},Ft:{Y:t,mask:w.B([[1,0,0],[1,1,0],[0,1,1]])},At:{Y:t,mask:w.B([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},Pt:{Y:1,mask:w.B([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Gt:{Y:1,mask:w.B([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Tt:{Y:1,mask:w.B([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Vt:{Y:t,mask:w.B([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Et:{Y:t,mask:w.B([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Ut:{Y:t,mask:w.B([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class y extends I{constructor(){super("B2/S245678/I1/4"),this.U=0}P(){return"SS"}T(){let t=.2;return{random:{Y:10,mask:null},Bt:{Y:1,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},It:{Y:t,mask:w.B([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Ct:{Y:t,mask:w.B([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},Ft:{Y:t,mask:w.B([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},At:{Y:t,mask:w.B([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Vt:{Y:t,mask:w.B([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},Et:{Y:t,mask:w.B([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},Pt:{Y:1,mask:w.B([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Ut:{Y:t,mask:w.B([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},Xt:{Y:t,mask:w.B([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Gt:{Y:1,mask:w.B([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},Yt:{Y:1,mask:w.B([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Wt:{Y:1,mask:w.B([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class x extends S{constructor(){super(),this.F=4,this.U=.4}A(t,e,n,r){var s=t%4,i=n[0][0]+n[0][2];return 1!=s&&3!=s||!(i<2||i>3)?1!=s&&3!=s||2!=i&&3!=i?0!=s&&2!=s||3!=i?2==s&&(e=0):e=3:e=1:e=2,e}T(){return{Ot:{Y:1,mask:null}}}P(){return"CW"}}class F extends v{constructor(t,e,n,r,s){super(),this.$t=e,this.Ht=t,this.F=this.$t,this.Lt=n,this.jt=r,this.Dt=s}A(t,e,n,r){e=0;for(let s=0;s<this.Ht.length;s++)if(this.Ht[s].test(n,t,r)){e=(s+1)%this.$t;break}return e}P(){return this.Ht.map((t=>t.name())).join("||")}static zt(e=null,n=null,r=null,s=4,i=4,a=null){var o=[];null==e&&(e=Math.floor(8*Math.random())+2),null==r&&(r=t(f)()),null==a&&(a=this.qt());for(let t=0;t<e;t++)o.push(b.v(n,s,r,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+r+": "+o.map((t=>t.name())).join(", ")),new F(o,i,n,r,a)}static qt(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Zt(t,e=4){var n=t.split("||").map((t=>b.p(t)));return new F(n,e,null,r,null)}Jt(t=null){var e,n=this.Ht.length;null==t&&(t=this.Lt),0==(e=2==n?Math.floor(2*Math.random())+1:10==n?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.Kt():1==e?this.Qt(t):this._t(t)}_t(t){var e=this.Ht.slice();e.push(b.v(t,4,this.jt,this.Dt)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.jt+": "+e.map((t=>t.name())).join("||")),this.Ht=e}Kt(){var t=this.Ht.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.Ht=t}Qt(t){var e=this.Ht.slice(),n=Math.floor(Math.random()*e.length);e[n]=b.v(t,4,this.jt,this.Dt),console.log((new Date).toLocaleTimeString()+" Changing condition "+n+" to "+this.jt+": "+e.map((t=>t.name())).join("||")),this.Ht=e}}const A="gr",P="safe",G="mix",T="general",V="test";class E{te;ee;A;ne(){throw new Error("Must override method")}re(){return function(t,e,n,r){e=this.ee[0].A(t%this.ee[0].F,e,n,r);var s=this.ee[0].F;for(let i=1;i<this.ee.length;i++)e+=s*this.ee[i].A(Math.floor(t/s)%this.ee[i].F,e,n,r),e%=s*=this.ee[i].F;return e%s}}se(){throw new Error("Must override method")}P(){return this.ee.map((t=>t.P())).join("-")}}class U extends E{constructor(t){super(),this.ie=t,this.te=1,this.ee=this.ne(),this.A=this.re()}ne(){var t=[];return"Original"==this.ie?t.push(new N):"StarWars"==this.ie?t.push(new B):"Modified"==this.ie?t.push(new k):"Conway"==this.ie?t.push(new x):t.push(new I(this.ie)),t}se(){}}class X extends E{constructor(t,e,n=null){super(),this.ie=t,this.Lt=e,this.Dt=null,this.ae=null,null==e&&(t==P||t==A||t==V?this.Lt={0:1,1:0}:t==G?(Math.random()<.5?this.Lt={0:.8,1:.2}:this.Lt={0:1,1:0},this.Lt={0:.8,1:.2}):this.Lt={0:.5,1:.5}),t==A&&(this.Dt=1),this.te=4,this.ee=null==n?this.ne():this.oe(n),this.A=this.re()}ne(){var t=[],e=Math.random();return this.ie==A?t.push(new k):this.ie==P?e<.5?t.push(new R):e<.65?t.push(new k):e<.7?t.push(new N):e<.8?t.push(new B):e<.85?t.push(new y):e<.9?t.push(new C):t.push(new x):(e<.5?t.push(new R):e<.65?t.push(new k):e<.7?t.push(new N):e<.8?t.push(new B):e<.85?t.push(new y):e<.9?t.push(new C):t.push(new x),0==t.length&&t.push(new R)),t.push(F.zt(null,this.Lt,this.ae,t[0].F,4,this.Dt)),this.ie==V&&((t=[]).push(new R(!1)),this.te=1),t}se(){this.ee[1]&&"function"==typeof this.ee[1].Jt&&this.ee[1].Jt(this.Lt)}oe(t){var e=[],[n,r]=t.split("-");return"BB"==n?e.push(new k):"TBB"==n?e.push(new N):"SW"==n?e.push(new B):"SS"==n?e.push(new y):"FS"==n?e.push(new C):"CW"==n?e.push(new x):e.push(new I(n)),e.push(F.Zt(r)),e}}class Y extends E{constructor(t,e,n=null){super(),this.ie=t,this.Lt=e,this.Dt=null,this.ae=null,null==e&&(t==P?this.Lt={0:1,1:0}:t==G?(Math.random()<.5?this.Lt={0:.8,1:.2}:this.Lt={0:1,1:0},this.Lt={0:.8,1:.2}):this.Lt={0:.5,1:.5}),this.te=16,this.ee=null==n?this.ne():this.oe(n),this.A=this.re()}ne(){var t=[];return t.push(new k),t.push(F.zt(null,this.Lt,this.ae,4,4,this.u)),t.push(F.zt(null,this.Lt,this.ae,16,4,this.u)),t}se(){this.ee[1].Jt(this.Lt),this.ee[2].Jt(this.Lt)}oe(t){var e=[],n=t.split("-")[1];return e.push(new k),e.push(F.Zt(n)),e}}function W(t,e=!1){Math.random()<Math.exp(t.he)||e||t.ue?("VariableGR"==t.le?(t.ce=new X(A),t.me=new X(A)):"VariableDemo"==t.le?t.ce=new X(A):"Variable"==t.le?t.ce=new X(P):"VariableMix"==t.le?t.ce=new X(G):"VariableUnsafe"==t.le?t.ce=new X(T):"VariableTest"==t.le?t.ce=new X(V):"Variable2Unsafe"==t.le?t.ce=new Y(T):"CustomRule"==t.le?t.ce=new X(null,null,t.fe):"OriginalBB"==t.le?t.ce=new U("Original"):"ModifiedBB"==t.le?t.ce=new U("Modified"):"StarWars"==t.le?t.ce=new U("StarWars"):"Conway"==t.le?t.ce=new U("Conway"):"SparseFourStates"==t.le?t.ce=new U("B378/S124567/4"):t.ce=new X(G),t.he=-25,t.de=-25,t.ue=!1,O(t)):(Math.random()<Math.exp(t.de)||t.Me)&&"CustomRule"!=t.le&&(t.ce.se(),"VariableGR"==t.le&&t.me.se(),t.de=-25,t.Me=!1,O(t));let n=Math.max(t.ge/200,1);t.he=t.he+t.pe*n,t.he>0&&(t.he=0),t.de=t.de+t.be*n,t.de>0&&(t.de=0)}function O(t){var e=document.getElementById("currentStyle");e&&(e.value=t.ce.P())}function $(t){let e={};for(let n in t){if("t"==n)continue;let r=Math.floor(3*Math.random())-1,s=t[n]+r;s=Math.max(0,Math.min(255,s)),e[n]=s}return e.we=t.we,e}function H(t){var e={r:247,g:255,b:28,we:255},n={r:13,g:112,b:255,we:255},r={r:240,g:239,b:239,we:255},s={r:0,g:0,b:0,we:255},i={r:240,g:240,b:240,we:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),we:255},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),we:255};"yellow"==t.ve?(t.backgroundColor=e,t.Se=s,t.ke=n,t.Ne=r):"blue"==t.ve?(t.backgroundColor=n,t.Se=r,t.ke=s,t.Ne=e):"blue2"==t.ve?(t.backgroundColor=n,t.Se=e,t.ke=s,t.Ne=r):"grey"==t.ve?(t.backgroundColor=r,t.Se=s,t.ke=n,t.Ne=e):"grey2"==t.ve?(t.backgroundColor=r,t.Se=e,t.ke=s,t.Ne=n):"black"==t.ve?(t.backgroundColor=s,t.Se=n,t.ke=e,t.Ne=r):"black2"==t.ve?(t.backgroundColor=s,t.Se=n,t.ke=r,t.Ne=e):"blackTrace"==t.ve?(t.backgroundColor=s,t.Se=r,t.ke=s,t.Ne=r):"blackTrace2"==t.ve?(t.backgroundColor=s,t.Se=s,t.ke=s,t.Ne=r):"blackTrace3"==t.ve?(t.backgroundColor=s,t.Se=s,t.ke=r,t.Ne=r):"redblue"==t.ve?(t.backgroundColor=s,t.Se=i,t.ke={r:221,g:85,b:12,we:255},t.Ne={r:49,g:130,b:189,we:255}):"variable"==t.ve?(t.backgroundColor=s,t.Se=i,t.ke=a,t.Ne=o):"mouseAnimation"==t.ve&&(t.backgroundColor={r:0,g:0,b:0,we:0},t.Se=n,t.ke=s,t.Ne=e)}function L(t,e,n,r,s){let i=(e+r+t.Be)%t.Be,a=(n+s+t.Ie)%t.Ie,o=i,h=a;return(i-e-r>0||i-e-r<0)&&(h=(t.Ie-a-t.Re+t.Ie)%t.Ie),(a-n-s>0||a-n-s<0)&&(o=(t.Be-i-t.Ce+t.Be)%t.Be),[o,h]}function j(t,e,n,r,s){let i=(e+r+t.Be)%t.Be,a=(n+s+t.Ie)%t.Ie,o=i,h=a;return(i-e-r>0||i-e-r<0)&&(h=(t.Ie-a-t.Re+t.Ie)%t.Ie),a-n-s>0?o=(i+t.Ce+t.Be)%t.Be:a-n-s<0&&(o=(i-t.Ce+t.Be)%t.Be),[o,h]}function D(t,e,n,r,s){let i=(e+r+t.Be)%t.Be,a=(n+s+t.Ie)%t.Ie,o=i,h=a;return i-e-r>0?h=(a+t.Re+t.Ie)%t.Ie:i-e-r<0&&(h=(a-t.Re+t.Ie)%t.Ie),(a-n-s>0||a-n-s<0)&&(o=(t.Be-i-t.Ce+t.Be)%t.Be),[o,h]}function z(t,e,n,r,s){let i=(e+r+t.Be)%t.Be,a=(n+s+t.Ie)%t.Ie,o=i,h=a;return i-e-r>0?h=(a+t.Re+t.Ie)%t.Ie:i-e-r<0&&(h=(a-t.Re+t.Ie)%t.Ie),a-n-s>0?o=(i+t.Ce+t.Be)%t.Be:a-n-s<0&&(o=(i-t.Ce+t.Be)%t.Be),[o,h]}function q(t){t.ye&&t.xe?t.t=L:t.ye?t.t=j:t.xe?t.t=D:t.t=z}function Z(t){W(t,!0)}function J(t,e){if(t.Fe){var n=t.ce.ee[0].P(),r=new Blob([n],{type:"text/plain"}),s=URL.createObjectURL(r),i=document.createElement("a");i.href=s,i.download="dataAutomata.txt",i.click()}}function K(t,e,n){var r=function(t){var e=Math.exp(-t),n=1,r=0;do{r++,n*=Math.random()}while(n>e);return r-1}(10**(t.Ae+t.ce.ee[0].U));if(0!=r)for(var s=t.ce.ee[0].W,i=t.ce.ee[0].X,a=0;a<r;a++){var o=Math.floor(Math.random()*t.Be),h=Math.floor(Math.random()*t.Ie);Q(e,t,i[s()],o,h,n)}}function Q(t,e,n,r,s,i){null===n?n=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?rt(t,t):e<.2?tt(t,t):e<.3?_(t,t):e<.4?function(t){let e=new w(t,t);for(let n=0;n<t;n++)for(let r=n;r<t;r++)e.set(n,r,Math.floor(1e5*Math.random())),e.set(r,n,e.get(n,r));return e}(t):e<.5?function(t){let e=new w(t,t);for(let n=0;n<t;n++)for(let r=n;r<t;r++)e.set(n,r,Math.floor(1e5*Math.random())),e.set(t-1-r,t-1-n,e.get(n,r));return e}(t):e<.6?et(t,t):e<.7?nt(t,t):e<.8?function(t){let e=new w(t,t);for(let n=0;n<t;n++)for(let r=Math.max(n,t-n);r<t;r++)e.set(n,r,Math.floor(1e5*Math.random())),e.set(r,n,e.get(n,r)),e.set(t-1-r,t-1-n,e.get(n,r)),e.set(t-1-n,t-1-r,e.get(n,r));return e}(t):e<.9?function(t){let e=new w(t,t);for(let n=0;n<Math.ceil(t/2);n++)for(let r=0;r<Math.ceil(t/2);r++)e.set(n,r,Math.floor(1e5*Math.random())),e.set(r,t-1-n,e.get(n,r)),e.set(t-1-n,t-1-r,e.get(n,r)),e.set(t-1-r,n,e.get(n,r));return e}(t):function(t){let e=new w(t,t);for(let n=0;n<Math.ceil(t/2);n++)for(let r=0;r<Math.ceil(t/2);r++)e.set(n,r,Math.floor(1e5*Math.random())),e.set(r,t-1-n,e.get(n,r)),e.set(t-1-n,t-1-r,e.get(n,r)),e.set(t-1-r,n,e.get(n,r)),e.set(t-1-n,r,e.get(n,r)),e.set(t-1-r,t-1-n,e.get(n,r)),e.set(n,t-1-r,e.get(n,r)),e.set(r,n,e.get(n,r));return e}(t)}(e);else{t=function(t,e){let n=Math.random();return n<.2?rt(t,e):n<.4?tt(t,e):n<.6?_(t,e):n<.8?et(t,e):nt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&n.I(),Math.random()<.5&&n.flipX(),Math.random()<.75&&n.flipY());let a=n.height,o=n.width;for(let h=0;h<a;h++)for(let u=0;u<o;u++){let l=i(e,r,s,h-Math.floor(a/2),u-Math.floor(o/2));t.set(l[0],l[1],n.get(h,u))}}function _(t,e){let n=new w(e,t);for(let r=0;r<t;r++)for(let t=0;t<Math.ceil(e/2);t++)n.set(r,t,Math.floor(1e5*Math.random())),n.set(r,e-1-t,n.get(r,t));return n}function tt(t,e){let n=new w(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let s=0;s<e;s++)n.set(r,s,Math.floor(1e5*Math.random())),n.set(t-1-r,s,n.get(r,s));return n}function et(t,e){let n=new w(e,t);for(let r=0;r<t;r++)for(let s=0;s<Math.ceil(e/2);s++)n.set(r,s,Math.floor(1e5*Math.random())),n.set(t-1-r,e-1-s,n.get(r,s));return n}function nt(t,e){let n=new w(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let s=0;s<Math.ceil(e/2);s++)n.set(r,s,Math.floor(1e5*Math.random())),n.set(t-1-r,s,n.get(r,s)),n.set(r,e-1-s,n.get(r,s)),n.set(t-1-r,e-1-s,n.get(r,s));return n}function rt(t,e){let n=new w(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,Math.floor(1e5*Math.random()));return n}function st(t){!function(t){let e=t.Pe,n=t.Ge;for(var r=0,s=0,i=0;i<t.Be;i++)for(var a=0;a<t.Ie;a++){if(0==t.Te.get(i,a))continue;r+=1;var o=Math.floor(t.grid.get(i,a)/t.ce.te)%4;let e;if(0==o)e=t.backgroundColor;else if(1==o)e=t.Se;else if(2==o)e=t.ke;else{if(3!=o)continue;e=t.Ne}let h=4*(i*t.Ie+a);s+=Math.sqrt((n.data[h+0]-e.r)**2+(n.data[h+1]-e.g)**2+(n.data[h+2]-e.b)**2),n.data[h+0]=e.r,n.data[h+1]=e.g,n.data[h+2]=e.b,n.data[h+3]=e.we}t.Ve=.01*r+.99*t.Ve,t.ge=.01*s/(r+t.Be*t.Ie/30)+.99*t.ge,t.ge>330&&(t.ue=!0,t.Ve,t.Be,t.Ie,console.log("Changing rule because suspected oscillation (std of color change: "+t.ge.toFixed(1)+")."),t.Ve=15,t.ge=10,J(t));t.Ve<3&&(t.ue=!0,console.log("Changing rule because not enough cells changed ("+t.Ve+")."),t.Ve=20,J(t)),e.putImageData(n,t.Ee,t.Ue)}(t),function(t){var r=[new Uint8Array(e[0]*t.ce.ee[0].F).fill(0),new Uint8Array(e[1]).fill(0)],s=new Uint8Array(5).fill(0),i=new w(t.Ie,t.Be),a=t.grid;const o=t.time,h=t.ce.ee[0].F;for(var u=0;u<t.Be;u++)for(var l=0;l<t.Ie;l++){var c=n(t,u,l,a,r,s,o,h,4);const e=t.grid.get(u,l);var m=e;m="VariableGR"!=t.le||0==t.mask.get(u,l)?t.ce.A(e,m,c,t.time):t.me.A(e,m,c,t.time),Math.floor(m/t.ce.te)%4!=Math.floor(e/t.ce.te)%4?t.Te.set(u,l,1):t.Te.set(u,l,0),i.set(u,l,m);for(let t=0;t<r.length;t++)r[t].fill(0);s.fill(0)}t.Xe&&K(t,i,t.t),t.grid=i}(t),W(t),t.time=(t.time+1)%166320,t.Ye&&function(t){Math.random()<1e-4&&(t.Re=Math.floor(Math.random()*t.Ie),console.log("Periodicity shift X: "+t.Re)),Math.random()<1e-4&&(t.Ce=Math.floor(Math.random()*t.Be),console.log("Periodicity shift Y: "+t.Ce)),Math.random()<1e-4&&(t.ye=!t.ye,q(t),console.log("Flip X: "+t.ye)),Math.random()<1e-4&&(t.xe=!t.xe,q(t),console.log("Flip Y: "+t.xe))}(t),"variable"==t.ve&&function(t){Math.random()<1&&(t.Ne=$(t.Ne),t.ke=$(t.ke))}(t),setTimeout((function(){requestAnimationFrame((()=>st(t)))}),t.timeout)}function it(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const r=new Image;r.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const s=e.getContext("2d");s.drawImage(r,0,0,r.width,r.height);const i=s.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<r.height;t++){const e=[];for(let n=0;n<r.width;n++){const s=4*(t*r.width+n),a=(i[s]+i[s+1]+i[s+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},r.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},r.src=n}))).then((e=>{new w(t.Ie,t.Be);const n=new w(t.Ie,t.Be),r=e[0].length/t.Ie,s=e.length/t.Be,i=Math.max(r,s),a=Math.floor((t.Ie-e[0].length/i)/2),o=Math.floor((t.Be-e.length/i)/2);for(let r=0;r<t.Be;r++)for(let s=0;s<t.Ie;s++){if(r<o||(r-o)*i>=e.length){n.set(r,s,1);continue}let t=Math.floor((s-a)*i);0===e[Math.floor((r-o)*i)][t]?n.set(r,s,0):n.set(r,s,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new w(t.Ie,t.Be)}));var n}async function at(t,e){if("VariableGR"==t.le&&await it(t),"zero"!=t.We)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new w(t.Ie,t.Be),t.Te=new w(t.Ie,t.Be);for(var n=0;n<t.Be;n++)for(var r=0;r<t.Ie;r++)if("gr"!=t.We||1!==t.mask.get(n,r)){for(var s=Math.random(),i=0;i<e;i++)if(s<(i+1)/(e+1)){t.grid.set(n,r,i);break}t.Te.set(n,r,1)}else t.grid.set(n,r,0)}))}(t);t.grid=new Grid(t.Ie,t.Be),t.Te=new Grid(t.Ie,t.Be)}function ot(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){var e=document.getElementById("userGridHeight").value,n=document.getElementById("userGridWidth").value,r=document.getElementById("userTimeout").value,s=document.getElementById("userXShift"),i=s?s.value:t.Oe,a=document.getElementById("userYShift"),o=a?a.value:t.$e,h=document.getElementById("userFlipX"),u=h?h.checked:t.He,l=document.getElementById("userFlipY"),c=l?l.checked:t.Le,m=document.getElementById("randomnessCheckbox"),f=m?m.checked:t.Xe,d=document.getElementById("randomnessSlider"),M=d?parseFloat(d.value):t.Ae,g=document.getElementById("userColorPalette").value,p=document.getElementById("metaRule").value,b=null;document.getElementById("currentStyle")&&(b=document.getElementById("currentStyle").value),localStorage.setItem("userGridHeight",e),localStorage.setItem("userGridWidth",n),localStorage.setItem("userTimeout",r),localStorage.setItem("userXShift",i),localStorage.setItem("userYShift",o),localStorage.setItem("userFlipX",u),localStorage.setItem("userFlipY",c),localStorage.setItem("userColorPalette",g),localStorage.setItem("userRandomnessOn",f),localStorage.setItem("userRandomnessAmount",M),localStorage.setItem("metaRule",p),localStorage.setItem("currentStyle",b),location.reload()}(t)}))}function ht(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.Ae=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var ut=document.getElementById("gameCanvas"),lt=ut.getContext("2d"),ct=192,mt=192,ft=30,dt=!0,Mt=-1.5,gt=!0,pt=0,bt=0,wt=!1,vt=!1,St="variable",kt="Variable",Nt="random",Bt=8,It=2e4,Rt=2e3,Ct=new class{constructor(t,e,n=200,r=200,s=20,i=!0,a=-2,o=!0,h=0,u=0,l=!1,c=!1,m="black2",f="VariableGR",d="random",M=6,g=2e4,p=2e3){this.Be=n,this.Ie=r,this.Ee=0,this.Ue=0,this.timeout=s,this.grid=null,this.Te=null,this.Ge=null,this.canvas=t,this.Pe=e,this.Xe=i,this.Ae=a,this.Ye=o,this.Re=h,this.Ce=u,this.ye=l,this.xe=c,this.ve=m,this.le=f,this.We=d,this.je=M,this.De=null,this.ze=null,this.t=null,this.mask=null,this.qe=g,this.Ze=p,this.he=-25,this.de=-25,this.pe=25/this.qe,this.be=25/this.Ze,this.canvas.width=this.Ie,this.canvas.height=this.Be,this.Ge=e.createImageData(t.width,t.height),this.ue=!0,this.Me=!1,this.Ve=0,this.ge=0,this.Fe=!1,this.time=0}}(ut,lt,ct,mt,ft,dt,Mt,gt,pt,bt,wt,vt,St,kt,Nt,Bt,It,Rt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.Xe=this.checked}))}(Ct),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(Ct),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,s=e.clientY-n.top,i=n.width/t.Ie,a=n.height/t.Be,o=Math.floor(r/i),h=Math.floor(s/a);t.grid.set(h,o,1)}}))}(Ct),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,s=e.clientY-n.top,i=n.width/t.Ie,a=n.height/t.Be,o=Math.floor(r/i),h=Math.floor(s/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(h,(o+1)%t.Ie,1),t.grid.set(h,o,1),t.grid.set((h+1)%t.Be,o,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(h,o,1),t.grid.set((h+1)%t.Be,o,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(h,o,1),t.grid.set(h,(o+1)%t.Ie,1)):(t.grid.set((h+1)%t.Be,(o+1)%t.Ie,1),t.grid.set((h-1+t.Be)%t.Be,(o+1)%t.Ie,1),t.grid.set((h-1+t.Be)%t.Be,(o-1+t.Ie)%t.Ie,1),t.grid.set((h+1)%t.Be,(o-1+t.Ie)%t.Ie,1))}))}(Ct),ot(Ct),ht(Ct),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.Re=e,q(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.Ce=e,q(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.ye=this.checked,q(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.xe=this.checked,q(t)}))}(Ct),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(Ct),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.ve=this.value,H(t)}))}(Ct),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.le=this.value,Z(t)}))}(Ct),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.ue=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.Me=!0}))}(Ct),function(t){document.getElementById("changeColor").addEventListener("click",(function(){H(t)}))}(Ct),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.Fe=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){J(t)})),document.getElementById("dislikeButton").addEventListener("click",(function(){J(t)}))}(Ct),function(t){null!==localStorage.getItem("userGridHeight")?(t.Be=parseInt(localStorage.getItem("userGridHeight")),t.Ie=parseInt(localStorage.getItem("userGridWidth")),t.Be>1e3&&(t.Be=1e3),t.Ie>1e3&&(t.Ie=1e3),t.Ge=t.Pe.createImageData(t.Ie,t.Be),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.Re=parseInt(localStorage.getItem("userXShift")),isNaN(t.Re)&&(t.Re=0),isNaN(t.Ce)&&(t.Ce=0),t.Ce=parseInt(localStorage.getItem("userYShift")),t.ye="true"===localStorage.getItem("userFlipX"),t.xe="true"===localStorage.getItem("userFlipY"),t.ve=localStorage.getItem("userColorPalette"),t.Xe="true"===localStorage.getItem("userRandomnessOn"),t.Ae=parseFloat(localStorage.getItem("userRandomnessAmount")),t.le=localStorage.getItem("metaRule"),t.fe=localStorage.getItem("currentStyle"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.Be,document.getElementById("userGridWidth").value=t.Ie,document.getElementById("userTimeout").value=t.timeout;let e=document.getElementById("userXShift");e&&(e.value=t.Re);let n=document.getElementById("userYShift");n&&(n.value=t.Ce);let r=document.getElementById("userFlipX");r&&(r.checked=t.ye);let s=document.getElementById("userFlipY");s&&(s.checked=t.xe);let i=document.getElementById("randomnessCheckbox");i&&(i.checked=t.Xe);let a=document.getElementById("randomnessSlider");a&&(a.value=t.Ae),document.getElementById("userColorPalette").value=t.ve,document.getElementById("metaRule").value=t.le,t.canvas.width=Math.max(t.Be,t.Ie),t.canvas.height=Math.max(t.Be,t.Ie),t.Ee=0,t.Ue=0;var o=document.getElementById("gameCanvas");if(t.Be>t.Ie){var h=Math.floor(t.Ie/t.Be*800);o.style.width=h+"px",o.style.height="800px",o.width=h*t.Be/800,o.height=t.Be}else{var u=Math.floor(t.Be/t.Ie*800);o.style.width="800px",o.style.height=u+"px",o.width=t.Ie,o.height=u*t.Ie/800}}(Ct),H(Ct),q(Ct),Z(Ct);let t=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==t&&""!==window.location.hostname||at(Ct).then((()=>{st(Ct)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
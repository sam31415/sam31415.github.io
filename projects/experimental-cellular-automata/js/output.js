(()=>{"use strict";function t(t){return"Cond"==t?function(t){return 0==t}:"Abs"==t?function(t){return t%4==0}:function(t){return!0}}class e{constructor(e,n,a,r){this.type=e,this.threshold=n,this.t=a,this.o=r,this.i=t(this.o),this.u=function(t,e,n){return"Eq"==e?function(e){return e[n]==t}:"Bigger"==e?function(e){return e[n]>t}:void 0}(this.threshold,this.type,this.t)}test(t,e){return this.u(t)&&this.i(e)}name(){return`${this.type}${this.threshold}${this.o}NT${this.t}`}static l(t=null){const n=["Eq","Bigger"],a=n[Math.floor(Math.random()*n.length)];var r=0;r="Eq"===a?Math.floor(8*Math.random())+1:Math.floor(9*Math.random());const o=["Cond","Abs","None"],i=o[Math.floor(Math.random()*o.length)];return null===t&&(t=Math.floor(8*Math.random())),new e(a,r,t,i)}}function n(t,e,n){return 1==t||3==t?e=2:2==t?e=0:0==t&&2==n?e=1:0==t&&n>2&&(e=3),e}function a(t,e,a){var r=a[0];a[1],a[2];e=n(t%4,e,r);Math.floor(t/4);return r>1&&(e=(e+4)%8),e}function r(t,e,a){var r=a[0];a[1],a[2];e=n(t%4,e,r);Math.floor(t/4);return r>3?e=(e+4)%16:3==r?e=(e+12)%16:2==r&&(e=(e+8)%16),e}function o(t,e,a){var r=a[0],o=a[1];a[2];e=n(t%4,e,r);var i=Math.floor(t/4);return 0==i&&o>3?e=(e+4)%16:0==i&&3==r?e=(e+12)%16:0==i&&2==r&&(e=(e+8)%16),e}function i(t,e,a){var r=a[0],o=a[1];a[2];e=n(t%4,e,r);var i=Math.floor(t/4);return 0==i&&o<1?e=(e+4)%16:0==i&&3==r?e=(e+12)%16:0==i&&2==r&&(e=(e+8)%16),e}function u(t,e,n){var a=n[0],r=n[1];n[2];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&r<1||t%4==0&&1==a)&&(e=3):e=1,e}function l(t,e,n){var a=n[0],r=n[1];n[2];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&r<1||t%4==0&&2==a)&&(e=3):e=1,e}function s(t,e,n){var a=n[0],r=n[1];n[2];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&r<1||t%4==0&&3==a)&&(e=3):e=1,e}function c(t,e,n){var a=n[0],r=n[1],o=n[2];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&r<1||t%4==0&&3==o)&&(e=3):e=1,e}function h(t,e,n){var a=n[0],r=n[1],o=n[2];return 1==t?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&r<3||t%4==0&&3==o)&&(e=3):e=1,e}function f(t,e,n){var a=n[0],r=n[2];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&a>2||t%4==0&&3==r)&&(e=3):e=1,e}function M(t,e,n){var a=n[0],r=n[2];return 1==t?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&a>2||t%4==0&&1==r)&&(e=3):e=1,e}function d(t,e,n){var a=n[0],r=n[1];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&a>2||t%4==0&&3==r)&&(e=3):e=1,e}function m(t,e,n){var a=n[0],r=n[1];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0&&a>2||t%4==0&&1==r)&&(e=3):e=1,e}function g(t,e,n){var a=n[0];return t%4==1?e=2:t%4==2?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0||t%4==3)&&a>2&&(e=3):e=1,e}function v(t,e,n){var a=n[0];return t%4==1?e=2:t%4==2||t%4==3?e=0:t%4!=0&&t%4!=3||2!=a?(t%4==0||t%4==3)&&a>2&&(e=3):e=1,e}function b(t,e,n){var a=n[0];return t%4==1||t%4==3?e=2:t%4==2?e=0:t%4==0&&2==a?e=1:t%4==0&&a>2&&(e=3),e}function S(t,e,n){var a=n[1];return(t%4==1||t%4==3)&&a<2?e=2:t%4!=1&&t%4!=3||2!=a&&3!=a?(t%4==1||t%4==3)&&a>5?e=2:t%4!=0&&t%4!=2||3!=a?t%4==2&&(e=0):e=3:e=1,e}function p(t,e,n){var a=n[0];return 2==t?e=0:1!=t&&3!=t||1!=a?(1==t||3==t)&&a>3?e=2:0!=t&&2!=t||4!=a||(e=1):e=1,e}function C(t,e,n){var a=n[0];return 2==t?e=0:1!=t&&3!=t||2!=a?(1==t||3==t)&&a>4?e=2:0!=t&&2!=t||4!=a||(e=1):e=1,e}function y(t){const[e,n]=t.split("S");return[e.slice(1).split("").map(Number),n.split("").map(Number)]}function B(t){const[e,n]=y(t);return function(t,a,r){return t%4==1||t%4==3?a=n.includes(r)?1:2:t%4!=0&&t%4!=2||e.includes(r)&&(a=3),a}}function T(t,e=null){const[n,a]=y(t);return null==e?function(t,e,r){return t%4==1||t%4==3?e=a.includes(r)?1:2:t%4==2?e=0:t%4==0&&n.includes(r)&&(e=3),e}:function(t,r,o){return o=o[e],t%4==1||t%4==3?r=a.includes(o)?1:2:t%4==2?r=0:t%4==0&&n.includes(o)&&(r=3),r}}var k=["B3S1234"];function R(t=!1,e=!1){var n,a,r,o,i;if(e){var u=Math.floor(Math.random()*k.length);n=k[u]}else a=w(1,8),r=w(1,8),o=a.join(""),i=r.join(""),n="B"+o+"S"+i;return t?[n+"D",T(n)]:[n,B(n)]}function w(t,e){for(var n=[],a=t;a<=e;a++)Math.random()<.5&&n.push(a);return n}function V(t=4,a=0,r=!1,o=!0){var i,u,l=n,s=Math.random()<.5;[i,u]=R(s,r);var c=4*(Math.floor(12*Math.random())+4),h=Math.random()<a,f=null;o&&(f=Math.floor(3*Math.random()));var M=[];for(let n=0;n<t-1;n++)M.push(e.l(f));return{h:"BBRuleNoZero",M:l,m:i,v:u,S:h,p:c,C:M}}function A(t,e,n=!1,a=!1,r=0,o=!1,i=!0){if(Math.random()<t.B||a){var u=V(e,r,o,i),l=function(t){var e=t.M,n=t.v,a=t.t,r=t.p,o=t.S,i=t.C;return function(t,u,l){u=e(t%4,u,l[0]),o&&(u=u%r+n(Math.floor(t/4)%4,u,l[a])%4*4);for(let e=0;e<i.length;e++)i[e].test(l,t)&&(u=(u+4*(e+1))%16);return u}}(u),s="Rule";n?(t.T=l,s="Auxiliary rule"):t.k=l,N(s,u,e),t.B=0,t.R=u}}function F(t,e,n=!1,a=!1,r=0,o=!1,i=!0){if(Math.random()<t.B||a){var u=V(e,r,o,i),l=function(t){var e=t.M,n=t.v,a=t.t,r=t.p,o=t.S,i=t.C;return function(t,u,l){u=e(t%4,u,l[0]),o&&(u=u%r+n(Math.floor(t/4)%4,u,l[a])%4*4);for(let e=0;e<i.length;e++)i[e].test(l,t)&&(u=(u+16*(e+1))%64);return u}}(u),s="Rule";n?(t.T=l,s="Auxiliary rule"):t.k=l,N(s,u,e),t.B=0,t.R=u}}function N(t,e,n){var a=e.C.map((t=>t.name())).join(" | ");console.log(t+" changed to:"),e.S&&console.log("  - "+e.m+" ntype "+e.t+" modulo "+e.p),console.log("  - "+n+" colors "+a)}function G(e,a=!1,r=!1){if(Math.random()<e.B||r){var o=Math.floor(Math.random()*ruleConditions.length),i=Math.floor(3*Math.random()),u=Math.floor(3*Math.random()),l=Math.floor(Math.random()*ruleConditions.length),s=Math.floor(3*Math.random()),c=Math.floor(3*Math.random()),h=Math.floor(Math.random()*ruleConditions.length),f=Math.floor(3*Math.random()),M=Math.floor(3*Math.random());o=Math.floor(Math.random()*ruleConditions.length),l=Math.floor(Math.random()*ruleConditions.length),h=Math.floor(Math.random()*ruleConditions.length);var d=ruleConditions[o],m=ruleConditions[l],g=ruleConditions[h],v=Math.floor(Math.random()*ruleConditions.length),b=Math.floor(4*Math.random())+3,S=Math.floor(3*Math.random()),p=Math.floor(Math.random()*ruleConditions.length),C=Math.floor(4*Math.random())+3,y=Math.floor(3*Math.random()),B=Math.floor(Math.random()*ruleConditions.length),T=Math.floor(4*Math.random())+3,k=Math.floor(3*Math.random());v=Math.floor(Math.random()*ruleConditions.length),p=Math.floor(Math.random()*ruleConditions.length),B=Math.floor(Math.random()*ruleConditions.length);var R=ruleConditions[v],w=ruleConditions[p],V=ruleConditions[B],A=0;"TertiaryFancySpcshp"==e.V&&(A=1);var F=function(e,a,r,o,i,u,l,s,c,h,f,M,d,m,g,v,b,S,p=0){return function(M,g,S){return g=n(M%4,g,S[0]),0==p&&(g%=16),1==p&&(g=g%4+16*Math.floor(g/16)),e(S[a])&&t(r)(M)?g=(g+4)%16:o(S[i])&&t(u)(M)?g=(g+8)%16:l(S[s])&&t(c)(M)&&(g=(g+12)%16),g%=16,h(S[f])?g=(g+16)%64:d(S[m])?g=(g+32)%64:v(S[b])&&(g=(g+48)%64),g}}(d,i,u,m,s,c,g,f,M,R,b,0,w,C,0,V,T,0,A),N="Rule";a?(e.T=F,N="Auxiliary rule"):e.k=F,console.log(N+"changed to rule ("+o+"-"+i+"-"+u+", "+l+"-"+s+"-"+c+", "+h+"-"+f+"-"+M+", "+v+"-"+b+"-"+S+", "+p+"-"+C+"-"+y+", "+B+"-"+T+"-"+k+")"),e.B=0}}function x(t){let e={};for(let n in t){let a=Math.floor(3*Math.random())-1,r=t[n]+a;r=Math.max(0,Math.min(255,r)),e[n]=r}return e}function X(t){var e={r:247,g:255,b:28},n={r:13,g:112,b:255},a={r:240,g:239,b:239},r={r:0,g:0,b:0},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},i={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};"yellow"==t.A?(t.backgroundColor=e,t.F=r,t.N=n,t.G=a):"blue"==t.A?(t.backgroundColor=n,t.F=a,t.N=r,t.G=e):"blue2"==t.A?(t.backgroundColor=n,t.F=e,t.N=r,t.G=a):"grey"==t.A?(t.backgroundColor=a,t.F=r,t.N=n,t.G=e):"grey2"==t.A?(t.backgroundColor=a,t.F=e,t.N=r,t.G=n):"black"==t.A?(t.backgroundColor=r,t.F=n,t.N=e,t.G=a):"black2"==t.A?(t.backgroundColor=r,t.F=n,t.N=a,t.G=e):"blackTrace"==t.A?(t.backgroundColor=r,t.F=a,t.N=r,t.G=a):"blackTrace2"==t.A?(t.backgroundColor=r,t.F=r,t.N=r,t.G=a):"blackTrace3"==t.A?(t.backgroundColor=r,t.F=r,t.N=a,t.G=a):"variable"==t.A&&(t.backgroundColor=r,t.F={r:240,g:240,b:240},t.N=o,t.G=i)}function Y(t,e,n,a,r){let o=(e+a+t.X)%t.X,i=(n+r+t.Y)%t.Y,u=o,l=i;return(o-e-a>0||o-e-a<0)&&(l=(t.Y-i-t.I+t.Y)%t.Y),(i-n-r>0||i-n-r<0)&&(u=(t.X-o-t.P+t.X)%t.X),[u,l]}function I(t,e,n,a,r){let o=(e+a+t.X)%t.X,i=(n+r+t.Y)%t.Y,u=o,l=i;return(o-e-a>0||o-e-a<0)&&(l=(t.Y-i-t.I+t.Y)%t.Y),i-n-r>0?u=(o+t.P+t.X)%t.X:i-n-r<0&&(u=(o-t.P+t.X)%t.X),[u,l]}function E(t,e,n,a,r){let o=(e+a+t.X)%t.X,i=(n+r+t.Y)%t.Y,u=o,l=i;return o-e-a>0?l=(i+t.I+t.Y)%t.Y:o-e-a<0&&(l=(i-t.I+t.Y)%t.Y),(i-n-r>0||i-n-r<0)&&(u=(t.X-o-t.P+t.X)%t.X),[u,l]}function P(t,e,n,a,r){let o=(e+a+t.X)%t.X,i=(n+r+t.Y)%t.Y,u=o,l=i;return o-e-a>0?l=(i+t.I+t.Y)%t.Y:o-e-a<0&&(l=(i-t.I+t.Y)%t.Y),i-n-r>0?u=(o+t.P+t.X)%t.X:i-n-r<0&&(u=(o-t.P+t.X)%t.X),[u,l]}function j(t){t.j&&t.O?t.q=Y:t.j?t.q=I:t.O?t.q=E:t.q=P}function O(t){if("Conway"==t.V)t.k=S;else if("BB"==t.V)t.k=v;else if("BBMod"==t.V)t.k=b;else if("BBTrace"==t.V)t.k=g;else if("BBTrace2"==t.V)t.k=m;else if("BBTrace3"==t.V)t.k=d;else if("BBTrace4"==t.V)t.k=M;else if("BBTrace5"==t.V)t.k=f;else if("BBTrace6"==t.V)t.k=h;else if("BBTrace7"==t.V)t.k=c;else if("BBTrace8"==t.V)t.k=s;else if("BBTrace9"==t.V)t.k=l;else if("BBTrace10"==t.V)t.k=u;else if("BBTraceSecondary1"==t.V)t.k=i;else if("BBTraceSecondary2"==t.V)t.k=o;else if("BBTraceSecondary3"==t.V)t.k=r;else if("Variable2Colors"==t.V)A(t,2,!1,!0);else if("Variable3Colors"==t.V)A(t,3,!1,!0);else if("Variable4Colors"==t.V)A(t,4,!1,!0);else if(["Variable","VariableUnsafe"].includes(t.V)){A(t,Math.floor(Math.random()*t.H)+2,!1,!0)}else if("VariableSecAutomata"==t.V){A(t,Math.floor(Math.random()*t.H)+2,!1,!0,1)}else if("TertiaryAutomata"==t.V){F(t,Math.floor(Math.random()*t.H)+2,!1,!0,1)}else if("TertiaryGood"==t.V){F(t,Math.floor(Math.random()*t.H)+2,!1,!0,.5,!0)}else if("Tertiary4Colors"==t.V||"TertiaryFancySpcshp"==t.V)G(t,!1,!0);else if("VariableGR"==t.V){A(t,Math.floor(Math.random()*t.H)+2,!1,!0),A(t,Math.floor(Math.random()*t.H)+2,!0,!0)}else"Stationary1"==t.V?t.k=p:"Stationary2"==t.V?t.k=C:"TestSecondary"==t.V&&(t.k=a)}function q(t,e){if(t.L){var n={...t.R};delete n.v,delete n.C;var a={...n,event:e},r=Object.keys(a).join(",")+"\n";r+=Object.values(a).join(",");var o=new Blob([r],{type:"text/csv"}),i=URL.createObjectURL(o),u=document.createElement("a");u.href=i,u.download="dataAutomata.csv",u.click()}}class H{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e),this.rows=new Array(e)}get(t,e){return this.data[t*this.width+e]}set(t,e,n){this.data[t*this.width+e]=n}}let L={U:{W:.1,mask:[[1,1],[1,1]]},$:{W:1,mask:[[1,0,1],[0,0,0],[1,0,1]]},D:{W:40,mask:null}},U=Object.keys(L).map((t=>L[t].mask)),W=Object.values(L).reduce(((t,e)=>t+e.W),0),$=Object.keys(L).map((t=>L[t].W/W)).reduce(((t,e,n)=>[...t,e+(t[n-1]||0)]),[]);function D(t,e,n,a,r){for(var o=function(t){var e=Math.exp(-t),n=1,a=0;do{a++,n*=Math.random()}while(n>e);return a-1}(10**t.Z),i=0;i<o;i++){e=Math.floor(Math.random()*t.X),n=Math.floor(Math.random()*t.Y);var u=Math.random();for(let o=0;o<U.length;o++)if(u<$[o]){Z(a,t,U[o],e,n,r);break}}return{J:e,K:n}}function Z(t,e,n,a,r,o){null===n&&(n=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,n=[];for(let a=0;a<t;a++){n.push([]);for(let t=0;t<e;t++)n[a].push(Math.floor(4*Math.random()))}return n}());let i=n.length,u=n[0].length;for(let l=0;l<i;l++)for(let s=0;s<u;s++){let c=o(e,a,r,l-Math.floor(i/2),s-Math.floor(u/2));t.set(c[0],c[1],n[l][s])}}function z(t){!function(t){let e=t._,n=t.tt;for(var a=0,r=0;r<t.X;r++)for(var o=0;o<t.Y;o++){if(0==t.et.get(r,o))continue;if(a+=1,2==t.nt)var i=Math.floor(t.grid.get(r,o)/4)%4;else i=3==t.nt?Math.floor(t.grid.get(r,o)/16)%4:t.grid.get(r,o)%4;let e;if(0==i)e=t.backgroundColor;else if(1==i)e=t.F;else if(2==i)e=t.N;else{if(3!=i)continue;e=t.G}let u=4*(r*t.Y+o);n.data[u+0]=e.r,n.data[u+1]=e.g,n.data[u+2]=e.b,n.data[u+3]=255}if(t.rt=1/300*a+299/300*t.rt,t.rt>.5*t.X*t.Y){t.ot=!0;var u=t.rt/(t.X*t.Y);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+u.toFixed(1)+")."),t.rt=15,q(t,"oscillation")}t.rt<3&&(t.ot=!0,console.log("Changing rule because not enough cells changed ("+t.rt+")."),t.rt=20,q(t,"blackout")),e.putImageData(n,t.it,t.ut)}(t),function(t){for(var e=new H(t.Y,t.X),n=0;n<t.X;n++)for(var a=0;a<t.Y;a++){for(var r=0,o=0,i=0,u=0,l=0,s=0,c=0,h=-1;h<=1;h++)for(var f=-1;f<=1;f++){if(0==h&&0==f)continue;let e=t.q(t,n,a,h,f),M=e[0],d=e[1];t.grid.get(M,d)%4==1?(r+=1,o+=1):t.grid.get(M,d)%4==2?i+=1:t.grid.get(M,d)%4==3&&(o+=1),0==Math.floor(t.grid.get(M,d)%16/4)?u+=1:1==Math.floor(t.grid.get(M,d)%16/4)?l+=1:2==Math.floor(t.grid.get(M,d)%16/4)?s+=1:3==Math.floor(t.grid.get(M,d)%16/4)&&(c+=1)}let m=t.grid.get(n,a);var M=m,d=[r,o,i,u,l,s,c,l+c];M="VariableGR"!=t.V||0==t.mask.get(n,a)?t.k(m,M,d):t.T(m,M,d),1==t.nt?M!=m?t.et.set(n,a,1):t.et.set(n,a,0):2==t.nt?Math.floor(M/4)%4!=Math.floor(m/4)%4?t.et.set(n,a,1):t.et.set(n,a,0):3==t.nt&&(Math.floor(M/16)!=Math.floor(m/16)?t.et.set(n,a,1):t.et.set(n,a,0)),e.set(n,a,M)}if(t.lt)var{J:n,K:a}=D(t,n,a,e,t.q);t.grid=e}(t),function(t){"Variable2Colors"==t.V?A(t,2,!1,t.ot):"Variable3Colors"==t.V?A(t,3,!1,t.ot):"Variable4Colors"==t.V?A(t,4,!1,t.ot):"Tertiary4Colors"==t.V||"TertiaryFancySpcshp"==t.V?G(t,t.ot):"VariableGR"==t.V?(A(t,Math.floor(Math.random()*t.H)+2,!1,t.ot),A(t,Math.floor(Math.random()*t.H)+2,!0,t.ot)):"Variable"==t.V?A(t,Math.floor(Math.random()*t.H)+2,!1,t.ot):"VariableUnsafe"==t.V?A(t,Math.floor(Math.random()*t.H)+2,!1,t.ot,0,!1,!1):"VariableSecAutomata"==t.V?A(t,Math.floor(Math.random()*t.H)+2,!1,t.ot,1):"TertiaryAutomata"==t.V?F(t,Math.floor(Math.random()*t.H)+2,!1,t.ot,1):"TertiaryGood"==t.V&&F(t,Math.floor(Math.random()*t.H)+2,!1,t.ot,.5,!0);t.B+=1/t.st**2,t.B>1&&(t.B=1),t.ot=!1}(t),t.V.includes("Variable")&&function(t){Math.random()<1e-4&&(t.I=Math.floor(Math.random()*t.Y),console.log("Periodicity shift X: "+t.I)),Math.random()<1e-4&&(t.P=Math.floor(Math.random()*t.X),console.log("Periodicity shift Y: "+t.P)),Math.random()<1e-4&&(t.j=!t.j,j(t),console.log("Flip X: "+t.j)),Math.random()<1e-4&&(t.O=!t.O,j(t),console.log("Flip Y: "+t.O))}(t),"variable"==t.A&&function(t){Math.random()<1&&(t.G=x(t.G),t.N=x(t.N))}(t),setTimeout((function(){requestAnimationFrame((()=>z(t)))}),t.timeout)}function J(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const a=new Image;a.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=a.width,e.height=a.height;const r=e.getContext("2d");r.drawImage(a,0,0,a.width,a.height);const o=r.getImageData(0,0,e.width,e.height).data,i=[];for(let t=0;t<a.height;t++){const e=[];for(let n=0;n<a.width;n++){const r=4*(t*a.width+n),i=(o[r]+o[r+1]+o[r+2])/3;e.push(i>128?1:0)}i.push(e)}t(i)},a.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},a.src=n}))).then((e=>{new H(t.Y,t.X);const n=new H(t.Y,t.X),a=e[0].length/t.Y,r=e.length/t.X,o=Math.max(a,r),i=Math.floor((t.Y-e[0].length/o)/2),u=Math.floor((t.X-e.length/o)/2);for(let a=0;a<t.X;a++)for(let r=0;r<t.Y;r++){if(a<u||(a-u)*o>=e.length){n.set(a,r,1);continue}let t=Math.floor((r-i)*o);0===e[Math.floor((a-u)*o)][t]?n.set(a,r,0):n.set(a,r,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new H(t.Y,t.X)}));var n}async function K(t,e){return await J(t),function(t,e=64){return Promise.resolve().then((()=>{t.grid=new H(t.Y,t.X),t.et=new H(t.Y,t.X);for(var n=0;n<t.X;n++)for(var a=0;a<t.Y;a++)if("gr"!=t.ct||1!==t.mask.get(n,a)){for(var r=Math.random(),o=0;o<e;o++)if(r<(o+1)/(e+1)){t.grid.set(n,a,o);break}t.et.set(n,a,1)}else t.grid.set(n,a,0)}))}(t)}function Q(t){return t.includes("Secondary")||t.includes("Variable")?2:t.includes("Tertiary")?3:1}function _(t){document.getElementById("submitButton").addEventListener("click",(function(){var t,e,n,a,r,o,i,u,l,s,c;t=document.getElementById("userGridHeight").value,e=document.getElementById("userGridWidth").value,n=document.getElementById("userTimeout").value,a=document.getElementById("userXShift").value,r=document.getElementById("userYShift").value,o=document.getElementById("userFlipX").checked,i=document.getElementById("userFlipY").checked,u=document.getElementById("userColorPalette").value,l=document.getElementById("randomnessCheckbox").checked,s=document.getElementById("randomnessSlider").value,c=document.getElementById("userRule").value,localStorage.setItem("userGridHeight",t),localStorage.setItem("userGridWidth",e),localStorage.setItem("userTimeout",n),localStorage.setItem("userXShift",a),localStorage.setItem("userYShift",r),localStorage.setItem("userFlipX",o),localStorage.setItem("userFlipY",i),localStorage.setItem("userColorPalette",u),localStorage.setItem("userRandomnessOn",l),localStorage.setItem("userRandomnessAmount",s),localStorage.setItem("userRule",c),location.reload()}))}function tt(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.Z=e,document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var et=document.getElementById("gameCanvas"),nt=et.getContext("2d"),at=200,rt=200,ot=30,it=!0,ut=-1.5,lt=0,st=0,ct=!1,ht=!1,ft="variable",Mt="VariableUnsafe",dt="random",mt=3,gt=8,vt=new class{constructor(t,e,n=200,a=200,r=20,o=!0,i=-2,u=0,l=0,s=!1,c=!1,h="black2",f="VariableGR",M="random",d=2,m=6,g=5e3){this.X=n,this.Y=a,this.it=0,this.ut=0,this.timeout=r,this.grid=null,this.et=null,this.tt=null,this.canvas=t,this._=e,this.lt=o,this.Z=i,this.I=u,this.P=l,this.j=s,this.O=c,this.A=h,this.V=f,this.ct=M,this.nt=d,this.H=m,this.k=null,this.T=null,this.q=null,this.mask=null,this.st=g,this.B=1/this.st,this.canvas.width=this.Y,this.canvas.height=this.X,this.tt=e.createImageData(t.width,t.height),this.ot=!0,this.rt=0,this.L=!1}}(et,nt,at,rt,ot,it,ut,lt,st,ct,ht,ft,Mt,dt,mt,gt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.lt=this.checked}))}(vt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(vt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),a=e.clientX-n.left,r=e.clientY-n.top,o=n.width/t.Y,i=n.height/t.X,u=Math.floor(a/o),l=Math.floor(r/i);t.grid.set(l,u,1)}}))}(vt),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),a=e.clientX-n.left,r=e.clientY-n.top,o=n.width/t.Y,i=n.height/t.X,u=Math.floor(a/o),l=Math.floor(r/i);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(l,(u+1)%t.Y,1),t.grid.set(l,u,1),t.grid.set((l+1)%t.X,u,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(l,u,1),t.grid.set((l+1)%t.X,u,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(l,u,1),t.grid.set(l,(u+1)%t.Y,1)):(t.grid.set((l+1)%t.X,(u+1)%t.Y,1),t.grid.set((l-1+t.X)%t.X,(u+1)%t.Y,1),t.grid.set((l-1+t.X)%t.X,(u-1+t.Y)%t.Y,1),t.grid.set((l+1)%t.X,(u-1+t.Y)%t.Y,1))}))}(vt),_(),tt(vt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.I=e,j(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.P=e,j(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.j=this.checked,j(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.O=this.checked,j(t)}))}(vt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(vt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.A=this.value,X(t)}))}(vt),function(t){document.getElementById("userRule").addEventListener("change",(async function(){t.V=this.value,2==t.nt^(t.V.includes("Secondary")||t.V.includes("Variable"))&&await K(t),t.nt=Q(t.V),O(t)}))}(vt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.ot=!0}))}(vt),function(t){document.getElementById("changeColor").addEventListener("click",(function(){X(t)}))}(vt),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.L=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){q(t,"like")})),document.getElementById("dislikeButton").addEventListener("click",(function(){q(t,"dislike")}))}(vt),function(t){null!==localStorage.getItem("userGridHeight")?(t.X=parseInt(localStorage.getItem("userGridHeight")),t.Y=parseInt(localStorage.getItem("userGridWidth")),t.X>1e3&&(t.X=1e3),t.Y>1e3&&(t.Y=1e3),t.tt=t._.createImageData(t.Y,t.X),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.I=parseInt(localStorage.getItem("userXShift")),isNaN(t.I)&&(t.I=0),isNaN(t.P)&&(t.P=0),t.P=parseInt(localStorage.getItem("userYShift")),t.j="true"===localStorage.getItem("userFlipX"),t.O="true"===localStorage.getItem("userFlipY"),t.A=localStorage.getItem("userColorPalette"),t.lt="true"===localStorage.getItem("userRandomnessOn"),t.Z=parseFloat(localStorage.getItem("userRandomnessAmount")),t.V=localStorage.getItem("userRule"),t.nt=Q(t.V),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.X,document.getElementById("userGridWidth").value=t.Y,document.getElementById("userTimeout").value=t.timeout,document.getElementById("userXShift").value=t.I,document.getElementById("userYShift").value=t.P,document.getElementById("userFlipX").checked=t.j,document.getElementById("userFlipY").checked=t.O,document.getElementById("userColorPalette").value=t.A,document.getElementById("randomnessCheckbox").checked=t.lt,document.getElementById("randomnessSlider").value=t.Z,document.getElementById("userRule").value=t.V,t.canvas.width=Math.max(t.X,t.Y),t.canvas.height=Math.max(t.X,t.Y),t.it=0,t.ut=0;var e=document.getElementById("gameCanvas");if(t.X>t.Y){var n=Math.floor(t.Y/t.X*800);e.style.width=n+"px",e.style.height="800px",e.width=n*t.X/800,e.height=t.X}else{var a=Math.floor(t.X/t.Y*800);e.style.width="800px",e.style.height=a+"px",e.width=t.Y,e.height=a*t.Y/800}}(vt),X(vt),j(vt),O(vt),K(vt).then((()=>{z(vt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
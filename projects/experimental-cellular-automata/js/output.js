(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),n=Object.values(t).reduce(((t,n,i)=>[...t,n/e+(t[i-1]||0)]),[]);return function(){let e=Math.random(),i=n.findIndex((t=>e<t));return Object.keys(t)[i]}}const e=[44,44];function n(t,e,n,i,r){for(var a=-1;a<=1;a++)for(var o=-1;o<=1;o++){if(0==a&&0==o)continue;r[0]=(Math.abs(a)+Math.abs(o))%2,r[t.time%4+1]=-1==a?1:0,r[(1+t.time)%4+1]=-1==o?1:0,r[(2+t.time)%4+1]=1==a?1:0,r[(3+t.time)%4+1]=1==o?1:0;let l=t.t(t,e,n,a,o),u=l[0],h=l[1],c=t.grid.get(u,h),f=c%4,d=Math.floor(c%16/4);if(1==f){i[0][0]+=1;for(var s=0;s<r.length;s++)i[0][4+8*s]+=r[s],i[0][8*(s+1)]+=1-r[s]}else if(2==f){i[0][2]+=1;for(s=0;s<r.length;s++)i[0][4+8*s+2]+=r[s],i[0][8*(s+1)+2]+=1-r[s]}else if(3==f){i[0][3]+=1;for(s=0;s<r.length;s++)i[0][4+8*s+3]+=r[s],i[0][8*(s+1)+3]+=1-r[s]}if(Math.floor(0==d)){i[1][0]+=1;for(s=0;s<r.length;s++)i[1][4+8*s]+=r[s],i[1][8*(s+1)]+=1-r[s]}else if(Math.floor(1==d)){i[1][1]+=1;for(s=0;s<r.length;s++)i[1][4+8*s+1]+=r[s],i[1][8*(s+1)+1]+=1-r[s]}else if(Math.floor(2==d)){i[1][2]+=1;for(s=0;s<r.length;s++)i[1][4+8*s+2]+=r[s],i[1][8*(s+1)+2]+=1-r[s]}else if(Math.floor(3==d)){i[1][3]+=1;for(s=0;s<r.length;s++)i[1][4+8*s+3]+=r[s],i[1][8*(s+1)+3]+=1-r[s]}}i[0][1]=i[0][0]+i[0][3];for(s=0;s<r.length+1;s++)i[0][4*s+1]+=i[0][4*s]+i[0][4*s+3];return i}const i="mix",r="isotropic",a="xcross",o="vcross",s="xvcross",l="directional1",u="directional2",h="directional3",c="directional2b",f="directional",d={[i]:.2,[r]:.4,[a]:.05,[o]:.05,[s]:.05,[l]:.05,[u]:.05,[h]:.05,[c]:.05,[f]:.05};const m="A",M="C",g="E",v="B";class p{constructor(t,e,n,i,r,a=null){this.type=t,this.threshold=e,this.i=n,this.o=i,this.l=r,this.u=a,this.h=function(t,e){return t==M?function(t){return 0==t}:t==m?function(t){return t%e==0}:function(t){return!0}}(this.o,this.l),this.m=function(t,e,n){return e==g?function(e){return e[n[0]][n[1]]==t}:e==v?function(e){return e[n[0]][n[1]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(a)}test(t,e,n){var i=this.M(n);return this.m(t)&&this.h(e)&&i}name(){var t="";return null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.o}[${this.i[0]}|${this.i[1]}]${t}`}static v(t,e=4){var n=null;t.startsWith(g)?n=g:t.startsWith(v)&&(n=v);var i=t.substring(n.length),r=parseInt(i.substring(0,1)),a=null;(i=i.substring(1)).startsWith(M)?a=M:i.startsWith(m)?a=m:i.startsWith("N")&&(a="N");var o=(i=i.substring(a.length)).split("[")[1].split("]")[0].split("|").map(Number),s=null;return(i=i.split("]")[1]).length>0&&(s=i.split("").map((t=>"1"===t))),new p(n,r,o,a,e,s)}static p(e=null,n=4,d=i,b=null){const w=[g,v],S=w[Math.floor(Math.random()*w.length)],R=[M,m,"N"],C=R[Math.floor(Math.random()*R.length)];null===e&&(e={0:2/3,1:1/3});const k=t(e)(),N=function(t,e){var n=e;if(n==i){var d=Math.random();n=d<.5?r:d<.7?a:d<.9?o:f}if(n==r)return Math.floor(4*Math.random());if(n==o)return Math.floor(4*Math.random()+4);if(n==a)return Math.floor(4*Math.random()+8);if(n==s)return Math.floor(8*Math.random()+4);if(n==l)return Math.floor(4*Math.random()+12);if(n==u)return Math.floor(8*Math.random()+12);if(n==h)return Math.floor(12*Math.random()+12);if(n==c){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return n==f?Math.floor(16*Math.random()+12):void 0}(0,d),x=[k,N];var F=0,y=8;if(0==x[0]&&x[1]%4!=1?y=5:x[1]>4&&x[1]<=16?y=4:x[1]>16&&(y=3),F=S===v?Math.floor(Math.random()*y):Math.floor(Math.random()*y)+1,Math.random()<.2)A=null;else{var A;null==b&&(b=Math.floor(20*Math.random())+2);do{A=new Array(b).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new p(S,F,x,C,n,A)}}class b{constructor(){this.S}R(t,e,n,i){throw new Error("Must override method")}}class w extends b{constructor(){super(),this.S=4}R(t,e,n,i){var r=t%4;return 1==r||3==r?e=2:2==r?e=0:0==r&&2==n[0][0]?e=1:0==r&&n[0][0]>2&&(e=3),e}C(){return"BB"}}class S extends b{constructor(t,e,n,i,r){super(),this.k=e,this.N=t,this.S=this.k,this.F=n,this.A=i,this.G=r}R(t,e,n,i){e=0;for(let r=0;r<this.N.length;r++)if(this.N[r].test(n,t,i)){e=(r+1)%this.k;break}return e}C(){return this.N.map((t=>t.name())).join("||")}static I(e=null,n=null,i=null,r=4,a=4,o=null){var s=[];null==e&&(e=Math.floor(8*Math.random())+2),null==i&&(i=t(d)()),null==o&&(o=this.X());for(let t=0;t<e;t++)s.push(p.p(n,r,i,o));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+i+": "+s.map((t=>t.name())).join(", ")),new S(s,a,n,i,o)}static X(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Y(t,e=4){var n=t.split("||").map((t=>p.v(t)));return new S(n,e,null,i,null)}V(t=null){var e,n=this.N.length;null==t&&(t=this.F),0==(e=2==n?Math.floor(2*Math.random())+1:10==n?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.j():1==e?this.P(t):this.T(t)}T(t){var e=this.N.slice();e.push(p.p(t,4,this.A,this.G)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.A+": "+e.map((t=>t.name())).join("||")),this.N=e}j(){var t=this.N.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.N=t}P(t){var e=this.N.slice(),n=Math.floor(Math.random()*e.length);e[n]=p.p(t,4,this.A,this.G),console.log((new Date).toLocaleTimeString()+" Changing condition "+n+" to "+this.A+": "+e.map((t=>t.name())).join("||")),this.N=e}}class R extends b{constructor(t,e){super(),this.k=e,this.N=t,this.S=this.k}R(t,e,n,i){e=0;var r=this.N[t%4];for(let i=0;i<r.length;i++)if(r[i].test(n,t)){e=(i+1)%this.k;break}return e}C(){return this.N.map((t=>t.map((t=>t.name())).join(", "))).join(" || ")}static I(t=null,e=null,n=4,i=4){var r=[];for(let i=0;i<4;i++){r.push([]),null==t&&(t=Math.floor(8*Math.random())+2);for(let a=0;a<t;a++)r[i].push(p.p(e,n))}return console.log("Sampling sparse four state rule: "+r.map((t=>t.map((t=>t.name())).join(", "))).join("||")),new R(r,i)}static Y(t,e=4){var n=[],i=t.split(" || ");for(let t=0;t<i.length;t++){n.push([]);var r=i[t].split(", ");n[t]=r.map((t=>p.v(t)))}return new R(n,e)}}const C="safe",k="mix",N="general";class x{O;B;R;L(){throw new Error("Must override method")}U(){return function(t,e,n,i){e=this.B[0].R(t%this.B[0].S,e,n,i);var r=this.B[0].S;for(let a=1;a<this.B.length;a++)e+=r*this.B[a].R(Math.floor(t/r)%this.B[a].S,e,n,i),e%=r*=this.B[a].S;return e%r}}H(){throw new Error("Must override method")}C(){return this.B.map((t=>t.C())).join("-")}}class F extends x{constructor(t,e,n=null){super(),this.$=t,this.F=e,this.G=null,this.D=null,null==e&&(t==C?this.F={0:1,1:0}:t==k?(Math.random()<.5?this.F={0:.8,1:.2}:this.F={0:1,1:0},this.F={0:.8,1:.2}):this.F={0:.5,1:.5}),this.O=4,this.B=null==n?this.L():this.W(n),this.R=this.U()}L(){var t=[];return t.push(new w),t.push(S.I(null,this.F,this.D,4,4,this.G)),t}H(){this.B[1].V(this.F)}W(t){var e=[],n=t.split("-")[1];return e.push(new w),e.push(S.Y(n)),e}}class y extends x{constructor(t,e,n=null){super(),this.$=t,this.F=e,this.G=null,this.D=null,null==e&&(t==C?this.F={0:1,1:0}:t==k?(Math.random()<.5?this.F={0:.8,1:.2}:this.F={0:1,1:0},this.F={0:.8,1:.2}):this.F={0:.5,1:.5}),this.O=16,this.B=null==n?this.L():this.W(n),this.R=this.U()}L(){var t=[];return t.push(new w),t.push(S.I(null,this.F,this.D,4,4,this.u)),t.push(S.I(null,this.F,this.D,16,4,this.u)),t}H(){this.B[1].V(this.F),this.B[2].V(this.F)}W(t){var e=[],n=t.split("-")[1];return e.push(new w),e.push(S.Y(n)),e}}class A extends x{constructor(t){super(),this.F=t,null==t&&(this.F={0:.5,1:.5}),this.O=1,this.B=this.L(),this.R=this.U()}L(){var t=[];return t.push(R.I(4,this.F)),t}H(){}}function G(t,e=!1){Math.random()<Math.exp(t.q)||e||t.Z?("VariableGR"==t.J?(t.K=new F(C),t._=new F(C)):"Variable"==t.J?t.K=new F(C):"VariableMix"==t.J?t.K=new F(k):"VariableUnsafe"==t.J?t.K=new F(N):"Variable2Unsafe"==t.J?t.K=new y(N):"CustomRule"==t.J?t.K=new F(null,null,t.tt):"SparseFourStates"==t.J&&(t.K=new A),t.q=-25,t.et=-25,t.Z=!1,I(t)):(Math.random()<Math.exp(t.et)||t.nt)&&"CustomRule"!=t.J&&(t.K.H(),"VariableGR"==t.J&&t._.H(),t.et=-25,t.nt=!1,I(t)),t.q=t.q+t.it,t.q>0&&(t.q=0),t.et=t.et+t.rt,t.et>0&&(t.et=0)}function I(t){var e=document.getElementById("currentRule");e&&(e.value=t.K.C())}function X(t){let e={};for(let n in t){let i=Math.floor(3*Math.random())-1,r=t[n]+i;r=Math.max(0,Math.min(255,r)),e[n]=r}return e}function Y(t){var e={r:247,g:255,b:28},n={r:13,g:112,b:255},i={r:240,g:239,b:239},r={r:0,g:0,b:0},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};"yellow"==t.ot?(t.backgroundColor=e,t.st=r,t.lt=n,t.ut=i):"blue"==t.ot?(t.backgroundColor=n,t.st=i,t.lt=r,t.ut=e):"blue2"==t.ot?(t.backgroundColor=n,t.st=e,t.lt=r,t.ut=i):"grey"==t.ot?(t.backgroundColor=i,t.st=r,t.lt=n,t.ut=e):"grey2"==t.ot?(t.backgroundColor=i,t.st=e,t.lt=r,t.ut=n):"black"==t.ot?(t.backgroundColor=r,t.st=n,t.lt=e,t.ut=i):"black2"==t.ot?(t.backgroundColor=r,t.st=n,t.lt=i,t.ut=e):"blackTrace"==t.ot?(t.backgroundColor=r,t.st=i,t.lt=r,t.ut=i):"blackTrace2"==t.ot?(t.backgroundColor=r,t.st=r,t.lt=r,t.ut=i):"blackTrace3"==t.ot?(t.backgroundColor=r,t.st=r,t.lt=i,t.ut=i):"variable"==t.ot&&(t.backgroundColor=r,t.st={r:240,g:240,b:240},t.lt=a,t.ut=o)}function E(t,e,n,i,r){let a=(e+i+t.ht)%t.ht,o=(n+r+t.ct)%t.ct,s=a,l=o;return(a-e-i>0||a-e-i<0)&&(l=(t.ct-o-t.ft+t.ct)%t.ct),(o-n-r>0||o-n-r<0)&&(s=(t.ht-a-t.dt+t.ht)%t.ht),[s,l]}function V(t,e,n,i,r){let a=(e+i+t.ht)%t.ht,o=(n+r+t.ct)%t.ct,s=a,l=o;return(a-e-i>0||a-e-i<0)&&(l=(t.ct-o-t.ft+t.ct)%t.ct),o-n-r>0?s=(a+t.dt+t.ht)%t.ht:o-n-r<0&&(s=(a-t.dt+t.ht)%t.ht),[s,l]}function j(t,e,n,i,r){let a=(e+i+t.ht)%t.ht,o=(n+r+t.ct)%t.ct,s=a,l=o;return a-e-i>0?l=(o+t.ft+t.ct)%t.ct:a-e-i<0&&(l=(o-t.ft+t.ct)%t.ct),(o-n-r>0||o-n-r<0)&&(s=(t.ht-a-t.dt+t.ht)%t.ht),[s,l]}function P(t,e,n,i,r){let a=(e+i+t.ht)%t.ht,o=(n+r+t.ct)%t.ct,s=a,l=o;return a-e-i>0?l=(o+t.ft+t.ct)%t.ct:a-e-i<0&&(l=(o-t.ft+t.ct)%t.ct),o-n-r>0?s=(a+t.dt+t.ht)%t.ht:o-n-r<0&&(s=(a-t.dt+t.ht)%t.ht),[s,l]}function T(t){t.Mt&&t.gt?t.t=E:t.Mt?t.t=V:t.gt?t.t=j:t.t=P}function O(t){G(t,!0)}function B(t,e){if(t.vt){var n={...t.bt};delete n.wt,delete n.N;var i={...n,event:e},r=Object.keys(i).join(",")+"\n";r+=Object.values(i).join(",");var a=new Blob([r],{type:"text/csv"}),o=URL.createObjectURL(a),s=document.createElement("a");s.href=o,s.download="dataAutomata.csv",s.click()}}class L{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e),this.rows=new Array(e)}get(t,e){return this.data[t*this.width+e]}set(t,e,n){this.data[t*this.width+e]=n}}let U={St:{Rt:2,mask:[[1,0],[0,1]]},Ct:{Rt:2,mask:[[0,1],[1,0]]},kt:{Rt:2,mask:[[1,0],[0,1]]},Nt:{Rt:2,mask:[[1,1],[1,1]]},xt:{Rt:4,mask:[[1,0,1],[0,0,0],[1,0,1]]},Ft:{Rt:4,mask:[[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]]},yt:{Rt:30,mask:null}},H=Object.keys(U).map((t=>U[t].mask)),$=t(Object.keys(U).map((t=>U[t].Rt)));function D(t,e,n,i,r){for(var a=function(t){var e=Math.exp(-t),n=1,i=0;do{i++,n*=Math.random()}while(n>e);return i-1}(10**t.At),o=0;o<a;o++){e=Math.floor(Math.random()*t.ht),n=Math.floor(Math.random()*t.ct);W(i,t,H[$()],e,n,r)}return{Gt:e,It:n}}function W(t,e,n,i,r,a){null===n&&(n=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,n=[];for(let i=0;i<t;i++){n.push([]);for(let t=0;t<e;t++)n[i].push(Math.floor(4*Math.random()))}return n}());let o=n.length,s=n[0].length;for(let l=0;l<o;l++)for(let u=0;u<s;u++){let h=a(e,i,r,l-Math.floor(o/2),u-Math.floor(s/2));t.set(h[0],h[1],n[l][u])}}function q(t){!function(t){let e=t.Xt,n=t.Yt;for(var i=0,r=0;r<t.ht;r++)for(var a=0;a<t.ct;a++){if(0==t.Et.get(r,a))continue;i+=1;var o=Math.floor(t.grid.get(r,a)/t.K.O)%4;let e;if(0==o)e=t.backgroundColor;else if(1==o)e=t.st;else if(2==o)e=t.lt;else{if(3!=o)continue;e=t.ut}let s=4*(r*t.ct+a);n.data[s+0]=e.r,n.data[s+1]=e.g,n.data[s+2]=e.b,n.data[s+3]=255}if(t.Vt=.01*i+.99*t.Vt,t.Vt>.5*t.ht*t.ct){t.Z=!0;var s=t.Vt/(t.ht*t.ct);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+s.toFixed(1)+")."),t.Vt=15,B(t,"oscillation")}t.Vt<3&&(t.Z=!0,console.log("Changing rule because not enough cells changed ("+t.Vt+")."),t.Vt=20,B(t,"blackout")),e.putImageData(n,t.jt,t.Pt)}(t),function(t){for(var i=[new Array(e[0]).fill(0),new Array(e[1]).fill(0)],r=[0,0,0,0,0],a=new L(t.ct,t.ht),o=0;o<t.ht;o++)for(var s=0;s<t.ct;s++){var l=n(t,o,s,i,r);let e=t.grid.get(o,s);var u=e;u="VariableGR"!=t.J||0==t.mask.get(o,s)?t.K.R(e,u,l,t.time):t._.R(e,u,l,t.time),Math.floor(u/t.K.O)%4!=Math.floor(e/t.K.O)%4?t.Et.set(o,s,1):t.Et.set(o,s,0),a.set(o,s,u);for(let t=0;t<i.length;t++)i[t].fill(0);r.fill(0)}if(t.Tt)var{Gt:o,It:s}=D(t,o,s,a,t.t);t.grid=a}(t),G(t),t.time=(t.time+1)%166320,function(t){Math.random()<1e-4&&(t.ft=Math.floor(Math.random()*t.ct),console.log("Periodicity shift X: "+t.ft)),Math.random()<1e-4&&(t.dt=Math.floor(Math.random()*t.ht),console.log("Periodicity shift Y: "+t.dt)),Math.random()<1e-4&&(t.Mt=!t.Mt,T(t),console.log("Flip X: "+t.Mt)),Math.random()<1e-4&&(t.gt=!t.gt,T(t),console.log("Flip Y: "+t.gt))}(t),"variable"==t.ot&&function(t){Math.random()<1&&(t.ut=X(t.ut),t.lt=X(t.lt))}(t),setTimeout((function(){requestAnimationFrame((()=>q(t)))}),t.timeout)}function z(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const i=new Image;i.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=i.width,e.height=i.height;const r=e.getContext("2d");r.drawImage(i,0,0,i.width,i.height);const a=r.getImageData(0,0,e.width,e.height).data,o=[];for(let t=0;t<i.height;t++){const e=[];for(let n=0;n<i.width;n++){const r=4*(t*i.width+n),o=(a[r]+a[r+1]+a[r+2])/3;e.push(o>128?1:0)}o.push(e)}t(o)},i.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},i.src=n}))).then((e=>{new L(t.ct,t.ht);const n=new L(t.ct,t.ht),i=e[0].length/t.ct,r=e.length/t.ht,a=Math.max(i,r),o=Math.floor((t.ct-e[0].length/a)/2),s=Math.floor((t.ht-e.length/a)/2);for(let i=0;i<t.ht;i++)for(let r=0;r<t.ct;r++){if(i<s||(i-s)*a>=e.length){n.set(i,r,1);continue}let t=Math.floor((r-o)*a);0===e[Math.floor((i-s)*a)][t]?n.set(i,r,0):n.set(i,r,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new L(t.ct,t.ht)}));var n}async function Z(t,e){return await z(t),function(t,e=64){return Promise.resolve().then((()=>{t.grid=new L(t.ct,t.ht),t.Et=new L(t.ct,t.ht);for(var n=0;n<t.ht;n++)for(var i=0;i<t.ct;i++)if("gr"!=t.Ot||1!==t.mask.get(n,i)){for(var r=Math.random(),a=0;a<e;a++)if(r<(a+1)/(e+1)){t.grid.set(n,i,a);break}t.Et.set(n,i,1)}else t.grid.set(n,i,0)}))}(t)}function J(t){document.getElementById("submitButton").addEventListener("click",(function(){var t,e,n,i,r,a,o,s,l,u,h,c;t=document.getElementById("userGridHeight").value,e=document.getElementById("userGridWidth").value,n=document.getElementById("userTimeout").value,i=document.getElementById("userXShift").value,r=document.getElementById("userYShift").value,a=document.getElementById("userFlipX").checked,o=document.getElementById("userFlipY").checked,s=document.getElementById("userColorPalette").value,l=document.getElementById("randomnessCheckbox").checked,u=document.getElementById("randomnessSlider").value,h=document.getElementById("metaRule").value,c=null,document.getElementById("currentRule")&&(c=document.getElementById("currentRule").value),localStorage.setItem("userGridHeight",t),localStorage.setItem("userGridWidth",e),localStorage.setItem("userTimeout",n),localStorage.setItem("userXShift",i),localStorage.setItem("userYShift",r),localStorage.setItem("userFlipX",a),localStorage.setItem("userFlipY",o),localStorage.setItem("userColorPalette",s),localStorage.setItem("userRandomnessOn",l),localStorage.setItem("userRandomnessAmount",u),localStorage.setItem("metaRule",h),localStorage.setItem("currentRule",c),location.reload()}))}function K(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.At=e,document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var Q=document.getElementById("gameCanvas"),_=Q.getContext("2d"),tt=192,et=192,nt=30,it=!0,rt=-1.5,at=0,ot=0,st=!1,lt=!1,ut="variable",ht="Variable",ct="random",ft=8,dt=2e4,mt=2e3,Mt=new class{constructor(t,e,n=200,i=200,r=20,a=!0,o=-2,s=0,l=0,u=!1,h=!1,c="black2",f="VariableGR",d="random",m=6,M=2e4,g=2e3){this.ht=n,this.ct=i,this.jt=0,this.Pt=0,this.timeout=r,this.grid=null,this.Et=null,this.Yt=null,this.canvas=t,this.Xt=e,this.Tt=a,this.At=o,this.ft=s,this.dt=l,this.Mt=u,this.gt=h,this.ot=c,this.J=f,this.Ot=d,this.Bt=m,this.Lt=null,this.Ut=null,this.t=null,this.mask=null,this.Ht=M,this.$t=g,this.q=-25,this.et=-25,this.it=25/this.Ht,this.rt=25/this.$t,this.canvas.width=this.ct,this.canvas.height=this.ht,this.Yt=e.createImageData(t.width,t.height),this.Z=!0,this.nt=!1,this.Vt=0,this.vt=!1,this.time=0}}(Q,_,tt,et,nt,it,rt,at,ot,st,lt,ut,ht,ct,ft,dt,mt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.Tt=this.checked}))}(Mt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(Mt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,a=n.width/t.ct,o=n.height/t.ht,s=Math.floor(i/a),l=Math.floor(r/o);t.grid.set(l,s,1)}}))}(Mt),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top,a=n.width/t.ct,o=n.height/t.ht,s=Math.floor(i/a),l=Math.floor(r/o);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(l,(s+1)%t.ct,1),t.grid.set(l,s,1),t.grid.set((l+1)%t.ht,s,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(l,s,1),t.grid.set((l+1)%t.ht,s,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(l,s,1),t.grid.set(l,(s+1)%t.ct,1)):(t.grid.set((l+1)%t.ht,(s+1)%t.ct,1),t.grid.set((l-1+t.ht)%t.ht,(s+1)%t.ct,1),t.grid.set((l-1+t.ht)%t.ht,(s-1+t.ct)%t.ct,1),t.grid.set((l+1)%t.ht,(s-1+t.ct)%t.ct,1))}))}(Mt),J(),K(Mt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.ft=e,T(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.dt=e,T(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.Mt=this.checked,T(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.gt=this.checked,T(t)}))}(Mt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(Mt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.ot=this.value,Y(t)}))}(Mt),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.J=this.value,O(t)}))}(Mt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.Z=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.nt=!0}))}(Mt),function(t){document.getElementById("changeColor").addEventListener("click",(function(){Y(t)}))}(Mt),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.vt=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){B(t,"like")})),document.getElementById("dislikeButton").addEventListener("click",(function(){B(t,"dislike")}))}(Mt),function(t){null!==localStorage.getItem("userGridHeight")?(t.ht=parseInt(localStorage.getItem("userGridHeight")),t.ct=parseInt(localStorage.getItem("userGridWidth")),t.ht>1e3&&(t.ht=1e3),t.ct>1e3&&(t.ct=1e3),t.Yt=t.Xt.createImageData(t.ct,t.ht),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.ft=parseInt(localStorage.getItem("userXShift")),isNaN(t.ft)&&(t.ft=0),isNaN(t.dt)&&(t.dt=0),t.dt=parseInt(localStorage.getItem("userYShift")),t.Mt="true"===localStorage.getItem("userFlipX"),t.gt="true"===localStorage.getItem("userFlipY"),t.ot=localStorage.getItem("userColorPalette"),t.Tt="true"===localStorage.getItem("userRandomnessOn"),t.At=parseFloat(localStorage.getItem("userRandomnessAmount")),t.J=localStorage.getItem("metaRule"),t.tt=localStorage.getItem("currentRule"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.ht,document.getElementById("userGridWidth").value=t.ct,document.getElementById("userTimeout").value=t.timeout,document.getElementById("userXShift").value=t.ft,document.getElementById("userYShift").value=t.dt,document.getElementById("userFlipX").checked=t.Mt,document.getElementById("userFlipY").checked=t.gt,document.getElementById("userColorPalette").value=t.ot,document.getElementById("randomnessCheckbox").checked=t.Tt,document.getElementById("randomnessSlider").value=t.At,document.getElementById("metaRule").value=t.J,t.canvas.width=Math.max(t.ht,t.ct),t.canvas.height=Math.max(t.ht,t.ct),t.jt=0,t.Pt=0;var e=document.getElementById("gameCanvas");if(t.ht>t.ct){var n=Math.floor(t.ct/t.ht*800);e.style.width=n+"px",e.style.height="800px",e.width=n*t.ht/800,e.height=t.ht}else{var i=Math.floor(t.ht/t.ct*800);e.style.width="800px",e.style.height=i+"px",e.width=t.ct,e.height=i*t.ct/800}}(Mt),Y(Mt),T(Mt),O(Mt);let t=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==t&&""!==window.location.hostname||Z(Mt).then((()=>{q(Mt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
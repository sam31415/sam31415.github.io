(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),i=Object.values(t).reduce(((t,i,n)=>[...t,i/e+(t[n-1]||0)]),[]);return function(){let e=Math.random(),n=i.findIndex((t=>e<t));return Object.keys(t)[n]}}const e=[11,44];function i(t,e,i,n,r,s,a,h,o){const u=n.height-1,l=n.width-1,c=n.data,f=n.width;var m=r[0],d=r[1];let g;for(var M=-1;M<=1;M++)for(var p=-1;p<=1;p++){if(0==M&&0==p)continue;if(s[0]=((-1===M?1:M)+(-1===p?1:p))%2,s[2+(3&a)]=-1==M?1:0,s[(1+a)%4+1]=-1==p?1:0,s[(2+a)%4+1]=1==M?1:0,s[(3+a)%4+1]=1==p?1:0,0==e||0==i||e==u||i==l)var[b,S]=t.t(t,e,i,M,p);else var b=e+M,S=i+p;const n=c[b*f+S],r=n%h,v=Math.floor(n/h)%o;g=h;for(var w=0;w<h-1;w++)r==w+1&&(m[w]+=1,m[g+w]+=s[0],g+=h,m[g+w]+=1-s[0],m[h+g+w]+=s[1],g+=h,m[g+w]+=1-s[1],m[h+g+w]+=s[2],g+=h,m[g+w]+=1-s[2],m[h+g+w]+=s[3],g+=h,m[g+w]+=1-s[3],m[h+g+w]+=s[4],g+=h,m[g+w]+=1-s[4]),g=h;g=o;for(w=0;w<o;w++)d[w]+=1,v==w&&(d[o+w]+=s[0],g+=o,d[g+w]+=1-s[0],d[o+g+w]+=s[1],g+=o,d[g+w]+=1-s[1],d[o+g+w]+=s[2],g+=o,d[g+w]+=1-s[2],d[o+g+w]+=s[3],g+=o,d[g+w]+=1-s[3],d[o+g+w]+=s[4],g+=o,d[g+w]+=1-s[4]),g=o}return[m,d]}const n="mix",r="isotropic",s="xcross",a="vcross",h="xvcross",o="directional1",u="directional2",l="directional3",c="directional2b",f="directional",m={[n]:.2,[r]:.4,[s]:.05,[a]:.05,[h]:.05,[o]:.05,[u]:.05,[l]:.05,[c]:.05,[f]:.05};const d="A",g="C",M="E",p="B";class b{constructor(t,e,i,n,r,s=null){this.type=t,this.threshold=e,this.i=i,this.h=n,this.o=r,this.u=s,this.l=function(t,e){return t==g?function(t){return 0==t}:t==d?function(t){return t%e==0}:function(t){return!0}}(this.h,this.o),this.m=function(t,e,i){return e==M&&2==i.length?function(e){return e[i[0]][i[1]]==t}:e==p&&2==i.length?function(e){return e[i[0]][i[1]]>t}:e==M&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]==t}:e==p&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(s)}test(t,e,i){var n=this.M(i);return this.m(t)&&this.l(e)&&n}name(){var t="";null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join(""));var e=this.i.join("|");return`${this.type}${this.threshold}${this.h}[${e}]${t}`}static p(t,e=4){var i=null;t.startsWith(M)?i=M:t.startsWith(p)&&(i=p);var n=t.substring(i.length),r=parseInt(n.substring(0,1)),s=null;(n=n.substring(1)).startsWith(g)?s=g:n.startsWith(d)?s=d:n.startsWith("N")&&(s="N");var a=(n=n.substring(s.length)).split("[")[1].split("]")[0].split("|").map(Number),h=null;return(n=n.split("]")[1]).length>0&&(h=n.split("").map((t=>"1"===t))),new b(i,r,a,s,e,h)}static S(e=null,i=4,m=n,S=null){const w=[M,p],v=w[Math.floor(Math.random()*w.length)],B=[g,d,"N"],N=B[Math.floor(Math.random()*B.length)];null===e&&(e={0:2/3,1:1/3});const k=t(e)(),I=function(t,e){var i=e;if(i==n){var m=Math.random();i=m<.5?r:m<.7?s:m<.9?a:f}if(i==r)return Math.floor(4*Math.random());if(i==a)return Math.floor(4*Math.random()+4);if(i==s)return Math.floor(4*Math.random()+8);if(i==h)return Math.floor(8*Math.random()+4);if(i==o)return Math.floor(4*Math.random()+12);if(i==u)return Math.floor(8*Math.random()+12);if(i==l)return Math.floor(12*Math.random()+12);if(i==c){var d=Math.floor(8*Math.random()+12);return d>=16&&(d+=4),d}return i==f?Math.floor(16*Math.random()+12):void 0}(0,m);var y=void 0;if(Math.random()<.5){y=[k,I,function(t){for(var e=4*Math.floor(t/4),i=t;i==t;)i=e+Math.floor(4*Math.random());return i}(I)]}else y=[k,I];var R=0,C=8;if(0==y[0]&&y[1]%4!=1?C=5:y[1]>4&&y[1]<=16?C=4:y[1]>16&&(C=3),R=v===p?Math.floor(Math.random()*C):Math.floor(Math.random()*C)+1,Math.random()<.2)x=null;else{var x;null==S&&(S=Math.floor(20*Math.random())+2);do{x=new Array(S).fill(0).map((()=>Math.random()<.5))}while(!x.includes(!0))}return new b(v,R,y,N,i,x)}}class S{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.v=!1,this.get=this.B,this.set=this.N}static k(t,e=!1,i=!1,n=!1){const r=t.length,s=t[0].length,a=new S(s,r);for(let e=0;e<r;e++){n&&(e=r-e-1);for(let n=0;n<s;n++)i&&(n=s-n-1),a.set(e,n,t[e][n])}return e&&a.I(),a}I(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.v?[this.B,this.N]:[this.R,this.C],this.v=!this.v}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const i=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,i)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const i=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,i)}}B(t,e){return this.data[t*this.width+e]}N(t,e,i){this.data[t*this.width+e]=i}R(t,e){return this.data[e*this.height+t]}C(t,e,i){this.data[e*this.height+t]=i}}class w{constructor(){this.P=void 0}A(t,e,i,n){throw new Error("Must override method")}F(){throw new Error("Must override method")}}class v extends w{constructor(){super(),this.$=this.G(),this.U(),this.T=0}G(){throw new Error("Must override method")}U(){this.V=Object.keys(this.$).map((t=>this.$[t].mask));let e=Object.keys(this.$).map((t=>this.$[t].O));this.j=t(e)}}class B extends v{constructor(){super(),this.P=4}A(t,e,i,n){var r=t%4;return 1==r||3==r?e=2:2==r?e=0:0==r&&2==i[0][0]?e=1:0==r&&i[0][0]>2&&(e=3),e}F(){return"BB"}G(){return{random:{O:15,mask:null},W:{O:4,mask:S.k([[1,1],[1,1]])},X:{O:4,mask:new S([[1,0,1],[0,0,0],[1,0,1]])},Y:{O:2,mask:S.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{O:2,mask:S.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},D:{O:2,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},H:{O:2,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class N extends v{constructor(){super(),this.P=4,this.T=-1}A(t,e,i,n){var r=t%4;return 3==r&&(r=0),1==r?e=2:2==r||3==r?e=0:0!=r&&3!=r||2!=i[0][0]?0==r&&i[0][0]>2&&(e=3):e=1,e}F(){return"TBB"}G(){return{random:{O:15,mask:null},D:{O:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Y:{O:2,mask:S.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{O:2,mask:S.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},W:{O:4,mask:S.k([[1,1],[1,1]])},q:{O:1e4,mask:S.k([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class k extends v{constructor(){super(),this.P=4,this.T=-1}A(t,e,i,n){var r=t%4;return 1==r&&(i[0][0]<3||i[0][0]>5)?e=2:2==r?e=3:3==r?e=0:0==r&&2==i[0][0]&&(e=1),e}F(){return"SW"}G(){let t=.2;return{random:{O:6,mask:null},_:{O:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Z:{O:t,mask:S.k([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},J:{O:t,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},K:{O:t,mask:S.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{O:t,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{O:t,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},it:{O:t,mask:S.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},nt:{O:t,mask:S.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},rt:{O:t,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},st:{O:t,mask:S.k([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ht:{O:t,mask:S.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ot:{O:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{O:t,mask:S.k([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{O:t,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{O:t,mask:S.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{O:t,mask:S.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},dt:{O:t,mask:S.k([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},X:{O:2,mask:S.k([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class I extends v{constructor(t){super(),null==t&&(t=I.gt()),this.Mt(t)}A(t,e,i,n){var r=t%this.P;return 1==r&&this.bt.includes(i[0][this.St])?e=1:r>0&&r<this.P-1?e+=1:r==this.P-1?e=0:0==r&&this.wt.includes(i[0][this.St])?e=1:0==r&&this.vt.includes(i[0][this.St])&&(e=this.P-1),e}Mt(t){this.Bt=t;const e=this.Bt.split("/");for(var i of(this.St=0,this.vt=[],e))"N"==i[0]?this.St=Number(e[0].substring(1)):"B"==i[0]?this.wt=new Uint8Array(i.substring(1).split("").map(Number)):"S"==i[0]?this.bt=new Uint8Array(i.substring(1).split("").map(Number)):"I"==i[0]?this.vt=new Uint8Array(e[2].substring(1).split("").map(Number)):this.P=Number(i)}static gt(t){let e=Math.floor(10*Math.random())+3;null==t&&(t=Math.floor(5*Math.random()*e));let i=Math.floor(t/e)%5;var n=8;[1,2].includes(i)?n=4:3==i?n=3:4==i&&(n=5);let r=R.Nt(1,n);0==r.length&&(r=[2]);let s=R.Nt(1,n),a=R.Nt(1,n);return a=a.filter((t=>!r.includes(t)&&!s.includes(t)&&2!=t)),`N${t}/B${r.join("")}/S${s.join("")}/I${a.join("")}/${e}`}static Nt(t,e){let i=[];for(let n=t;n<=e;n++)Math.random()<.5&&i.push(n);return i}F(){return this.Bt}G(){return{random:{O:1,mask:null}}}}class y extends I{constructor(t,e=null){if(super(t),"ships"==e){let t=y.gt(0);this.Mt(t);let e=Array.from(this.wt).indexOf(1);if(-1!==e){let t=new Uint8Array(this.wt.length-1);t.set(this.wt.subarray(0,e),0),t.set(this.wt.subarray(e+1),e),this.wt=t}if(-1===this.wt.indexOf(2)){let t=new Uint8Array(this.wt.length+1);t[0]=2,t.set(this.wt,1),this.wt=t}if(e=Array.from(this.bt).indexOf(1),-1!==e){let t=new Uint8Array(this.bt.length-1);t.set(this.bt.subarray(0,e),0),t.set(this.bt.subarray(e+1),e),this.bt=t}this.vt=this.vt.filter((t=>!this.wt.includes(t)&&!this.bt.includes(t)&&2!=t)),this.Bt=`N${this.St}/B${this.wt.join("")}/S${this.bt.join("")}/I${this.vt.join("")}/${this.P}`,this.kt=1,this.T=.5}else this.kt=20/this.wt[0]**3,this.T=1}A(t,e,i,n,r){var s=t%this.P;return 1==s&&this.bt.includes(i[0][this.St])?e=1:s>0&&s<this.P-1?e+=1:s==this.P-1?e=0:0==s&&this.wt.includes(i[0][this.St])&&Math.random()>this.kt*r-.01?e=1:0==s&&this.vt.includes(i[0][this.St])&&(e=this.P-1),e}F(){return`SGen/${this.Bt}`}Mt(t){"SGen"==t.substring(0,4)?super.Mt(t.substring(5)):super.Mt(t)}}class R extends I{constructor(t=null,e=!0){super(null==t?e?R.It():R.gt():t)}static It(){let e=t({"N0/B2/S2/I13":5,"N0/B2/S24/I36/7":1,"N0/B2/S24/I36/9":1,"N0/B2/S24/I36/10":1,"N0/B2/S24/I36/11":1,"N0/B2/S37/I1568/3":1,"N0/B245/S347/I/5":1,yt:3,"B234568/S2458/I1/6":1,"B234568/S2458/I1/7":1,"B234568/S2458/I1/8":1,"B234568/S2458/I1/9":1,"B234568/S2458/I1/10":1,"B234568/S2458/I1/11":1,"B234568/S2458/I1/12":1,"B234568/S2458/I1/13":1,"B234568/S2458/I1/14":1,"B234568/S4568/I1/4":1,"B234568/S4568/I1/5":1,"B234568/S458/I1/4":1,"B234568/S458/I1/5":1,"N0/B24568/S3478/I/4":3,"N0/B24568/S3478/I/5":1,"N0/B24568/S3478/I/6":1,"N0/B24568/S3478/I/7":1,"N0/B24568/S34578/I/9":1,"N0/B24568/S34578/I/12":1,"N0/B24568/S34578/I/13":1,"N0/B24568/S34578/I/14":1,"N0/B24568/S34678/I/4":3,"N0/B24568/S34678/I/5":1,"N0/B24568/S34678/I/6":1,"N0/B24568/S34678/I/7":10,"N0/B24568/S34678/I/8":3,"N0/B24568/S34678/I/9":1,"N0/B24568/S34678/I/10":1,"N0/B24568/S34678/I/11":1,"N0/B25/S345/I/4":1,"N0/B25/S345/I/5":1,"N0/B25/S345/I/6":3,"N0/B2568/S345678/I/8":1,"N0/B2568/S345678/I/10":1,"N0/B2568/S345678/I/12":1,"N0/B2568/S34578/I/4":1,"N0/B2568/S34578/I/5":1,"N0/B2568/S34578/I/6":1,"N0/B2568/S34578/I/7":1,"N0/B2568/S34578/I/8":1,"N1/B2/S3/I/11":1,"N1/B23468/S146/I5/12":1,"N15/B23/S/I/5":1,"N15/B23/S3/I/5":1,"N15/B23/S3/I45/5":1,"N15/B23/S35/I46/5":1,"N15/B23/S36/I45/5":1,"N15/B245/S347/I/5":1,"N18/B234/S45/I13/6":1,"N18/B2345/S457/I13/6":1,"N19/B248/S457/I1/6":1,"N20/B23/S3/I45/5":1,"N20/B23/S3/I/5":1,"N20/B245/S347/I/5":1,"N30/B24/S23/I1/7":1,"N30/B24/S23/I1/9":1,"N30/B24/S23/I1/10":1,"N30/B24/S23/I1/11":1,"N33/B23/S3/I/11":1,"N42/B234/S345/I1/10":1,"N47/B2/S25/I/11":1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}G(){return{random:{O:1,mask:null}}}F(){return`GGShips/${this.Bt}`}Mt(t){"GGShips/"==t.substring(0,7)?super.Mt(t.substring(8)):super.Mt(t)}}class C extends I{constructor(){super("B24/S34/I15678/4"),this.T=0}F(){return"FS"}G(){let t=.2;return{random:{O:20,mask:null},Rt:{O:1,mask:S.k([[1,1],[1,1]])},Ct:{O:t,mask:S.k([[1,1]])},xt:{O:1,mask:S.k([[1,0],[1,1]])},Pt:{O:t,mask:S.k([[1,1],[2,2]])},At:{O:1,mask:S.k([[0,1,0],[1,1,1],[0,1,0]])},Ft:{O:1,mask:S.k([[1,0,1],[0,0,0],[1,0,1]])},$t:{O:t,mask:S.k([[1,0,0],[1,1,0],[0,1,1]])},Gt:{O:t,mask:S.k([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},Ut:{O:1,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Et:{O:1,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Tt:{O:1,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Vt:{O:t,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Ot:{O:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},jt:{O:t,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class x extends I{constructor(){super("B2/S245678/I1/4"),this.T=0}F(){return"SS"}G(){let t=.2;return{random:{O:10,mask:null},Rt:{O:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Ct:{O:t,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Pt:{O:t,mask:S.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},$t:{O:t,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Gt:{O:t,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Vt:{O:t,mask:S.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},Ot:{O:t,mask:S.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},Ut:{O:1,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},jt:{O:t,mask:S.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},Wt:{O:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Et:{O:1,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},Xt:{O:1,mask:S.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Yt:{O:1,mask:S.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class P extends v{constructor(){super(),this.P=4,this.T=.4}A(t,e,i,n){var r=t%4,s=i[0][0]+i[0][2];return 1!=r&&3!=r||!(s<2||s>3)?1!=r&&3!=r||2!=s&&3!=s?0!=r&&2!=r||3!=s?2==r&&(e=0):e=3:e=1:e=2,e}G(){return{Lt:{O:1,mask:null}}}F(){return"CW"}}class A extends w{constructor(t,e,i,n,r){super(),this.Dt=e,this.Ht=t,this.P=this.Dt,this.qt=i,this.zt=n,this._t=r}A(t,e,i,n){e=0;for(let r=0;r<this.Ht.length;r++)if(this.Ht[r].test(i,t,n)){e=(r+1)%this.Dt;break}return e}F(){return this.Ht.map((t=>t.name())).join("||")}static Zt(e=null,i=null,n=null,r=4,s=4,a=null){var h=[];null==e&&(e=Math.floor(8*Math.random())+2),null==n&&(n=t(m)()),null==a&&(a=this.Jt());for(let t=0;t<e;t++)h.push(b.S(i,r,n,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+h.map((t=>t.name())).join(", ")),new A(h,s,i,n,a)}static Jt(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Kt(t,e=4){var i=t.split("||").map((t=>b.p(t)));return new A(i,e,null,n,null)}Qt(t=null){var e,i=this.Ht.length;null==t&&(t=this.qt),0==(e=2==i?Math.floor(2*Math.random())+1:10==i?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.te():1==e?this.ee(t):this.ie(t)}ie(t){var e=this.Ht.slice();e.push(b.S(t,4,this.zt,this._t)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.zt+": "+e.map((t=>t.name())).join("||")),this.Ht=e}te(){var t=this.Ht.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.Ht=t}ee(t){var e=this.Ht.slice(),i=Math.floor(Math.random()*e.length);e[i]=b.S(t,4,this.zt,this._t),console.log((new Date).toLocaleTimeString()+" Changing condition "+i+" to "+this.zt+": "+e.map((t=>t.name())).join("||")),this.Ht=e}}const F="gr",$="safe",G="mix",U="general",E="test";class T{ne;re;A;se(){throw new Error("Must override method")}ae(){return function(t,e,i,n,r){e=this.re[0].A(t%this.re[0].P,e,i,n,r);var s=this.re[0].P;for(let r=1;r<this.re.length;r++)e+=s*this.re[r].A(Math.floor(t/s)%this.re[r].P,e,i,n),e%=s*=this.re[r].P;return e%s}}he(){throw new Error("Must override method")}F(){return this.re.map((t=>t.F())).join("-")}}class V extends T{constructor(t){super(),this.oe=t,this.ne=1,this.re=this.se(),this.A=this.ae()}se(){var t=[];return"Original"==this.oe?t.push(new N):"StarWars"==this.oe?t.push(new k):"Modified"==this.oe?t.push(new B):"Conway"==this.oe?t.push(new P):t.push(new I(this.oe)),t}he(){}}class O extends T{constructor(t,e,i=null){super(),this.oe=t,this.qt=e,this._t=null,this.ue=null,null==e&&(t==$||t==F||t==E?this.qt={0:1,1:0}:t==G?(Math.random()<.5?this.qt={0:.8,1:.2}:this.qt={0:1,1:0},this.qt={0:.8,1:.2}):this.qt={0:.5,1:.5}),t==F&&(this._t=1),this.ne=4,this.re=null==i?this.se():this.le(i),this.A=this.ae()}ce=[{fe:y,me:[null,"ships"],weight:4},{fe:y,me:[],weight:2},{fe:R,me:[],weight:2},{fe:B,me:[],weight:4},{fe:N,me:[],weight:1},{fe:k,me:[],weight:1},{fe:x,me:[],weight:1},{fe:C,me:[],weight:1},{fe:P,me:[],weight:1}];de=[{fe:B,me:[],weight:1}];se(){let t=this.ce;this.oe==F&&(t=this.de);let e=t.reduce(((t,e)=>t+e.weight),0);var i=[];let n=Math.random()*e;for(let e=0;e<t.length;e++){if(n<t[e].weight){i.push(new t[e].fe(...t[e].me));break}n-=t[e].weight}return i.push(A.Zt(null,this.qt,this.ue,i[0].P,4,this._t)),this.oe==E&&((i=[]).push(new y(null,"ships")),this.ne=i[0].P,i.push(A.Zt(null,this.qt,this.ue,4,4,this._t))),i}he(){this.re[1]&&"function"==typeof this.re[1].Qt&&this.re[1].Qt(this.qt)}le(t){var e=[],[i,n]=t.split("-");return"BB"==i?e.push(new B):"TBB"==i?e.push(new N):"SW"==i?e.push(new k):"SS"==i?e.push(new x):"FS"==i?e.push(new C):"CW"==i?e.push(new P):i.startsWith("SGen")?e.push(new y(i,"ships")):i.startsWith("GGShips")?e.push(new R(i)):e.push(new I(i)),e.push(A.Kt(n)),e}}class j extends T{constructor(t,e,i=null){super(),this.oe=t,this.qt=e,this._t=null,this.ue=null,null==e&&(t==$?this.qt={0:1,1:0}:t==G?(Math.random()<.5?this.qt={0:.8,1:.2}:this.qt={0:1,1:0},this.qt={0:.8,1:.2}):this.qt={0:.5,1:.5}),this.ne=16,this.re=null==i?this.se():this.le(i),this.A=this.ae()}se(){var t=[];return t.push(new B),t.push(A.Zt(null,this.qt,this.ue,4,4,this.u)),t.push(A.Zt(null,this.qt,this.ue,16,4,this.u)),t}he(){this.re[1].Qt(this.qt),this.re[2].Qt(this.qt)}le(t){var e=[],i=t.split("-")[1];return e.push(new B),e.push(A.Kt(i)),e}}function W(t,e=!1){Math.random()<Math.exp(t.ge)||e||t.Me?("VariableGR"==t.pe?(t.be=new O(F),t.Se=new O(F),t.we=!0):"VariableDemo"==t.pe?(t.be=new O(F),t.Se=null,t.we=!1):"Variable"==t.pe?t.be=new O($):"VariableMix"==t.pe?t.be=new O(G):"VariableUnsafe"==t.pe?t.be=new O(U):"VariableTest"==t.pe?t.be=new O(E):"Variable2Unsafe"==t.pe?t.be=new j(U):"CustomRule"==t.pe?t.be=new O(null,null,t.ve):"OriginalBB"==t.pe?t.be=new V("Original"):"ModifiedBB"==t.pe?t.be=new V("Modified"):"StarWars"==t.pe?t.be=new V("StarWars"):"Conway"==t.pe?t.be=new V("Conway"):"SparseFourStates"==t.pe?t.be=new V("B378/S124567/4"):t.be=new O(G),t.ge=-25,t.Be=-25,t.Me=!1,X(t)):(Math.random()<Math.exp(t.Be)||t.Ne)&&"CustomRule"!=t.pe&&(t.be.he(),t.we&&null!==t.Se&&t.Se.he(),t.Be=-25,t.Ne=!1,X(t));let i=Math.max(t.ke/200,1);t.ge=t.ge+t.Ie*i,t.ge>0&&(t.ge=0),t.Be=t.Be+t.ye*i,t.Be>0&&(t.Be=0)}function X(t){var e=document.getElementById("currentStyle");e&&(t.we&&null!==t.Se?e.value=t.be.F()+"__"+t.Se.F():e.value=t.be.F())}function Y(t){let e={};for(let i in t){if("t"==i)continue;let n=Math.floor(3*Math.random())-1,r=t[i]+n;r=Math.max(0,Math.min(255,r)),e[i]=r}return e.Re=t.Re,e}function L(t){var e={r:247,g:255,b:28,Re:255},i={r:13,g:112,b:255,Re:255},n={r:240,g:239,b:239,Re:255},r={r:0,g:0,b:0,Re:255},s={r:240,g:240,b:240,Re:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Re:255},h={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Re:255};"yellow"==t.Ce?(t.backgroundColor=e,t.xe=r,t.Pe=i,t.Ae=n):"blue"==t.Ce?(t.backgroundColor=i,t.xe=n,t.Pe=r,t.Ae=e):"blue2"==t.Ce?(t.backgroundColor=i,t.xe=e,t.Pe=r,t.Ae=n):"grey"==t.Ce?(t.backgroundColor=n,t.xe=r,t.Pe=i,t.Ae=e):"grey2"==t.Ce?(t.backgroundColor=n,t.xe=e,t.Pe=r,t.Ae=i):"black"==t.Ce?(t.backgroundColor=r,t.xe=i,t.Pe=e,t.Ae=n):"black2"==t.Ce?(t.backgroundColor=r,t.xe=i,t.Pe=n,t.Ae=e):"blackTrace"==t.Ce?(t.backgroundColor=r,t.xe=n,t.Pe=r,t.Ae=n):"blackTrace2"==t.Ce?(t.backgroundColor=r,t.xe=r,t.Pe=r,t.Ae=n):"blackTrace3"==t.Ce?(t.backgroundColor=r,t.xe=r,t.Pe=n,t.Ae=n):"redBlue"==t.Ce?(t.backgroundColor=r,t.xe=s,t.Pe={r:221,g:12,b:12,Re:255},t.Ae={r:29,g:29,b:189,Re:255}):"turquoiseRed"==t.Ce?(t.backgroundColor=r,t.xe=s,t.Pe={r:39,g:192,b:177,Re:255},t.Ae={r:252,g:53,b:47,Re:255}):"magentaCyan"==t.Ce?(t.backgroundColor=r,t.xe=s,t.Pe={r:156,g:36,b:150,Re:255},t.Ae={r:114,g:223,b:174,Re:255}):"variable"==t.Ce?(t.backgroundColor=r,t.xe=s,t.Pe=a,t.Ae=h):"mouseAnimation"==t.Ce&&(t.backgroundColor={r:0,g:0,b:0,Re:0},t.xe=i,t.Pe=r,t.Ae=e)}function D(t,e,i,n,r){let s=(e+n+t.Fe)%t.Fe,a=(i+r+t.$e)%t.$e,h=s,o=a;return(s-e-n>0||s-e-n<0)&&(o=(t.$e-a-t.Ge+t.$e)%t.$e),(a-i-r>0||a-i-r<0)&&(h=(t.Fe-s-t.Ue+t.Fe)%t.Fe),[h,o]}function H(t,e,i,n,r){let s=(e+n+t.Fe)%t.Fe,a=(i+r+t.$e)%t.$e,h=s,o=a;return(s-e-n>0||s-e-n<0)&&(o=(t.$e-a-t.Ge+t.$e)%t.$e),a-i-r>0?h=(s+t.Ue+t.Fe)%t.Fe:a-i-r<0&&(h=(s-t.Ue+t.Fe)%t.Fe),[h,o]}function q(t,e,i,n,r){let s=(e+n+t.Fe)%t.Fe,a=(i+r+t.$e)%t.$e,h=s,o=a;return s-e-n>0?o=(a+t.Ge+t.$e)%t.$e:s-e-n<0&&(o=(a-t.Ge+t.$e)%t.$e),(a-i-r>0||a-i-r<0)&&(h=(t.Fe-s-t.Ue+t.Fe)%t.Fe),[h,o]}function z(t,e,i,n,r){let s=(e+n+t.Fe)%t.Fe,a=(i+r+t.$e)%t.$e,h=s,o=a;return s-e-n>0?o=(a+t.Ge+t.$e)%t.$e:s-e-n<0&&(o=(a-t.Ge+t.$e)%t.$e),a-i-r>0?h=(s+t.Ue+t.Fe)%t.Fe:a-i-r<0&&(h=(s-t.Ue+t.Fe)%t.Fe),[h,o]}function _(t){t.Ee&&t.Te?t.t=D:t.Ee?t.t=H:t.Te?t.t=q:t.t=z}function Z(t){W(t,!0)}function J(t,e){if(t.Ve){var i=t.be.re[0].F(),n=new Blob([i],{type:"text/plain"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download="dataAutomata.txt",s.click()}}function K(t,e,i){var n=function(t){var e=Math.exp(-t),i=1,n=0;do{n++,i*=Math.random()}while(i>e);return n-1}(10**(t.Oe+t.be.re[0].T));if(0!=n)for(var r=t.be.re[0].j,s=t.be.re[0].V,a=0;a<n;a++){var h=Math.floor(Math.random()*t.Fe),o=Math.floor(Math.random()*t.$e);Q(e,t,s[r()],h,o,i)}}function Q(t,e,i,n,r,s){null===i?i=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?rt(t,t):e<.2?et(t,t):e<.3?tt(t,t):e<.4?function(t){let e=new S(t,t);for(let i=0;i<t;i++)for(let n=i;n<t;n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,i,e.get(i,n));return e}(t):e<.5?function(t){let e=new S(t,t);for(let i=0;i<t;i++)for(let n=i;n<t;n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(t-1-n,t-1-i,e.get(i,n));return e}(t):e<.6?it(t,t):e<.7?nt(t,t):e<.8?function(t){let e=new S(t,t);for(let i=0;i<t;i++)for(let n=Math.max(i,t-i);n<t;n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,i,e.get(i,n)),e.set(t-1-n,t-1-i,e.get(i,n)),e.set(t-1-i,t-1-n,e.get(i,n));return e}(t):e<.9?function(t){let e=new S(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let n=0;n<Math.ceil(t/2);n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,t-1-i,e.get(i,n)),e.set(t-1-i,t-1-n,e.get(i,n)),e.set(t-1-n,i,e.get(i,n));return e}(t):function(t){let e=new S(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let n=0;n<Math.ceil(t/2);n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,t-1-i,e.get(i,n)),e.set(t-1-i,t-1-n,e.get(i,n)),e.set(t-1-n,i,e.get(i,n)),e.set(t-1-i,n,e.get(i,n)),e.set(t-1-n,t-1-i,e.get(i,n)),e.set(i,t-1-n,e.get(i,n)),e.set(n,i,e.get(i,n));return e}(t)}(e);else{t=function(t,e){let i=Math.random();return i<.2?rt(t,e):i<.4?et(t,e):i<.6?tt(t,e):i<.8?it(t,e):nt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&i.I(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let a=i.height,h=i.width;for(let o=0;o<a;o++)for(let u=0;u<h;u++){let l=s(e,n,r,o-Math.floor(a/2),u-Math.floor(h/2));t.set(l[0],l[1],i.get(o,u))}}function tt(t,e){let i=new S(e,t);for(let n=0;n<t;n++)for(let t=0;t<Math.ceil(e/2);t++)i.set(n,t,Math.floor(1e5*Math.random())),i.set(n,e-1-t,i.get(n,t));return i}function et(t,e){let i=new S(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let r=0;r<e;r++)i.set(n,r,Math.floor(1e5*Math.random())),i.set(t-1-n,r,i.get(n,r));return i}function it(t,e){let i=new S(e,t);for(let n=0;n<t;n++)for(let r=0;r<Math.ceil(e/2);r++)i.set(n,r,Math.floor(1e5*Math.random())),i.set(t-1-n,e-1-r,i.get(n,r));return i}function nt(t,e){let i=new S(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let r=0;r<Math.ceil(e/2);r++)i.set(n,r,Math.floor(1e5*Math.random())),i.set(t-1-n,r,i.get(n,r)),i.set(n,e-1-r,i.get(n,r)),i.set(t-1-n,e-1-r,i.get(n,r));return i}function rt(t,e){let i=new S(e,t);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,Math.floor(1e5*Math.random()));return i}function st(t){!function(t){let e=t.je,i=t.We;for(var n=0,r=0,s=0;s<t.Fe;s++)for(var a=0;a<t.$e;a++){if(0==t.Xe.get(s,a))continue;n+=1;var h=Math.floor(t.grid.get(s,a)/t.be.ne)%4;let e;if(0==h)e=t.backgroundColor;else if(1==h)e=t.xe;else if(2==h)e=t.Pe;else{if(3!=h)continue;e=t.Ae}let o=4*(s*t.$e+a);r+=Math.sqrt((i.data[o+0]-e.r)**2+(i.data[o+1]-e.g)**2+(i.data[o+2]-e.b)**2),i.data[o+0]=e.r,i.data[o+1]=e.g,i.data[o+2]=e.b,i.data[o+3]=e.Re}t.Ye=.8*t.Ye+n/(t.Fe*t.$e)/5,t.Le=.01*n+.99*t.Le,t.ke=.01*r/(n+t.Fe*t.$e/30)+.99*t.ke,t.ke>330&&(t.Me=!0,t.Le,t.Fe,t.$e,console.log("Changing rule because suspected oscillation (std of color change: "+t.ke.toFixed(1)+")."),t.Le=15,t.ke=10,J(t));t.Le<3&&(t.Me=!0,console.log("Changing rule because not enough cells changed ("+t.Le+")."),t.Le=20,J(t)),e.putImageData(i,t.De,t.He)}(t),function(t){var n=[new Uint8Array(e[0]*t.be.re[0].P).fill(0),new Uint8Array(e[1]).fill(0)],r=new Uint8Array(5).fill(0),s=new S(t.$e,t.Fe),a=t.grid;const h=t.time,o=t.be.re[0].P;for(var u=0;u<t.Fe;u++)for(var l=0;l<t.$e;l++){var c=i(t,u,l,a,n,r,h,o,4);const e=t.grid.get(u,l);var f=e;f=t.we&&0!=t.mask.get(u,l)?t.Se.A(e,f,c,t.time,t.Ye):t.be.A(e,f,c,t.time,t.Ye),Math.floor(f/t.be.ne)%4!=Math.floor(e/t.be.ne)%4?t.Xe.set(u,l,1):t.Xe.set(u,l,0),s.set(u,l,f);for(let t=0;t<n.length;t++)n[t].fill(0);r.fill(0)}t.qe&&K(t,s,t.t),t.grid=s}(t),W(t),t.time=(t.time+1)%166320,t.ze&&function(t){Math.random()<1e-4&&(t.Ge=Math.floor(Math.random()*t.$e),console.log("Periodicity shift X: "+t.Ge)),Math.random()<1e-4&&(t.Ue=Math.floor(Math.random()*t.Fe),console.log("Periodicity shift Y: "+t.Ue)),Math.random()<1e-4&&(t.Ee=!t.Ee,_(t),console.log("Flip X: "+t.Ee)),Math.random()<1e-4&&(t.Te=!t.Te,_(t),console.log("Flip Y: "+t.Te))}(t),"variable"==t.Ce&&function(t){Math.random()<1&&(t.Ae=Y(t.Ae),t.Pe=Y(t.Pe))}(t),setTimeout((function(){requestAnimationFrame((()=>st(t)))}),t.timeout)}function at(t,e){return console.log("Attempting to load image"),(i=t._e,console.log("Loading image:",i),new Promise(((t,e)=>{const n=new Image;n.onload=()=>{console.log("Image loaded:",i);const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const r=e.getContext("2d");r.drawImage(n,0,0,n.width,n.height);const s=r.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<n.height;t++){const e=[];for(let i=0;i<n.width;i++){const r=4*(t*n.width+i),a=(s[r]+s[r+1]+s[r+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},n.onerror=()=>{console.error("Error loading image:",i),e(new Error("Error loading image"))},n.src=i}))).then((e=>{new S(t.$e,t.Fe);const i=new S(t.$e,t.Fe),n=e[0].length/t.$e,r=e.length/t.Fe,s=Math.max(n,r),a=Math.floor((t.$e-e[0].length/s)/2),h=Math.floor((t.Fe-e.length/s)/2);for(let n=0;n<t.Fe;n++)for(let r=0;r<t.$e;r++){if(n<h||(n-h)*s>=e.length){i.set(n,r,1);continue}let t=Math.floor((r-a)*s);0===e[Math.floor((n-h)*s)][t]?i.set(n,r,0):i.set(n,r,1)}t.mask=i})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new S(t.$e,t.Fe)}));var i}async function ht(t,e){if(null!==t._e&&await at(t),"zero"!=t.Ze)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new S(t.$e,t.Fe),t.Xe=new S(t.$e,t.Fe);for(var i=0;i<t.Fe;i++)for(var n=0;n<t.$e;n++)if("gr"!=t.Ze||1!==t.mask.get(i,n)){for(var r=Math.random(),s=0;s<e;s++)if(r<(s+1)/(e+1)){t.grid.set(i,n,s);break}t.Xe.set(i,n,1)}else t.grid.set(i,n,0)}))}(t);t.grid=new Grid(t.$e,t.Fe),t.Xe=new Grid(t.$e,t.Fe)}function ot(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){Object.keys(t).forEach((t=>{let e=document.getElementById(t);var i;e&&(i="checkbox"===e.type?e.checked:"number"===e.type||"range"===e.type?parseFloat(e.value):e.value,localStorage.setItem(t,i))})),location.reload()}(t)}))}function ut(t){document.getElementById("randomnessAmount").addEventListener("input",(function(){!function(t,e){t.Oe=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var lt={canvas:document.getElementById("gameCanvas"),je:document.getElementById("gameCanvas").getContext("2d"),Fe:192,$e:192,timeout:30,qe:!0,Oe:-1.5,ze:!0,Ge:0,Ue:0,Ee:!1,Te:!1,Ce:"variable",pe:"Variable",Ze:"random",Je:2e4,Ke:2e3},ct=new class{constructor({canvas:t,je:e,Fe:i=200,$e:n=200,timeout:r=20,qe:s=!0,Oe:a=-2,ze:h=!0,Ge:o=0,Ue:u=0,Ee:l=!1,Te:c=!1,Ce:f="black2",pe:m="VariableGR",Ze:d="random",Je:g=2e4,Ke:M=2e3,_e:p=null,we:b=!1}={}){this.grid=null,this.Fe=i,this.$e=n,this.Ge=o,this.Ue=u,this.Ee=l,this.Te=c,this.mask=null,this.t=null,this.canvas=t,this.je=e,this.De=0,this.He=0,this.canvas.width=this.$e,this.canvas.height=this.Fe,this.Xe=null,this.We=e.createImageData(t.width,t.height),this.Ce=f,this.Ze=d,this._e=p,this.we=b,this.timeout=r,this.qe=s,this.Oe=a,this.ze=h,this.pe=m,this.Qe=null,this.ti=null,this.Je=g,this.Ke=M,this.time=0,this.ge=-25,this.Be=-25,this.Ie=25/this.Je,this.ye=25/this.Ke,this.Me=!0,this.Ne=!1,this.Ye=0,this.Le=0,this.ke=0,this.Ve=!1}}(lt);window.onload=function(){!function(t){document.getElementById("addRandomness").addEventListener("change",(function(){t.qe=this.checked}))}(ct),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(ct),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var i=t.canvas.getBoundingClientRect(),n=e.clientX-i.left,r=e.clientY-i.top,s=i.width/t.$e,a=i.height/t.Fe,h=Math.floor(n/s),o=Math.floor(r/a);t.grid.set(o,h,1)}}))}(ct),function(t){t.canvas.addEventListener("mousedown",(function(e){var i=t.canvas.getBoundingClientRect(),n=e.clientX-i.left,r=e.clientY-i.top,s=i.width/t.$e,a=i.height/t.Fe,h=Math.floor(n/s),o=Math.floor(r/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(o,(h+1)%t.$e,1),t.grid.set(o,h,1),t.grid.set((o+1)%t.Fe,h,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(o,h,1),t.grid.set((o+1)%t.Fe,h,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(o,h,1),t.grid.set(o,(h+1)%t.$e,1)):(t.grid.set((o+1)%t.Fe,(h+1)%t.$e,1),t.grid.set((o-1+t.Fe)%t.Fe,(h+1)%t.$e,1),t.grid.set((o-1+t.Fe)%t.Fe,(h-1+t.$e)%t.$e,1),t.grid.set((o+1)%t.Fe,(h-1+t.$e)%t.$e,1))}))}(ct),ot(ct),ut(ct),function(t){document.getElementById("gridPeriodicityShiftX").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.Ge=e,_(t)})),document.getElementById("gridPeriodicityShiftY").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.Ue=e,_(t)})),document.getElementById("gridFlipX").addEventListener("change",(function(){t.Ee=this.checked,_(t)})),document.getElementById("gridFlipY").addEventListener("change",(function(){t.Te=this.checked,_(t)}))}(ct),function(t){document.getElementById("timeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(ct),function(t){document.getElementById("colorPalette").addEventListener("change",(function(){t.Ce=this.value,L(t)}))}(ct),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.pe=this.value,Z(t)}))}(ct),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.Me=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.Ne=!0}))}(ct),function(t){document.getElementById("changeColor").addEventListener("click",(function(){L(t)}))}(ct),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.Ve=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){J(t)})),document.getElementById("dislikeButton").addEventListener("click",(function(){J(t)}))}(ct),function(t){Object.keys(t).forEach((e=>{let i=localStorage.getItem(e);null!==i&&("boolean"==typeof t[e]?t[e]="true"===i:"number"==typeof t[e]?t[e]=parseFloat(i):t[e]=i)}))}(ct),function(t){Object.keys(t).forEach((e=>{let i=document.getElementById(e);i&&("checkbox"===i.type?i.checked=t[e]:i.value=t[e])}))}(ct),function(t){t.canvas.width=Math.max(t.Fe,t.$e),t.canvas.height=Math.max(t.Fe,t.$e),t.De=0,t.He=0;var e=document.getElementById("gameCanvas");if(t.Fe>t.$e){var i=Math.floor(t.$e/t.Fe*800);e.style.width=i+"px",e.style.height="800px",e.width=i*t.Fe/800,e.height=t.Fe}else{var n=Math.floor(t.Fe/t.$e*800);e.style.width="800px",e.style.height=n+"px",e.width=t.$e,e.height=n*t.$e/800}t.We=t.je.createImageData(t.$e,t.Fe)}(ct),L(ct),_(ct),Z(ct);let t=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==t&&""!==window.location.hostname||ht(ct).then((()=>{st(ct)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
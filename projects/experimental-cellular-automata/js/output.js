(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),n=Object.values(t).reduce(((t,n,r)=>[...t,n/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=n.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[44,44];function n(t,e,n,r,i,s,o){const a=r.height-1,h=r.width-1,u=r.data,l=r.width;for(var c=i[0],m=i[1],d=-1;d<=1;d++)for(var f=-1;f<=1;f++){if(0==d&&0==f)continue;if(s[0]=((-1===d?1:d)+(-1===f?1:f))%2,s[1+(3&o)]=-1==d?1:0,s[1+(1+o&3)]=-1==f?1:0,s[1+(2+o&3)]=1==d?1:0,s[1+(3+o&3)]=1==f?1:0,0==e||0==n||e==a||n==h)var[g,M]=t.t(t,e,n,d,f);else var g=e+d,M=n+f;const r=u[g*l+M],i=3&r,v=(15&r)>>2;if(1==i){c[0]+=1;for(var p=0;p<s.length;p++)c[4+8*p]+=s[p],c[8*(p+1)]+=1-s[p]}else if(2==i){c[2]+=1;for(p=0;p<s.length;p++)c[4+8*p+2]+=s[p],c[8*(p+1)+2]+=1-s[p]}else if(3==i){c[3]+=1;for(p=0;p<s.length;p++)c[4+8*p+3]+=s[p],c[8*(p+1)+3]+=1-s[p]}if(0==v){m[0]+=1;for(p=0;p<s.length;p++)m[4+8*p]+=s[p],m[8*(p+1)]+=1-s[p]}else if(1==v){m[1]+=1;for(p=0;p<s.length;p++)m[4+8*p+1]+=s[p],m[8*(p+1)+1]+=1-s[p]}else if(2==v){m[2]+=1;for(p=0;p<s.length;p++)m[4+8*p+2]+=s[p],m[8*(p+1)+2]+=1-s[p]}else if(3==v){m[3]+=1;for(p=0;p<s.length;p++)m[4+8*p+3]+=s[p],m[8*(p+1)+3]+=1-s[p]}}for(p=0;p<s.length+1;p++)c[4*p+1]+=c[4*p]+c[4*p+3];return[c,m]}const r="mix",i="isotropic",s="xcross",o="vcross",a="xvcross",h="directional1",u="directional2",l="directional3",c="directional2b",m="directional",d={[r]:.2,[i]:.4,[s]:.05,[o]:.05,[a]:.05,[h]:.05,[u]:.05,[l]:.05,[c]:.05,[m]:.05};const f="A",g="C",M="E",p="B";class v{constructor(t,e,n,r,i,s=null){this.type=t,this.threshold=e,this.i=n,this.o=r,this.h=i,this.u=s,this.l=function(t,e){return t==g?function(t){return 0==t}:t==f?function(t){return t%e==0}:function(t){return!0}}(this.o,this.h),this.m=function(t,e,n){return e==M?function(e){return e[n[0]][n[1]]==t}:e==p?function(e){return e[n[0]][n[1]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(s)}test(t,e,n){var r=this.M(n);return this.m(t)&&this.l(e)&&r}name(){var t="";return null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.o}[${this.i[0]}|${this.i[1]}]${t}`}static p(t,e=4){var n=null;t.startsWith(M)?n=M:t.startsWith(p)&&(n=p);var r=t.substring(n.length),i=parseInt(r.substring(0,1)),s=null;(r=r.substring(1)).startsWith(g)?s=g:r.startsWith(f)?s=f:r.startsWith("N")&&(s="N");var o=(r=r.substring(s.length)).split("[")[1].split("]")[0].split("|").map(Number),a=null;return(r=r.split("]")[1]).length>0&&(a=r.split("").map((t=>"1"===t))),new v(n,i,o,s,e,a)}static v(e=null,n=4,d=r,b=null){const w=[M,p],S=w[Math.floor(Math.random()*w.length)],k=[g,f,"N"],R=k[Math.floor(Math.random()*k.length)];null===e&&(e={0:2/3,1:1/3});const C=t(e)(),N=function(t,e){var n=e;if(n==r){var d=Math.random();n=d<.5?i:d<.7?s:d<.9?o:m}if(n==i)return Math.floor(4*Math.random());if(n==o)return Math.floor(4*Math.random()+4);if(n==s)return Math.floor(4*Math.random()+8);if(n==a)return Math.floor(8*Math.random()+4);if(n==h)return Math.floor(4*Math.random()+12);if(n==u)return Math.floor(8*Math.random()+12);if(n==l)return Math.floor(12*Math.random()+12);if(n==c){var f=Math.floor(8*Math.random()+12);return f>=16&&(f+=4),f}return n==m?Math.floor(16*Math.random()+12):void 0}(0,d),y=[C,N];var x=0,B=8;if(0==y[0]&&y[1]%4!=1?B=5:y[1]>4&&y[1]<=16?B=4:y[1]>16&&(B=3),x=S===p?Math.floor(Math.random()*B):Math.floor(Math.random()*B)+1,Math.random()<.2)A=null;else{var A;null==b&&(b=Math.floor(20*Math.random())+2);do{A=new Array(b).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new v(S,x,y,R,n,A)}}class b{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.S=!1,this.get=this.k,this.set=this.R}static C(t,e=!1,n=!1,r=!1){const i=t.length,s=t[0].length,o=new b(s,i);for(let e=0;e<i;e++){r&&(e=i-e-1);for(let r=0;r<s;r++)n&&(r=s-r-1),o.set(e,r,t[e][r])}return e&&o.N(),o}N(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.S?[this.k,this.R]:[this.B,this.A],this.S=!this.S}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const n=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,n)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const n=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,n)}}k(t,e){return this.data[t*this.width+e]}R(t,e,n){this.data[t*this.width+e]=n}B(t,e){return this.data[e*this.height+t]}A(t,e,n){this.data[e*this.height+t]=n}}class w{constructor(){this.F=void 0}G(t,e,n,r){throw new Error("Must override method")}P(){throw new Error("Must override method")}}class S extends w{constructor(){super(),this.I=this.T(),this.V(),this.U=0}T(){throw new Error("Must override method")}V(){this.X=Object.keys(this.I).map((t=>this.I[t].mask));let e=Object.keys(this.I).map((t=>this.I[t].Y));this.O=t(e)}}class k extends S{constructor(){super(),this.F=4}G(t,e,n,r){var i=t%4;return 1==i||3==i?e=2:2==i?e=0:0==i&&2==n[0][0]?e=1:0==i&&n[0][0]>2&&(e=3),e}P(){return"BB"}T(){return{random:{Y:10,mask:null},W:{Y:2,mask:b.C([[1,0],[0,1]])},j:{Y:2,mask:b.C([[0,1],[1,0]])},H:{Y:2,mask:b.C([[1,0],[0,1]])},L:{Y:4,mask:b.C([[1,1],[1,1]])},$:{Y:4,mask:new b([[1,0,1],[0,0,0],[1,0,1]])},D:{Y:2,mask:b.C([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},q:{Y:2,mask:b.C([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},Z:{Y:2,mask:b.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},J:{Y:2,mask:b.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class R extends S{constructor(){super(),this.F=4,this.U=-1}G(t,e,n,r){var i=t%4;return 3==i&&(i=0),1==i?e=2:2==i||3==i?e=0:0!=i&&3!=i||2!=n[0][0]?0==i&&n[0][0]>2&&(e=3):e=1,e}P(){return"TBB"}T(){return{random:{Y:10,mask:null},Z:{Y:1,mask:b.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},D:{Y:2,mask:b.C([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},q:{Y:2,mask:b.C([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},L:{Y:4,mask:b.C([[1,1],[1,1]])},K:{Y:1e4,mask:b.C([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class C extends S{constructor(){super(),this.F=4,this.U=-1}G(t,e,n,r){var i=t%4;return 1==i&&(n[0][0]<3||n[0][0]>5)?e=2:2==i?e=3:3==i?e=0:0==i&&2==n[0][0]&&(e=1),e}P(){return"SW"}T(){let t=.2;return{random:{Y:3,mask:null},_:{Y:1,mask:b.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},tt:{Y:t,mask:b.C([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},et:{Y:t,mask:b.C([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},nt:{Y:t,mask:b.C([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},rt:{Y:t,mask:b.C([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},it:{Y:t,mask:b.C([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},st:{Y:t,mask:b.C([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},ot:{Y:t,mask:b.C([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},ht:{Y:t,mask:b.C([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ut:{Y:t,mask:b.C([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},lt:{Y:t,mask:b.C([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ct:{Y:t,mask:b.C([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},dt:{Y:t,mask:b.C([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},ft:{Y:t,mask:b.C([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},gt:{Y:t,mask:b.C([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Mt:{Y:t,mask:b.C([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},vt:{Y:t,mask:b.C([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},$:{Y:2,mask:b.C([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class N extends S{constructor(t){super(),this.bt=t;const e=this.bt.split("/");this.wt=new Uint8Array(e[0].substring(1).split("").map(Number)),this.St=new Uint8Array(e[1].substring(1).split("").map(Number)),"I"==e[2][0]?(this.kt=new Uint8Array(e[2].substring(1).split("").map(Number)),this.F=Number(e[3])):this.F=Number(e[2])}G(t,e,n,r){var i=t%this.F;return 1==i&&this.St.includes(n[0][0])?e=1:i>0&&i<this.F-1?e+=1:i==this.F-1?e=0:0==i&&this.wt.includes(n[0][0])?e=1:0==i&&this.kt.includes(n[0][0])&&(e=this.F-1),e}P(){return this.bt}T(){return{random:{Y:1,mask:null}}}}class y extends S{constructor(){super(),this.F=4,this.U=.4}G(t,e,n,r){var i=t%4,s=n[0][1];return 1!=i&&3!=i||!(s<2||s>3)?1!=i&&3!=i||2!=s&&3!=s?0!=i&&2!=i||3!=s?2==i&&(e=0):e=3:e=1:e=2,e}T(){return{Rt:{Y:1,mask:null}}}P(){return"CW"}}class x extends w{constructor(t,e,n,r,i){super(),this.Ct=e,this.Nt=t,this.F=this.Ct,this.yt=n,this.xt=r,this.Bt=i}G(t,e,n,r){e=0;for(let i=0;i<this.Nt.length;i++)if(this.Nt[i].test(n,t,r)){e=(i+1)%this.Ct;break}return e}P(){return this.Nt.map((t=>t.name())).join("||")}static At(e=null,n=null,r=null,i=4,s=4,o=null){var a=[];null==e&&(e=Math.floor(8*Math.random())+2),null==r&&(r=t(d)()),null==o&&(o=this.Ft());for(let t=0;t<e;t++)a.push(v.v(n,i,r,o));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+r+": "+a.map((t=>t.name())).join(", ")),new x(a,s,n,r,o)}static Ft(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Gt(t,e=4){var n=t.split("||").map((t=>v.p(t)));return new x(n,e,null,r,null)}Pt(t=null){var e,n=this.Nt.length;null==t&&(t=this.yt),0==(e=2==n?Math.floor(2*Math.random())+1:10==n?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.It():1==e?this.Tt(t):this.Vt(t)}Vt(t){var e=this.Nt.slice();e.push(v.v(t,4,this.xt,this.Bt)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.xt+": "+e.map((t=>t.name())).join("||")),this.Nt=e}It(){var t=this.Nt.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.Nt=t}Tt(t){var e=this.Nt.slice(),n=Math.floor(Math.random()*e.length);e[n]=v.v(t,4,this.xt,this.Bt),console.log((new Date).toLocaleTimeString()+" Changing condition "+n+" to "+this.xt+": "+e.map((t=>t.name())).join("||")),this.Nt=e}}const B="gr",A="safe",F="mix",G="general",P="test";class I{Et;Ut;G;Xt(){throw new Error("Must override method")}Yt(){return function(t,e,n,r){e=this.Ut[0].G(t%this.Ut[0].F,e,n,r);var i=this.Ut[0].F;for(let s=1;s<this.Ut.length;s++)e+=i*this.Ut[s].G(Math.floor(t/i)%this.Ut[s].F,e,n,r),e%=i*=this.Ut[s].F;return e%i}}Ot(){throw new Error("Must override method")}P(){return this.Ut.map((t=>t.P())).join("-")}}class T extends I{constructor(t){super(),this.Wt=t,this.Et=1,this.Ut=this.Xt(),this.G=this.Yt()}Xt(){var t=[];return"Original"==this.Wt?t.push(new R):"StarWars"==this.Wt?t.push(new C):"Modified"==this.Wt?t.push(new k):"Conway"==this.Wt?t.push(new y):t.push(new N(this.Wt)),t}Ot(){}}class V extends I{constructor(t,e,n=null){super(),this.Wt=t,this.yt=e,this.Bt=null,this.jt=null,null==e&&(t==A||t==B||t==P?this.yt={0:1,1:0}:t==F?(Math.random()<.5?this.yt={0:.8,1:.2}:this.yt={0:1,1:0},this.yt={0:.8,1:.2}):this.yt={0:.5,1:.5}),t==B&&(this.Bt=1),this.Et=4,this.Ut=null==n?this.Xt():this.Ht(n),this.G=this.Yt()}Xt(){var t=[],e=Math.random();return this.Wt==B?t.push(new k):this.Wt==A?e<.3?t.push(new k):e<.4?t.push(new R):e<.7?t.push(new C):t.push(new y):(e<.3?t.push(new k):e<.4?t.push(new R):e<.7?t.push(new C):e<1?t.push(new y):this.Wt,0==t.length&&t.push(new k)),t.push(x.At(null,this.yt,this.jt,4,4,this.Bt)),this.Wt==P&&((t=[]).push(new N("B2/S245678/I1/4")),t.push(x.At(null,this.yt,this.jt,4,4,this.Bt))),t}Ot(){this.Ut[1].Pt(this.yt)}Ht(t){var e=[],[n,r]=t.split("-");return"BB"==n?e.push(new k):"TBB"==n?e.push(new R):"SW"==n&&e.push(new C),e.push(new C),e.push(x.Gt(r)),e}}class E extends I{constructor(t,e,n=null){super(),this.Wt=t,this.yt=e,this.Bt=null,this.jt=null,null==e&&(t==A?this.yt={0:1,1:0}:t==F?(Math.random()<.5?this.yt={0:.8,1:.2}:this.yt={0:1,1:0},this.yt={0:.8,1:.2}):this.yt={0:.5,1:.5}),this.Et=16,this.Ut=null==n?this.Xt():this.Ht(n),this.G=this.Yt()}Xt(){var t=[];return t.push(new k),t.push(x.At(null,this.yt,this.jt,4,4,this.u)),t.push(x.At(null,this.yt,this.jt,16,4,this.u)),t}Ot(){this.Ut[1].Pt(this.yt),this.Ut[2].Pt(this.yt)}Ht(t){var e=[],n=t.split("-")[1];return e.push(new k),e.push(x.Gt(n)),e}}function U(t,e=!1){Math.random()<Math.exp(t.Lt)||e||t.$t?("VariableGR"==t.Dt?(t.zt=new V(B),t.qt=new V(B)):"VariableDemo"==t.Dt?t.zt=new V(B):"Variable"==t.Dt?t.zt=new V(A):"VariableMix"==t.Dt?t.zt=new V(F):"VariableUnsafe"==t.Dt?t.zt=new V(G):"VariableTest"==t.Dt?t.zt=new V(P):"Variable2Unsafe"==t.Dt?t.zt=new E(G):"CustomRule"==t.Dt?t.zt=new V(null,null,t.Zt):"OriginalBB"==t.Dt?t.zt=new T("Original"):"ModifiedBB"==t.Dt?t.zt=new T("Modified"):"StarWars"==t.Dt?t.zt=new T("StarWars"):"Conway"==t.Dt?t.zt=new T("Conway"):"SparseFourStates"==t.Dt?t.zt=new T("B2/S245678/I1/4"):t.zt=new V(F),t.Lt=-25,t.Jt=-25,t.$t=!1,X(t)):(Math.random()<Math.exp(t.Jt)||t.Kt)&&"CustomRule"!=t.Dt&&(t.zt.Ot(),"VariableGR"==t.Dt&&t.qt.Ot(),t.Jt=-25,t.Kt=!1,X(t)),t.Lt=t.Lt+t.Qt,t.Lt>0&&(t.Lt=0),t.Jt=t.Jt+t._t,t.Jt>0&&(t.Jt=0)}function X(t){var e=document.getElementById("currentStyle");e&&(e.value=t.zt.P())}function Y(t){let e={};for(let n in t){if("t"==n)continue;let r=Math.floor(3*Math.random())-1,i=t[n]+r;i=Math.max(0,Math.min(255,i)),e[n]=i}return e.te=t.te,e}function O(t){var e={r:247,g:255,b:28,te:255},n={r:13,g:112,b:255,te:255},r={r:240,g:239,b:239,te:255},i={r:0,g:0,b:0,te:255},s={r:240,g:240,b:240,te:255},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),te:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),te:255};"yellow"==t.ee?(t.backgroundColor=e,t.ne=i,t.re=n,t.ie=r):"blue"==t.ee?(t.backgroundColor=n,t.ne=r,t.re=i,t.ie=e):"blue2"==t.ee?(t.backgroundColor=n,t.ne=e,t.re=i,t.ie=r):"grey"==t.ee?(t.backgroundColor=r,t.ne=i,t.re=n,t.ie=e):"grey2"==t.ee?(t.backgroundColor=r,t.ne=e,t.re=i,t.ie=n):"black"==t.ee?(t.backgroundColor=i,t.ne=n,t.re=e,t.ie=r):"black2"==t.ee?(t.backgroundColor=i,t.ne=n,t.re=r,t.ie=e):"blackTrace"==t.ee?(t.backgroundColor=i,t.ne=r,t.re=i,t.ie=r):"blackTrace2"==t.ee?(t.backgroundColor=i,t.ne=i,t.re=i,t.ie=r):"blackTrace3"==t.ee?(t.backgroundColor=i,t.ne=i,t.re=r,t.ie=r):"redblue"==t.ee?(t.backgroundColor=i,t.ne=s,t.re={r:221,g:85,b:12,te:255},t.ie={r:49,g:130,b:189,te:255}):"variable"==t.ee?(t.backgroundColor=i,t.ne=s,t.re=o,t.ie=a):"mouseAnimation"==t.ee&&(t.backgroundColor={r:0,g:0,b:0,te:0},t.ne=n,t.re=i,t.ie=e)}function W(t,e,n,r,i){let s=(e+r+t.se)%t.se,o=(n+i+t.oe)%t.oe,a=s,h=o;return(s-e-r>0||s-e-r<0)&&(h=(t.oe-o-t.ae+t.oe)%t.oe),(o-n-i>0||o-n-i<0)&&(a=(t.se-s-t.he+t.se)%t.se),[a,h]}function j(t,e,n,r,i){let s=(e+r+t.se)%t.se,o=(n+i+t.oe)%t.oe,a=s,h=o;return(s-e-r>0||s-e-r<0)&&(h=(t.oe-o-t.ae+t.oe)%t.oe),o-n-i>0?a=(s+t.he+t.se)%t.se:o-n-i<0&&(a=(s-t.he+t.se)%t.se),[a,h]}function H(t,e,n,r,i){let s=(e+r+t.se)%t.se,o=(n+i+t.oe)%t.oe,a=s,h=o;return s-e-r>0?h=(o+t.ae+t.oe)%t.oe:s-e-r<0&&(h=(o-t.ae+t.oe)%t.oe),(o-n-i>0||o-n-i<0)&&(a=(t.se-s-t.he+t.se)%t.se),[a,h]}function L(t,e,n,r,i){let s=(e+r+t.se)%t.se,o=(n+i+t.oe)%t.oe,a=s,h=o;return s-e-r>0?h=(o+t.ae+t.oe)%t.oe:s-e-r<0&&(h=(o-t.ae+t.oe)%t.oe),o-n-i>0?a=(s+t.he+t.se)%t.se:o-n-i<0&&(a=(s-t.he+t.se)%t.se),[a,h]}function $(t){t.ue&&t.le?t.t=W:t.ue?t.t=j:t.le?t.t=H:t.t=L}function D(t){U(t,!0)}function z(t,e){if(t.ce){var n={...t.me};delete n.de,delete n.Nt;var r={...n,event:e},i=Object.keys(r).join(",")+"\n";i+=Object.values(r).join(",");var s=new Blob([i],{type:"text/csv"}),o=URL.createObjectURL(s),a=document.createElement("a");a.href=o,a.download="dataAutomata.csv",a.click()}}function q(t,e,n){for(var r=function(t){var e=Math.exp(-t),n=1,r=0;do{r++,n*=Math.random()}while(n>e);return r-1}(10**(t.fe+t.zt.Ut[0].U)),i=t.zt.Ut[0].O,s=t.zt.Ut[0].X,o=0;o<r;o++){var a=Math.floor(Math.random()*t.se),h=Math.floor(Math.random()*t.oe);Z(e,t,s[i()],a,h,n)}}function Z(t,e,n,r,i,s){null===n?n=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,n=new b(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,Math.floor(1e5*Math.random()));return n}():(Math.random()<.5&&n.N(),Math.random()<.5&&n.flipX(),Math.random()<.5&&n.flipY());let o=n.height,a=n.width;for(let h=0;h<o;h++)for(let u=0;u<a;u++){let l=s(e,r,i,h-Math.floor(o/2),u-Math.floor(a/2));t.set(l[0],l[1],n.get(h,u))}}function J(t){!function(t){let e=t.ge,n=t.Me;for(var r=0,i=0;i<t.se;i++)for(var s=0;s<t.oe;s++){if(0==t.pe.get(i,s))continue;r+=1;var o=Math.floor(t.grid.get(i,s)/t.zt.Et)%4;let e;if(0==o)e=t.backgroundColor;else if(1==o)e=t.ne;else if(2==o)e=t.re;else{if(3!=o)continue;e=t.ie}let a=4*(i*t.oe+s);n.data[a+0]=e.r,n.data[a+1]=e.g,n.data[a+2]=e.b,n.data[a+3]=e.te}if(t.ve=.01*r+.99*t.ve,t.ve>.5*t.se*t.oe){t.$t=!0;var a=t.ve/(t.se*t.oe);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+a.toFixed(1)+")."),t.ve=15,z(t,"oscillation")}t.ve<3&&(t.$t=!0,console.log("Changing rule because not enough cells changed ("+t.ve+")."),t.ve=20,z(t,"blackout")),e.putImageData(n,t.be,t.we)}(t),function(t){var r=[new Uint8Array(e[0]).fill(0),new Uint8Array(e[1]).fill(0)],i=new Uint8Array(5).fill(0),s=new b(t.oe,t.se),o=t.grid;const a=t.time;for(var h=0;h<t.se;h++)for(var u=0;u<t.oe;u++){var l=n(t,h,u,o,r,i,a);const e=t.grid.get(h,u);var c=e;c="VariableGR"!=t.Dt||0==t.mask.get(h,u)?t.zt.G(e,c,l,t.time):t.qt.G(e,c,l,t.time),Math.floor(c/t.zt.Et)%4!=Math.floor(e/t.zt.Et)%4?t.pe.set(h,u,1):t.pe.set(h,u,0),s.set(h,u,c);for(let t=0;t<r.length;t++)r[t].fill(0);i.fill(0)}t.Se&&q(t,s,t.t),t.grid=s}(t),U(t),t.time=(t.time+1)%166320,t.ke&&function(t){Math.random()<1e-4&&(t.ae=Math.floor(Math.random()*t.oe),console.log("Periodicity shift X: "+t.ae)),Math.random()<1e-4&&(t.he=Math.floor(Math.random()*t.se),console.log("Periodicity shift Y: "+t.he)),Math.random()<1e-4&&(t.ue=!t.ue,$(t),console.log("Flip X: "+t.ue)),Math.random()<1e-4&&(t.le=!t.le,$(t),console.log("Flip Y: "+t.le))}(t),"variable"==t.ee&&function(t){Math.random()<1&&(t.ie=Y(t.ie),t.re=Y(t.re))}(t),setTimeout((function(){requestAnimationFrame((()=>J(t)))}),t.timeout)}function K(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const r=new Image;r.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const s=i.getImageData(0,0,e.width,e.height).data,o=[];for(let t=0;t<r.height;t++){const e=[];for(let n=0;n<r.width;n++){const i=4*(t*r.width+n),o=(s[i]+s[i+1]+s[i+2])/3;e.push(o>128?1:0)}o.push(e)}t(o)},r.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},r.src=n}))).then((e=>{new b(t.oe,t.se);const n=new b(t.oe,t.se),r=e[0].length/t.oe,i=e.length/t.se,s=Math.max(r,i),o=Math.floor((t.oe-e[0].length/s)/2),a=Math.floor((t.se-e.length/s)/2);for(let r=0;r<t.se;r++)for(let i=0;i<t.oe;i++){if(r<a||(r-a)*s>=e.length){n.set(r,i,1);continue}let t=Math.floor((i-o)*s);0===e[Math.floor((r-a)*s)][t]?n.set(r,i,0):n.set(r,i,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new b(t.oe,t.se)}));var n}async function Q(t,e){if("VariableGR"==t.Dt&&await K(t),"zero"!=t.Re)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new b(t.oe,t.se),t.pe=new b(t.oe,t.se);for(var n=0;n<t.se;n++)for(var r=0;r<t.oe;r++)if("gr"!=t.Re||1!==t.mask.get(n,r)){for(var i=Math.random(),s=0;s<e;s++)if(i<(s+1)/(e+1)){t.grid.set(n,r,s);break}t.pe.set(n,r,1)}else t.grid.set(n,r,0)}))}(t);t.grid=new Grid(t.oe,t.se),t.pe=new Grid(t.oe,t.se)}function _(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){var e=document.getElementById("userGridHeight").value,n=document.getElementById("userGridWidth").value,r=document.getElementById("userTimeout").value,i=document.getElementById("userXShift"),s=i?i.value:t.Ce,o=document.getElementById("userYShift"),a=o?o.value:t.Ne,h=document.getElementById("userFlipX"),u=h?h.checked:t.ye,l=document.getElementById("userFlipY"),c=l?l.checked:t.xe,m=document.getElementById("randomnessCheckbox"),d=m?m.checked:t.Se,f=document.getElementById("randomnessSlider"),g=f?f.value:t.fe,M=document.getElementById("userColorPalette").value,p=document.getElementById("metaRule").value,v=null;document.getElementById("currentStyle")&&(v=document.getElementById("currentStyle").value),localStorage.setItem("userGridHeight",e),localStorage.setItem("userGridWidth",n),localStorage.setItem("userTimeout",r),localStorage.setItem("userXShift",s),localStorage.setItem("userYShift",a),localStorage.setItem("userFlipX",u),localStorage.setItem("userFlipY",c),localStorage.setItem("userColorPalette",M),localStorage.setItem("userRandomnessOn",d),localStorage.setItem("userRandomnessAmount",g),localStorage.setItem("metaRule",p),localStorage.setItem("currentStyle",v),location.reload()}(t)}))}function tt(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.fe=e,document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var et=document.getElementById("gameCanvas"),nt=et.getContext("2d"),rt=192,it=192,st=30,ot=!0,at=-1.5,ht=!0,ut=0,lt=0,ct=!1,mt=!1,dt="variable",ft="Variable",gt="random",Mt=8,pt=2e4,vt=2e3,bt=new class{constructor(t,e,n=200,r=200,i=20,s=!0,o=-2,a=!0,h=0,u=0,l=!1,c=!1,m="black2",d="VariableGR",f="random",g=6,M=2e4,p=2e3){this.se=n,this.oe=r,this.be=0,this.we=0,this.timeout=i,this.grid=null,this.pe=null,this.Me=null,this.canvas=t,this.ge=e,this.Se=s,this.fe=o,this.ke=a,this.ae=h,this.he=u,this.ue=l,this.le=c,this.ee=m,this.Dt=d,this.Re=f,this.Be=g,this.Ae=null,this.Fe=null,this.t=null,this.mask=null,this.Ge=M,this.Pe=p,this.Lt=-25,this.Jt=-25,this.Qt=25/this.Ge,this._t=25/this.Pe,this.canvas.width=this.oe,this.canvas.height=this.se,this.Me=e.createImageData(t.width,t.height),this.$t=!0,this.Kt=!1,this.ve=0,this.ce=!1,this.time=0}}(et,nt,rt,it,st,ot,at,ht,ut,lt,ct,mt,dt,ft,gt,Mt,pt,vt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.Se=this.checked}))}(bt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(bt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,s=n.width/t.oe,o=n.height/t.se,a=Math.floor(r/s),h=Math.floor(i/o);t.grid.set(h,a,1)}}))}(bt),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,s=n.width/t.oe,o=n.height/t.se,a=Math.floor(r/s),h=Math.floor(i/o);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(h,(a+1)%t.oe,1),t.grid.set(h,a,1),t.grid.set((h+1)%t.se,a,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(h,a,1),t.grid.set((h+1)%t.se,a,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(h,a,1),t.grid.set(h,(a+1)%t.oe,1)):(t.grid.set((h+1)%t.se,(a+1)%t.oe,1),t.grid.set((h-1+t.se)%t.se,(a+1)%t.oe,1),t.grid.set((h-1+t.se)%t.se,(a-1+t.oe)%t.oe,1),t.grid.set((h+1)%t.se,(a-1+t.oe)%t.oe,1))}))}(bt),_(bt),tt(bt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.ae=e,$(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.he=e,$(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.ue=this.checked,$(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.le=this.checked,$(t)}))}(bt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(bt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.ee=this.value,O(t)}))}(bt),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.Dt=this.value,D(t)}))}(bt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.$t=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.Kt=!0}))}(bt),function(t){document.getElementById("changeColor").addEventListener("click",(function(){O(t)}))}(bt),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.ce=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){z(t,"like")})),document.getElementById("dislikeButton").addEventListener("click",(function(){z(t,"dislike")}))}(bt),function(t){null!==localStorage.getItem("userGridHeight")?(t.se=parseInt(localStorage.getItem("userGridHeight")),t.oe=parseInt(localStorage.getItem("userGridWidth")),t.se>1e3&&(t.se=1e3),t.oe>1e3&&(t.oe=1e3),t.Me=t.ge.createImageData(t.oe,t.se),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.ae=parseInt(localStorage.getItem("userXShift")),isNaN(t.ae)&&(t.ae=0),isNaN(t.he)&&(t.he=0),t.he=parseInt(localStorage.getItem("userYShift")),t.ue="true"===localStorage.getItem("userFlipX"),t.le="true"===localStorage.getItem("userFlipY"),t.ee=localStorage.getItem("userColorPalette"),t.Se="true"===localStorage.getItem("userRandomnessOn"),t.fe=parseFloat(localStorage.getItem("userRandomnessAmount")),t.Dt=localStorage.getItem("metaRule"),t.Zt=localStorage.getItem("currentStyle"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.se,document.getElementById("userGridWidth").value=t.oe,document.getElementById("userTimeout").value=t.timeout;let e=document.getElementById("userXShift");e&&(e.value=t.ae);let n=document.getElementById("userYShift");n&&(n.value=t.he);let r=document.getElementById("userFlipX");r&&(r.checked=t.ue);let i=document.getElementById("userFlipY");i&&(i.checked=t.le);let s=document.getElementById("randomnessCheckbox");s&&(s.checked=t.Se);let o=document.getElementById("randomnessSlider");o&&(o.value=t.fe),document.getElementById("userColorPalette").value=t.ee,document.getElementById("metaRule").value=t.Dt,t.canvas.width=Math.max(t.se,t.oe),t.canvas.height=Math.max(t.se,t.oe),t.be=0,t.we=0;var a=document.getElementById("gameCanvas");if(t.se>t.oe){var h=Math.floor(t.oe/t.se*800);a.style.width=h+"px",a.style.height="800px",a.width=h*t.se/800,a.height=t.se}else{var u=Math.floor(t.se/t.oe*800);a.style.width="800px",a.style.height=u+"px",a.width=t.oe,a.height=u*t.oe/800}}(bt),O(bt),$(bt),D(bt);let t=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==t&&""!==window.location.hostname||Q(bt).then((()=>{J(bt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
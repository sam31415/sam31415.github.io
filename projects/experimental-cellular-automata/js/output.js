(()=>{"use strict";var t={},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,i),o.exports}class r{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.transposed=!1,this.get=this.getNormal,this.set=this.setNormal}static fromArray(t,e=!1,i=!1,n=!1){const o=t.length,s=t[0].length,a=new r(s,o);for(let e=0;e<o;e++){n&&(e=o-e-1);for(let r=0;r<s;r++)i&&(r=s-r-1),a.set(e,r,t[e][r])}return e&&a.transpose(),a}transpose(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.transposed?[this.getNormal,this.setNormal]:[this.getTransposed,this.setTransposed],this.transposed=!this.transposed}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const i=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,i)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const i=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,i)}}getNormal(t,e){return this.data[t*this.width+e]}setNormal(t,e,i){this.data[t*this.width+e]=i}getTransposed(t,e){return this.data[e*this.height+t]}setTransposed(t,e,i){this.data[e*this.height+t]=i}}function n(t,e){let i={t:e.t,drift:e.drift};for(let t in["r","g","b"]){let r=Math.round(2*Math.random()*e.drift-e.drift),n=e[t]+r;n=Math.max(0,Math.min(255,n)),i[t]=n}return i}function o(){return 10**(1.5*Math.random()-.5)}function s(){return Math.floor(256*Math.random())}function a(){return{r:s(),g:s(),b:s(),t:255,drift:o()}}function l(t){var e={r:247,g:255,b:28,t:255,drift:0},i={r:13,g:112,b:255,t:255,drift:0},r={r:240,g:239,b:239,t:255,drift:0},n={r:0,g:0,b:0,t:255,drift:0},o={r:255,g:255,b:255,t:255,drift:0},s={r:240,g:240,b:240,t:255,drift:0},l={r:255,g:0,b:255,t:255,drift:0},h={r:0,g:255,b:255,t:255,drift:0},u=[{r:255,g:0,b:0,t:255,drift:0},{r:0,g:255,b:0,t:255,drift:0},{r:0,g:0,b:255,t:255,drift:0},{r:255,g:255,b:0,t:255,drift:0},l,h];if(t.driftColors=[!1,!1,!1,!1],"variable"==t.colorPalette){t.colors=[n,s];for(var d=t.nColors-t.colors.length,g=0;g<d;g++)t.colors.push(a())}if("allRandom"==t.colorPalette){t.colors=[];for(g=0;g<t.nColors;g++)t.colors.push(a())}else if("monochrome"==t.colorPalette)t.colors=[n,o,{r:75,g:75,b:75,t:255,drift:0},{r:175,g:175,b:175,t:255,drift:0}];else if("retro"==t.colorPalette){let e=u[Math.floor(Math.random()*u.length)],i=u[Math.floor(Math.random()*u.length)];for(;e==i;)i=u[Math.floor(Math.random()*u.length)];t.colors=[n,o,e,i]}else"cga"==t.colorPalette?t.colors=[n,o,h,l]:"blackwhite"==t.colorPalette?t.colors=[n,o,n,o]:"yellow"==t.colorPalette?t.colors=[e,n,i,r]:"blue"==t.colorPalette?t.colors=[i,r,n,e]:"blue2"==t.colorPalette?t.colors=[i,e,n,r]:"grey2"==t.colorPalette?t.colors=[r,e,n,i]:"black2"==t.colorPalette?t.colors=[n,i,r,e]:"blackTrace"==t.colorPalette?t.colors=[n,r,n,r]:"redBlue"==t.colorPalette?t.colors=[n,s,{r:221,g:12,b:12,t:255,drift:0},{r:29,g:29,b:189,t:255,drift:0}]:"turquoiseRed"==t.colorPalette?t.colors=[n,s,{r:39,g:192,b:177,t:255,drift:0},{r:252,g:53,b:47,t:255,drift:0}]:"magentaCyan"==t.colorPalette?t.colors=[n,s,{r:156,g:36,b:150,t:255,drift:0},{r:114,g:223,b:174,t:255,drift:0}]:"mouseAnimation"==t.colorPalette&&(t.colors=[{r:0,g:0,b:0,t:0,drift:0},i,n,e])}function h(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),i=Object.values(t).reduce(((t,i,r)=>[...t,i/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=i.findIndex((t=>e<t));return Object.keys(t)[r]}}const u=[15,60];function d(t,e,i,r,n,o,s,a,l){const h=r.height-1,u=r.width-1,d=r.data,g=r.width;var c=n[0],m=n[1];let f;for(var p=-1;p<=1;p++)for(var b=-1;b<=1;b++){if(0==p&&0==b)continue;if(o[0]=((-1===p?1:p)+(-1===b?1:b))%2,o[s%4+1]=-1==p?1:0,o[(1+s)%4+1]=-1==b?1:0,o[(2+s)%4+1]=1==p?1:0,o[(3+s)%4+1]=1==b?1:0,o[(1+s)%2+5]=p*b==1?0:1,o[s%2+5]=p*b==-1?0:1,0==e||0==i||e==h||i==u)var[v,y]=t.findNeighbour(t,e,i,p,b);else var v=e+p,y=i+b;const r=d[v*g+y],n=r%a,S=Math.floor(r/a)%l;f=0;for(var C=0;C<a-1;C++)n==C+1&&(c[C]+=1,f+=a,c[f+C]+=o[0],f+=a,c[f+C]+=1-o[0],f+=a,c[f+C]+=o[1],f+=a,c[f+C]+=1-o[1],f+=a,c[f+C]+=o[2],f+=a,c[f+C]+=1-o[2],f+=a,c[f+C]+=o[3],f+=a,c[f+C]+=1-o[3],f+=a,c[f+C]+=o[4],f+=a,c[f+C]+=1-o[4],f+=a,c[f+C]+=o[5],f+=a,c[f+C]+=1-o[5],f+=a,c[f+C]+=o[6],f+=a,c[f+C]+=1-o[6]),f=0;for(f=0,C=0;C<l;C++)S==C&&(m[C]+=1,f+=l,m[f+C]+=o[0],f+=l,m[f+C]+=1-o[0],f+=l,m[f+C]+=o[1],f+=l,m[f+C]+=1-o[1],f+=l,m[f+C]+=o[2],f+=l,m[f+C]+=1-o[2],f+=l,m[f+C]+=o[3],f+=l,m[f+C]+=1-o[3],f+=l,m[f+C]+=o[4],f+=l,m[f+C]+=1-o[4],f+=l,m[f+C]+=o[5],f+=l,m[f+C]+=1-o[5],f+=l,m[f+C]+=o[6],f+=l,m[f+C]+=1-o[6]),f=0}return[c,m]}const g="mix",c="isotropic",m="xcross",f="vcross",p="xvcross",b="directional1",v="directional2",y="directional3",C="directional2b",S="directional",M={[g]:.2,[c]:.4,[m]:.05,[f]:.05,[p]:.05,[b]:.05,[v]:.05,[y]:.05,[C]:.05,[S]:.05};const w="A",B="C",R="E",P="B";class k{constructor(t,e,i,r,n,o=null){this.type=t,this.threshold=e,this.neighbourType=i,this.inactivation=r,this.modulo=n,this.periodicity=o,this.testInactive=function(t,e){return t==B?function(t){return 0==t}:t==w?function(t){return t%e==0}:function(t){return!0}}(this.inactivation,this.modulo),this.testValue=function(t,e,i){return e==R&&2==i.length?function(e){return e[i[0]][i[1]]==t}:e==P&&2==i.length?function(e){return e[i[0]][i[1]]>t}:e==R&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]==t}:e==P&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]>t}:void 0}(this.threshold,this.type,this.neighbourType),this.testPeriodicity=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(o)}test(t,e,i){var r=this.testPeriodicity(i);return this.testValue(t)&&this.testInactive(e)&&r}name(){var t="";null!=this.periodicity&&(t=this.periodicity.map((t=>t?"1":"0")).join(""));var e=this.neighbourType.join("|"),i=this.inactivation;return this.inactivation==w&&(i+=this.modulo),`${this.type}${this.threshold}${i}[${e}]${t}`}static fromName(t){var e=null,i=4;t.startsWith(R)?e=R:t.startsWith(P)&&(e=P);var r=t.substring(e.length),n=parseInt(r.substring(0,1)),o=null;(r=r.substring(1)).startsWith(B)?o=B:r.startsWith(w)?(isNaN(r.charAt(1))||(i=parseInt(r.charAt(1)),r=r.substring(1)),o=w):r.startsWith("N")&&(o="N");var s=(r=r.substring(o.length)).split("[")[1].split("]")[0].split("|").map(Number),a=null;return(r=r.split("]")[1]).length>0&&(a=r.split("").map((t=>"1"===t))),new k(e,n,s,o,i,a)}static randomSample(t=null,e=g,i=null){const r=[R,P],n=r[Math.floor(Math.random()*r.length)],o=[B,w,"N"],s=o[Math.floor(Math.random()*o.length)];null===t&&(t={0:2/3,1:1/3});const a=h(t)(),l=function(t,e){var i=e;if(i==g){var r=Math.random();i=r<.5?c:r<.7?m:r<.9?f:S}if(i==c)return Math.floor(4*Math.random());if(i==f)return Math.floor(4*Math.random()+4);if(i==m)return Math.floor(4*Math.random()+8);if(i==p)return Math.floor(8*Math.random()+4);if(i==b)return Math.floor(4*Math.random()+12);if(i==v)return Math.floor(8*Math.random()+12);if(i==y)return Math.floor(12*Math.random()+12);if(i==C){var n=Math.floor(8*Math.random()+12);return n>=16&&(n+=4),n}return i==S?Math.floor(16*Math.random()+12):void 0}(0,e);var u=void 0;if(Math.random()<.5){u=[a,l,function(t){for(var e=4*Math.floor(t/4),i=t;i==t;)i=e+Math.floor(4*Math.random());return i}(l)]}else u=[a,l];var d=0,M=8;0==u[0]&&u[1]%4!=1?M=5:u[1]>4&&u[1]<=16?M=4:u[1]>16&&(M=3),d=n===P?Math.floor(Math.random()*M):Math.floor(Math.random()*M)+1;var N=Math.floor(5*Math.random())+2;if(Math.random()<.2)I=null;else{var I;null==i&&(i=Math.floor(20*Math.random())+2);do{I=new Array(i).fill(0).map((()=>Math.random()<.5))}while(!I.includes(!0))}return new k(n,d,u,s,N,I)}}class N{constructor(){this.nStates=void 0}updateRule(t,e,i,r){throw new Error("Must override method")}getName(){throw new Error("Must override method")}}class I extends N{constructor(){super(),this.seedingPatterns=this.getSeedingPatterns(),this.constructSeedingSampler(),this.randomnessLogShift=0}getSeedingPatterns(){throw new Error("Must override method")}constructSeedingSampler(){this.seedMasks=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].mask));let t=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].prob));this.seedSampler=h(t)}}class A extends I{constructor(){super(),this.nStates=4}updateRule(t,e,i,r){var n=t%4;return 1==n||3==n?e=2:2==n?e=0:0==n&&2==i[0][0]?e=1:0==n&&i[0][0]>2&&(e=3),e}getName(){return"BB"}getSeedingPatterns(){return{random:{prob:15,mask:null},waveSquare:{prob:4,mask:r.fromArray([[1,1],[1,1]])},star:{prob:4,mask:new r([[1,0,1],[0,0,0],[1,0,1]])},oscillator0:{prob:2,mask:r.fromArray([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},oscillator1:{prob:2,mask:r.fromArray([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},snakeHoriz:{prob:2,mask:r.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},snakeVert:{prob:2,mask:r.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class E extends I{constructor(){super(),this.nStates=4,this.randomnessLogShift=-1}updateRule(t,e,i,r){var n=t%4;return 3==n&&(n=0),1==n?e=2:2==n||3==n?e=0:0!=n&&3!=n||2!=i[0][0]?0==n&&i[0][0]>2&&(e=3):e=1,e}getName(){return"TBB"}getSeedingPatterns(){return{random:{prob:15,mask:null},snakeHoriz:{prob:1,mask:r.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},oscillator0:{prob:2,mask:r.fromArray([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},oscillator1:{prob:2,mask:r.fromArray([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},waveSquare:{prob:4,mask:r.fromArray([[1,1],[1,1]])},butterflyGun:{prob:1e4,mask:r.fromArray([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class F extends I{constructor(){super(),this.nStates=4,this.randomnessLogShift=-1}updateRule(t,e,i,r){var n=t%4;return 1==n&&(i[0][0]<3||i[0][0]>5)?e=2:2==n?e=3:3==n?e=0:0==n&&2==i[0][0]&&(e=1),e}getName(){return"SW"}getSeedingPatterns(){let t=.2;return{random:{prob:6,mask:null},snake:{prob:1,mask:r.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},gun0:{prob:t,mask:r.fromArray([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},gun1:{prob:t,mask:r.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},gun2:{prob:t,mask:r.fromArray([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},gun3:{prob:t,mask:r.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},gun4:{prob:t,mask:r.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},gun5:{prob:t,mask:r.fromArray([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},gun6:{prob:t,mask:r.fromArray([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},gun7:{prob:t,mask:r.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},gun8:{prob:t,mask:r.fromArray([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},gun9:{prob:t,mask:r.fromArray([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},gun10:{prob:t,mask:r.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},gun11:{prob:t,mask:r.fromArray([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},gun12:{prob:t,mask:r.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},gun13:{prob:t,mask:r.fromArray([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},gun14:{prob:t,mask:r.fromArray([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},gun15:{prob:t,mask:r.fromArray([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},star:{prob:2,mask:r.fromArray([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class L extends I{constructor(t){super(),null==t&&(t=L.generateRule()),this.initialiseRule(t)}updateRule(t,e,i,r){var n=t%this.nStates;return 1==n&&this.survive.includes(i[0][this.neighbourhood[0]])?e=1:n>0&&n<this.nStates-1?e+=1:n==this.nStates-1?e=0:0==n&&this.birth.includes(i[0][this.neighbourhood[1]])?e=1:0==n&&this.inhibited.includes(i[0][this.neighbourhood[2]])&&(e=this.nStates-1),e}sampleDigitsInBrackets(t){return t.replace(/\[([0-9]+)\]|\{([0-9|]+)\}/g,((t,e,i)=>{if(e){let t="";for(const i of e)Math.random()>.5&&(t+=i);return t}if(i){const t=i.split("|");return t[Math.floor(Math.random()*t.length)]}}))}initialiseRule(t){this.ruleString=this.sampleDigitsInBrackets(t),console.log("Sampled rulestring: ",this.ruleString);const e=this.ruleString.split("/");for(var i of(this.neighbourhood=[0,0,0],this.inhibited=[],this.nStates=Number(e[e.length-1]),e))"N"==i[0]?(this.neighbourhood=i.substring(1).split("|").map((t=>{const[e,i]=t.split(":");return i?parseInt(e)*this.nStates+parseInt(i):parseInt(e)})),this.neighbourhood.length<3&&(this.neighbourhood=[this.neighbourhood[0],this.neighbourhood[0],this.neighbourhood[0]])):"B"==i[0]?this.birth=new Uint8Array(i.substring(1).split("").map(Number)):"S"==i[0]?this.survive=new Uint8Array(i.substring(1).split("").map(Number)):"I"==i[0]&&(this.inhibited=new Uint8Array(i.substring(1).split("").map(Number)))}static generateRule(t){let e=Math.floor(10*Math.random())+3,i=[8,8,8];null==t&&(t=[Math.floor(Math.random()*u[0]*e),Math.floor(Math.random()*u[0]*e),Math.floor(Math.random()*u[0]*e)]);let r=[Math.floor(t[0]/e)%u[0],Math.floor(t[1]/e)%u[0],Math.floor(t[2]/e)%u[0]];for(let t=0;t<3;t++)[1,2].includes(r[t])?i[t]=4:3==r[t]?i[t]=3:4==r[t]?i[t]=5:5==r[t]?i[t]=6:6==r[t]&&(i[t]=2);let n=this.generateRandomArray(1,i[0]);0==n.length&&(n=[2]);let o=this.generateRandomArray(1,i[1]),s=this.generateRandomArray(1,i[2]);return s=s.filter((t=>!n.includes(t)&&!o.includes(t)&&2!=t)),this.getRuleString(t,n,o,s,e)}static getRuleString(t,e,i,r,n){return`N${t.map((t=>Math.floor(t/n)%u[0]+":"+t%n)).join("|")}/B${e.join("")}/S${i.join("")}/I${r.join("")}/${n}`}static generateRandomArray(t,e){let i=[];for(let r=t;r<=e;r++)Math.random()<.5&&i.push(r);return i}getName(){return this.ruleString}getSeedingPatterns(){return{random:{prob:1,mask:null}}}}class H extends L{constructor(t,e=null){if(super(t),"ships"==e){this.initialiseRule(this.ruleString),this.neighbourhood[0]=0;let t=Array.from(this.birth).indexOf(1);if(-1!==t){let e=new Uint8Array(this.birth.length-1);e.set(this.birth.subarray(0,t),0),e.set(this.birth.subarray(t+1),t),this.birth=e}if(-1===this.birth.indexOf(2)){let t=new Uint8Array(this.birth.length+1);t[0]=2,t.set(this.birth,1),this.birth=t}if(t=Array.from(this.survive).indexOf(1),-1!==t){let e=new Uint8Array(this.survive.length-1);e.set(this.survive.subarray(0,t),0),e.set(this.survive.subarray(t+1),t),this.survive=e}this.inhibited=this.inhibited.filter((t=>!this.birth.includes(t)&&!this.survive.includes(t)&&2!=t)),this.ruleString=L.getRuleString(this.neighbourhood,this.birth,this.survive,this.inhibited,this.nStates),this.activationFactor=1,this.randomnessLogShift=.5}else this.activationFactor=20/this.birth[0]**3,this.randomnessLogShift=1.5}updateRule(t,e,i,r,n){var o=t%this.nStates;return 1==o&&this.survive.includes(i[0][this.neighbourhood[0]])?e=1:o>0&&o<this.nStates-1?e+=1:o==this.nStates-1?e=0:0==o&&this.birth.includes(i[0][this.neighbourhood[1]])&&Math.random()>this.activationFactor*n-.05?e=1:0==o&&this.inhibited.includes(i[0][this.neighbourhood[2]])&&(e=this.nStates-1),e}getName(){return`SGen/${this.ruleString}`}initialiseRule(t){"SGen"==t.substring(0,4)?super.initialiseRule(t.substring(5)):super.initialiseRule(t)}}class W extends L{constructor(t=null,e=!0){super(null),this.ruleString=null==t?e?W.getPresetRule():W.generateRule(null):t,this.initialiseRule(this.ruleString)}static getPresetRule(){let t=h({"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:{0|1}|0:0/B2[45678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":12,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:{0|1}|0:0/B2[45678]/S2[45678]/I1[345678]/{9|10|11|12|13|14}":6,"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":8,"N0/B23/S34[678]/I1[2345678]/{6|7|8|9|10|11|12|13}":3,"N0/B234[5678]/S2[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":12,"N0/B234[5678]/S3[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234[5678]/S[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234578/S37/I/11":1,"N0/B23[45678]/S3[5678]/I[45678]/{5|6|7|8|9|10|11|12}":8,"N0/B2368/S358/I/5":1,"N0/B24[5678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":12,"N0/B24568/S3478/I34578/5":1,"N0/B24568/S3478/I34578/6":1,"N0/B24568/S3478/I34578/7":3,"N0/B24568/S34578/I34578/9":1,"N0/B24568/S34578/I34578/12":1,"N0/B24568/S34578/I34578/13":1,"N0/B24568/S34578/I34578/14":1,"N0/B24568/S34678/I34678/4":3,"N0/B24568/S34678/I34678/5":3,"N0/B24568/S34678/I34678/6":3,"N0/B24568/S34678/I34678/7":10,"N0/B24568/S34678/I34678/8":3,"N0/B24568/S34678/I34678/9":3,"N0/B24568/S34678/I34678/10":1,"N0/B24568/S34678/I34678/11":1,"N0/B25[678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":12,"N0/B25/S345/I/4":1,"N0/B25/S345/I/5":1,"N0:0/B2[5678]/S34567/I1[345678]/{5|6|7|8|9|10|11|12|13|14}":5,"N0/B2[5678]/S34[5678]/I[5678]/{5|6}":15,"N0/B25678/S2478/I345678/12":1,"N0/B2568/S345678/I345678/8":1,"N0/B2568/S345678/I345678/10":1,"N0/B2568/S345678/I345678/12":1,"N0/B2568/S34578/I34578/4":1,"N0/B2568/S34578/I34578/5":1,"N0/B2568/S34578/I34578/6":1,"N0/B2568/S34578/I34578/7":1,"N0/B2568/S34578/I34578/8":1,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B2[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":15,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B23[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":6,"N1/B2[45678]/S3[45678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N1/B23[45678]/S1[2345678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N5|1|18/B2[345678]/S1[345678]/I[345678]/{7|7|7|8|8|8|11|12|13|14|15}":8,"N45|0|33/B2/S/I34/7":1,"N58|0|16/B24568/S/I1/{5|6|7|8}":3,"N66|0|67/B2/S23/I23/6":3,"N66|0|0/B2/S1/I1/6":2,"N67|0|0/B2/S1/I1/6":2})();for(;t.split("/").length<5;)if("N"!=t[0])t="N0/"+t;else{t=t+"/"+(Math.floor(10*Math.random())+3)}return t}getSeedingPatterns(){return{random:{prob:1,mask:null}}}getName(){return"GGShips"==this.ruleString.substring(0,7)?this.ruleString:`GGShips/${this.ruleString}`}initialiseRule(t){"GGShips/"==t.substring(0,8)?super.initialiseRule(t.substring(8)):super.initialiseRule(t)}}class x extends L{constructor(){super("B24/S34/I15678/4"),this.randomnessLogShift=0}getName(){return"FS"}getSeedingPatterns(){let t=.2;return{random:{prob:20,mask:null},burst1:{prob:1,mask:r.fromArray([[1,1],[1,1]])},ships1:{prob:t,mask:r.fromArray([[1,1]])},rake1:{prob:1,mask:r.fromArray([[1,0],[1,1]])},ships2:{prob:t,mask:r.fromArray([[1,1],[2,2]])},star1:{prob:1,mask:r.fromArray([[0,1,0],[1,1,1],[0,1,0]])},star2:{prob:1,mask:r.fromArray([[1,0,1],[0,0,0],[1,0,1]])},ships3:{prob:t,mask:r.fromArray([[1,0,0],[1,1,0],[0,1,1]])},ships4:{prob:t,mask:r.fromArray([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},burst2:{prob:1,mask:r.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},burst3:{prob:1,mask:r.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},rake2:{prob:1,mask:r.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},ships5:{prob:t,mask:r.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ships6:{prob:t,mask:r.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ships7:{prob:t,mask:r.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class T extends L{constructor(){super("B2/S245678/I1/4"),this.randomnessLogShift=0}getName(){return"SS"}getSeedingPatterns(){let t=.2;return{random:{prob:10,mask:null},burst1:{prob:1,mask:r.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},ships1:{prob:t,mask:r.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},ships2:{prob:t,mask:r.fromArray([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},ships3:{prob:t,mask:r.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},ships4:{prob:t,mask:r.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},ships5:{prob:t,mask:r.fromArray([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},ships6:{prob:t,mask:r.fromArray([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},burst2:{prob:1,mask:r.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ships7:{prob:t,mask:r.fromArray([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ships8:{prob:t,mask:r.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},burst3:{prob:1,mask:r.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},burst4:{prob:1,mask:r.fromArray([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},birst5:{prob:1,mask:r.fromArray([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class G extends I{constructor(){super(),this.nStates=4,this.randomnessLogShift=.4}updateRule(t,e,i,r){var n=t%4,o=i[0][0]+i[0][2];return 1!=n&&3!=n||!(o<2||o>3)?1!=n&&3!=n||2!=o&&3!=o?0!=n&&2!=n||3!=o?2==n&&(e=0):e=3:e=1:e=2,e}getSeedingPatterns(){return{void:{prob:1,mask:null}}}getName(){return"CW"}}class U extends N{constructor(t,e,i,r){super(),this.conditions=t,this.nStates=this.conditions.length+1,this.neighbourTypes=e,this.neighbourhoodGeometryType=i,this.periodicityLength=r}updateRule(t,e,i,r){e=0;for(let n=0;n<this.conditions.length;n++)if(this.conditions[n].test(i,t,r)){e=n+1;break}return e}getName(){return this.conditions.map((t=>t.name())).join("||")}static sampleRule(t=null,e=null,i=null,r=null){var n=[];null==t&&(t=Math.floor(8*Math.random())+2),null==i&&(i=h(M)()),null==r&&(r=this.samplePeriodicityLength());for(let o=0;o<t;o++)n.push(k.randomSample(e,i,r));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+i+": "+n.map((t=>t.name())).join(", ")),new U(n,e,i,r)}static samplePeriodicityLength(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static ruleFromNames(t){var e=t.split("||").map((t=>k.fromName(t)));return new U(e,null,g,null)}evolveRule(t=null){var e,i=this.conditions.length;null==t&&(t=this.neighbourTypes),0==(e=2==i?Math.floor(2*Math.random())+1:10==i?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.removeCondition():1==e?this.changeCondition(t):this.addCondition(t)}addCondition(t){var e=this.conditions.slice();e.push(k.randomSample(t,this.neighbourhoodGeometryType,this.periodicityLength)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}removeCondition(){var t=this.conditions.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.conditions=t}changeCondition(t){var e=this.conditions.slice(),i=Math.floor(Math.random()*e.length);e[i]=k.randomSample(t,this.neighbourhoodGeometryType,this.periodicityLength),console.log((new Date).toLocaleTimeString()+" Changing condition "+i+" to "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}}const X="gr",Y="safe",j="mix",O="general",D="test";class V{colorUnit;ruleChain;updateRule;setRuleChain(){throw new Error("Must override method")}setUpdateRule(){this.updateRule=function(t,e,i,r,n){e=this.ruleChain[0].updateRule(t%this.ruleChain[0].nStates,e,i,r,n);var o=this.ruleChain[0].nStates;for(let n=1;n<this.ruleChain.length;n++)e+=o*this.ruleChain[n].updateRule(Math.floor(t/o)%this.ruleChain[n].nStates,e,i,r),e%=o*=this.ruleChain[n].nStates;return e%o}}evolveRuleChain(){throw new Error("Must override method")}setBaseRule(){throw new Error("Must override method")}setColoringRule(){throw new Error("Must override method")}getName(){return this.ruleChain.map((t=>t.getName())).join("-")}}class q extends V{constructor(t){super(),this.preset=t,this.colorUnit=1,this.setRuleChain(),this.setUpdateRule()}setRuleChain(){this.ruleChain=[],"Original"==this.preset?this.ruleChain.push(new E):"StarWars"==this.preset?this.ruleChain.push(new F):"Modified"==this.preset?this.ruleChain.push(new A):"Conway"==this.preset?this.ruleChain.push(new G):this.ruleChain.push(new L(this.preset))}}class $ extends V{constructor(t,e,i=null){if(super(),this.preset=t,this.neighbourTypes=e,this.periodicityLength=null,this.neighbourGeometryType=null,null==e)if(t==Y||t==X)this.neighbourTypes={0:1,1:0};else if(t==j){let t=Math.random();this.neighbourTypes=t<.3?{0:1,1:0}:t<.6?{0:.8,1:.2}:t<.8?{0:.5,1:.5}:{0:0,1:1}}else{let t=Math.random();this.neighbourTypes=t<.5?{0:.5,1:.5}:{0:0,1:1}}t==X&&(this.periodicityLength=1),null==i?this.setRuleChain():this.setRuleChainfromName(i),this.setUpdateRule()}rulesGeneral=[{rule:H,args:[null,"ships"],weight:2},{rule:H,args:[],weight:2},{rule:W,args:[],weight:6},{rule:A,args:[],weight:4},{rule:E,args:[],weight:1},{rule:F,args:[],weight:1},{rule:T,args:[],weight:1},{rule:x,args:[],weight:1},{rule:G,args:[],weight:1}];rulesGR=[{rule:A,args:[],weight:1}];setRuleChain(){this.ruleChain=[null,null],this.setBaseRule(),this.setColoringRule(),this.preset==D&&(ruleChain=[],ruleChain.push(new W(null,!0)),this.colorUnit=ruleChain[0].nStates,this.neighbourTypes={0:.8,1:.2},ruleChain.push(U.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,this.periodicityLength)))}setBaseRule(){let t=this.rulesGeneral;this.preset==X&&(t=this.rulesGR);let e=t.reduce(((t,e)=>t+e.weight),0);var i;let r=Math.random()*e;for(let e=0;e<t.length;e++){if(r<t[e].weight){i=new t[e].rule(...t[e].args);break}r-=t[e].weight}this.colorUnit=i.nStates,this.ruleChain[0]=i}setColoringRule(){this.ruleChain[1]=U.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,this.ruleChain[0].nStates,this.periodicityLength)}evolveRuleChain(){this.ruleChain[1]&&"function"==typeof this.ruleChain[1].evolveRule&&this.ruleChain[1].evolveRule(this.neighbourTypes)}setRuleChainfromName(t){this.ruleChain=[];var[e,i]=t.split("-");"BB"==e?this.ruleChain.push(new A):"TBB"==e?this.ruleChain.push(new E):"SW"==e?this.ruleChain.push(new F):"SS"==e?this.ruleChain.push(new T):"FS"==e?this.ruleChain.push(new x):"CW"==e?this.ruleChain.push(new G):e.startsWith("SGen")?(this.ruleChain.push(new H(e)),this.ruleChain[ruleChain.length-1].activationFactor=0,this.ruleChain[ruleChain.length-1].randomnessLogShift=0):e.startsWith("GGShips")?this.ruleChain.push(new W(e)):this.ruleChain.push(new L(e)),this.colorUnit=1,i&&(this.ruleChain.push(U.ruleFromNames(i)),this.colorUnit=this.ruleChain[0].nStates)}}class K extends V{constructor(t,e,i=null){if(super(),this.preset=t,this.neighbourTypes=e,this.periodicityLength=null,this.neighbourGeometryType=null,null==e)if(t==Y)this.neighbourTypes={0:1,1:0};else if(t==j){Math.random();this.neighbourTypes={0:0,1:1}}else this.neighbourTypes={0:.5,1:.5};this.colorUnit=16,null==i?this.setRuleChain():this.setRuleChainfromName(i),this.setUpdateRule()}setRuleChain(){this.ruleChain=[],this.ruleChain.push(new A),this.ruleChain.push(U.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,this.periodicity)),this.ruleChain.push(U.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,this.periodicity))}evolveRuleChain(){this.ruleChain[1].evolveRule(this.neighbourTypes),this.ruleChain[2].evolveRule(this.neighbourTypes)}setRuleChainfromName(t){this.ruleChain=[];var e=t.split("-")[1];this.ruleChain.push(new A),this.ruleChain.push(U.ruleFromNames(e))}}function _(t,e=!1){(Math.random()<Math.exp(t.ruleLogSwitchProbability)||e||t.changeRuleFlag)&&(t.nColors=4,"VariableGR"==t.metaRule?(t.ruleClass=new $(X),t.ruleClass2=new $(X),t.useLogo=!0):"VariableDemo"==t.metaRule?(t.ruleClass=new $(X),t.ruleClass2=null,t.useLogo=!1):"Variable"==t.metaRule?(z(t),t.ruleClass=new $(Y)):"VariableMix"==t.metaRule?(z(t),t.ruleClass=new $(j)):"VariableUnsafe"==t.metaRule?(z(t),t.ruleClass=new $(O)):"VariableTest"==t.metaRule?t.ruleClass=new $(D):"Variable2Unsafe"==t.metaRule?(z(t),t.ruleClass=new K(O)):"CustomRule"==t.metaRule?t.ruleClass=new $(null,null,t.currentStyle):"OriginalBB"==t.metaRule?t.ruleClass=new q("Original"):"ModifiedBB"==t.metaRule?t.ruleClass=new q("Modified"):"StarWars"==t.metaRule?t.ruleClass=new q("StarWars"):"Conway"==t.metaRule?t.ruleClass=new q("Conway"):"SparseFourStates"==t.metaRule?t.ruleClass=new q("B378/S124567/4"):t.ruleClass=new $(j),t.ruleLogSwitchProbability=-25,t.ruleLogEvolveProbability=-25,t.changeRuleFlag=!1,t.time=0,Z(t),J(t)),t.changeBaseRuleFlag&&(t.ruleClass.setBaseRule(),t.ruleLogSwitchProbability=-25,t.changeBaseRuleFlag=!1,Z(t),J(t)),t.changeColoringRuleFlag&&(t.ruleClass.setColoringRule(),t.ruleLogEvolveProbability=-25,t.changeColoringRuleFlag=!1,Z(t),J(t),Q(t)),(Math.random()<Math.exp(t.ruleLogEvolveProbability)||t.evolveColoringRuleFlag)&&"CustomRule"!=t.metaRule&&(t.ruleClass.evolveRuleChain(),t.useLogo&&null!==t.ruleClass2&&t.ruleClass2.evolveRuleChain(),t.ruleLogEvolveProbability=-25,t.evolveColoringRuleFlag=!1,t.time=0,Z(t),J(t),Q(t));t.ruleLogSwitchProbability=t.ruleLogSwitchProbability+1*t.logMultiplicativeFactor,t.ruleLogSwitchProbability>0&&(t.ruleLogSwitchProbability=0),t.ruleLogEvolveProbability=t.ruleLogEvolveProbability+1*t.logMultiplicativeEvolveFactor,t.ruleLogEvolveProbability>0&&(t.ruleLogEvolveProbability=0)}function z(t){var e=Math.floor(6*Math.random())+2;if(t.nColors>e)t.colors=t.colors.slice(0,e);else if(t.nColors<e)for(var i=t.nColors;i<e;i++)t.colors.push(a());t.nColors=e}function J(t){"VariableGR"!=t.metaRule&&(t.redPerturbationStrength=Math.floor(21*Math.random()),t.greenPerturbationStrength=Math.floor(21*Math.random()),t.bluePerturbationStrength=Math.floor(21*Math.random()),t.brightnessPerturbationStrength=Math.floor(21*Math.random()))}function Q(t){for(color in t.colors)0!=color.driftSpeed&&(color.driftSpeed=o())}function Z(t){if("undefined"!=typeof document){var e=document.getElementById("currentStyle");e&&(t.useLogo&&null!==t.ruleClass2?e.value=t.ruleClass.getName()+"__"+t.ruleClass2.getName():e.value=t.ruleClass.getName())}}function tt(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,s=(i+n+t.gridWidth)%t.gridWidth,a=o,l=s;return(o-e-r>0||o-e-r<0)&&(l=(t.gridWidth-s-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(s-i-n>0||s-i-n<0)&&(a=(t.gridHeight-o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[a,l]}function et(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,s=(i+n+t.gridWidth)%t.gridWidth,a=o,l=s;return(o-e-r>0||o-e-r<0)&&(l=(t.gridWidth-s-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),s-i-n>0?a=(o+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:s-i-n<0&&(a=(o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[a,l]}function it(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,s=(i+n+t.gridWidth)%t.gridWidth,a=o,l=s;return o-e-r>0?l=(s+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:o-e-r<0&&(l=(s-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(s-i-n>0||s-i-n<0)&&(a=(t.gridHeight-o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[a,l]}function rt(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,s=(i+n+t.gridWidth)%t.gridWidth,a=o,l=s;return o-e-r>0?l=(s+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:o-e-r<0&&(l=(s-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),s-i-n>0?a=(o+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:s-i-n<0&&(a=(o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[a,l]}function nt(t){t.gridFlipX&&t.gridFlipY?t.findNeighbour=tt:t.gridFlipX?t.findNeighbour=et:t.gridFlipY?t.findNeighbour=it:t.findNeighbour=rt}function ot(t){_(t,!0)}function st(t,e=!1){(t.time%200==0||e)&&(isNaN(t.brightness)&&(t.brightness=127,t.maxBrightness=130,t.minBrightness=124),isNaN(t.maxBrightness)&&(t.maxBrightness=130),isNaN(t.minBrightness)&&(t.minBrightness=124),console.log("Activity level: "+t.activityLevel.toFixed(2)+"."),console.log("Proportion of cells changed: "+t.relCellChanged.toFixed(4)+"."),console.log("Mean color change magnitude: "+t.meanColorChangeHistoric.toFixed(1)+"."),console.log("Brightness: "+t.brightness.toFixed(1)+"."),console.log("Max - min brightness: "+t.diffBrightness+"."),console.log("Flicker index: "+t.flickerIndex.toFixed(2)+"."),console.log("Color count: "+t.colorCount.map((t=>t.toFixed(3)))+"."))}function at(t,e,i){var r=function(t){var e=Math.exp(-t),i=1,r=0;do{r++,i*=Math.random()}while(i>e);return r-1}(10**(t.randomnessAmount+t.ruleClass.ruleChain[0].randomnessLogShift));if(0!=r)for(var n=t.ruleClass.ruleChain[0].seedSampler,o=t.ruleClass.ruleChain[0].seedMasks,s=0;s<r;s++){var a=Math.floor(Math.random()*t.gridHeight),l=Math.floor(Math.random()*t.gridWidth);lt(e,t,o[n()],a,l,i)}}function lt(t,e,i,n,o,s){null===i?i=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?ct(t,t):e<.2?ut(t,t):e<.3?ht(t,t):e<.4?function(t){let e=new r(t,t);for(let i=0;i<t;i++)for(let r=i;r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,i,e.get(i,r));return e}(t):e<.5?function(t){let e=new r(t,t);for(let i=0;i<t;i++)for(let r=i;r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(t-1-r,t-1-i,e.get(i,r));return e}(t):e<.6?dt(t,t):e<.7?gt(t,t):e<.8?function(t){let e=new r(t,t);for(let i=0;i<t;i++)for(let r=Math.max(i,t-i);r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,i,e.get(i,r)),e.set(t-1-r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r));return e}(t):e<.9?function(t){let e=new r(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let r=0;r<Math.ceil(t/2);r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r)),e.set(t-1-r,i,e.get(i,r));return e}(t):function(t){let e=new r(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let r=0;r<Math.ceil(t/2);r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r)),e.set(t-1-r,i,e.get(i,r)),e.set(t-1-i,r,e.get(i,r)),e.set(t-1-r,t-1-i,e.get(i,r)),e.set(i,t-1-r,e.get(i,r)),e.set(r,i,e.get(i,r));return e}(t)}(e);else{t=function(t,e){let i=Math.random();return i<.2?ct(t,e):i<.4?ut(t,e):i<.6?ht(t,e):i<.8?dt(t,e):gt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&i.transpose(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let a=i.height,l=i.width;for(let r=0;r<a;r++)for(let h=0;h<l;h++){let u=s(e,n,o,r-Math.floor(a/2),h-Math.floor(l/2));t.set(u[0],u[1],i.get(r,h))}}function ht(t,e){let i=new r(e,t);for(let r=0;r<t;r++)for(let t=0;t<Math.ceil(e/2);t++)i.set(r,t,Math.floor(1e5*Math.random())),i.set(r,e-1-t,i.get(r,t));return i}function ut(t,e){let i=new r(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<e;n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(t-1-r,n,i.get(r,n));return i}function dt(t,e){let i=new r(e,t);for(let r=0;r<t;r++)for(let n=0;n<Math.ceil(e/2);n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(t-1-r,e-1-n,i.get(r,n));return i}function gt(t,e){let i=new r(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(e/2);n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(t-1-r,n,i.get(r,n)),i.set(r,e-1-n,i.get(r,n)),i.set(t-1-r,e-1-n,i.get(r,n));return i}function ct(t,e){let i=new r(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)i.set(r,t,Math.floor(1e5*Math.random()));return i}function mt(t){!function(t){t.time>100&&(t.meanColorChangeHistoric>330||t.flickerIndex>15)&&(t.changeRuleFlag=!0,t.meanColorChangeHistoric>330?console.log("Changing rule because of suspected oscillations (meanColorChangeHistoric: "+t.meanColorChangeHistoric+")."):console.log("Changing rule because of suspected oscillations (flickerIndex: "+t.flickerIndex+")."),st(t,!0),t.nCellChangedHistoric=15,t.meanColorChangeHistoric=10,t.brightness=127,t.maxBrightness=130,t.minBrightness=124)}(t),function(t){t.nCellChangedHistoric<3&&(t.changeRuleFlag=!0,console.log("Changing rule because not enough cells changed ("+t.nCellChangedHistoric+")."),st(t,!0),t.nCellChangedHistoric=20)}(t),function(t){var e=.99;t.time>100&&(t.colorCount[1]>e||t.colorCount[2]>e||t.colorCount[3]>e)&&(t.changeRuleFlag=!0,console.log("Changing rule because the canvas is too plainly colored."),st(t,!0),t.colorCount=[0,0,0,0])}(t)}function ft(t){return console.log("Loading image:",t),new Promise(((e,r)=>{const n=function(){if("undefined"!=typeof window)return new window.Image;try{const{Image:t}=i(Object(function(){var t=new Error("Cannot find module 'canvas'");throw t.code="MODULE_NOT_FOUND",t}()));return new t}catch(t){throw console.error('The canvas module is not installed. Please run "npm install canvas" to install it.'),t}}();n.onload=()=>{console.log("Image loaded:",t);const r=function(t,e){if("undefined"!=typeof window){const i=document.createElement("canvas");return i.width=t,i.height=e,i}try{const{createCanvas:r}=i(Object(function(){var t=new Error("Cannot find module 'canvas'");throw t.code="MODULE_NOT_FOUND",t}()));return r(t,e)}catch(t){throw console.error('The canvas module is not installed. Please run "npm install canvas" to install it.'),t}}(n.width,n.height),o=r.getContext("2d");o.drawImage(n,0,0,n.width,n.height);const s=o.getImageData(0,0,r.width,r.height).data,a=[];for(let t=0;t<n.height;t++){const e=[];for(let i=0;i<n.width;i++){const r=4*(t*n.width+i),o=(s[r]+s[r+1]+s[r+2])/3;e.push(o>128?1:0)}a.push(e)}e(a)},n.onerror=()=>{console.error("Error loading image:",t),r(new Error("Error loading image"))},n.src=t}))}async function pt(t,e){if(null!==t.logo&&await function(t,e){return console.log("Attempting to load image"),ft(t.logo).then((e=>{new r(t.gridWidth,t.gridHeight);const i=new r(t.gridWidth,t.gridHeight),n=e[0].length/t.gridWidth,o=e.length/t.gridHeight,s=Math.max(n,o),a=Math.floor((t.gridWidth-e[0].length/s)/2),l=Math.floor((t.gridHeight-e.length/s)/2);for(let r=0;r<t.gridHeight;r++)for(let n=0;n<t.gridWidth;n++){if(r<l||(r-l)*s>=e.length){i.set(r,n,1);continue}let t=Math.floor((n-a)*s);0===e[Math.floor((r-l)*s)][t]?i.set(r,n,0):i.set(r,n,1)}t.mask=i})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new r(t.gridWidth,t.gridHeight)}))}(t),"zero"!=t.initialisation)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new r(t.gridWidth,t.gridHeight),t.redraw=new r(t.gridWidth,t.gridHeight);for(var i=0;i<t.gridHeight;i++)for(var n=0;n<t.gridWidth;n++)if("gr"!=t.initialisation||1!==t.mask.get(i,n)){for(var o=Math.random(),s=0;s<e;s++)if(o<(s+1)/(e+1)){t.grid.set(i,n,s);break}t.redraw.set(i,n,1)}else t.grid.set(i,n,0)}))}(t);t.grid=new Grid(t.gridWidth,t.gridHeight),t.redraw=new Grid(t.gridWidth,t.gridHeight)}var bt=166320;function vt(t,e=null){const i=performance.now();t.paused?t.step&&(yt(t,e),t.step=!1):yt(t,e);const r=performance.now();t.frameExecutionTime=r-i,t.reinitialiseGridFlag&&(pt(t),t.reinitialiseGridFlag=!1),setTimeout((function(){requestAnimationFrame((()=>vt(t,e)))}),Math.max(0,t.targetCycleTime-t.frameExecutionTime))}function yt(t,e){!function(t){let e=t.imageData;var i=0,r=0,n=0,o=t.colors.length,s=new Array(o).fill(0);const a=2*t.redPerturbationStrength+1,l=2*t.greenPerturbationStrength+1,h=2*t.bluePerturbationStrength+1,u=2*t.brightnessPerturbationStrength+1;for(var d=0;d<t.gridHeight;d++)for(var g=0;g<t.gridWidth;g++){var c=Math.floor(t.grid.get(d,g)/t.ruleClass.colorUnit)%o;if(s[c]+=1,0==t.redraw.get(d,g))continue;i+=1;let m=t.colors[c],f=4*(d*t.gridWidth+g);r+=Math.sqrt((e[f+0]-m.r)**2+(e[f+1]-m.g)**2+(e[f+2]-m.b)**2),n+=m.r+m.g+m.b;const p=Math.floor(Math.random()*a)-t.redPerturbationStrength,b=Math.floor(Math.random()*l)-t.greenPerturbationStrength,v=Math.floor(Math.random()*h)-t.bluePerturbationStrength,y=Math.floor(Math.random()*u)-t.brightnessPerturbationStrength;e[f+0]=m.r+p+y,e[f+1]=m.g+b+y,e[f+2]=m.b+v+y,e[f+3]=m.t}!function(t,e,i,r,n){var o=t.gridHeight*t.gridWidth;t.activityLevel=.8*t.activityLevel+e/o/5,t.nCellChangedHistoric=.01*e+.99*t.nCellChangedHistoric,t.meanColorChangeHistoric=.01*i/(e+o/30)+.99*t.meanColorChangeHistoric,0==e?r=127:r/=3*e,t.brightness=.01*r+.99*t.brightness,t.maxBrightness=.99*(t.maxBrightness-t.brightness)+t.brightness,t.minBrightness=.99*(t.minBrightness-t.brightness)+t.brightness,t.relCellChanged=e/o,t.diffBrightness=t.maxBrightness-t.minBrightness,t.flickerIndex=t.diffBrightness*t.relCellChanged,t.maxBrightness<r?t.maxBrightness+=3:t.minBrightness>r&&(t.minBrightness-=3);for(var s=0;s<t.colorCount.length;s++)t.colorCount[s]=.01*t.colorCount[s]+.99*n[s]/o}(t,i,r,n,s),st(t),t.imageData=e}(t),null!=e&&e(t),mt(t),function(t){var e=[new Uint8Array(u[0]*t.ruleClass.ruleChain[0].nStates).fill(0),new Uint8Array(u[1]).fill(0)],i=new Uint8Array(Math.floor(u[0]/2)).fill(0),n=new r(t.gridWidth,t.gridHeight),o=t.grid;const s=t.time,a=t.ruleClass.ruleChain[0].nStates,l=t.ruleClass.ruleChain[1].nStates;for(var h=0;h<t.gridHeight;h++)for(var g=0;g<t.gridWidth;g++){var c=d(t,h,g,o,e,i,s,a,l);const r=t.grid.get(h,g);var m=r;m=t.useLogo&&0!=t.mask.get(h,g)?t.ruleClass2.updateRule(r,m,c,t.time,t.activityLevel):t.ruleClass.updateRule(r,m,c,t.time,t.activityLevel),Math.floor(m/t.ruleClass.colorUnit)%t.nColors!=Math.floor(r/t.ruleClass.colorUnit)%t.nColors?t.redraw.set(h,g,1):t.redraw.set(h,g,0),n.set(h,g,m);for(let t=0;t<e.length;t++)e[t].fill(0);i.fill(0)}t.addRandomness&&at(t,n,t.findNeighbour),t.grid=n}(t),_(t),t.time=(t.time+1)%bt,t.randomisePeriodicityShiftAndTopology&&function(t){Math.random()<1e-4&&(t.gridPeriodicityShiftX=Math.floor(Math.random()*t.gridWidth),console.log("Periodicity shift X: "+t.gridPeriodicityShiftX)),Math.random()<1e-4&&(t.gridPeriodicityShiftY=Math.floor(Math.random()*t.gridHeight),console.log("Periodicity shift Y: "+t.gridPeriodicityShiftY)),Math.random()<1e-4&&(t.gridFlipX=!t.gridFlipX,nt(t),console.log("Flip X: "+t.gridFlipX)),Math.random()<1e-4&&(t.gridFlipY=!t.gridFlipY,nt(t),console.log("Flip Y: "+t.gridFlipY))}(t),t.reloadColorPaletteFlag&&(l(t),t.reloadColorPaletteFlag=!1),"variable"==t.colorPalette&&function(t){for(let e in t.colors)e.drift>0&&(t.colors[e]=n(0,t.colors[e]))}(t)}function Ct(t,e){if(t.saveEventData){var i=t.ruleClass.ruleChain[0].getName(),r=new Blob([i],{type:"text/plain"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download="dataAutomata.txt",o.click()}}function St(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){Object.keys(t).forEach((t=>{let e=document.getElementById(t);var i;e&&(i="checkbox"===e.type?e.checked:"number"===e.type||"range"===e.type?parseFloat(e.value):e.value,localStorage.setItem(t,i))})),location.reload()}(t)}))}function Mt(t){document.getElementById("randomnessAmount").addEventListener("input",(function(){!function(t,e){t.randomnessAmount=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}function wt(t){let e=new ImageData(t.imageData,t.gridWidth,t.gridHeight);t.ctx.putImageData(e,t.canvasCornerX,t.canvasCornerY)}console.log("Loading main.js");var Bt=new class{constructor({gridHeight:t=200,gridWidth:e=200,targetCycleTime:i=100,addRandomness:n=!0,randomnessAmount:o=-2,randomisePeriodicityShiftAndTopology:s=!0,gridPeriodicityShiftX:a=0,gridPeriodicityShiftY:l=0,gridFlipX:h=!1,gridFlipY:u=!1,colorPalette:d="black2",metaRule:g="VariableGR",initialisation:c="random",ruleSwitchPeriod:m=2e4,ruleEvolvePeriod:f=2e3,logo:p=null,useLogo:b=!1}={}){this.paused=!1,this.step=!1,this.targetCycleTime=i,this.gridHeight=t,this.gridWidth=e,this.grid=new r(this.gridWidth,this.gridHeight),this.gridPeriodicityShiftX=a,this.gridPeriodicityShiftY=l,this.gridFlipX=h,this.gridFlipY=u,this.mask=null,this.findNeighbour=null,this.imageData=new Uint8ClampedArray(4*this.gridWidth*this.gridHeight).fill(0),this.redraw=new r(this.gridWidth,this.gridHeight),this.colorPalette=d,this.initialisation=c,this.logo=p,this.useLogo=b,this.redPerturbationStrength=0,this.greenPerturbationStrength=0,this.bluePerturbationStrength=0,this.brightnessPerturbationStrength=0,this.colors=[],this.nColors=4,this.addRandomness=n,this.randomnessAmount=o,this.randomisePeriodicityShiftAndTopology=s,this.reinitialiseGridFlag=!1,this.metaRule=g,this.updateCellValue=null,this.updateCellValueAuxiliary=null,this.ruleSwitchPeriod=m,this.ruleEvolvePeriod=f,this.currentStyle=null,this.time=0,this.ruleLogSwitchProbability=-25,this.ruleLogEvolveProbability=-25,this.logMultiplicativeFactor=25/this.ruleSwitchPeriod,this.logMultiplicativeEvolveFactor=25/this.ruleEvolvePeriod,this.changeRuleFlag=!0,this.changeBaseRuleFlag=!1,this.changeColoringRuleFlag=!1,this.evolveColoringRuleFlag=!1,this.reloadColorPaletteFlag=!1,this.activityLevel=0,this.nCellChangedHistoric=0,this.meanColorChangeHistoric=0,this.brightness=127,this.maxBrightness=130,this.minBrightness=124,this.diffBrightness=0,this.relCellChanged=0,this.flickerIndex=0,this.colorCount=[0,0,0,0],this.saveEventData=!1}}({gridHeight:192,gridWidth:192,targetCycleTime:100,addRandomness:!0,randomnessAmount:-1.5,randomisePeriodicityShiftAndTopology:!0,gridPeriodicityShiftX:0,gridPeriodicityShiftY:0,gridFlipX:!1,gridFlipY:!1,colorPalette:"variable",metaRule:"Variable",initialisation:"random",ruleSwitchPeriod:2e4,ruleEvolvePeriod:2e3});!function(t){t.canvasCornerX=0,t.canvasCornerY=0,t.canvas=document.getElementById("gameCanvas"),t.canvas.width=t.gridWidth,t.canvas.height=t.gridHeight,t.ctx=t.canvas.getContext("2d")}(Bt),window.onload=function(){!function(t){document.getElementById("addRandomness").addEventListener("change",(function(){t.addRandomness=this.checked}))}(Bt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(Bt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var i=t.canvas.getBoundingClientRect(),r=e.clientX-i.left,n=e.clientY-i.top,o=i.width/t.gridWidth,s=i.height/t.gridHeight,a=Math.floor(r/o),l=Math.floor(n/s);t.grid.set(l,a,1)}}))}(Bt),function(t){t.canvas.addEventListener("mousedown",(function(e){var i=t.canvas.getBoundingClientRect(),r=e.clientX-i.left,n=e.clientY-i.top,o=i.width/t.gridWidth,s=i.height/t.gridHeight,a=Math.floor(r/o),l=Math.floor(n/s);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(l,(a+1)%t.gridWidth,1),t.grid.set(l,a,1),t.grid.set((l+1)%t.gridHeight,a,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(l,a,1),t.grid.set((l+1)%t.gridHeight,a,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(l,a,1),t.grid.set(l,(a+1)%t.gridWidth,1)):(t.grid.set((l+1)%t.gridHeight,(a+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(a+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(a-1+t.gridWidth)%t.gridWidth,1),t.grid.set((l+1)%t.gridHeight,(a-1+t.gridWidth)%t.gridWidth,1))}))}(Bt),St(Bt),Mt(Bt),function(t){document.getElementById("gridPeriodicityShiftX").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.gridPeriodicityShiftX=e,nt(t)})),document.getElementById("gridPeriodicityShiftY").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.gridPeriodicityShiftY=e,nt(t)})),document.getElementById("gridFlipX").addEventListener("change",(function(){t.gridFlipX=this.checked,nt(t)})),document.getElementById("gridFlipY").addEventListener("change",(function(){t.gridFlipY=this.checked,nt(t)}))}(Bt),function(t){document.getElementById("cycleTime").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.targetCycleTime=e}))}(Bt),function(t){document.getElementById("colorPalette").addEventListener("change",(function(){t.colorPalette=this.value,l(t)}))}(Bt),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.metaRule=this.value,ot(t)}))}(Bt),function(t){document.getElementById("changeRule").addEventListener("click",(function(){t.changeRuleFlag=!0})),document.getElementById("changeBaseRule").addEventListener("click",(function(){t.changeBaseRuleFlag=!0})),document.getElementById("changeColoringRule").addEventListener("click",(function(){t.changeColoringRuleFlag=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.evolveColoringRuleFlag=!0})),null!==document.getElementById("reinitialiseGrid")&&document.getElementById("reinitialiseGrid").addEventListener("click",(function(){t.reinitialiseGridFlag=!0}))}(Bt),function(t){document.getElementById("changeColor").addEventListener("click",(function(){t.reloadColorPaletteFlag=!0}))}(Bt),function(t){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){t.saveEventData=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){Ct(t)})),document.getElementById("dislikeButton").addEventListener("click",(function(){Ct(t)}))}(Bt),function(t){const e=document.getElementById("playPauseButton");e.addEventListener("click",(()=>{t.paused=!t.paused,e.textContent=t.paused?"Pause":"Play",console.log("Paused",t.paused)})),document.getElementById("stepButton").addEventListener("click",(()=>{t.paused=!0,t.step=!0}))}(Bt),function(t){Object.keys(t).forEach((e=>{let i=localStorage.getItem(e);null!==i&&("boolean"==typeof t[e]?t[e]="true"===i:"number"==typeof t[e]?t[e]=parseFloat(i):t[e]=i)}))}(Bt),function(t){Object.keys(t).forEach((e=>{let i=document.getElementById(e);i&&("checkbox"===i.type?i.checked=t[e]:i.value=t[e])}))}(Bt),function(t){t.canvas.width=Math.max(t.gridHeight,t.gridWidth),t.canvas.height=Math.max(t.gridHeight,t.gridWidth),t.canvasCornerX=0,t.canvasCornerY=0;var e=document.getElementById("gameCanvas");if(t.gridHeight>t.gridWidth){var i=Math.floor(t.gridWidth/t.gridHeight*800);e.style.width=i+"px",e.style.height="800px",e.width=i*t.gridHeight/800,e.height=t.gridHeight}else{var r=Math.floor(t.gridHeight/t.gridWidth*800);e.style.width="800px",e.style.height=r+"px",e.width=t.gridWidth,e.height=r*t.gridWidth/800}t.imageData=new Uint8ClampedArray(4*t.gridWidth*t.gridHeight).fill(0)}(Bt),l(Bt),nt(Bt),ot(Bt),pt(Bt).then((()=>{vt(Bt,wt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
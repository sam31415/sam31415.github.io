(()=>{"use strict";var e={},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,i),o.exports}class r{constructor(e,t){this.width=e,this.height=t,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.transposed=!1,this.get=this.getNormal,this.set=this.setNormal}static fromArray(e,t=!1,i=!1,n=!1){const o=e.length,a=e[0].length,l=new r(a,o);for(let t=0;t<o;t++){n&&(t=o-t-1);for(let r=0;r<a;r++)i&&(r=a-r-1),l.set(t,r,e[t][r])}return t&&l.transpose(),l}transpose(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.transposed?[this.getNormal,this.setNormal]:[this.getTransposed,this.setTransposed],this.transposed=!this.transposed}flipX(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width/2;t++){const i=this.get(e,t);this.set(e,t,this.get(e,this.width-t-1)),this.set(e,this.width-t-1,i)}}flipY(){for(let e=0;e<this.height/2;e++)for(let t=0;t<this.width;t++){const i=this.get(e,t);this.set(e,t,this.get(this.height-e-1,t)),this.set(this.height-e-1,t,i)}}getNormal(e,t){return this.data[e*this.width+t]}setNormal(e,t,i){this.data[e*this.width+t]=i}getTransposed(e,t){return this.data[t*this.height+e]}setTransposed(e,t,i){this.data[t*this.height+e]=i}}class n{constructor({r:e=0,g:t=0,b:i=0,t:r=255,drift:n=0,redPerturbationStrength:o=0,greenPerturbationStrength:a=0,bluePerturbationStrength:l=0,brightnessPerturbationStrength:s=0}={}){this.r=e,this.g=t,this.b=i,this.t=r,this.drift=n,this.redPerturbationStrength=o,this.greenPerturbationStrength=a,this.bluePerturbationStrength=l,this.brightnessPerturbationStrength=s,this.updateDoubles()}updateDoubles(){this.redPertStrength2=2*this.redPerturbationStrength,this.greenPertStrength2=2*this.greenPerturbationStrength,this.bluePertStrength2=2*this.bluePerturbationStrength,this.brightnessPertStrength2=2*this.brightnessPerturbationStrength}}function o(e){let t=e;for(let i of["r","g","b"]){let r=Math.round(2*Math.random()*e.drift-e.drift),n=e[i]+r;n=Math.max(0,Math.min(255,n)),t[i]=n}return t}function a(){return 10**(1.5*Math.random()-.5)}function l(){return Math.floor(256*Math.random())}function s(){return 21*Math.random()}function h(){return new n({r:l(),g:l(),b:l(),t:255,drift:a(),redPerturbationStrength:s(),greenPerturbationStrength:s(),bluePerturbationStrength:s(),brightnessPerturbationStrength:s()})}function g(e){return new n({r:e.r,g:e.g,b:e.b,t:e.t,drift:e.drift,redPerturbationStrength:s(),greenPerturbationStrength:s(),bluePerturbationStrength:s(),brightnessPerturbationStrength:s()})}function d(e){var t=new n({r:13,g:112,b:255}),i=new n({r:240,g:239,b:239}),r=new n({r:0,g:0,b:0}),o=new n({r:247,g:255,b:28}),a=new n({r:255,g:255,b:255}),l=new n({r:240,g:240,b:240}),s=new n({r:221,g:12,b:12}),d=new n({r:29,g:29,b:189}),u=new n({r:39,g:192,b:177}),c=new n({r:252,g:53,b:47}),f=new n({r:156,g:36,b:150}),m=new n({r:114,g:223,b:174}),y=new n({r:0,g:0,b:0,t:0}),b=new n({r:75,g:75,b:75}),S=new n({r:175,g:175,b:175}),w=[new n({r:255,g:0,b:0}),new n({r:0,g:255,b:0}),new n({r:0,g:0,b:255}),new n({r:255,g:255,b:0}),new n({r:255,g:0,b:255}),new n({r:0,g:255,b:255})],p=new n({r:0,g:0,b:0}),v=new n({r:85,g:85,b:85}),C=new n({r:0,g:0,b:170}),B=new n({r:85,g:85,b:255}),M=new n({r:0,g:170,b:0}),I=new n({r:85,g:255,b:85}),N=new n({r:0,g:170,b:170}),R=new n({r:85,g:255,b:255}),P=new n({r:170,g:0,b:0}),x=new n({r:255,g:85,b:85}),F=new n({r:170,g:0,b:170}),E=new n({r:255,g:85,b:255}),L=new n({r:170,g:85,b:0}),k=new n({r:255,g:255,b:85}),H=new n({r:170,g:170,b:170}),A=new n({r:255,g:255,b:255}),W=[p,v,C,B,M,I,N,R,P,x,F,E,L,k,H,A];if(e.driftColors=[!1,!1,!1,!1],"variable"==e.colorPalette){e.nColors=Math.floor(6*Math.random())+2,e.colors=[g(r),g(l)];for(var T=e.nColors-e.colors.length,G=0;G<T;G++)e.colors.push(h())}if("allRandom"==e.colorPalette){e.nColors=Math.floor(6*Math.random())+2,e.colors=[];for(G=0;G<e.nColors;G++)e.colors.push(h())}else if("monochrome"==e.colorPalette)e.colors=[r,a,b,S];else if("basic"==e.colorPalette){let t=w[Math.floor(Math.random()*w.length)],i=w[Math.floor(Math.random()*w.length)];for(;t==i;)i=w[Math.floor(Math.random()*w.length)];e.colors=[r,a,t,i]}else if("cga-4"==e.colorPalette)e.colors=[p,A,R,E];else if("cga-16"==e.colorPalette){e.nColors=Math.floor(6*Math.random())+2;var U=W.slice();!function(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}}(U),e.colors=U.slice(0,e.nColors)}else"blackwhite"==e.colorPalette?e.colors=[r,a,r,a]:"yellow"==e.colorPalette?e.colors=[o,r,t,i]:"blue"==e.colorPalette?e.colors=[t,i,r,o]:"blue2"==e.colorPalette?e.colors=[t,o,r,i]:"grey2"==e.colorPalette?e.colors=[i,o,r,t]:"black2"==e.colorPalette?e.colors=[r,t,i,o]:"blackTrace"==e.colorPalette?e.colors=[r,i,r,i]:"redBlue"==e.colorPalette?e.colors=[r,l,s,d]:"turquoiseRed"==e.colorPalette?e.colors=[r,l,u,c]:"magentaCyan"==e.colorPalette?e.colors=[r,l,f,m]:"mouseAnimation"==e.colorPalette&&(e.colors=[y,t,r,o]);e.nColors=e.colors.length,e.colorCount=new Array(e.nColors).fill(0)}function u(e){if("VariableGR"!=e.metaRule)for(var t of e.colors)0!=t.redPerturbationStrength&&(t.redPerturbationStrength=s()),0!=t.greenPerturbationStrength&&(t.greenPerturbationStrength=s()),0!=t.bluePerturbationStrength&&(t.bluePerturbationStrength=s()),0!=t.brightnessPerturbationStrength&&(t.brightnessPerturbationStrength=s()),t.updateDoubles()}function c(e){for(var t of e.colors)0!=t.drift&&(t.drift=a())}function f(e){let t=Object.values(e).reduce(((e,t)=>e+t),0),i=Object.values(e).reduce(((e,i,r)=>[...e,i/t+(e[r-1]||0)]),[]);return function(){let t=Math.random(),r=i.findIndex((e=>t<e));return Object.keys(e)[r]}}const m=15;function y(e,t,i,r,n,o,a,l,s){const h=r.height-1,g=r.width-1,d=r.data,u=r.width;var c=n[0],f=n[1];let m;for(var y=-1;y<=1;y++)for(var b=-1;b<=1;b++){if(0==y&&0==b)continue;if(o[0]=((-1===y?1:y)+(-1===b?1:b))%2,o[a%4+1]=-1==y?1:0,o[(1+a)%4+1]=-1==b?1:0,o[(2+a)%4+1]=1==y?1:0,o[(3+a)%4+1]=1==b?1:0,o[(1+a)%2+5]=y*b==1?0:1,o[a%2+5]=y*b==-1?0:1,0==t||0==i||t==h||i==g)var[S,w]=e.findNeighbour(e,t,i,y,b);else var S=t+y,w=i+b;const r=d[S*u+w],n=r%l,v=Math.floor(r/l)%s;m=0;for(var p=0;p<l-1;p++)n==p+1&&(c[p]+=1,m+=l,c[m+p]+=o[0],m+=l,c[m+p]+=1-o[0],m+=l,c[m+p]+=o[1],m+=l,c[m+p]+=1-o[1],m+=l,c[m+p]+=o[2],m+=l,c[m+p]+=1-o[2],m+=l,c[m+p]+=o[3],m+=l,c[m+p]+=1-o[3],m+=l,c[m+p]+=o[4],m+=l,c[m+p]+=1-o[4],m+=l,c[m+p]+=o[5],m+=l,c[m+p]+=1-o[5],m+=l,c[m+p]+=o[6],m+=l,c[m+p]+=1-o[6]),m=0;for(m=0,p=0;p<s;p++)v==p&&(f[p]+=1,m+=s,f[m+p]+=o[0],m+=s,f[m+p]+=1-o[0],m+=s,f[m+p]+=o[1],m+=s,f[m+p]+=1-o[1],m+=s,f[m+p]+=o[2],m+=s,f[m+p]+=1-o[2],m+=s,f[m+p]+=o[3],m+=s,f[m+p]+=1-o[3],m+=s,f[m+p]+=o[4],m+=s,f[m+p]+=1-o[4],m+=s,f[m+p]+=o[5],m+=s,f[m+p]+=1-o[5],m+=s,f[m+p]+=o[6],m+=s,f[m+p]+=1-o[6]),m=0}return[c,f]}const b="mix",S="isotropic",w="xcross",p="vcross",v="xvcross",C="directional1",B="directional2",M="directional3",I="directional2b",N="directional",R="hexagonal1",P="hexagonal2",x={[b]:.2,[S]:.4,[w]:.05,[p]:.05,[v]:.05,[C]:.05,[B]:.05,[M]:.05,[I]:.05,[N]:.05,[R]:.05,[P]:.05};function F(e,t){var i,r=t;if(r==b){var n=Math.random();r=n<.5?S:n<.7?w:n<.9?p:N}return r==S?Math.floor(Math.random()*e):r==p?Math.floor(Math.random()*e+e):r==w?Math.floor(Math.random()*e+2*e):r==v?Math.floor(2*Math.random()*e+e):r==C?Math.floor(2*Math.random()*e+3*e):r==B?Math.floor(4*Math.random()*e+3*e):r==M?Math.floor(6*Math.random()*e+3*e):r==I?((i=Math.floor(4*Math.random()*e+3*e))>=5*e&&(i+=2*e),i):r==N?Math.floor(8*Math.random()*e+3*e):r==R?((i=Math.floor(2*Math.random()*e+11*e))>=12*e&&(i+=e),i):r==P?((i=Math.floor(2*Math.random()*e+12*e))>=13*e&&(i+=e),i):void 0}function E(e){var t=8;return[1,2].includes(e)?t=4:[3,5,7,9].includes(e)?t=3:[4,6,8,10].includes(e)?t=5:[11,13].includes(e)?t=6:[12,14].includes(e)&&(t=2),t}const L="A",k="C",H="E",A="B";class W{constructor(e,t,i,r,n,o=null,a=4){this.type=e,this.threshold=t,this.neighbourType=i,this.inactivation=r,this.modulo=n,this.periodicity=o,this.nStatesPrimary=a,this.testInactive=function(e,t){return e==k?function(e){return 0==e}:e==L?function(e){return e%t==0}:function(e){return!0}}(this.inactivation,this.modulo);var l=[i[0],i[1][0]*a+i[1][1]];this.neighbourType.length>2&&l.push(i[2][0]*a+i[2][1]),this.testValue=function(e,t,i){return t==H&&2==i.length?function(t){return t[i[0]][i[1]]==e}:t==A&&2==i.length?function(t){return t[i[0]][i[1]]>e}:t==H&&3==i.length?function(t){return t[i[0]][i[1]]+t[i[0]][i[2]]==e}:t==A&&3==i.length?function(t){return t[i[0]][i[1]]+t[i[0]][i[2]]>e}:void 0}(this.threshold,this.type,l),this.testPeriodicity=function(e){let t;return t=null==e?function(e){return!0}:function(t){return e[t%e.length]},t}(o)}test(e,t,i){var r=this.testPeriodicity(i);return this.testValue(e)&&this.testInactive(t)&&r}name(){var e="";null!=this.periodicity&&(e=this.periodicity.map((e=>e?"1":"0")).join(""));var t=`${this.neighbourType[0]}|`;t+=`${this.neighbourType[1][0]}:${this.neighbourType[1][1]}`,this.neighbourType.length>2&&(t+=`|${this.neighbourType[2][0]}:${this.neighbourType[2][1]}`);var i=this.inactivation;return this.inactivation==L&&(i+=this.modulo),`${this.type}${this.threshold}${i}[${t}]${e}`}static fromName(e){var t=null,i=4;e.startsWith(H)?t=H:e.startsWith(A)&&(t=A);var r=e.substring(t.length),n=parseInt(r.substring(0,1)),o=null;(r=r.substring(1)).startsWith(k)?o=k:r.startsWith(L)?(isNaN(r.charAt(1))||(i=parseInt(r.charAt(1)),r=r.substring(1)),o=L):r.startsWith("N")&&(o="N");var a=(r=r.substring(o.length)).split("[")[1].split("]")[0].split("|"),l=[parseInt(a[0])],s=a[1].split(":").map((e=>parseInt(e)));if(l.push(s),a.length>2){var h=a[2].split(":").map((e=>parseInt(e)));l.push(h)}var g=null;return(r=r.split("]")[1]).length>0&&(g=r.split("").map((e=>"1"===e))),new W(t,n,l,o,i,g)}static randomSample(e,t,i=null,r=b,n=null){var o=[e,t];const a=[H,A],l=a[Math.floor(Math.random()*a.length)],s=[k,L,"N"],h=s[Math.floor(Math.random()*s.length)];null===i&&(i={0:2/3,1:1/3});const g=f(i)(),d=F(o[g],r),u=[Math.floor(d/o[g]),d%o[g]];var c=void 0;if(Math.random()<.5){for(var m=F(o[g],r);d==m;)m=F(o[g],r);c=[g,u,[Math.floor(m/o[g]),m%o[g]]]}else c=[g,u];var y=0,S=E(c[1][0]);c.length>2&&E(c[2][0])>S&&(S=E(c[2][0])),y=l===A?Math.floor(Math.random()*S):Math.floor(Math.random()*S)+1;var w=Math.floor(5*Math.random())+2;if(Math.random()<.2)p=null;else{var p;null==n&&(n=Math.floor(20*Math.random())+2);do{p=new Array(n).fill(0).map((()=>Math.random()<.5))}while(!p.includes(!0))}return new W(l,y,c,h,w,p,e)}}class T{constructor(){this.nStates=void 0}updateRule(e,t,i,r){throw new Error("Must override method")}getName(){throw new Error("Must override method")}}class G extends T{constructor(){super(),this.seedingPatterns=this.getSeedingPatterns(),this.constructSeedingSampler(),this.randomnessLogShift=0}getSeedingPatterns(){throw new Error("Must override method")}constructSeedingSampler(){this.seedMasks=Object.keys(this.seedingPatterns).map((e=>this.seedingPatterns[e].mask));let e=Object.keys(this.seedingPatterns).map((e=>this.seedingPatterns[e].prob));this.seedSampler=f(e)}}class U extends G{constructor(e){super(),null==e&&(e=U.generateRule()),this.initialiseRule(e)}updateRule(e,t,i,r){var n=e%this.nStates;return 1==n&&this.survive.includes(i[0][this.neighbourhood[0]])?t=1:n>0&&n<this.nStates-1?t+=1:n==this.nStates-1?t=0:0==n&&this.birth.includes(i[0][this.neighbourhood[1]])?t=1:0==n&&this.inhibited.includes(i[0][this.neighbourhood[2]])&&(t=this.nStates-1),t}sampleDigitsInBrackets(e){return e.replace(/\[([0-9]+)\]|\{([0-9|]+)\}/g,((e,t,i)=>{if(t){let e="";for(const i of t)Math.random()>.5&&(e+=i);return e}if(i){const e=i.split("|");return e[Math.floor(Math.random()*e.length)]}}))}initialiseRule(e){this.ruleString=this.sampleDigitsInBrackets(e),console.log("Sampled rulestring: ",this.ruleString);const t=this.ruleString.split("/");for(var i of(this.neighbourhood=[0,0,0],this.inhibited=[],this.nStates=Number(t[t.length-1]),t))"N"==i[0]?(this.neighbourhood=i.substring(1).split("|").map((e=>{const[t,i]=e.split(":");return i?parseInt(t)*this.nStates+parseInt(i):parseInt(t)})),this.neighbourhood.length<3&&(this.neighbourhood=[this.neighbourhood[0],this.neighbourhood[0],this.neighbourhood[0]])):"B"==i[0]?this.birth=new Uint8Array(i.substring(1).split("").map(Number)):"S"==i[0]?this.survive=new Uint8Array(i.substring(1).split("").map(Number)):"I"==i[0]&&(this.inhibited=new Uint8Array(i.substring(1).split("").map(Number)))}static generateRule(e){let t=Math.floor(10*Math.random())+3,i=[8,8,8];null==e&&(e=[Math.floor(Math.random()*m*t),Math.floor(Math.random()*m*t),Math.floor(Math.random()*m*t)]);let r=[Math.floor(e[0]/t)%m,Math.floor(e[1]/t)%m,Math.floor(e[2]/t)%m];for(let e=0;e<3;e++)i[e]=E(r[e]);let n=this.generateRandomArray(1,i[0]);0==n.length&&(n=[2]);let o=this.generateRandomArray(1,i[1]),a=this.generateRandomArray(1,i[2]);return a=a.filter((e=>!n.includes(e)&&!o.includes(e)&&2!=e)),this.getRuleString(e,n,o,a,t)}static getRuleString(e,t,i,r,n){return`N${e.map((e=>Math.floor(e/n)%m+":"+e%n)).join("|")}/B${t.join("")}/S${i.join("")}/I${r.join("")}/${n}`}static generateRandomArray(e,t){let i=[];for(let r=e;r<=t;r++)Math.random()<.5&&i.push(r);return i}getName(){return this.ruleString}getSeedingPatterns(){return{random:{prob:1,mask:null}}}}class D extends U{constructor(e,t=null){if(super(e),"ships"==t){this.initialiseRule(this.ruleString),this.neighbourhood[0]=0;let e=Array.from(this.birth).indexOf(1);if(-1!==e){let t=new Uint8Array(this.birth.length-1);t.set(this.birth.subarray(0,e),0),t.set(this.birth.subarray(e+1),e),this.birth=t}if(-1===this.birth.indexOf(2)){let e=new Uint8Array(this.birth.length+1);e[0]=2,e.set(this.birth,1),this.birth=e}if(e=Array.from(this.survive).indexOf(1),-1!==e){let t=new Uint8Array(this.survive.length-1);t.set(this.survive.subarray(0,e),0),t.set(this.survive.subarray(e+1),e),this.survive=t}this.inhibited=this.inhibited.filter((e=>!this.birth.includes(e)&&!this.survive.includes(e)&&2!=e)),this.ruleString=U.getRuleString(this.neighbourhood,this.birth,this.survive,this.inhibited,this.nStates),this.activationFactor=1,this.randomnessLogShift=.5}else this.activationFactor=20/this.birth[0]**3,this.randomnessLogShift=1.5}updateRule(e,t,i,r,n){var o=e%this.nStates;return 1==o&&this.survive.includes(i[0][this.neighbourhood[0]])?t=1:o>0&&o<this.nStates-1?t+=1:o==this.nStates-1?t=0:0==o&&this.birth.includes(i[0][this.neighbourhood[1]])&&Math.random()>this.activationFactor*n-.05?t=1:0==o&&this.inhibited.includes(i[0][this.neighbourhood[2]])&&(t=this.nStates-1),t}getName(){return`SGen/${this.ruleString}`}initialiseRule(e){"SGen"==e.substring(0,4)?super.initialiseRule(e.substring(5)):super.initialiseRule(e)}}class X extends T{constructor(e,t,i,r,n=4){super(),this.conditions=e,this.nStates=this.conditions.length+1,this.nStatesPrimary=n,this.conditionLevels=t,this.neighbourhoodGeometryType=i,this.periodicityLength=r}updateRule(e,t,i,r){t=0;for(let n=0;n<this.conditions.length;n++)if(this.conditions[n].test(i,e,r)){t=n+1;break}return t}getName(){return this.conditions.map((e=>e.name())).join("||")}static sampleRule(e,t){var i=e.nConditions,r=e.chosenConditionLevels,n=e.neighbourhoodGeometryType,o=e.periodicityLength,a=[];null==i&&(i=Math.floor(8*Math.random())+2),null==n&&(n=f(x)()),null==o&&(o=this.samplePeriodicityLength());var l=i+1;for(let e=0;e<i;e++)a.push(W.randomSample(t,l,r,n,o));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+a.map((e=>e.name())).join(", ")),new X(a,r,n,o,t)}static samplePeriodicityLength(){var e=Math.random();return e<.2?null:e<.6?1:e<.7?2:e<.8?3:e<.9?4:Math.floor(20*Math.random())+5}static ruleFromNames(e){var t=e.split("||").map((e=>W.fromName(e)));return new X(t,null,b,null)}evolveRule(e=null){var t,i=this.conditions.length;null==e&&(e=this.conditionLevels),0==(t=2==i?Math.floor(2*Math.random())+1:10==i?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.removeCondition():1==t?this.changeCondition(e):this.addCondition(e)}addCondition(e){var t=this.conditions.slice();t.push(W.randomSample(this.nStatesPrimary,this.nStates,this.conditionLevels,this.neighbourhoodGeometryType,this.periodicityLength)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.neighbourhoodGeometryType+": "+t.map((e=>e.name())).join("||")),this.conditions=t}removeCondition(){var e=this.conditions.slice(),t=Math.floor(Math.random()*e.length);e.splice(t,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+e.map((e=>e.name())).join("||")),this.conditions=e}changeCondition(e){var t=this.conditions.slice(),i=Math.floor(Math.random()*t.length);t[i]=W.randomSample(this.nStatesPrimary,this.nStates,e,this.neighbourhoodGeometryType,this.periodicityLength),console.log((new Date).toLocaleTimeString()+" Changing condition "+i+" to "+this.neighbourhoodGeometryType+": "+t.map((e=>e.name())).join("||")),this.conditions=t}}class Y{colorUnit;ruleChain;updateRule;setRuleChain(){throw new Error("Must override method")}setUpdateRule(){this.updateRule=function(e,t,i,r,n){t=this.ruleChain[0].updateRule(e%this.ruleChain[0].nStates,t,i,r,n);var o=this.ruleChain[0].nStates;for(let n=1;n<this.ruleChain.length;n++)t+=o*this.ruleChain[n].updateRule(Math.floor(e/o)%this.ruleChain[n].nStates,t,i,r),t%=o*=this.ruleChain[n].nStates;return t%o}}setBaseRule(){throw new Error("Must override method")}setStyleRule(){throw new Error("Must override method")}getName(){return this.ruleChain.map((e=>e.getName())).join("-")}}class j extends Y{constructor(e){super(),this.ruleConfig=e.config.ruleConfig,this.styleConfig=e.config.styleConfig,this.coloringConfig=e.config.coloringConfig,this.randomnessConfig=e.config.randomnessConfig,this.sanityConfig=e.config.sanityConfig,this.currentGenerationsRule=null,this.setRuleChain(e),this.setUpdateRule()}setRuleChain(e){this.ruleChain=[null],this.setBaseRule(e),this.setStyleRule(e)}setBaseRule(e){this.ruleConfig=e.config.ruleConfig;let t=f(this.ruleConfig.rules)();var i=U;if("SGen"==t.substring(0,4)&&(t=t.substring(5),i=D),["Random","andom"].includes(t))t=null;else for(;t.split("/").length<5;)if("N"!=t[0])t="N0/"+t;else{t=t+"/"+(Math.floor(10*Math.random())+3)}this.ruleChain[0]=new i(t),this.colorUnit=this.ruleChain[0].nStates}setStyleRule(e){if(this.styleConfig=e.config.styleConfig,0===Object.keys(this.styleConfig).length||"No style"==this.styleConfig.name)return this.colorUnit=1,void(this.ruleChain=this.ruleChain.slice(0,1));for(;this.ruleChain.length>1;)this.ruleChain.pop();if(this.styleConfig.style)return this.ruleChain.push(X.ruleFromNames(this.styleConfig.style)),void(this.colorUnit=this.ruleChain[0].nStates);var t=this.styleConfig.conditionLevels,i=f(t.reduce(((e,t,i)=>(e[i]=t.weight,e)),{}))();this.styleConfig.chosenConditionLevels=t[i].probabilities;var r=this.ruleChain[0].nStates;this.ruleChain.push(X.sampleRule(this.styleConfig,r)),this.colorUnit=this.ruleChain[0].nStates}updateGlobalDataWithConfig(e){}}var O=2e4;const V={Test:{name:"Test",rules:{"SGen/N0/B234/S2345[678]/I[12345678]/{25|30|35|40}":1},timeBetweenRuleChanges:O},Custom:{name:"Custom",rules:{}},"Asteroid fields family":{name:"Asteroid fields family",rules:{"N0/B2[5678]/S0[5678]/I[2345678]/4":1},timeBetweenRuleChanges:O},"Bloomerang family":{name:"Bloomerang family",rules:{"N0/B34[5678]/S234[678]/I[12345678]/{9|10|11|12|13|14|24}":1},timeBetweenRuleChanges:O},"Bombers family":{name:"Bombers family",rules:{"N0/B24[5678]/S345[678]/I[12345678]/{11|12|13|14}":1},timeBetweenRuleChanges:O},"Brian's brain":{name:"Brian's brain",rules:{"N0/B2/S/I345678/3":1},timeBetweenRuleChanges:O},"Modified Brian's brain":{name:"Modified Brian's brain",rules:{"N0/B2/S/I345678/3":1},timeBetweenRuleChanges:O},"Brian's brain family":{name:"Brian's brain family",rules:{"N0/B2[45678]/S[45678]/I[345678]/{3|4}":1},timeBetweenRuleChanges:O},"Brian's brain S0 family":{name:"Brian's brain S0 family",rules:{"N0/B2[45678]/S0[45678]/I[345678]/{4|5}":1},timeBetweenRuleChanges:O},"Burst family":{name:"Burst family",rules:{"N0/B34[568]/S0235[678]/I[345678]/5":1,"N0/B34[568]/S235[678]/I[345678]/5":1},timeBetweenRuleChanges:O},"Caterpillars family":{name:"Caterpillars family",rules:{"N0/B378/S124567/I1345678/3":5},timeBetweenRuleChanges:O},"Conway's game of life":{name:"Conway's game of life",rules:{"N0/B3/S23/I/2":1},timeBetweenRuleChanges:O},Crawlers:{name:"Crawlers",rules:{"N11:1|0:0|0:0/B2/S1/I1/6":1},timeBetweenRuleChanges:O},"Flaming ships":{name:"Flaming ships",rules:{"B24/S34/I15678/4":1},timeBetweenRuleChanges:O},"Flaming ships family":{name:"Flaming ships family",rules:{"N0/B24[678]/S34[678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":1},timeBetweenRuleChanges:O},"Leggy ships family":{name:"Leggy ships family",rules:{"N0/B23[5678]/S14[5678]/I1[2345678]/{5|6|7|8|9|10}":1},timeBetweenRuleChanges:O},"Life-like family":{name:"Life-like family",rules:{"N0/B34[5678]/S235[678]/I[45678]/5":1},timeBetweenRuleChanges:O},"Slow growth":{name:"Slow growth",rules:{"N0/B34[5678]/S234[678]/I2[45678]/{10|11|12|13|14|15|16|17|18|19|20}":1}},"Star wars":{name:"Star wars",rules:{"N0/B2/S345/I/4":1},timeBetweenRuleChanges:O},"Star wars family":{name:"Star wars family",rules:{"N0/B2[5678]/S345[78]/I[12345678]/{3|4}":6,"N0/B2[5678]/S345[678]/I[12345678]/{5|6|7|8|9|10}":1},timeBetweenRuleChanges:O},"Star wars S0 family":{name:"Star wars S0 family",rules:{"N0/B2[5678]/S0345[678]/I[12345678]/{7|8}":8},timeBetweenRuleChanges:O},"Star cruiser family":{name:"Star cruiser family",rules:{"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":15},timeBetweenRuleChanges:O},"Straight ships":{name:"Straight ships",rules:{"B2/S245678/I1/4":1},timeBetweenRuleChanges:O},"Straight ships family":{name:"Straight ships family",rules:{"N0/B2[5678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":1},timeBetweenRuleChanges:O},"Straight ships S0 family":{name:"Straight ships S0 family",rules:{"N0/B2[5678]/S02[45678]/I1[345678]/5":1},timeBetweenRuleChanges:O},"Trains family":{name:"Trains family",rules:{"N1:0|1:0|0:0/B14/S[34]/I1[345678]/{12|13|14|15|16|17|18|19|20}":1},timeBetweenRuleChanges:O},"Wiggly ships":{name:"Wiggly ships",rules:{"N0/B24568/S34678/I34678/7":1},timeBetweenRuleChanges:O},"Wiggly ships family":{name:"Wiggly ships family",rules:{"N0/B24568/S34678/I3[45678]/{4|5|6|7|8|9|10|11}":1},timeBetweenRuleChanges:O},"Safe mixed generations":{name:"Safe mixed generations",rules:{"N0/B2/S/I345678/3":20,"N0/B2/S/I/3":4,"N0/B2/S345/I/4":5,"B2/S245678/I1/4":5,"B24/S34/I15678/4":5,"N0/B3/S23/I/2":8,"N0/B2[45678]/S[45678]/I[345678]/{3|4}":12,"N0/B2[5678]/S345[78]/I[12345678]/{3|4}":6,"N0/B27/S345/I12357/5":4,"N0/B2[5678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":12,"N0/B24[678]/S34[678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":15,"N0/B34[5678]/S235[678]/I[45678]/5":15,"N0/B24568/S34678/I34678/7":5,"N0/B24568/S34678/I3[45678]/{4|5|6|7|8|9|10|11}":15,"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":15},timeBetweenRuleChanges:O},"Mixed generations":{name:"Mixed generations",rules:{"N0/B2/S/I345678/3":20,"N0/B2/S/I/3":4,"N0/B2/S345/I/4":5,"B2/S245678/I1/4":5,"B24/S34/I15678/4":5,"N0/B3/S23/I/2":8,"N0/B2[45678]/S[45678]/I[345678]/{3|4}":12,"N0/B2[5678]/S345[678]/I[12345678]/{5|6|7|8|9|10}":9,"N0/B2[5678]/S345[78]/I[12345678]/{3|4}":6,"N0/B2[5678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":12,"N0/B24[678]/S34[678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":15,"N0/B34[5678]/S235[678]/I[45678]/5":15,"N0/B23[5678]/S14[5678]/I1[2345678]/{5|6|7|8|9|10}":10,"N0/B34[5678]/S234[678]/I2[45678]/{10|11|12|13|14|15|16|17|18|19|20}":12,"N0/B34[5678]/S234[678]/I[12345678]/{9|10|11|12|13|14|24}":12,"N0/B24[5678]/S345[678]/I[12345678]/{11|12|13|14}":8,"N0/B34[568]/S0235[678]/I[345678]/5":8,"N0/B34[568]/S235[678]/I[345678]/5":8,"N0/B378/S124567/I1345678/3":5,"N0/B2[5678]/S0[5678]/I[2345678]/4":8,"N0/B2[5678]/S02[45678]/I1[345678]/5":8,"N0/B2[45678]/S0[45678]/I[345678]/{4|5}":8,"N0/B2[5678]/S0345[678]/I[12345678]/{7|8}":8,"N0/B27/S345/I12357/5":2,"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":15,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:{0|1}|0:0/B2[45678]/S2[45678]/I1[345678]/{9|10|11|12|13|14}":6,"N0/B23/S34[678]/I1[2345678]/{6|7|8|9|10|11|12|13}":3,"N0/B234[5678]/S2[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":12,"N0/B234[5678]/S3[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234[5678]/S[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234578/S37/I/11":1,"N0/B23[45678]/S3[5678]/I[45678]/{5|6|7|8|9|10|11|12}":8,"N0/B2368/S358/I/5":1,"N0/B24[5678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":5,"N0/B24568/S3478/I34578/5":1,"N0/B24568/S3478/I34578/6":1,"N0/B24568/S3478/I34578/7":3,"N0/B24568/S34578/I34578/9":1,"N0/B24568/S34578/I34578/12":1,"N0/B24568/S34578/I34578/13":1,"N0/B24568/S34578/I34578/14":1,"N0/B24568/S34678/I34678/7":5,"N0/B24568/S34678/I3[45678]/{4|5|6|7|8|9|10|11}":15,"N0/B245[678]/S346[78]/I123[45678]/{4|5|6|7|8|9|10|11}":8,"N0/B25[678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":12,"N0/B25/S345/I/4":1,"N0/B25/S345/I/5":1,"N0:0/B2[5678]/S34567/I1[345678]/{5|6|7|8|9|10|11|12|13|14}":5,"N0/B2[5678]/S34[5678]/I[5678]/{5|6}":15,"N0/B25678/S2478/I345678/12":1,"N0/B2568/S345678/I345678/8":1,"N0/B2568/S345678/I345678/10":1,"N0/B2568/S345678/I345678/12":1,"N0/B2568/S34578/I34578/4":1,"N0/B2568/S34578/I34578/5":1,"N0/B2568/S34578/I34578/6":1,"N0/B2568/S34578/I34578/7":1,"N0/B2568/S34578/I34578/8":1,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B2[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":15,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B23[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":6,"N1/B2[45678]/S3[45678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N1/B23[45678]/S1[2345678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N5|1|18/B2[345678]/S1[345678]/I[345678]/{7|7|7|8|8|8|11|12|13|14|15}":8,"N11:1|0:0|0:0/B245/S1/I12357/6":3,"SGen/N0/B2[345678]/S[2345678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":20,"SGen/N0/B[12345678]/S[012345678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":20,"N0/B1[2345678]/S[12345678]/I[12345678]/{25|50|75|100}":12,"N0/B1/S[5678]/I[2345678]/{25|50|75|100}":12,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:0|{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:0|{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:0/B1[2345678]/S[12345678]/I[12345678]/{25|50|75|100}":20,"N45|0|33/B2/S/I34/7":1,"N58|0|16/B24568/S/I1/{5|6|7|8}":3,"N66|0|67/B2/S23/I23/6":3,"N66|0|0/B2/S1/I1/6":2,"N67|0|0/B2/S1/I1/6":2},timeBetweenRuleChanges:O}};function q(e,t,i){return{probabilities:{0:e,1:t},weight:i}}const z={Mixed:[q(1,0,3),q(.8,.2,3),q(.5,.5,2),q(0,1,2)],Static:[q(1,0,1)],Dynamic:[q(0,1,1)]},$={Mixed:{name:"Mixed",nConditions:null,conditionLevels:z.Mixed,neighbourhoodGeometryType:null,periodicityLength:null,timeBetweenStyleChanges:2e3},"Mixed static":{name:"Mixed static",nConditions:null,conditionLevels:z.Static,neighbourhoodGeometryType:null,periodicityLength:null,timeBetweenStyleChanges:2e3},"Mixed constant":{name:"Mixed constant",nConditions:null,conditionLevels:z.Mixed,neighbourhoodGeometryType:null,periodicityLength:1,timeBetweenStyleChanges:2e3},"Mixed safe":{name:"Mixed safe",nConditions:null,conditionLevels:z.Static,neighbourhoodGeometryType:null,periodicityLength:1,timeBetweenStyleChanges:2e3},Custom:{name:"Custom",style:null},"No style":{name:"No style"}},K={Mixed:{ruleConfig:V["Mixed generations"],styleConfig:$.Mixed},"Mixed safe":{ruleConfig:V["Mixed generations"],styleConfig:$["Mixed safe"]},Safe:{ruleConfig:V["Modified Brian's brain"],styleConfig:$["Mixed safe"]},"Test rule":{ruleConfig:V.Test,styleConfig:$.Mixed},Custom:{ruleConfig:V.Custom,styleConfig:$.Custom}};function _(e,t=!1){if(Math.random()<Math.exp(e.ruleLogSwitchProbability)||t||e.changeRuleFlag){if(e.colorCount=new Array(e.nColors).fill(0),"VariableGR"==e.metaRule)e.nColors=4,e.config=K.Safe,e.ruleClass=new j(e),e.ruleClass2=new j(e),e.useLogo=!0;else if("VariableDemo"==e.metaRule)e.config=K["Mixed safe"],e.ruleClass=new j(e),e.useLogo=!1;else if("Variable"==e.metaRule)e.config=K["Mixed safe"],e.ruleClass=new j(e);else if("VariableMix"==e.metaRule)e.config=K.Mixed,e.ruleClass=new j(e);else if("VariableUnsafe"==e.metaRule)e.config=K.Mixed,e.ruleClass=new j(e);else if("VariableTest"==e.metaRule)e.config=K["Test rule"],e.ruleClass=new j(e);else if("CustomRule"==e.metaRule){e.config=K.Custom;var[i,r]=e.currentStyle.split("-");e.config.ruleConfig.rules={[i]:1},r?e.config.styleConfig.style=r:e.config.styleConfig={},e.ruleClass=new j(e)}else e.config=K["Default mixed"],e.ruleClass=new j(e);e.ruleLogSwitchProbability=-25,e.ruleLogEvolveProbability=-25,e.changeRuleFlag=!1,e.time=0,Z(e),d(e)}e.changeBaseRuleFlag&&(e.ruleClass.setBaseRule(e),e.ruleLogSwitchProbability=-25,e.changeBaseRuleFlag=!1,e.time=0,Z(e),u(e),c(e)),e.changeStyleFlag&&(e.ruleClass.setStyleRule(e),e.ruleLogEvolveProbability=-25,e.changeStyleFlag=!1,e.time=0,Z(e),u(e),c(e)),(Math.random()<Math.exp(e.ruleLogEvolveProbability)||e.evolveColoringRuleFlag)&&"CustomRule"!=e.metaRule&&(J(e.ruleClass),e.useLogo&&null!==e.ruleClass2&&J(e.ruleClass2),e.ruleLogEvolveProbability=-25,e.evolveColoringRuleFlag=!1,e.time=0,Z(e),u(e),c(e));e.ruleLogSwitchProbability=e.ruleLogSwitchProbability+1*e.logMultiplicativeFactor,e.ruleLogSwitchProbability>0&&(e.ruleLogSwitchProbability=0),e.ruleLogEvolveProbability=e.ruleLogEvolveProbability+1*e.logMultiplicativeEvolveFactor,e.ruleLogEvolveProbability>0&&(e.ruleLogEvolveProbability=0)}function Z(e){if("undefined"!=typeof document){var t=document.getElementById("currentStyle");t&&(e.useLogo&&null!==e.ruleClass2?t.value=e.ruleClass.getName()+"__"+e.ruleClass2.getName():t.value=e.ruleClass.getName())}}function J(e){e.ruleChain[1]&&"function"==typeof e.ruleChain[1].evolveRule&&e.ruleChain[1].evolveRule(e.conditionLevels)}function Q(e,t,i,r,n){let o=(t+r+e.gridHeight)%e.gridHeight,a=(i+n+e.gridWidth)%e.gridWidth,l=o,s=a;return(o-t-r>0||o-t-r<0)&&(s=(e.gridWidth-a-e.gridPeriodicityShiftX+e.gridWidth)%e.gridWidth),(a-i-n>0||a-i-n<0)&&(l=(e.gridHeight-o-e.gridPeriodicityShiftY+e.gridHeight)%e.gridHeight),[l,s]}function ee(e,t,i,r,n){let o=(t+r+e.gridHeight)%e.gridHeight,a=(i+n+e.gridWidth)%e.gridWidth,l=o,s=a;return(o-t-r>0||o-t-r<0)&&(s=(e.gridWidth-a-e.gridPeriodicityShiftX+e.gridWidth)%e.gridWidth),a-i-n>0?l=(o+e.gridPeriodicityShiftY+e.gridHeight)%e.gridHeight:a-i-n<0&&(l=(o-e.gridPeriodicityShiftY+e.gridHeight)%e.gridHeight),[l,s]}function te(e,t,i,r,n){let o=(t+r+e.gridHeight)%e.gridHeight,a=(i+n+e.gridWidth)%e.gridWidth,l=o,s=a;return o-t-r>0?s=(a+e.gridPeriodicityShiftX+e.gridWidth)%e.gridWidth:o-t-r<0&&(s=(a-e.gridPeriodicityShiftX+e.gridWidth)%e.gridWidth),(a-i-n>0||a-i-n<0)&&(l=(e.gridHeight-o-e.gridPeriodicityShiftY+e.gridHeight)%e.gridHeight),[l,s]}function ie(e,t,i,r,n){let o=(t+r+e.gridHeight)%e.gridHeight,a=(i+n+e.gridWidth)%e.gridWidth,l=o,s=a;return o-t-r>0?s=(a+e.gridPeriodicityShiftX+e.gridWidth)%e.gridWidth:o-t-r<0&&(s=(a-e.gridPeriodicityShiftX+e.gridWidth)%e.gridWidth),a-i-n>0?l=(o+e.gridPeriodicityShiftY+e.gridHeight)%e.gridHeight:a-i-n<0&&(l=(o-e.gridPeriodicityShiftY+e.gridHeight)%e.gridHeight),[l,s]}function re(e){e.gridFlipX&&e.gridFlipY?e.findNeighbour=Q:e.gridFlipX?e.findNeighbour=ee:e.gridFlipY?e.findNeighbour=te:e.findNeighbour=ie}function ne(e){_(e,!0)}function oe(e,t=!1){(e.time%200==0||t)&&(isNaN(e.brightness)&&(e.brightness=127,e.maxBrightness=130,e.minBrightness=124),isNaN(e.maxBrightness)&&(e.maxBrightness=130),isNaN(e.minBrightness)&&(e.minBrightness=124),console.log("Activity level: "+e.activityLevel.toFixed(2)+"."),console.log("Proportion of cells changed: "+e.relCellChanged.toFixed(4)+"."),console.log("Mean color change magnitude: "+e.meanColorChangeHistoric.toFixed(1)+"."),console.log("Brightness: "+e.brightness.toFixed(1)+"."),console.log("Max - min brightness: "+e.diffBrightness+"."),console.log("Flicker index: "+e.flickerIndex.toFixed(2)+"."),console.log("Color count: "+e.colorCount.map((e=>e.toFixed(3)))+"."))}function ae(e,t,i){var r=function(e){var t=Math.exp(-e),i=1,r=0;do{r++,i*=Math.random()}while(i>t);return r-1}(10**(e.randomnessAmount+e.ruleClass.ruleChain[0].randomnessLogShift));if(0!=r)for(var n=e.ruleClass.ruleChain[0].seedSampler,o=e.ruleClass.ruleChain[0].seedMasks,a=0;a<r;a++){var l=Math.floor(Math.random()*e.gridHeight),s=Math.floor(Math.random()*e.gridWidth);le(t,e,o[n()],l,s,i)}}function le(e,t,i,n,o,a){null===i?i=function(){let e,t=Math.floor(10*Math.random())+1;if(Math.random()<.7)e=function(e){let t=Math.random();return t<.1?ue(e,e):t<.2?he(e,e):t<.3?se(e,e):t<.4?function(e){let t=new r(e,e);for(let i=0;i<e;i++)for(let r=i;r<e;r++)t.set(i,r,Math.floor(1e5*Math.random())),t.set(r,i,t.get(i,r));return t}(e):t<.5?function(e){let t=new r(e,e);for(let i=0;i<e;i++)for(let r=i;r<e;r++)t.set(i,r,Math.floor(1e5*Math.random())),t.set(e-1-r,e-1-i,t.get(i,r));return t}(e):t<.6?ge(e,e):t<.7?de(e,e):t<.8?function(e){let t=new r(e,e);for(let i=0;i<e;i++)for(let r=Math.max(i,e-i);r<e;r++)t.set(i,r,Math.floor(1e5*Math.random())),t.set(r,i,t.get(i,r)),t.set(e-1-r,e-1-i,t.get(i,r)),t.set(e-1-i,e-1-r,t.get(i,r));return t}(e):t<.9?function(e){let t=new r(e,e);for(let i=0;i<Math.ceil(e/2);i++)for(let r=0;r<Math.ceil(e/2);r++)t.set(i,r,Math.floor(1e5*Math.random())),t.set(r,e-1-i,t.get(i,r)),t.set(e-1-i,e-1-r,t.get(i,r)),t.set(e-1-r,i,t.get(i,r));return t}(e):function(e){let t=new r(e,e);for(let i=0;i<Math.ceil(e/2);i++)for(let r=0;r<Math.ceil(e/2);r++)t.set(i,r,Math.floor(1e5*Math.random())),t.set(r,e-1-i,t.get(i,r)),t.set(e-1-i,e-1-r,t.get(i,r)),t.set(e-1-r,i,t.get(i,r)),t.set(e-1-i,r,t.get(i,r)),t.set(e-1-r,e-1-i,t.get(i,r)),t.set(i,e-1-r,t.get(i,r)),t.set(r,i,t.get(i,r));return t}(e)}(t);else{e=function(e,t){let i=Math.random();return i<.2?ue(e,t):i<.4?he(e,t):i<.6?se(e,t):i<.8?ge(e,t):de(e,t)}(t,Math.floor(10*Math.random())+1)}return e}():(Math.random()<.25&&i.transpose(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let l=i.height,s=i.width;for(let r=0;r<l;r++)for(let h=0;h<s;h++){let g=a(t,n,o,r-Math.floor(l/2),h-Math.floor(s/2));e.set(g[0],g[1],i.get(r,h))}}function se(e,t){let i=new r(t,e);for(let r=0;r<e;r++)for(let e=0;e<Math.ceil(t/2);e++)i.set(r,e,Math.floor(1e5*Math.random())),i.set(r,t-1-e,i.get(r,e));return i}function he(e,t){let i=new r(t,e);for(let r=0;r<Math.ceil(e/2);r++)for(let n=0;n<t;n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(e-1-r,n,i.get(r,n));return i}function ge(e,t){let i=new r(t,e);for(let r=0;r<e;r++)for(let n=0;n<Math.ceil(t/2);n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(e-1-r,t-1-n,i.get(r,n));return i}function de(e,t){let i=new r(t,e);for(let r=0;r<Math.ceil(e/2);r++)for(let n=0;n<Math.ceil(t/2);n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(e-1-r,n,i.get(r,n)),i.set(r,t-1-n,i.get(r,n)),i.set(e-1-r,t-1-n,i.get(r,n));return i}function ue(e,t){let i=new r(t,e);for(let r=0;r<e;r++)for(let e=0;e<t;e++)i.set(r,e,Math.floor(1e5*Math.random()));return i}function ce(e){!function(e){e.time>100&&(e.meanColorChangeHistoric>330||e.flickerIndex>10)&&(e.changeRuleFlag=!0,e.meanColorChangeHistoric>330?console.log("Changing rule because of suspected oscillations (meanColorChangeHistoric: "+e.meanColorChangeHistoric+")."):console.log("Changing rule because of suspected oscillations (flickerIndex: "+e.flickerIndex+")."),oe(e,!0),e.nCellChangedHistoric=15,e.meanColorChangeHistoric=10,e.brightness=127,e.maxBrightness=130,e.minBrightness=124,e.flickerIndex=0)}(e),function(e){e.nCellChangedHistoric<3&&(e.changeRuleFlag=!0,console.log("Changing rule because not enough cells changed ("+e.nCellChangedHistoric+")."),oe(e,!0),e.nCellChangedHistoric=20)}(e),function(e){const t=e.colorCount.slice(1).some((e=>e>.99));e.time>100&&t&&(e.changeRuleFlag=!0,console.log("Changing rule because the canvas is too plainly colored."),oe(e,!0),e.colorCount=new Array(e.nColors).fill(0))}(e)}function fe(e){return console.log("Loading image:",e),new Promise(((t,r)=>{const n=function(){if("undefined"!=typeof window)return new window.Image;try{const{Image:e}=i(Object(function(){var e=new Error("Cannot find module 'canvas'");throw e.code="MODULE_NOT_FOUND",e}()));return new e}catch(e){throw console.error('The canvas module is not installed. Please run "npm install canvas" to install it.'),e}}();n.onload=()=>{console.log("Image loaded:",e);const r=function(e,t){if("undefined"!=typeof window){const i=document.createElement("canvas");return i.width=e,i.height=t,i}try{const{createCanvas:r}=i(Object(function(){var e=new Error("Cannot find module 'canvas'");throw e.code="MODULE_NOT_FOUND",e}()));return r(e,t)}catch(e){throw console.error('The canvas module is not installed. Please run "npm install canvas" to install it.'),e}}(n.width,n.height),o=r.getContext("2d");o.drawImage(n,0,0,n.width,n.height);const a=o.getImageData(0,0,r.width,r.height).data,l=[];for(let e=0;e<n.height;e++){const t=[];for(let i=0;i<n.width;i++){const r=4*(e*n.width+i),o=(a[r]+a[r+1]+a[r+2])/3;t.push(o>128?1:0)}l.push(t)}t(l)},n.onerror=()=>{console.error("Error loading image:",e),r(new Error("Error loading image"))},n.src=e}))}async function me(e,t){if(null!==e.logo&&await function(e,t){return console.log("Attempting to load image"),fe(e.logo).then((t=>{new r(e.gridWidth,e.gridHeight);const i=new r(e.gridWidth,e.gridHeight),n=t[0].length/e.gridWidth,o=t.length/e.gridHeight,a=Math.max(n,o),l=Math.floor((e.gridWidth-t[0].length/a)/2),s=Math.floor((e.gridHeight-t.length/a)/2);for(let r=0;r<e.gridHeight;r++)for(let n=0;n<e.gridWidth;n++){if(r<s||(r-s)*a>=t.length){i.set(r,n,1);continue}let e=Math.floor((n-l)*a);0===t[Math.floor((r-s)*a)][e]?i.set(r,n,0):i.set(r,n,1)}e.mask=i})).catch((t=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",t),e.mask=new r(e.gridWidth,e.gridHeight)}))}(e),"zero"!=e.initialisation)return function(e,t=1e4){return Promise.resolve().then((()=>{e.grid=new r(e.gridWidth,e.gridHeight),e.redraw=new r(e.gridWidth,e.gridHeight);for(var i=0;i<e.gridHeight;i++)for(var n=0;n<e.gridWidth;n++)if("gr"!=e.initialisation||1!==e.mask.get(i,n)){for(var o=Math.random(),a=0;a<t;a++)if(o<(a+1)/(t+1)){e.grid.set(i,n,a);break}e.redraw.set(i,n,1)}else e.grid.set(i,n,0)}))}(e);e.grid=new r(e.gridWidth,e.gridHeight),e.redraw=new r(e.gridWidth,e.gridHeight)}var ye={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function be(e=256){let t=0,i=new Uint8Array(e);return{get buffer(){return i.buffer},reset(){t=0},bytesView:()=>i.subarray(0,t),bytes:()=>i.slice(0,t),writeByte(e){r(t+1),i[t]=e,t++},writeBytes(e,n=0,o=e.length){r(t+o);for(let r=0;r<o;r++)i[t++]=e[r+n]},writeBytesView(e,n=0,o=e.byteLength){r(t+o),i.set(e.subarray(n,n+o),t),t+=o}};function r(e){var r=i.length;if(r>=e)return;e=Math.max(e,r*(r<1048576?2:1.125)>>>0),0!=r&&(e=Math.max(e,256));let n=i;i=new Uint8Array(e),t>0&&i.set(n.subarray(0,t),0)}}var Se=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var we=function(e,t,i,r,n=be(512),o=new Uint8Array(256),a=new Int32Array(5003),l=new Int32Array(5003)){let s=a.length,h=Math.max(2,r);o.fill(0),l.fill(0),a.fill(-1);let g=0,d=0,u=h+1,c=u,f=!1,m=c,y=(1<<m)-1,b=1<<u-1,S=b+1,w=b+2,p=0,v=i[0],C=0;for(let e=s;e<65536;e*=2)++C;C=8-C,n.writeByte(h),M(b);let B=i.length;for(let e=1;e<B;e++)e:{let t=i[e],r=(t<<12)+v,n=t<<C^v;if(a[n]===r){v=l[n];break e}let o=0===n?1:s-n;for(;a[n]>=0;)if(n-=o,n<0&&(n+=s),a[n]===r){v=l[n];break e}M(v),v=t,w<4096?(l[n]=w++,a[n]=r):(a.fill(-1),w=b+2,f=!0,M(b))}return M(v),M(S),n.writeByte(0),n.bytesView();function M(e){for(g&=Se[d],d>0?g|=e<<d:g=e,d+=m;d>=8;)o[p++]=255&g,p>=254&&(n.writeByte(p),n.writeBytesView(o,0,p),p=0),g>>=8,d-=8;if((w>y||f)&&(f?(m=c,y=(1<<m)-1,f=!1):(++m,y=12===m?1<<m:(1<<m)-1)),e==S){for(;d>0;)o[p++]=255&g,p>=254&&(n.writeByte(p),n.writeBytesView(o,0,p),p=0),g>>=8,d-=8;p>0&&(n.writeByte(p),n.writeBytesView(o,0,p),p=0)}}};function pe(e,t,i){return e<<8&63488|t<<2&992|i>>3}function ve(e,t,i,r){return e>>4|240&t|(240&i)<<4|(240&r)<<8}function Ce(e,t,i){return e>>4<<8|240&t|i>>4}function Be(e,t,i){return e<t?t:e>i?i:e}function Me(e){return e*e}function Ie(e,t,i){var r=0,n=1e100;let o=e[t],a=o.cnt,l=o.ac,s=o.rc,h=o.gc,g=o.bc;for(var d=o.fw;0!=d;d=e[d].fw){let t=e[d],o=t.cnt,c=a*o/(a+o);if(!(c>=n)){var u=0;i&&(u+=c*Me(t.ac-l))>=n||!((u+=c*Me(t.rc-s))>=n)&&(!((u+=c*Me(t.gc-h))>=n)&&(!((u+=c*Me(t.bc-g))>=n)&&(n=u,r=d)))}}o.err=n,o.nn=r}function Ne(e,t,i={}){let{format:r="rgb565",clearAlpha:n=!0,clearAlphaColor:o=0,clearAlphaThreshold:a=0,oneBitAlpha:l=!1}=i;if(!e||!e.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let s=new Uint32Array(e.buffer),h=!1!==i.useSqrt,g="rgba4444"===r,d=function(e,t){let i=new Array("rgb444"===t?4096:65536),r=e.length;if("rgba4444"===t)for(let t=0;t<r;++t){let r=e[t],n=r>>24&255,o=r>>16&255,a=r>>8&255,l=255&r,s=ve(l,a,o,n),h=s in i?i[s]:i[s]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};h.rc+=l,h.gc+=a,h.bc+=o,h.ac+=n,h.cnt++}else if("rgb444"===t)for(let t=0;t<r;++t){let r=e[t],n=r>>16&255,o=r>>8&255,a=255&r,l=Ce(a,o,n),s=l in i?i[l]:i[l]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};s.rc+=a,s.gc+=o,s.bc+=n,s.cnt++}else for(let t=0;t<r;++t){let r=e[t],n=r>>16&255,o=r>>8&255,a=255&r,l=pe(a,o,n),s=l in i?i[l]:i[l]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};s.rc+=a,s.gc+=o,s.bc+=n,s.cnt++}return i}(s,r),u=d.length,c=u-1,f=new Uint32Array(u+1);for(var m=0,y=0;y<u;++y){let e=d[y];if(null!=e){var b=1/e.cnt;g&&(e.ac*=b),e.rc*=b,e.gc*=b,e.bc*=b,d[m++]=e}}Me(t)/m<.022&&(h=!1);for(y=0;y<m-1;++y)d[y].fw=y+1,d[y+1].bk=y,h&&(d[y].cnt=Math.sqrt(d[y].cnt));var S,w,p;for(h&&(d[y].cnt=Math.sqrt(d[y].cnt)),y=0;y<m;++y){Ie(d,y,!1);var v=d[y].err;for(w=++f[0];w>1&&!(d[S=f[p=w>>1]].err<=v);w=p)f[w]=S;f[w]=y}var C=m-t;for(y=0;y<C;){for(var B;;){var M=f[1];if((B=d[M]).tm>=B.mtm&&d[B.nn].mtm<=B.tm)break;B.mtm==c?M=f[1]=f[f[0]--]:(Ie(d,M,!1),B.tm=y);v=d[M].err;for(w=1;(p=w+w)<=f[0]&&(p<f[0]&&d[f[p]].err>d[f[p+1]].err&&p++,!(v<=d[S=f[p]].err));w=p)f[w]=S;f[w]=M}var I=d[B.nn],N=B.cnt,R=I.cnt;b=1/(N+R);g&&(B.ac=b*(N*B.ac+R*I.ac)),B.rc=b*(N*B.rc+R*I.rc),B.gc=b*(N*B.gc+R*I.gc),B.bc=b*(N*B.bc+R*I.bc),B.cnt+=I.cnt,B.mtm=++y,d[I.bk].fw=I.fw,d[I.fw].bk=I.bk,I.mtm=c}let P=[];var x=0;for(y=0;;++x){let e=Be(Math.round(d[y].rc),0,255),t=Be(Math.round(d[y].gc),0,255),i=Be(Math.round(d[y].bc),0,255),r=255;if(g){if(r=Be(Math.round(d[y].ac),0,255),l){r=r<=("number"==typeof l?l:127)?0:255}n&&r<=a&&(e=t=i=o,r=0)}let s=g?[e,t,i,r]:[e,t,i];if(Re(P,s)||P.push(s),0==(y=d[y].fw))break}return P}function Re(e,t){for(let i=0;i<e.length;i++){let r=e[i],n=r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2],o=!(r.length>=4&&t.length>=4)||r[3]===t[3];if(n&&o)return!0}return!1}function Pe(e,t,i,r,n){let o=0,a=1e100;for(let l=0;l<n.length;l++){let s=n[l],h=Fe(s[3]-r);h>a||(h+=Fe(s[0]-e),h>a||(h+=Fe(s[1]-t),h>a||(h+=Fe(s[2]-i),!(h>a)&&(a=h,o=l))))}return o}function xe(e,t,i,r){let n=0,o=1e100;for(let a=0;a<r.length;a++){let l=r[a],s=Fe(l[0]-e);s>o||(s+=Fe(l[1]-t),s>o||(s+=Fe(l[2]-i),!(s>o)&&(o=s,n=a)))}return n}function Fe(e){return e*e}function Ee(e={}){let{initialCapacity:t=4096,auto:i=!0}=e,r=be(t),n=new Uint8Array(256),o=new Int32Array(5003),a=new Int32Array(5003),l=!1;return{reset(){r.reset(),l=!1},finish(){r.writeByte(ye.trailer)},bytes:()=>r.bytes(),bytesView:()=>r.bytesView(),get buffer(){return r.buffer},get stream(){return r},writeHeader:s,writeFrame(e,t,h,g={}){let{transparent:d=!1,transparentIndex:u=0,delay:c=0,palette:f=null,repeat:m=0,colorDepth:y=8,dispose:b=-1}=g,S=!1;if(i?l||(S=!0,s(),l=!0):S=Boolean(g.first),t=Math.max(0,Math.floor(t)),h=Math.max(0,Math.floor(h)),S){if(!f)throw new Error("First frame must include a { palette } option");(function(e,t,i,r,n=8){let o=1,a=0,l=Ae(r.length)-1,s=o<<7|n-1<<4|a<<3|l,h=0,g=0;ke(e,t),ke(e,i),e.writeBytes([s,h,g])})(r,t,h,f,y),Le(r,f),m>=0&&function(e,t){e.writeByte(33),e.writeByte(255),e.writeByte(11),He(e,"NETSCAPE2.0"),e.writeByte(3),e.writeByte(1),ke(e,t),e.writeByte(0)}(r,m)}let w=Math.round(c/10);!function(e,t,i,r,n){var o,a;e.writeByte(33),e.writeByte(249),e.writeByte(4),n<0&&(n=0,r=!1),r?(o=1,a=2):(o=0,a=0),t>=0&&(a=7&t),a<<=2;let l=0;e.writeByte(a|l|o),ke(e,i),e.writeByte(n||0),e.writeByte(0)}(r,b,w,d,u);let p=Boolean(f)&&!S;(function(e,t,i,r){if(e.writeByte(44),ke(e,0),ke(e,0),ke(e,t),ke(e,i),r){let t=0,i=0,n=Ae(r.length)-1;e.writeByte(128|t|i|n)}else e.writeByte(0)})(r,t,h,p?f:null),p&&Le(r,f),function(e,t,i,r,n=8,o,a,l){we(i,r,t,n,e,o,a,l)}(r,e,t,h,y,n,o,a)}};function s(){He(r,"GIF89a")}}function Le(e,t){let i=1<<Ae(t.length);for(let r=0;r<i;r++){let i=[0,0,0];r<t.length&&(i=t[r]),e.writeByte(i[0]),e.writeByte(i[1]),e.writeByte(i[2])}}function ke(e,t){e.writeByte(255&t),e.writeByte(t>>8&255)}function He(e,t){for(var i=0;i<t.length;i++)e.writeByte(t.charCodeAt(i))}function Ae(e){return Math.max(Math.ceil(Math.log2(e)),1)}function We(e){if(e.startRecordingGifFlag){console.log("Starting GIF recording...");const{data:t,width:i,height:r}=e.ctx.getImageData(0,0,3*e.gridWidth,3*e.gridHeight);e.gifPalette=Ne(t,16),e.gif=Ee(),e.recordingGif=!0,e.startRecordingGifFlag=!1}if(e.stopRecordingGifFlag){e.gif.finish(),e.gifOutput=e.gif.bytes();const n=new Blob([e.gifOutput],{type:"image/gif"}),o=URL.createObjectURL(n);if("Download"==e.gifMode){const e=document.createElement("a");e.href=o,e.download="output.gif",document.body.appendChild(e),e.click(),document.body.removeChild(e)}else"InAppWebView"==e.gifMode&&(t=n,i=function(e){window.flutter_inappwebview.callHandler("saveGif",e)},(r=new FileReader).onload=function(e){i(e.target.result)},r.readAsDataURL(t));e.recordingGif=!1,e.stopRecordingGifFlag=!1,console.log("Stopped recording gif")}var t,i,r;if(e.recordingGif){const{data:t,width:i,height:r}=e.ctx.getImageData(0,0,e.gridWidth,e.gridHeight),n=function(e,t,i="rgb565"){if(!e||!e.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(t.length>256)throw new Error("applyPalette() only works with 256 colors or less");let r=new Uint32Array(e.buffer),n=r.length,o="rgb444"===i?4096:65536,a=new Uint8Array(n),l=new Array(o);if("rgba4444"===i)for(let e=0;e<n;e++){let i=r[e],n=i>>24&255,o=i>>16&255,s=i>>8&255,h=255&i,g=ve(h,s,o,n),d=g in l?l[g]:l[g]=Pe(h,s,o,n,t);a[e]=d}else{let e="rgb444"===i?Ce:pe;for(let i=0;i<n;i++){let n=r[i],o=n>>16&255,s=n>>8&255,h=255&n,g=e(h,s,o),d=g in l?l[g]:l[g]=xe(h,s,o,t);a[i]=d}}return a}(t,e.gifPalette),o=e.gifPalette;e.gif.writeFrame(n,i,r,{palette:o}),e.nRecordedFrames=e.nRecordedFrames+1,e.nRecordedFrames>1e3&&(e.stopRecordingGifFlag=!0,e.paused=!0,console.log("Stopped recording gif after 1000 frames."))}}var Te=166320;function Ge(e,t=null){performance.now();e.paused?(e.step&&(Ue(e,t),e.step=!1),e.recordingGif&&We(e)):Ue(e,t),e.reinitialiseGridFlag&&(me(e),e.reinitialiseGridFlag=!1),e.changeGridSizeFlag&&(e.gridHeight=e.tempGridHeight,e.gridWidth=e.tempGridWidth,e.imageData=new Uint8ClampedArray(4*e.gridWidth*e.gridHeight),e.redraw=new r(e.gridWidth,e.gridHeight),e.canvas=document.getElementById("gameCanvas"),e.canvas.width=e.gridWidth,e.canvas.height=e.gridHeight,e.ctx=e.canvas.getContext("2d"),me(e),e.changeGridSizeFlag=!1),setTimeout((function(){requestAnimationFrame((()=>Ge(e,t)))}),Math.max(0,e.targetCycleTime-e.frameExecutionTime))}function Ue(e,t){!function(e){let t=e.imageData;for(var i=0,r=0,n=0,o=e.colors.length,a=new Array(o).fill(0),l=0;l<e.gridHeight;l++)for(var s=0;s<e.gridWidth;s++){var h=Math.floor(e.grid.get(l,s)/e.ruleClass.colorUnit)%o;if(a[h]+=1,0==e.redraw.get(l,s))continue;i+=1;let g=e.colors[h],d=4*(l*e.gridWidth+s);r+=Math.sqrt((t[d+0]-g.r)**2+(t[d+1]-g.g)**2+(t[d+2]-g.b)**2),n+=g.r+g.g+g.b;const u=Math.round(Math.random()*g.redPertStrength2-g.redPerturbationStrength),c=Math.round(Math.random()*g.greenPertStrength2-g.greenPerturbationStrength),f=Math.round(Math.random()*g.bluePertStrength2-g.bluePerturbationStrength),m=Math.round(Math.random()*g.brightnessPertStrength2-g.brightnessPerturbationStrength);t[d+0]=g.r+u+m,t[d+1]=g.g+c+m,t[d+2]=g.b+f+m,t[d+3]=g.t}!function(e,t,i,r,n){var o=e.gridHeight*e.gridWidth;e.activityLevel=.8*e.activityLevel+t/o/5,e.nCellChangedHistoric=.01*t+.99*e.nCellChangedHistoric,e.meanColorChangeHistoric=.01*i/(t+o/30)+.99*e.meanColorChangeHistoric,0==t?r=127:r/=3*t,e.brightness=.01*r+.99*e.brightness,e.maxBrightness=.99*(e.maxBrightness-e.brightness)+e.brightness,e.minBrightness=.99*(e.minBrightness-e.brightness)+e.brightness,e.relCellChanged=t/o,e.diffBrightness=e.maxBrightness-e.minBrightness,e.flickerIndex=.99*e.flickerIndex+e.diffBrightness*e.relCellChanged*.01,e.maxBrightness<r?e.maxBrightness+=3:e.minBrightness>r&&(e.minBrightness-=3);for(var a=0;a<e.colorCount.length;a++)e.colorCount[a]=.01*e.colorCount[a]+.99*n[a]/o}(e,i,r,n,a),oe(e),e.imageData=t}(e),null!=t&&t(e),ce(e),function(e){const t=e.ruleClass.ruleChain[0].nStates;var i=0;e.ruleClass.ruleChain.length>1&&(i=e.ruleClass.ruleChain[1].nStates);var n=m*t,o=m*i,a=Math.floor(m/2),l=[new Uint8Array(n),new Uint8Array(o)],s=new Uint8Array(a),h=new r(e.gridWidth,e.gridHeight),g=e.grid;const d=e.time;for(var u=0;u<e.gridHeight;u++)for(var c=0;c<e.gridWidth;c++){var f=y(e,u,c,g,l,s,d,t,i);const r=e.grid.get(u,c);var b=r;b=e.useLogo&&0!=e.mask.get(u,c)?e.ruleClass2.updateRule(r,b,f,e.time,e.activityLevel):e.ruleClass.updateRule(r,b,f,e.time,e.activityLevel),Math.floor(b/e.ruleClass.colorUnit)%e.nColors!=Math.floor(r/e.ruleClass.colorUnit)%e.nColors?e.redraw.set(u,c,1):e.redraw.set(u,c,0),h.set(u,c,b),l[0]=l[0].fill(0),l[1]=l[1].fill(0),s=s.fill(0)}e.addRandomness&&ae(e,h,e.findNeighbour),e.grid=h}(e),_(e),We(e),e.time=(e.time+1)%Te,e.randomisePeriodicityShiftAndTopology&&function(e){Math.random()<1e-4&&(e.gridPeriodicityShiftX=Math.floor(Math.random()*e.gridWidth),console.log("Periodicity shift X: "+e.gridPeriodicityShiftX)),Math.random()<1e-4&&(e.gridPeriodicityShiftY=Math.floor(Math.random()*e.gridHeight),console.log("Periodicity shift Y: "+e.gridPeriodicityShiftY)),Math.random()<1e-4&&(e.gridFlipX=!e.gridFlipX,re(e),console.log("Flip X: "+e.gridFlipX)),Math.random()<1e-4&&(e.gridFlipY=!e.gridFlipY,re(e),console.log("Flip Y: "+e.gridFlipY))}(e),e.reloadColorPaletteFlag&&(d(e),e.reloadColorPaletteFlag=!1),function(e){for(var t=0;t<e.colors.length;t++){var i=e.colors[t];i.drift>0&&(e.colors[t]=o(i))}}(e)}function De(e,t){if(e.saveEventData){var i=e.ruleClass.ruleChain[0].getName(),r=new Blob([i],{type:"text/plain"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download="dataAutomata.txt",o.click()}}function Xe(e){document.getElementById("submitButton").addEventListener("click",(function(){!function(e){Object.keys(e).forEach((e=>{let t=document.getElementById(e);var i;t&&(i="checkbox"===t.type?t.checked:"number"===t.type||"range"===t.type?parseFloat(t.value):t.value,localStorage.setItem(e,i))})),location.reload()}(e)}))}function Ye(e){document.getElementById("randomnessAmount").addEventListener("input",(function(){!function(e,t){e.randomnessAmount=parseFloat(t),document.getElementById("randomnessAmountValue").textContent=t}(e,this.value)}))}function je(e){let t=new ImageData(e.imageData,e.gridWidth,e.gridHeight);e.ctx.putImageData(t,e.canvasCornerX,e.canvasCornerY)}console.log("Loading main.js");var Oe=new class{constructor({gridHeight:e=200,gridWidth:t=200,targetCycleTime:i=100,addRandomness:n=!0,randomnessAmount:o=-2,randomisePeriodicityShiftAndTopology:a=!0,gridPeriodicityShiftX:l=0,gridPeriodicityShiftY:s=0,gridFlipX:h=!1,gridFlipY:g=!1,colorPalette:d="black2",metaRule:u="VariableGR",initialisation:c="random",ruleSwitchPeriod:f=2e4,ruleEvolvePeriod:m=2e3,logo:y=null,useLogo:b=!1,config:S=null}={}){this.config=S,this.paused=!1,this.step=!1,this.targetCycleTime=i,this.gridHeight=e,this.gridWidth=t,this.grid=new r(this.gridWidth,this.gridHeight),this.gridPeriodicityShiftX=l,this.gridPeriodicityShiftY=s,this.gridFlipX=h,this.gridFlipY=g,this.mask=null,this.findNeighbour=null,this.tempGridHeight=null,this.tempGridWidth=null,this.imageData=new Uint8ClampedArray(4*this.gridWidth*this.gridHeight).fill(0),this.redraw=new r(this.gridWidth,this.gridHeight),this.colorPalette=d,this.initialisation=c,this.logo=y,this.useLogo=b,this.colors=[],this.nColors=4,this.addRandomness=n,this.randomnessAmount=o,this.randomisePeriodicityShiftAndTopology=a,this.reinitialiseGridFlag=!1,this.changeGridSizeFlag=!1,this.metaRule=u,this.ruleClass=null,this.updateCellValue=null,this.updateCellValueAuxiliary=null,this.ruleSwitchPeriod=f,this.ruleEvolvePeriod=m,this.currentStyle=null,this.time=0,this.ruleLogSwitchProbability=-25,this.ruleLogEvolveProbability=-25,this.logMultiplicativeFactor=25/this.ruleSwitchPeriod,this.logMultiplicativeEvolveFactor=25/this.ruleEvolvePeriod,this.changeRuleFlag=!0,this.changeBaseRuleFlag=!1,this.changeStyleFlag=!1,this.evolveColoringRuleFlag=!1,this.reloadColorPaletteFlag=!1,this.activityLevel=0,this.nCellChangedHistoric=0,this.meanColorChangeHistoric=0,this.brightness=127,this.maxBrightness=130,this.minBrightness=124,this.diffBrightness=0,this.relCellChanged=0,this.flickerIndex=0,this.colorCount=[0,0,0,0],this.frameExecutionTime=0,this.gif=null,this.gifMode="Download",this.startRecordingGifFlag=!1,this.stopRecordingGifFlag=!1,this.recordingGif=!1,this.nRecordedFrames=0,this.saveEventData=!1}}({gridHeight:192,gridWidth:192,targetCycleTime:50,addRandomness:!0,randomnessAmount:-1.5,randomisePeriodicityShiftAndTopology:!0,gridPeriodicityShiftX:0,gridPeriodicityShiftY:0,gridFlipX:!1,gridFlipY:!1,colorPalette:"variable",metaRule:"VariableMix",initialisation:"random",ruleSwitchPeriod:2e4,ruleEvolvePeriod:2e3});!function(e){e.canvasCornerX=0,e.canvasCornerY=0,e.canvas=document.getElementById("gameCanvas"),e.canvas.width=e.gridWidth,e.canvas.height=e.gridHeight,e.ctx=e.canvas.getContext("2d")}(Oe),window.onload=function(){!function(e){document.getElementById("addRandomness").addEventListener("change",(function(){e.addRandomness=this.checked}))}(Oe),document.getElementById("fullscreenButton").addEventListener("click",(function(){var e=document.getElementById("canvasContainer");e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()})),function(e){e.canvas.addEventListener("mousemove",(function(t){if(t.shiftKey){var i=e.canvas.getBoundingClientRect(),r=t.clientX-i.left,n=t.clientY-i.top,o=i.width/e.gridWidth,a=i.height/e.gridHeight,l=Math.floor(r/o),s=Math.floor(n/a);e.grid.set(s,l,1)}}))}(Oe),function(e){e.canvas.addEventListener("mousedown",(function(t){var i=e.canvas.getBoundingClientRect(),r=t.clientX-i.left,n=t.clientY-i.top,o=i.width/e.gridWidth,a=i.height/e.gridHeight,l=Math.floor(r/o),s=Math.floor(n/a);t.shiftKey||t.ctrlKey?t.shiftKey&&!t.ctrlKey?(e.grid.set(s,(l+1)%e.gridWidth,1),e.grid.set(s,l,1),e.grid.set((s+1)%e.gridHeight,l,1)):!t.shiftKey&&t.ctrlKey?(e.grid.set(s,l,1),e.grid.set((s+1)%e.gridHeight,l,1)):t.shiftKey&&t.ctrlKey&&(e.grid.set(s,l,1),e.grid.set(s,(l+1)%e.gridWidth,1)):(e.grid.set((s+1)%e.gridHeight,(l+1)%e.gridWidth,1),e.grid.set((s-1+e.gridHeight)%e.gridHeight,(l+1)%e.gridWidth,1),e.grid.set((s-1+e.gridHeight)%e.gridHeight,(l-1+e.gridWidth)%e.gridWidth,1),e.grid.set((s+1)%e.gridHeight,(l-1+e.gridWidth)%e.gridWidth,1))}))}(Oe),Xe(Oe),Ye(Oe),function(e){document.getElementById("gridPeriodicityShiftX").addEventListener("input",(function(){let t=parseInt(this.value);isNaN(t)&&(t=0),e.gridPeriodicityShiftX=t,re(e)})),document.getElementById("gridPeriodicityShiftY").addEventListener("input",(function(){let t=parseInt(this.value);isNaN(t)&&(t=0),e.gridPeriodicityShiftY=t,re(e)})),document.getElementById("gridFlipX").addEventListener("change",(function(){e.gridFlipX=this.checked,re(e)})),document.getElementById("gridFlipY").addEventListener("change",(function(){e.gridFlipY=this.checked,re(e)}))}(Oe),function(e){document.getElementById("cycleTime").addEventListener("input",(function(){let t=parseInt(this.value);isNaN(t)&&(t=0),e.targetCycleTime=t}))}(Oe),function(e){document.getElementById("colorPalette").addEventListener("change",(function(){e.colorPalette=this.value,d(e)}))}(Oe),function(e){document.getElementById("metaRule").addEventListener("change",(async function(){e.metaRule=this.value,ne(e)}))}(Oe),function(e){document.getElementById("changeRule").addEventListener("click",(function(){e.changeRuleFlag=!0})),document.getElementById("changeBaseRule").addEventListener("click",(function(){e.changeBaseRuleFlag=!0})),document.getElementById("changeColoringRule").addEventListener("click",(function(){e.changeStyleFlag=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){e.evolveColoringRuleFlag=!0})),null!==document.getElementById("reinitialiseGrid")&&document.getElementById("reinitialiseGrid").addEventListener("click",(function(){e.reinitialiseGridFlag=!0}))}(Oe),function(e){document.getElementById("changeColor").addEventListener("click",(function(){e.reloadColorPaletteFlag=!0}))}(Oe),function(e){document.getElementById("saveEventCheckbox").addEventListener("change",(function(){e.saveEventData=this.checked})),document.getElementById("likeButton").addEventListener("click",(function(){De(e)})),document.getElementById("dislikeButton").addEventListener("click",(function(){De(e)}))}(Oe),function(e){Object.keys(e).forEach((t=>{let i=localStorage.getItem(t);null!==i&&("boolean"==typeof e[t]?e[t]="true"===i:"number"==typeof e[t]?e[t]=parseFloat(i):e[t]=i)}))}(Oe),function(e){Object.keys(e).forEach((t=>{let i=document.getElementById(t);i&&("checkbox"===i.type?i.checked=e[t]:i.value=e[t])}))}(Oe),d(Oe),re(Oe),ne(Oe);let e=atob("c2FtMzE0MTUuZ2l0aHViLmlv");window.location.hostname!==e&&""!==window.location.hostname||me(Oe).then((()=>{Ge(Oe,je)})).catch((e=>{console.error("Error initialising the grid: ",e)}))}})();
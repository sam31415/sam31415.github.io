(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),r=Object.values(t).reduce(((t,r,n)=>[...t,r/e+(t[n-1]||0)]),[]);return function(){let e=Math.random(),n=r.findIndex((t=>e<t));return Object.keys(t)[n]}}const e=[11,44];function r(t,e,r,n,s,a,i,o,h){const u=n.height-1,l=n.width-1,c=n.data,m=n.width;var f=s[0],d=s[1];let M;for(var g=-1;g<=1;g++)for(var p=-1;p<=1;p++){if(0==g&&0==p)continue;if(a[0]=((-1===g?1:g)+(-1===p?1:p))%2,a[2+(3&i)]=-1==g?1:0,a[(1+i)%4+1]=-1==p?1:0,a[(2+i)%4+1]=1==g?1:0,a[(3+i)%4+1]=1==p?1:0,0==e||0==r||e==u||r==l)var[b,w]=t.t(t,e,r,g,p);else var b=e+g,w=r+p;const n=c[b*m+w],s=n%o,S=Math.floor(n/o)%h;M=o;for(var v=0;v<o-1;v++)s==v+1&&(f[v]+=1,f[M+v]+=a[0],M+=o,f[M+v]+=1-a[0],f[o+M+v]+=a[1],M+=o,f[M+v]+=1-a[1],f[o+M+v]+=a[2],M+=o,f[M+v]+=1-a[2],f[o+M+v]+=a[3],M+=o,f[M+v]+=1-a[3],f[o+M+v]+=a[4],M+=o,f[M+v]+=1-a[4]),M=o;M=h;for(v=0;v<h;v++)d[v]+=1,S==v&&(d[h+v]+=a[0],M+=h,d[M+v]+=1-a[0],d[h+M+v]+=a[1],M+=h,d[M+v]+=1-a[1],d[h+M+v]+=a[2],M+=h,d[M+v]+=1-a[2],d[h+M+v]+=a[3],M+=h,d[M+v]+=1-a[3],d[h+M+v]+=a[4],M+=h,d[M+v]+=1-a[4]),M=h}return[f,d]}const n="mix",s="isotropic",a="xcross",i="vcross",o="xvcross",h="directional1",u="directional2",l="directional3",c="directional2b",m="directional",f={[n]:.2,[s]:.4,[a]:.05,[i]:.05,[o]:.05,[h]:.05,[u]:.05,[l]:.05,[c]:.05,[m]:.05};const d="A",M="C",g="E",p="B";class b{constructor(t,e,r,n,s,a=null){this.type=t,this.threshold=e,this.i=r,this.o=n,this.h=s,this.u=a,this.l=function(t,e){return t==M?function(t){return 0==t}:t==d?function(t){return t%e==0}:function(t){return!0}}(this.o,this.h),this.m=function(t,e,r){return e==g&&2==r.length?function(e){return e[r[0]][r[1]]==t}:e==p&&2==r.length?function(e){return e[r[0]][r[1]]>t}:e==g&&3==r.length?function(e){return e[r[0]][r[1]]+e[r[0]][r[2]]==t}:e==p&&3==r.length?function(e){return e[r[0]][r[1]]+e[r[0]][r[2]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(a)}test(t,e,r){var n=this.M(r);return this.m(t)&&this.l(e)&&n}name(){var t="";null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join(""));var e=this.i.join("|");return`${this.type}${this.threshold}${this.o}[${e}]${t}`}static p(t,e=4){var r=null;t.startsWith(g)?r=g:t.startsWith(p)&&(r=p);var n=t.substring(r.length),s=parseInt(n.substring(0,1)),a=null;(n=n.substring(1)).startsWith(M)?a=M:n.startsWith(d)?a=d:n.startsWith("N")&&(a="N");var i=(n=n.substring(a.length)).split("[")[1].split("]")[0].split("|").map(Number),o=null;return(n=n.split("]")[1]).length>0&&(o=n.split("").map((t=>"1"===t))),new b(r,s,i,a,e,o)}static v(e=null,r=4,f=n,w=null){const v=[g,p],S=v[Math.floor(Math.random()*v.length)],k=[M,d,"N"],N=k[Math.floor(Math.random()*k.length)];null===e&&(e={0:2/3,1:1/3});const B=t(e)(),R=function(t,e){var r=e;if(r==n){var f=Math.random();r=f<.5?s:f<.7?a:f<.9?i:m}if(r==s)return Math.floor(4*Math.random());if(r==i)return Math.floor(4*Math.random()+4);if(r==a)return Math.floor(4*Math.random()+8);if(r==o)return Math.floor(8*Math.random()+4);if(r==h)return Math.floor(4*Math.random()+12);if(r==u)return Math.floor(8*Math.random()+12);if(r==l)return Math.floor(12*Math.random()+12);if(r==c){var d=Math.floor(8*Math.random()+12);return d>=16&&(d+=4),d}return r==m?Math.floor(16*Math.random()+12):void 0}(0,f);var I=void 0;if(Math.random()<.5){I=[B,R,function(t){for(var e=4*Math.floor(t/4),r=t;r==t;)r=e+Math.floor(4*Math.random());return r}(R)]}else I=[B,R];var C=0,y=8;if(0==I[0]&&I[1]%4!=1?y=5:I[1]>4&&I[1]<=16?y=4:I[1]>16&&(y=3),C=S===p?Math.floor(Math.random()*y):Math.floor(Math.random()*y)+1,Math.random()<.2)x=null;else{var x;null==w&&(w=Math.floor(20*Math.random())+2);do{x=new Array(w).fill(0).map((()=>Math.random()<.5))}while(!x.includes(!0))}return new b(S,C,I,N,r,x)}}class w{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.S=!1,this.get=this.k,this.set=this.N}static B(t,e=!1,r=!1,n=!1){const s=t.length,a=t[0].length,i=new w(a,s);for(let e=0;e<s;e++){n&&(e=s-e-1);for(let n=0;n<a;n++)r&&(n=a-n-1),i.set(e,n,t[e][n])}return e&&i.R(),i}R(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.S?[this.k,this.N]:[this.I,this.C],this.S=!this.S}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const r=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,r)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const r=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,r)}}k(t,e){return this.data[t*this.width+e]}N(t,e,r){this.data[t*this.width+e]=r}I(t,e){return this.data[e*this.height+t]}C(t,e,r){this.data[e*this.height+t]=r}}class v{constructor(){this.A=void 0}F(t,e,r,n){throw new Error("Must override method")}P(){throw new Error("Must override method")}}class S extends v{constructor(){super(),this.G=this.T(),this.V(),this.X=0}T(){throw new Error("Must override method")}V(){this.Y=Object.keys(this.G).map((t=>this.G[t].mask));let e=Object.keys(this.G).map((t=>this.G[t].O));this.U=t(e)}}class k extends S{constructor(){super(),this.A=4}F(t,e,r,n){var s=t%4;return 1==s||3==s?e=2:2==s?e=0:0==s&&2==r[0][0]?e=1:0==s&&r[0][0]>2&&(e=3),e}P(){return"BB"}T(){return{random:{O:15,mask:null},W:{O:4,mask:w.B([[1,1],[1,1]])},$:{O:4,mask:new w([[1,0,1],[0,0,0],[1,0,1]])},j:{O:2,mask:w.B([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},H:{O:2,mask:w.B([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},L:{O:2,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},D:{O:2,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class N extends S{constructor(){super(),this.A=4,this.X=-1}F(t,e,r,n){var s=t%4;return 3==s&&(s=0),1==s?e=2:2==s||3==s?e=0:0!=s&&3!=s||2!=r[0][0]?0==s&&r[0][0]>2&&(e=3):e=1,e}P(){return"TBB"}T(){return{random:{O:15,mask:null},L:{O:1,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},j:{O:2,mask:w.B([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},H:{O:2,mask:w.B([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},W:{O:4,mask:w.B([[1,1],[1,1]])},q:{O:1e4,mask:w.B([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class B extends S{constructor(){super(),this.A=4,this.X=-1}F(t,e,r,n){var s=t%4;return 1==s&&(r[0][0]<3||r[0][0]>5)?e=2:2==s?e=3:3==s?e=0:0==s&&2==r[0][0]&&(e=1),e}P(){return"SW"}T(){let t=.2;return{random:{O:6,mask:null},J:{O:1,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},K:{O:t,mask:w.B([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},Z:{O:t,mask:w.B([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},_:{O:t,mask:w.B([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{O:t,mask:w.B([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{O:t,mask:w.B([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},rt:{O:t,mask:w.B([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},nt:{O:t,mask:w.B([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},st:{O:t,mask:w.B([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},it:{O:t,mask:w.B([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ot:{O:t,mask:w.B([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ht:{O:t,mask:w.B([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{O:t,mask:w.B([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{O:t,mask:w.B([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{O:t,mask:w.B([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{O:t,mask:w.B([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},dt:{O:t,mask:w.B([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},$:{O:2,mask:w.B([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class R extends S{constructor(t){super(),this.Mt=t;const e=this.Mt.split("/");for(var r of(this.gt=0,this.bt=[],e))"N"==r[0]?this.gt=Number(e[0].substring(1)):"B"==r[0]?this.wt=new Uint8Array(r.substring(1).split("").map(Number)):"S"==r[0]?this.vt=new Uint8Array(r.substring(1).split("").map(Number)):"I"==r[0]?this.bt=new Uint8Array(e[2].substring(1).split("").map(Number)):this.A=Number(r)}F(t,e,r,n){var s=t%this.A;return 1==s&&this.vt.includes(r[0][this.gt])?e=1:s>0&&s<this.A-1?e+=1:s==this.A-1?e=0:0==s&&this.wt.includes(r[0][this.gt])?e=1:0==s&&this.bt.includes(r[0][this.gt])&&(e=this.A-1),e}P(){return this.Mt}T(){return{random:{O:1,mask:null}}}}class I extends R{constructor(t=!0){t?super(I.St()):(super(I.kt()),this.X=0)}static St(){let e=t({Nt:5,Bt:1,Rt:1,It:1,Ct:1,yt:1,xt:1,At:1,Ft:1,Pt:1,Gt:1,Tt:1,Vt:1,Xt:1,Yt:1,Ot:1,Ut:1,Et:1,Wt:1,$t:1,jt:1,Ht:1,Lt:1,Dt:1,qt:1,zt:1,Jt:1,Kt:1,Qt:1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}static kt(){let t=Math.floor(10*Math.random())+3,e=Math.floor(5*Math.random()*t),r=Math.floor(e/t)%5;var n=8;[1,2].includes(r)?n=4:3==r?n=3:4==r&&(n=5);let s=I.Zt(3,n),a=I.Zt(2,n),i=I.Zt(1,n);return i=i.filter((t=>!s.includes(t)&&!a.includes(t)&&2!=t)),`N${e}/B2${s.join("")}/S${a.join("")}/I${i.join("")}/${t}`}static Zt(t,e){let r=[];for(let n=t;n<=e;n++)Math.random()<.5&&r.push(n);return r}T(){return{random:{O:1,mask:null}}}}class C extends R{constructor(){super("B24/S34/I15678/4"),this.X=0}P(){return"FS"}T(){let t=.2;return{random:{O:20,mask:null},_t:{O:1,mask:w.B([[1,1],[1,1]])},te:{O:t,mask:w.B([[1,1]])},ee:{O:1,mask:w.B([[1,0],[1,1]])},re:{O:t,mask:w.B([[1,1],[2,2]])},ne:{O:1,mask:w.B([[0,1,0],[1,1,1],[0,1,0]])},se:{O:1,mask:w.B([[1,0,1],[0,0,0],[1,0,1]])},ae:{O:t,mask:w.B([[1,0,0],[1,1,0],[0,1,1]])},ie:{O:t,mask:w.B([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},oe:{O:1,mask:w.B([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},he:{O:1,mask:w.B([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},ue:{O:1,mask:w.B([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},le:{O:t,mask:w.B([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ce:{O:t,mask:w.B([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},me:{O:t,mask:w.B([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class y extends R{constructor(){super("B2/S245678/I1/4"),this.X=0}P(){return"SS"}T(){let t=.2;return{random:{O:10,mask:null},_t:{O:1,mask:w.B([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},te:{O:t,mask:w.B([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},re:{O:t,mask:w.B([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},ae:{O:t,mask:w.B([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},ie:{O:t,mask:w.B([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},le:{O:t,mask:w.B([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},ce:{O:t,mask:w.B([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},oe:{O:1,mask:w.B([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},me:{O:t,mask:w.B([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},fe:{O:t,mask:w.B([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},he:{O:1,mask:w.B([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},de:{O:1,mask:w.B([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Me:{O:1,mask:w.B([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class x extends S{constructor(){super(),this.A=4,this.X=.4}F(t,e,r,n){var s=t%4,a=r[0][0]+r[0][2];return 1!=s&&3!=s||!(a<2||a>3)?1!=s&&3!=s||2!=a&&3!=a?0!=s&&2!=s||3!=a?2==s&&(e=0):e=3:e=1:e=2,e}T(){return{ge:{O:1,mask:null}}}P(){return"CW"}}class A extends v{constructor(t,e,r,n,s){super(),this.pe=e,this.be=t,this.A=this.pe,this.we=r,this.ve=n,this.Se=s}F(t,e,r,n){e=0;for(let s=0;s<this.be.length;s++)if(this.be[s].test(r,t,n)){e=(s+1)%this.pe;break}return e}P(){return this.be.map((t=>t.name())).join("||")}static ke(e=null,r=null,n=null,s=4,a=4,i=null){var o=[];null==e&&(e=Math.floor(8*Math.random())+2),null==n&&(n=t(f)()),null==i&&(i=this.Ne());for(let t=0;t<e;t++)o.push(b.v(r,s,n,i));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+o.map((t=>t.name())).join(", ")),new A(o,a,r,n,i)}static Ne(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Be(t,e=4){var r=t.split("||").map((t=>b.p(t)));return new A(r,e,null,n,null)}Re(t=null){var e,r=this.be.length;null==t&&(t=this.we),0==(e=2==r?Math.floor(2*Math.random())+1:10==r?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.Ie():1==e?this.Ce(t):this.ye(t)}ye(t){var e=this.be.slice();e.push(b.v(t,4,this.ve,this.Se)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.ve+": "+e.map((t=>t.name())).join("||")),this.be=e}Ie(){var t=this.be.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.be=t}Ce(t){var e=this.be.slice(),r=Math.floor(Math.random()*e.length);e[r]=b.v(t,4,this.ve,this.Se),console.log((new Date).toLocaleTimeString()+" Changing condition "+r+" to "+this.ve+": "+e.map((t=>t.name())).join("||")),this.be=e}}const F="gr",P="safe",G="mix",T="general",V="test";class X{xe;Ae;F;Fe(){throw new Error("Must override method")}Pe(){return function(t,e,r,n){e=this.Ae[0].F(t%this.Ae[0].A,e,r,n);var s=this.Ae[0].A;for(let a=1;a<this.Ae.length;a++)e+=s*this.Ae[a].F(Math.floor(t/s)%this.Ae[a].A,e,r,n),e%=s*=this.Ae[a].A;return e%s}}Ge(){throw new Error("Must override method")}P(){return this.Ae.map((t=>t.P())).join("-")}}class Y extends X{constructor(t){super(),this.Te=t,this.xe=1,this.Ae=this.Fe(),this.F=this.Pe()}Fe(){var t=[];return"Original"==this.Te?t.push(new N):"StarWars"==this.Te?t.push(new B):"Modified"==this.Te?t.push(new k):"Conway"==this.Te?t.push(new x):t.push(new R(this.Te)),t}Ge(){}}class O extends X{constructor(t,e,r=null){super(),this.Te=t,this.we=e,this.Se=null,this.Ve=null,null==e&&(t==P||t==F||t==V?this.we={0:1,1:0}:t==G?(Math.random()<.5?this.we={0:.8,1:.2}:this.we={0:1,1:0},this.we={0:.8,1:.2}):this.we={0:.5,1:.5}),t==F&&(this.Se=1),this.xe=4,this.Ae=null==r?this.Fe():this.Xe(r),this.F=this.Pe()}Fe(){var t=[],e=Math.random();return this.Te==F?t.push(new k):this.Te==P?e<.5?t.push(new I):e<.65?t.push(new k):e<.7?t.push(new N):e<.8?t.push(new B):e<.85?t.push(new y):e<.9?t.push(new C):t.push(new x):(e<.5?t.push(new I):e<.65?t.push(new k):e<.7?t.push(new N):e<.8?t.push(new B):e<.85?t.push(new y):e<.9?t.push(new C):t.push(new x),0==t.length&&t.push(new I)),t.push(A.ke(null,this.we,this.Ve,t[0].A,4,this.Se)),this.Te==V&&((t=[]).push(new I(!1)),this.xe=1),t}Ge(){this.Ae[1]&&"function"==typeof this.Ae[1].Re&&this.Ae[1].Re(this.we)}Xe(t){var e=[],[r,n]=t.split("-");return"BB"==r?e.push(new k):"TBB"==r?e.push(new N):"SW"==r?e.push(new B):"SS"==r?e.push(new y):"FS"==r?e.push(new C):"CW"==r?e.push(new x):e.push(new R(r)),e.push(A.Be(n)),e}}class U extends X{constructor(t,e,r=null){super(),this.Te=t,this.we=e,this.Se=null,this.Ve=null,null==e&&(t==P?this.we={0:1,1:0}:t==G?(Math.random()<.5?this.we={0:.8,1:.2}:this.we={0:1,1:0},this.we={0:.8,1:.2}):this.we={0:.5,1:.5}),this.xe=16,this.Ae=null==r?this.Fe():this.Xe(r),this.F=this.Pe()}Fe(){var t=[];return t.push(new k),t.push(A.ke(null,this.we,this.Ve,4,4,this.u)),t.push(A.ke(null,this.we,this.Ve,16,4,this.u)),t}Ge(){this.Ae[1].Re(this.we),this.Ae[2].Re(this.we)}Xe(t){var e=[],r=t.split("-")[1];return e.push(new k),e.push(A.Be(r)),e}}function E(t,e=!1){Math.random()<Math.exp(t.Ye)||e||t.Oe?("VariableGR"==t.Ue?(t.Ee=new O(F),t.We=new O(F)):"VariableDemo"==t.Ue?t.Ee=new O(F):"Variable"==t.Ue?t.Ee=new O(P):"VariableMix"==t.Ue?t.Ee=new O(G):"VariableUnsafe"==t.Ue?t.Ee=new O(T):"VariableTest"==t.Ue?t.Ee=new O(V):"Variable2Unsafe"==t.Ue?t.Ee=new U(T):"CustomRule"==t.Ue?t.Ee=new O(null,null,t.$e):"OriginalBB"==t.Ue?t.Ee=new Y("Original"):"ModifiedBB"==t.Ue?t.Ee=new Y("Modified"):"StarWars"==t.Ue?t.Ee=new Y("StarWars"):"Conway"==t.Ue?t.Ee=new Y("Conway"):"SparseFourStates"==t.Ue?t.Ee=new Y("B378/S124567/4"):t.Ee=new O(G),t.Ye=-25,t.je=-25,t.Oe=!1,W(t)):(Math.random()<Math.exp(t.je)||t.He)&&"CustomRule"!=t.Ue&&(t.Ee.Ge(),"VariableGR"==t.Ue&&t.We.Ge(),t.je=-25,t.He=!1,W(t));let r=Math.max(t.Le/200,1);t.Ye=t.Ye+t.De*r,t.Ye>0&&(t.Ye=0),t.je=t.je+t.qe*r,t.je>0&&(t.je=0)}function W(t){var e=document.getElementById("currentStyle");e&&(e.value=t.Ee.P())}function $(t){let e={};for(let r in t){if("t"==r)continue;let n=Math.floor(3*Math.random())-1,s=t[r]+n;s=Math.max(0,Math.min(255,s)),e[r]=s}return e.ze=t.ze,e}function j(t){var e={r:247,g:255,b:28,ze:255},r={r:13,g:112,b:255,ze:255},n={r:240,g:239,b:239,ze:255},s={r:0,g:0,b:0,ze:255},a={r:240,g:240,b:240,ze:255},i={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),ze:255},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),ze:255};"yellow"==t.Je?(t.backgroundColor=e,t.Ke=s,t.Qe=r,t.Ze=n):"blue"==t.Je?(t.backgroundColor=r,t.Ke=n,t.Qe=s,t.Ze=e):"blue2"==t.Je?(t.backgroundColor=r,t.Ke=e,t.Qe=s,t.Ze=n):"grey"==t.Je?(t.backgroundColor=n,t.Ke=s,t.Qe=r,t.Ze=e):"grey2"==t.Je?(t.backgroundColor=n,t.Ke=e,t.Qe=s,t.Ze=r):"black"==t.Je?(t.backgroundColor=s,t.Ke=r,t.Qe=e,t.Ze=n):"black2"==t.Je?(t.backgroundColor=s,t.Ke=r,t.Qe=n,t.Ze=e):"blackTrace"==t.Je?(t.backgroundColor=s,t.Ke=n,t.Qe=s,t.Ze=n):"blackTrace2"==t.Je?(t.backgroundColor=s,t.Ke=s,t.Qe=s,t.Ze=n):"blackTrace3"==t.Je?(t.backgroundColor=s,t.Ke=s,t.Qe=n,t.Ze=n):"redblue"==t.Je?(t.backgroundColor=s,t.Ke=a,t.Qe={r:221,g:85,b:12,ze:255},t.Ze={r:49,g:130,b:189,ze:255}):"variable"==t.Je?(t.backgroundColor=s,t.Ke=a,t.Qe=i,t.Ze=o):"mouseAnimation"==t.Je&&(t.backgroundColor={r:0,g:0,b:0,ze:0},t.Ke=r,t.Qe=s,t.Ze=e)}function H(t,e,r,n,s){let a=(e+n+t._e)%t._e,i=(r+s+t.tr)%t.tr,o=a,h=i;return(a-e-n>0||a-e-n<0)&&(h=(t.tr-i-t.er+t.tr)%t.tr),(i-r-s>0||i-r-s<0)&&(o=(t._e-a-t.rr+t._e)%t._e),[o,h]}function L(t,e,r,n,s){let a=(e+n+t._e)%t._e,i=(r+s+t.tr)%t.tr,o=a,h=i;return(a-e-n>0||a-e-n<0)&&(h=(t.tr-i-t.er+t.tr)%t.tr),i-r-s>0?o=(a+t.rr+t._e)%t._e:i-r-s<0&&(o=(a-t.rr+t._e)%t._e),[o,h]}function D(t,e,r,n,s){let a=(e+n+t._e)%t._e,i=(r+s+t.tr)%t.tr,o=a,h=i;return a-e-n>0?h=(i+t.er+t.tr)%t.tr:a-e-n<0&&(h=(i-t.er+t.tr)%t.tr),(i-r-s>0||i-r-s<0)&&(o=(t._e-a-t.rr+t._e)%t._e),[o,h]}function q(t,e,r,n,s){let a=(e+n+t._e)%t._e,i=(r+s+t.tr)%t.tr,o=a,h=i;return a-e-n>0?h=(i+t.er+t.tr)%t.tr:a-e-n<0&&(h=(i-t.er+t.tr)%t.tr),i-r-s>0?o=(a+t.rr+t._e)%t._e:i-r-s<0&&(o=(a-t.rr+t._e)%t._e),[o,h]}function z(t){t.nr&&t.sr?t.t=H:t.nr?t.t=L:t.sr?t.t=D:t.t=q}function J(t){E(t,!0)}function K(t,e){if(t.ar){var r={...t.ir};delete r.hr,delete r.be;var n={...r,event:e},s=Object.keys(n).join(",")+"\n";s+=Object.values(n).join(",");var a=new Blob([s],{type:"text/csv"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download="dataAutomata.csv",o.click()}}function Q(t,e,r){var n=function(t){var e=Math.exp(-t),r=1,n=0;do{n++,r*=Math.random()}while(r>e);return n-1}(10**(t.ur+t.Ee.Ae[0].X));if(0!=n)for(var s=t.Ee.Ae[0].U,a=t.Ee.Ae[0].Y,i=0;i<n;i++){var o=Math.floor(Math.random()*t._e),h=Math.floor(Math.random()*t.tr);Z(e,t,a[s()],o,h,r)}}function Z(t,e,r,n,s,a){null===r?r=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?nt(t,t):e<.2?tt(t,t):e<.3?_(t,t):e<.4?function(t){let e=new w(t,t);for(let r=0;r<t;r++)for(let n=r;n<t;n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,r,e.get(r,n));return e}(t):e<.5?function(t){let e=new w(t,t);for(let r=0;r<t;r++)for(let n=r;n<t;n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(t-1-n,t-1-r,e.get(r,n));return e}(t):e<.6?et(t,t):e<.7?rt(t,t):e<.8?function(t){let e=new w(t,t);for(let r=0;r<t;r++)for(let n=Math.max(r,t-r);n<t;n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,r,e.get(r,n)),e.set(t-1-n,t-1-r,e.get(r,n)),e.set(t-1-r,t-1-n,e.get(r,n));return e}(t):e<.9?function(t){let e=new w(t,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(t/2);n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,t-1-r,e.get(r,n)),e.set(t-1-r,t-1-n,e.get(r,n)),e.set(t-1-n,r,e.get(r,n));return e}(t):function(t){let e=new w(t,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(t/2);n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,t-1-r,e.get(r,n)),e.set(t-1-r,t-1-n,e.get(r,n)),e.set(t-1-n,r,e.get(r,n)),e.set(t-1-r,n,e.get(r,n)),e.set(t-1-n,t-1-r,e.get(r,n)),e.set(r,t-1-n,e.get(r,n)),e.set(n,r,e.get(r,n));return e}(t)}(e);else{t=function(t,e){let r=Math.random();return r<.2?nt(t,e):r<.4?tt(t,e):r<.6?_(t,e):r<.8?et(t,e):rt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&r.R(),Math.random()<.5&&r.flipX(),Math.random()<.75&&r.flipY());let i=r.height,o=r.width;for(let h=0;h<i;h++)for(let u=0;u<o;u++){let l=a(e,n,s,h-Math.floor(i/2),u-Math.floor(o/2));t.set(l[0],l[1],r.get(h,u))}}function _(t,e){let r=new w(e,t);for(let n=0;n<t;n++)for(let t=0;t<Math.ceil(e/2);t++)r.set(n,t,Math.floor(1e5*Math.random())),r.set(n,e-1-t,r.get(n,t));return r}function tt(t,e){let r=new w(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let s=0;s<e;s++)r.set(n,s,Math.floor(1e5*Math.random())),r.set(t-1-n,s,r.get(n,s));return r}function et(t,e){let r=new w(e,t);for(let n=0;n<t;n++)for(let s=0;s<Math.ceil(e/2);s++)r.set(n,s,Math.floor(1e5*Math.random())),r.set(t-1-n,e-1-s,r.get(n,s));return r}function rt(t,e){let r=new w(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let s=0;s<Math.ceil(e/2);s++)r.set(n,s,Math.floor(1e5*Math.random())),r.set(t-1-n,s,r.get(n,s)),r.set(n,e-1-s,r.get(n,s)),r.set(t-1-n,e-1-s,r.get(n,s));return r}function nt(t,e){let r=new w(e,t);for(let n=0;n<t;n++)for(let t=0;t<e;t++)r.set(n,t,Math.floor(1e5*Math.random()));return r}function st(t){!function(t){let e=t.lr,r=t.cr;for(var n=0,s=0,a=0;a<t._e;a++)for(var i=0;i<t.tr;i++){if(0==t.mr.get(a,i))continue;n+=1;var o=Math.floor(t.grid.get(a,i)/t.Ee.xe)%4;let e;if(0==o)e=t.backgroundColor;else if(1==o)e=t.Ke;else if(2==o)e=t.Qe;else{if(3!=o)continue;e=t.Ze}let h=4*(a*t.tr+i);s+=Math.sqrt((r.data[h+0]-e.r)**2+(r.data[h+1]-e.g)**2+(r.data[h+2]-e.b)**2),r.data[h+0]=e.r,r.data[h+1]=e.g,r.data[h+2]=e.b,r.data[h+3]=e.ze}t.dr=.01*n+.99*t.dr,t.Le=.01*s/(n+t._e*t.tr/30)+.99*t.Le,t.Le>330&&(t.Oe=!0,t.dr,t._e,t.tr,console.log("Changing rule because suspected oscillation (std of color change: "+t.Le.toFixed(1)+")."),t.dr=15,t.Le=10,K(t,"oscillation"));t.dr<3&&(t.Oe=!0,console.log("Changing rule because not enough cells changed ("+t.dr+")."),t.dr=20,K(t,"blackout")),e.putImageData(r,t.Mr,t.gr)}(t),function(t){var n=[new Uint8Array(e[0]*t.Ee.Ae[0].A).fill(0),new Uint8Array(e[1]).fill(0)],s=new Uint8Array(5).fill(0),a=new w(t.tr,t._e),i=t.grid;const o=t.time,h=t.Ee.Ae[0].A;for(var u=0;u<t._e;u++)for(var l=0;l<t.tr;l++){var c=r(t,u,l,i,n,s,o,h,4);const e=t.grid.get(u,l);var m=e;m="VariableGR"!=t.Ue||0==t.mask.get(u,l)?t.Ee.F(e,m,c,t.time):t.We.F(e,m,c,t.time),Math.floor(m/t.Ee.xe)%4!=Math.floor(e/t.Ee.xe)%4?t.mr.set(u,l,1):t.mr.set(u,l,0),a.set(u,l,m);for(let t=0;t<n.length;t++)n[t].fill(0);s.fill(0)}t.pr&&Q(t,a,t.t),t.grid=a}(t),E(t),t.time=(t.time+1)%166320,t.br&&function(t){Math.random()<1e-4&&(t.er=Math.floor(Math.random()*t.tr),console.log("Periodicity shift X: "+t.er)),Math.random()<1e-4&&(t.rr=Math.floor(Math.random()*t._e),console.log("Periodicity shift Y: "+t.rr)),Math.random()<1e-4&&(t.nr=!t.nr,z(t),console.log("Flip X: "+t.nr)),Math.random()<1e-4&&(t.sr=!t.sr,z(t),console.log("Flip Y: "+t.sr))}(t),"variable"==t.Je&&function(t){Math.random()<1&&(t.Ze=$(t.Ze),t.Qe=$(t.Qe))}(t),setTimeout((function(){requestAnimationFrame((()=>st(t)))}),t.timeout)}function at(t,e){return console.log("Attempting to load image"),(r="grLogoLarge.png",console.log("Loading image:",r),new Promise(((t,e)=>{const n=new Image;n.onload=()=>{console.log("Image loaded:",r);const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const s=e.getContext("2d");s.drawImage(n,0,0,n.width,n.height);const a=s.getImageData(0,0,e.width,e.height).data,i=[];for(let t=0;t<n.height;t++){const e=[];for(let r=0;r<n.width;r++){const s=4*(t*n.width+r),i=(a[s]+a[s+1]+a[s+2])/3;e.push(i>128?1:0)}i.push(e)}t(i)},n.onerror=()=>{console.error("Error loading image:",r),e(new Error("Error loading image"))},n.src=r}))).then((e=>{new w(t.tr,t._e);const r=new w(t.tr,t._e),n=e[0].length/t.tr,s=e.length/t._e,a=Math.max(n,s),i=Math.floor((t.tr-e[0].length/a)/2),o=Math.floor((t._e-e.length/a)/2);for(let n=0;n<t._e;n++)for(let s=0;s<t.tr;s++){if(n<o||(n-o)*a>=e.length){r.set(n,s,1);continue}let t=Math.floor((s-i)*a);0===e[Math.floor((n-o)*a)][t]?r.set(n,s,0):r.set(n,s,1)}t.mask=r})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new w(t.tr,t._e)}));var r}async function it(t,e){if("VariableGR"==t.Ue&&await at(t),"zero"!=t.wr)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new w(t.tr,t._e),t.mr=new w(t.tr,t._e);for(var r=0;r<t._e;r++)for(var n=0;n<t.tr;n++)if("gr"!=t.wr||1!==t.mask.get(r,n)){for(var s=Math.random(),a=0;a<e;a++)if(s<(a+1)/(e+1)){t.grid.set(r,n,a);break}t.mr.set(r,n,1)}else t.grid.set(r,n,0)}))}(t);t.grid=new Grid(t.tr,t._e),t.mr=new Grid(t.tr,t._e)}function ot(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){var e=document.getElementById("userGridHeight").value,r=document.getElementById("userGridWidth").value,n=document.getElementById("userTimeout").value,s=document.getElementById("userXShift"),a=s?s.value:t.vr,i=document.getElementById("userYShift"),o=i?i.value:t.Sr,h=document.getElementById("userFlipX"),u=h?h.checked:t.kr,l=document.getElementById("userFlipY"),c=l?l.checked:t.Nr,m=document.getElementById("randomnessCheckbox"),f=m?m.checked:t.pr,d=document.getElementById("randomnessSlider"),M=d?parseFloat(d.value):t.ur,g=document.getElementById("userColorPalette").value,p=document.getElementById("metaRule").value,b=null;document.getElementById("currentStyle")&&(b=document.getElementById("currentStyle").value),localStorage.setItem("userGridHeight",e),localStorage.setItem("userGridWidth",r),localStorage.setItem("userTimeout",n),localStorage.setItem("userXShift",a),localStorage.setItem("userYShift",o),localStorage.setItem("userFlipX",u),localStorage.setItem("userFlipY",c),localStorage.setItem("userColorPalette",g),localStorage.setItem("userRandomnessOn",f),localStorage.setItem("userRandomnessAmount",M),localStorage.setItem("metaRule",p),localStorage.setItem("currentStyle",b),location.reload()}(t)}))}function ht(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.ur=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var ut=document.getElementById("gameCanvas"),lt=ut.getContext("2d"),ct=128,mt=128,ft=20,dt=!0,Mt=-1,gt=!0,pt=0,bt=0,wt=!1,vt=!1,St="black2",kt="VariableGR",Nt="random",Bt=6,Rt=new class{constructor(t,e,r=200,n=200,s=20,a=!0,i=-2,o=!0,h=0,u=0,l=!1,c=!1,m="black2",f="VariableGR",d="random",M=6,g=2e4,p=2e3){this._e=r,this.tr=n,this.Mr=0,this.gr=0,this.timeout=s,this.grid=null,this.mr=null,this.cr=null,this.canvas=t,this.lr=e,this.pr=a,this.ur=i,this.br=o,this.er=h,this.rr=u,this.nr=l,this.sr=c,this.Je=m,this.Ue=f,this.wr=d,this.Br=M,this.Rr=null,this.Ir=null,this.t=null,this.mask=null,this.Cr=g,this.yr=p,this.Ye=-25,this.je=-25,this.De=25/this.Cr,this.qe=25/this.yr,this.canvas.width=this.tr,this.canvas.height=this._e,this.cr=e.createImageData(t.width,t.height),this.Oe=!0,this.He=!1,this.dr=0,this.Le=0,this.ar=!1,this.time=0}}(ut,lt,ct,mt,ft,dt,Mt,gt,pt,bt,wt,vt,St,kt,Nt,Bt);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.pr=this.checked}))}(Rt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(Rt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var r=t.canvas.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top,a=r.width/t.tr,i=r.height/t._e,o=Math.floor(n/a),h=Math.floor(s/i);t.grid.set(h,o,1)}}))}(Rt),function(t){t.canvas.addEventListener("mousedown",(function(e){var r=t.canvas.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top,a=r.width/t.tr,i=r.height/t._e,o=Math.floor(n/a),h=Math.floor(s/i);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(h,(o+1)%t.tr,1),t.grid.set(h,o,1),t.grid.set((h+1)%t._e,o,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(h,o,1),t.grid.set((h+1)%t._e,o,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(h,o,1),t.grid.set(h,(o+1)%t.tr,1)):(t.grid.set((h+1)%t._e,(o+1)%t.tr,1),t.grid.set((h-1+t._e)%t._e,(o+1)%t.tr,1),t.grid.set((h-1+t._e)%t._e,(o-1+t.tr)%t.tr,1),t.grid.set((h+1)%t._e,(o-1+t.tr)%t.tr,1))}))}(Rt),ot(Rt),ht(Rt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.er=e,z(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.rr=e,z(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.nr=this.checked,z(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.sr=this.checked,z(t)}))}(Rt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(Rt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.Je=this.value,j(t)}))}(Rt),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.Ue=this.value,J(t)}))}(Rt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.Oe=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.He=!0}))}(Rt),function(t){null!==localStorage.getItem("userGridHeight")?(t._e=parseInt(localStorage.getItem("userGridHeight")),t.tr=parseInt(localStorage.getItem("userGridWidth")),t._e>1e3&&(t._e=1e3),t.tr>1e3&&(t.tr=1e3),t.cr=t.lr.createImageData(t.tr,t._e),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.er=parseInt(localStorage.getItem("userXShift")),isNaN(t.er)&&(t.er=0),isNaN(t.rr)&&(t.rr=0),t.rr=parseInt(localStorage.getItem("userYShift")),t.nr="true"===localStorage.getItem("userFlipX"),t.sr="true"===localStorage.getItem("userFlipY"),t.Je=localStorage.getItem("userColorPalette"),t.pr="true"===localStorage.getItem("userRandomnessOn"),t.ur=parseFloat(localStorage.getItem("userRandomnessAmount")),t.Ue=localStorage.getItem("metaRule"),t.$e=localStorage.getItem("currentStyle"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t._e,document.getElementById("userGridWidth").value=t.tr,document.getElementById("userTimeout").value=t.timeout;let e=document.getElementById("userXShift");e&&(e.value=t.er);let r=document.getElementById("userYShift");r&&(r.value=t.rr);let n=document.getElementById("userFlipX");n&&(n.checked=t.nr);let s=document.getElementById("userFlipY");s&&(s.checked=t.sr);let a=document.getElementById("randomnessCheckbox");a&&(a.checked=t.pr);let i=document.getElementById("randomnessSlider");i&&(i.value=t.ur),document.getElementById("userColorPalette").value=t.Je,document.getElementById("metaRule").value=t.Ue,t.canvas.width=Math.max(t._e,t.tr),t.canvas.height=Math.max(t._e,t.tr),t.Mr=0,t.gr=0;var o=document.getElementById("gameCanvas");if(t._e>t.tr){var h=Math.floor(t.tr/t._e*800);o.style.width=h+"px",o.style.height="800px",o.width=h*t._e/800,o.height=t._e}else{var u=Math.floor(t._e/t.tr*800);o.style.width="800px",o.style.height=u+"px",o.width=t.tr,o.height=u*t.tr/800}}(Rt),j(Rt),z(Rt),J(Rt),it(Rt).then((()=>{st(Rt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
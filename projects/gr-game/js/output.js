(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),i=Object.values(t).reduce(((t,i,n)=>[...t,i/e+(t[n-1]||0)]),[]);return function(){let e=Math.random(),n=i.findIndex((t=>e<t));return Object.keys(t)[n]}}const e=[11,44];function i(t,e,i,n,r,s,a,h,o){const u=n.height-1,l=n.width-1,c=n.data,f=n.width;var m=r[0],d=r[1];let g;for(var M=-1;M<=1;M++)for(var p=-1;p<=1;p++){if(0==M&&0==p)continue;if(s[0]=((-1===M?1:M)+(-1===p?1:p))%2,s[2+(3&a)]=-1==M?1:0,s[(1+a)%4+1]=-1==p?1:0,s[(2+a)%4+1]=1==M?1:0,s[(3+a)%4+1]=1==p?1:0,0==e||0==i||e==u||i==l)var[b,S]=t.t(t,e,i,M,p);else var b=e+M,S=i+p;const n=c[b*f+S],r=n%h,v=Math.floor(n/h)%o;g=h;for(var w=0;w<h-1;w++)r==w+1&&(m[w]+=1,m[g+w]+=s[0],g+=h,m[g+w]+=1-s[0],m[h+g+w]+=s[1],g+=h,m[g+w]+=1-s[1],m[h+g+w]+=s[2],g+=h,m[g+w]+=1-s[2],m[h+g+w]+=s[3],g+=h,m[g+w]+=1-s[3],m[h+g+w]+=s[4],g+=h,m[g+w]+=1-s[4]),g=h;g=o;for(w=0;w<o;w++)d[w]+=1,v==w&&(d[o+w]+=s[0],g+=o,d[g+w]+=1-s[0],d[o+g+w]+=s[1],g+=o,d[g+w]+=1-s[1],d[o+g+w]+=s[2],g+=o,d[g+w]+=1-s[2],d[o+g+w]+=s[3],g+=o,d[g+w]+=1-s[3],d[o+g+w]+=s[4],g+=o,d[g+w]+=1-s[4]),g=o}return[m,d]}const n="mix",r="isotropic",s="xcross",a="vcross",h="xvcross",o="directional1",u="directional2",l="directional3",c="directional2b",f="directional",m={[n]:.2,[r]:.4,[s]:.05,[a]:.05,[h]:.05,[o]:.05,[u]:.05,[l]:.05,[c]:.05,[f]:.05};const d="A",g="C",M="E",p="B";class b{constructor(t,e,i,n,r,s=null){this.type=t,this.threshold=e,this.i=i,this.h=n,this.o=r,this.u=s,this.l=function(t,e){return t==g?function(t){return 0==t}:t==d?function(t){return t%e==0}:function(t){return!0}}(this.h,this.o),this.m=function(t,e,i){return e==M&&2==i.length?function(e){return e[i[0]][i[1]]==t}:e==p&&2==i.length?function(e){return e[i[0]][i[1]]>t}:e==M&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]==t}:e==p&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(s)}test(t,e,i){var n=this.M(i);return this.m(t)&&this.l(e)&&n}name(){var t="";null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join(""));var e=this.i.join("|");return`${this.type}${this.threshold}${this.h}[${e}]${t}`}static p(t,e=4){var i=null;t.startsWith(M)?i=M:t.startsWith(p)&&(i=p);var n=t.substring(i.length),r=parseInt(n.substring(0,1)),s=null;(n=n.substring(1)).startsWith(g)?s=g:n.startsWith(d)?s=d:n.startsWith("N")&&(s="N");var a=(n=n.substring(s.length)).split("[")[1].split("]")[0].split("|").map(Number),h=null;return(n=n.split("]")[1]).length>0&&(h=n.split("").map((t=>"1"===t))),new b(i,r,a,s,e,h)}static S(e=null,i=4,m=n,S=null){const w=[M,p],v=w[Math.floor(Math.random()*w.length)],N=[g,d,"N"],B=N[Math.floor(Math.random()*N.length)];null===e&&(e={0:2/3,1:1/3});const k=t(e)(),I=function(t,e){var i=e;if(i==n){var m=Math.random();i=m<.5?r:m<.7?s:m<.9?a:f}if(i==r)return Math.floor(4*Math.random());if(i==a)return Math.floor(4*Math.random()+4);if(i==s)return Math.floor(4*Math.random()+8);if(i==h)return Math.floor(8*Math.random()+4);if(i==o)return Math.floor(4*Math.random()+12);if(i==u)return Math.floor(8*Math.random()+12);if(i==l)return Math.floor(12*Math.random()+12);if(i==c){var d=Math.floor(8*Math.random()+12);return d>=16&&(d+=4),d}return i==f?Math.floor(16*Math.random()+12):void 0}(0,m);var R=void 0;if(Math.random()<.5){R=[k,I,function(t){for(var e=4*Math.floor(t/4),i=t;i==t;)i=e+Math.floor(4*Math.random());return i}(I)]}else R=[k,I];var y=0,C=8;if(0==R[0]&&R[1]%4!=1?C=5:R[1]>4&&R[1]<=16?C=4:R[1]>16&&(C=3),y=v===p?Math.floor(Math.random()*C):Math.floor(Math.random()*C)+1,Math.random()<.2)x=null;else{var x;null==S&&(S=Math.floor(20*Math.random())+2);do{x=new Array(S).fill(0).map((()=>Math.random()<.5))}while(!x.includes(!0))}return new b(v,y,R,B,i,x)}}class S{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.v=!1,this.get=this.N,this.set=this.B}static k(t,e=!1,i=!1,n=!1){const r=t.length,s=t[0].length,a=new S(s,r);for(let e=0;e<r;e++){n&&(e=r-e-1);for(let n=0;n<s;n++)i&&(n=s-n-1),a.set(e,n,t[e][n])}return e&&a.I(),a}I(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.v?[this.N,this.B]:[this.R,this.C],this.v=!this.v}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const i=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,i)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const i=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,i)}}N(t,e){return this.data[t*this.width+e]}B(t,e,i){this.data[t*this.width+e]=i}R(t,e){return this.data[e*this.height+t]}C(t,e,i){this.data[e*this.height+t]=i}}class w{constructor(){this.A=void 0}P(t,e,i,n){throw new Error("Must override method")}G(){throw new Error("Must override method")}}class v extends w{constructor(){super(),this.$=this.F(),this.U(),this.O=0}F(){throw new Error("Must override method")}U(){this.T=Object.keys(this.$).map((t=>this.$[t].mask));let e=Object.keys(this.$).map((t=>this.$[t].V));this.j=t(e)}}class N extends v{constructor(){super(),this.A=4}P(t,e,i,n){var r=t%4;return 1==r||3==r?e=2:2==r?e=0:0==r&&2==i[0][0]?e=1:0==r&&i[0][0]>2&&(e=3),e}G(){return"BB"}F(){return{random:{V:15,mask:null},W:{V:4,mask:S.k([[1,1],[1,1]])},X:{V:4,mask:new S([[1,0,1],[0,0,0],[1,0,1]])},Y:{V:2,mask:S.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{V:2,mask:S.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},D:{V:2,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},q:{V:2,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class B extends v{constructor(){super(),this.A=4,this.O=-1}P(t,e,i,n){var r=t%4;return 3==r&&(r=0),1==r?e=2:2==r||3==r?e=0:0!=r&&3!=r||2!=i[0][0]?0==r&&i[0][0]>2&&(e=3):e=1,e}G(){return"TBB"}F(){return{random:{V:15,mask:null},D:{V:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Y:{V:2,mask:S.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{V:2,mask:S.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},W:{V:4,mask:S.k([[1,1],[1,1]])},H:{V:1e4,mask:S.k([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class k extends v{constructor(){super(),this.A=4,this.O=-1}P(t,e,i,n){var r=t%4;return 1==r&&(i[0][0]<3||i[0][0]>5)?e=2:2==r?e=3:3==r?e=0:0==r&&2==i[0][0]&&(e=1),e}G(){return"SW"}F(){let t=.2;return{random:{V:6,mask:null},_:{V:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},J:{V:t,mask:S.k([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},K:{V:t,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Z:{V:t,mask:S.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{V:t,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{V:t,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},it:{V:t,mask:S.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},nt:{V:t,mask:S.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},rt:{V:t,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},st:{V:t,mask:S.k([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ht:{V:t,mask:S.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ot:{V:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{V:t,mask:S.k([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{V:t,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{V:t,mask:S.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{V:t,mask:S.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},dt:{V:t,mask:S.k([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},X:{V:2,mask:S.k([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class I extends v{constructor(t){super(),null==t&&(t=I.gt()),this.Mt(t)}P(t,e,i,n){var r=t%this.A;return 1==r&&this.bt.includes(i[0][this.St])?e=1:r>0&&r<this.A-1?e+=1:r==this.A-1?e=0:0==r&&this.wt.includes(i[0][this.St])?e=1:0==r&&this.vt.includes(i[0][this.St])&&(e=this.A-1),e}Mt(t){this.Nt=t;const e=this.Nt.split("/");for(var i of(this.St=0,this.vt=[],e))"N"==i[0]?this.St=Number(e[0].substring(1)):"B"==i[0]?this.wt=new Uint8Array(i.substring(1).split("").map(Number)):"S"==i[0]?this.bt=new Uint8Array(i.substring(1).split("").map(Number)):"I"==i[0]?this.vt=new Uint8Array(e[2].substring(1).split("").map(Number)):this.A=Number(i)}static gt(t){let e=Math.floor(10*Math.random())+3;null==t&&(t=Math.floor(5*Math.random()*e));let i=Math.floor(t/e)%5;var n=8;[1,2].includes(i)?n=4:3==i?n=3:4==i&&(n=5);let r=y.Bt(1,n);0==r.length&&(r=[2]);let s=y.Bt(1,n),a=y.Bt(1,n);return a=a.filter((t=>!r.includes(t)&&!s.includes(t)&&2!=t)),`N${t}/B${r.join("")}/S${s.join("")}/I${a.join("")}/${e}`}static Bt(t,e){let i=[];for(let n=t;n<=e;n++)Math.random()<.5&&i.push(n);return i}G(){return this.Nt}F(){return{random:{V:1,mask:null}}}}class R extends I{constructor(t,e=null){if(super(t),"ships"==e){let t=R.gt(0);this.Mt(t);let e=Array.from(this.wt).indexOf(1);if(-1!==e){let t=new Uint8Array(this.wt.length-1);t.set(this.wt.subarray(0,e),0),t.set(this.wt.subarray(e+1),e),this.wt=t}if(-1===this.wt.indexOf(2)){let t=new Uint8Array(this.wt.length+1);t[0]=2,t.set(this.wt,1),this.wt=t}if(e=Array.from(this.bt).indexOf(1),-1!==e){let t=new Uint8Array(this.bt.length-1);t.set(this.bt.subarray(0,e),0),t.set(this.bt.subarray(e+1),e),this.bt=t}this.vt=this.vt.filter((t=>!this.wt.includes(t)&&!this.bt.includes(t)&&2!=t)),this.Nt=`N${this.St}/B${this.wt.join("")}/S${this.bt.join("")}/I${this.vt.join("")}/${this.A}`,this.kt=1,this.O=.5}else this.kt=20/this.wt[0]**3,this.O=1}P(t,e,i,n,r){var s=t%this.A;return 1==s&&this.bt.includes(i[0][this.St])?e=1:s>0&&s<this.A-1?e+=1:s==this.A-1?e=0:0==s&&this.wt.includes(i[0][this.St])&&Math.random()>this.kt*r-.01?e=1:0==s&&this.vt.includes(i[0][this.St])&&(e=this.A-1),e}G(){return`SGen/${this.Nt}`}Mt(t){"SGen"==t.substring(0,4)?super.Mt(t.substring(5)):super.Mt(t)}}class y extends I{constructor(t=null,e=!0){super(null==t?e?y.It():y.gt():t)}static It(){let e=t({Rt:5,yt:1,Ct:1,xt:1,At:1,Pt:1,Gt:1,$t:3,Ft:1,Ut:1,Et:1,Ot:1,Tt:1,Vt:1,jt:1,Wt:1,Xt:1,Yt:1,Lt:1,Dt:1,qt:1,Ht:3,zt:1,_t:1,Jt:1,Kt:1,Qt:1,Zt:1,te:1,ee:3,ie:1,ne:1,re:10,se:3,ae:1,he:1,oe:1,ue:1,le:1,ce:3,fe:1,me:1,de:1,ge:1,Me:1,pe:1,be:1,Se:1,we:1,ve:1,Ne:1,Be:1,ke:1,Ie:1,Re:1,ye:1,Ce:1,xe:1,Ae:1,Pe:1,Ge:1,$e:1,Fe:1,Ue:1,Ee:1,Oe:1,Te:1,Ve:1,je:1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}F(){return{random:{V:1,mask:null}}}G(){return`GGShips/${this.Nt}`}Mt(t){"GGShips/"==t.substring(0,7)?super.Mt(t.substring(8)):super.Mt(t)}}class C extends I{constructor(){super("B24/S34/I15678/4"),this.O=0}G(){return"FS"}F(){let t=.2;return{random:{V:20,mask:null},We:{V:1,mask:S.k([[1,1],[1,1]])},Xe:{V:t,mask:S.k([[1,1]])},Ye:{V:1,mask:S.k([[1,0],[1,1]])},Le:{V:t,mask:S.k([[1,1],[2,2]])},De:{V:1,mask:S.k([[0,1,0],[1,1,1],[0,1,0]])},qe:{V:1,mask:S.k([[1,0,1],[0,0,0],[1,0,1]])},He:{V:t,mask:S.k([[1,0,0],[1,1,0],[0,1,1]])},ze:{V:t,mask:S.k([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},_e:{V:1,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Je:{V:1,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Ke:{V:1,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Qe:{V:t,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Ze:{V:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ti:{V:t,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class x extends I{constructor(){super("B2/S245678/I1/4"),this.O=0}G(){return"SS"}F(){let t=.2;return{random:{V:10,mask:null},We:{V:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Xe:{V:t,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Le:{V:t,mask:S.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},He:{V:t,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},ze:{V:t,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Qe:{V:t,mask:S.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},Ze:{V:t,mask:S.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},_e:{V:1,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ti:{V:t,mask:S.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ei:{V:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Je:{V:1,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ii:{V:1,mask:S.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ni:{V:1,mask:S.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class A extends v{constructor(){super(),this.A=4,this.O=.4}P(t,e,i,n){var r=t%4,s=i[0][0]+i[0][2];return 1!=r&&3!=r||!(s<2||s>3)?1!=r&&3!=r||2!=s&&3!=s?0!=r&&2!=r||3!=s?2==r&&(e=0):e=3:e=1:e=2,e}F(){return{ri:{V:1,mask:null}}}G(){return"CW"}}class P extends w{constructor(t,e,i,n,r){super(),this.si=e,this.ai=t,this.A=this.si,this.hi=i,this.oi=n,this.ui=r}P(t,e,i,n){e=0;for(let r=0;r<this.ai.length;r++)if(this.ai[r].test(i,t,n)){e=(r+1)%this.si;break}return e}G(){return this.ai.map((t=>t.name())).join("||")}static li(e=null,i=null,n=null,r=4,s=4,a=null){var h=[];null==e&&(e=Math.floor(8*Math.random())+2),null==n&&(n=t(m)()),null==a&&(a=this.ci());for(let t=0;t<e;t++)h.push(b.S(i,r,n,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+h.map((t=>t.name())).join(", ")),new P(h,s,i,n,a)}static ci(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static fi(t,e=4){var i=t.split("||").map((t=>b.p(t)));return new P(i,e,null,n,null)}mi(t=null){var e,i=this.ai.length;null==t&&(t=this.hi),0==(e=2==i?Math.floor(2*Math.random())+1:10==i?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.di():1==e?this.gi(t):this.Mi(t)}Mi(t){var e=this.ai.slice();e.push(b.S(t,4,this.oi,this.ui)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.oi+": "+e.map((t=>t.name())).join("||")),this.ai=e}di(){var t=this.ai.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.ai=t}gi(t){var e=this.ai.slice(),i=Math.floor(Math.random()*e.length);e[i]=b.S(t,4,this.oi,this.ui),console.log((new Date).toLocaleTimeString()+" Changing condition "+i+" to "+this.oi+": "+e.map((t=>t.name())).join("||")),this.ai=e}}const G="gr",$="safe",F="mix",U="general",E="test";class O{pi;bi;P;Si(){throw new Error("Must override method")}wi(){return function(t,e,i,n,r){e=this.bi[0].P(t%this.bi[0].A,e,i,n,r);var s=this.bi[0].A;for(let r=1;r<this.bi.length;r++)e+=s*this.bi[r].P(Math.floor(t/s)%this.bi[r].A,e,i,n),e%=s*=this.bi[r].A;return e%s}}vi(){throw new Error("Must override method")}G(){return this.bi.map((t=>t.G())).join("-")}}class T extends O{constructor(t){super(),this.Ni=t,this.pi=1,this.bi=this.Si(),this.P=this.wi()}Si(){var t=[];return"Original"==this.Ni?t.push(new B):"StarWars"==this.Ni?t.push(new k):"Modified"==this.Ni?t.push(new N):"Conway"==this.Ni?t.push(new A):t.push(new I(this.Ni)),t}vi(){}}class V extends O{constructor(t,e,i=null){super(),this.Ni=t,this.hi=e,this.ui=null,this.Bi=null,null==e&&(t==$||t==G||t==E?this.hi={0:1,1:0}:t==F?(Math.random()<.5?this.hi={0:.8,1:.2}:this.hi={0:1,1:0},this.hi={0:.8,1:.2}):this.hi={0:.5,1:.5}),t==G&&(this.ui=1),this.pi=4,this.bi=null==i?this.Si():this.ki(i),this.P=this.wi()}Ii=[{Ri:R,yi:[null,"ships"],weight:4},{Ri:R,yi:[],weight:2},{Ri:y,yi:[],weight:2},{Ri:N,yi:[],weight:4},{Ri:B,yi:[],weight:1},{Ri:k,yi:[],weight:1},{Ri:x,yi:[],weight:1},{Ri:C,yi:[],weight:1},{Ri:A,yi:[],weight:1}];Ci=[{Ri:N,yi:[],weight:1}];Si(){let t=this.Ii;this.Ni==G&&(t=this.Ci);let e=t.reduce(((t,e)=>t+e.weight),0);var i=[];let n=Math.random()*e;for(let e=0;e<t.length;e++){if(n<t[e].weight){i.push(new t[e].Ri(...t[e].yi));break}n-=t[e].weight}return i.push(P.li(null,this.hi,this.Bi,i[0].A,4,this.ui)),this.Ni==E&&((i=[]).push(new R(null,"ships")),this.pi=i[0].A,i.push(P.li(null,this.hi,this.Bi,4,4,this.ui))),i}vi(){this.bi[1]&&"function"==typeof this.bi[1].mi&&this.bi[1].mi(this.hi)}ki(t){var e=[],[i,n]=t.split("-");return"BB"==i?e.push(new N):"TBB"==i?e.push(new B):"SW"==i?e.push(new k):"SS"==i?e.push(new x):"FS"==i?e.push(new C):"CW"==i?e.push(new A):i.startsWith("SGen")?e.push(new R(i,"ships")):i.startsWith("GGShips")?e.push(new y(i)):e.push(new I(i)),e.push(P.fi(n)),e}}class j extends O{constructor(t,e,i=null){super(),this.Ni=t,this.hi=e,this.ui=null,this.Bi=null,null==e&&(t==$?this.hi={0:1,1:0}:t==F?(Math.random()<.5?this.hi={0:.8,1:.2}:this.hi={0:1,1:0},this.hi={0:.8,1:.2}):this.hi={0:.5,1:.5}),this.pi=16,this.bi=null==i?this.Si():this.ki(i),this.P=this.wi()}Si(){var t=[];return t.push(new N),t.push(P.li(null,this.hi,this.Bi,4,4,this.u)),t.push(P.li(null,this.hi,this.Bi,16,4,this.u)),t}vi(){this.bi[1].mi(this.hi),this.bi[2].mi(this.hi)}ki(t){var e=[],i=t.split("-")[1];return e.push(new N),e.push(P.fi(i)),e}}function W(t,e=!1){Math.random()<Math.exp(t.xi)||e||t.Ai?("VariableGR"==t.Pi?(t.Gi=new V(G),t.$i=new V(G),t.Fi=!0):"VariableDemo"==t.Pi?(t.Gi=new V(G),t.$i=null,t.Fi=!1):"Variable"==t.Pi?t.Gi=new V($):"VariableMix"==t.Pi?t.Gi=new V(F):"VariableUnsafe"==t.Pi?t.Gi=new V(U):"VariableTest"==t.Pi?t.Gi=new V(E):"Variable2Unsafe"==t.Pi?t.Gi=new j(U):"CustomRule"==t.Pi?t.Gi=new V(null,null,t.Ui):"OriginalBB"==t.Pi?t.Gi=new T("Original"):"ModifiedBB"==t.Pi?t.Gi=new T("Modified"):"StarWars"==t.Pi?t.Gi=new T("StarWars"):"Conway"==t.Pi?t.Gi=new T("Conway"):"SparseFourStates"==t.Pi?t.Gi=new T("B378/S124567/4"):t.Gi=new V(F),t.xi=-25,t.Ei=-25,t.Ai=!1,X(t)):(Math.random()<Math.exp(t.Ei)||t.Oi)&&"CustomRule"!=t.Pi&&(t.Gi.vi(),t.Fi&&null!==t.$i&&t.$i.vi(),t.Ei=-25,t.Oi=!1,X(t));let i=Math.max(t.Ti/200,1);t.xi=t.xi+t.Vi*i,t.xi>0&&(t.xi=0),t.Ei=t.Ei+t.ji*i,t.Ei>0&&(t.Ei=0)}function X(t){var e=document.getElementById("currentStyle");e&&(t.Fi&&null!==t.$i?e.value=t.Gi.G()+"__"+t.$i.G():e.value=t.Gi.G())}function Y(t){let e={};for(let i in t){if("t"==i)continue;let n=Math.floor(3*Math.random())-1,r=t[i]+n;r=Math.max(0,Math.min(255,r)),e[i]=r}return e.Wi=t.Wi,e}function L(t){var e={r:247,g:255,b:28,Wi:255},i={r:13,g:112,b:255,Wi:255},n={r:240,g:239,b:239,Wi:255},r={r:0,g:0,b:0,Wi:255},s={r:240,g:240,b:240,Wi:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Wi:255},h={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Wi:255};"yellow"==t.Xi?(t.backgroundColor=e,t.Yi=r,t.Li=i,t.Di=n):"blue"==t.Xi?(t.backgroundColor=i,t.Yi=n,t.Li=r,t.Di=e):"blue2"==t.Xi?(t.backgroundColor=i,t.Yi=e,t.Li=r,t.Di=n):"grey"==t.Xi?(t.backgroundColor=n,t.Yi=r,t.Li=i,t.Di=e):"grey2"==t.Xi?(t.backgroundColor=n,t.Yi=e,t.Li=r,t.Di=i):"black"==t.Xi?(t.backgroundColor=r,t.Yi=i,t.Li=e,t.Di=n):"black2"==t.Xi?(t.backgroundColor=r,t.Yi=i,t.Li=n,t.Di=e):"blackTrace"==t.Xi?(t.backgroundColor=r,t.Yi=n,t.Li=r,t.Di=n):"blackTrace2"==t.Xi?(t.backgroundColor=r,t.Yi=r,t.Li=r,t.Di=n):"blackTrace3"==t.Xi?(t.backgroundColor=r,t.Yi=r,t.Li=n,t.Di=n):"redBlue"==t.Xi?(t.backgroundColor=r,t.Yi=s,t.Li={r:221,g:12,b:12,Wi:255},t.Di={r:29,g:29,b:189,Wi:255}):"turquoiseRed"==t.Xi?(t.backgroundColor=r,t.Yi=s,t.Li={r:39,g:192,b:177,Wi:255},t.Di={r:252,g:53,b:47,Wi:255}):"magentaCyan"==t.Xi?(t.backgroundColor=r,t.Yi=s,t.Li={r:156,g:36,b:150,Wi:255},t.Di={r:114,g:223,b:174,Wi:255}):"variable"==t.Xi?(t.backgroundColor=r,t.Yi=s,t.Li=a,t.Di=h):"mouseAnimation"==t.Xi&&(t.backgroundColor={r:0,g:0,b:0,Wi:0},t.Yi=i,t.Li=r,t.Di=e)}function D(t,e,i,n,r){let s=(e+n+t.qi)%t.qi,a=(i+r+t.Hi)%t.Hi,h=s,o=a;return(s-e-n>0||s-e-n<0)&&(o=(t.Hi-a-t.zi+t.Hi)%t.Hi),(a-i-r>0||a-i-r<0)&&(h=(t.qi-s-t._i+t.qi)%t.qi),[h,o]}function q(t,e,i,n,r){let s=(e+n+t.qi)%t.qi,a=(i+r+t.Hi)%t.Hi,h=s,o=a;return(s-e-n>0||s-e-n<0)&&(o=(t.Hi-a-t.zi+t.Hi)%t.Hi),a-i-r>0?h=(s+t._i+t.qi)%t.qi:a-i-r<0&&(h=(s-t._i+t.qi)%t.qi),[h,o]}function H(t,e,i,n,r){let s=(e+n+t.qi)%t.qi,a=(i+r+t.Hi)%t.Hi,h=s,o=a;return s-e-n>0?o=(a+t.zi+t.Hi)%t.Hi:s-e-n<0&&(o=(a-t.zi+t.Hi)%t.Hi),(a-i-r>0||a-i-r<0)&&(h=(t.qi-s-t._i+t.qi)%t.qi),[h,o]}function z(t,e,i,n,r){let s=(e+n+t.qi)%t.qi,a=(i+r+t.Hi)%t.Hi,h=s,o=a;return s-e-n>0?o=(a+t.zi+t.Hi)%t.Hi:s-e-n<0&&(o=(a-t.zi+t.Hi)%t.Hi),a-i-r>0?h=(s+t._i+t.qi)%t.qi:a-i-r<0&&(h=(s-t._i+t.qi)%t.qi),[h,o]}function _(t){t.Ji&&t.Ki?t.t=D:t.Ji?t.t=q:t.Ki?t.t=H:t.t=z}function J(t){W(t,!0)}function K(t,e){if(t.Qi){var i=t.Gi.bi[0].G(),n=new Blob([i],{type:"text/plain"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download="dataAutomata.txt",s.click()}}function Q(t,e,i){var n=function(t){var e=Math.exp(-t),i=1,n=0;do{n++,i*=Math.random()}while(i>e);return n-1}(10**(t.Zi+t.Gi.bi[0].O));if(0!=n)for(var r=t.Gi.bi[0].j,s=t.Gi.bi[0].T,a=0;a<n;a++){var h=Math.floor(Math.random()*t.qi),o=Math.floor(Math.random()*t.Hi);Z(e,t,s[r()],h,o,i)}}function Z(t,e,i,n,r,s){null===i?i=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?rt(t,t):e<.2?et(t,t):e<.3?tt(t,t):e<.4?function(t){let e=new S(t,t);for(let i=0;i<t;i++)for(let n=i;n<t;n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,i,e.get(i,n));return e}(t):e<.5?function(t){let e=new S(t,t);for(let i=0;i<t;i++)for(let n=i;n<t;n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(t-1-n,t-1-i,e.get(i,n));return e}(t):e<.6?it(t,t):e<.7?nt(t,t):e<.8?function(t){let e=new S(t,t);for(let i=0;i<t;i++)for(let n=Math.max(i,t-i);n<t;n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,i,e.get(i,n)),e.set(t-1-n,t-1-i,e.get(i,n)),e.set(t-1-i,t-1-n,e.get(i,n));return e}(t):e<.9?function(t){let e=new S(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let n=0;n<Math.ceil(t/2);n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,t-1-i,e.get(i,n)),e.set(t-1-i,t-1-n,e.get(i,n)),e.set(t-1-n,i,e.get(i,n));return e}(t):function(t){let e=new S(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let n=0;n<Math.ceil(t/2);n++)e.set(i,n,Math.floor(1e5*Math.random())),e.set(n,t-1-i,e.get(i,n)),e.set(t-1-i,t-1-n,e.get(i,n)),e.set(t-1-n,i,e.get(i,n)),e.set(t-1-i,n,e.get(i,n)),e.set(t-1-n,t-1-i,e.get(i,n)),e.set(i,t-1-n,e.get(i,n)),e.set(n,i,e.get(i,n));return e}(t)}(e);else{t=function(t,e){let i=Math.random();return i<.2?rt(t,e):i<.4?et(t,e):i<.6?tt(t,e):i<.8?it(t,e):nt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&i.I(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let a=i.height,h=i.width;for(let o=0;o<a;o++)for(let u=0;u<h;u++){let l=s(e,n,r,o-Math.floor(a/2),u-Math.floor(h/2));t.set(l[0],l[1],i.get(o,u))}}function tt(t,e){let i=new S(e,t);for(let n=0;n<t;n++)for(let t=0;t<Math.ceil(e/2);t++)i.set(n,t,Math.floor(1e5*Math.random())),i.set(n,e-1-t,i.get(n,t));return i}function et(t,e){let i=new S(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let r=0;r<e;r++)i.set(n,r,Math.floor(1e5*Math.random())),i.set(t-1-n,r,i.get(n,r));return i}function it(t,e){let i=new S(e,t);for(let n=0;n<t;n++)for(let r=0;r<Math.ceil(e/2);r++)i.set(n,r,Math.floor(1e5*Math.random())),i.set(t-1-n,e-1-r,i.get(n,r));return i}function nt(t,e){let i=new S(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let r=0;r<Math.ceil(e/2);r++)i.set(n,r,Math.floor(1e5*Math.random())),i.set(t-1-n,r,i.get(n,r)),i.set(n,e-1-r,i.get(n,r)),i.set(t-1-n,e-1-r,i.get(n,r));return i}function rt(t,e){let i=new S(e,t);for(let n=0;n<t;n++)for(let t=0;t<e;t++)i.set(n,t,Math.floor(1e5*Math.random()));return i}function st(t){!function(t){let e=t.tn,i=t.en;for(var n=0,r=0,s=0;s<t.qi;s++)for(var a=0;a<t.Hi;a++){if(0==t.nn.get(s,a))continue;n+=1;var h=Math.floor(t.grid.get(s,a)/t.Gi.pi)%4;let e;if(0==h)e=t.backgroundColor;else if(1==h)e=t.Yi;else if(2==h)e=t.Li;else{if(3!=h)continue;e=t.Di}let o=4*(s*t.Hi+a);r+=Math.sqrt((i.data[o+0]-e.r)**2+(i.data[o+1]-e.g)**2+(i.data[o+2]-e.b)**2),i.data[o+0]=e.r,i.data[o+1]=e.g,i.data[o+2]=e.b,i.data[o+3]=e.Wi}t.rn=.8*t.rn+n/(t.qi*t.Hi)/5,t.sn=.01*n+.99*t.sn,t.Ti=.01*r/(n+t.qi*t.Hi/30)+.99*t.Ti,t.Ti>330&&(t.Ai=!0,t.sn,t.qi,t.Hi,console.log("Changing rule because suspected oscillation (std of color change: "+t.Ti.toFixed(1)+")."),t.sn=15,t.Ti=10,K(t));t.sn<3&&(t.Ai=!0,console.log("Changing rule because not enough cells changed ("+t.sn+")."),t.sn=20,K(t)),e.putImageData(i,t.an,t.hn)}(t),function(t){var n=[new Uint8Array(e[0]*t.Gi.bi[0].A).fill(0),new Uint8Array(e[1]).fill(0)],r=new Uint8Array(5).fill(0),s=new S(t.Hi,t.qi),a=t.grid;const h=t.time,o=t.Gi.bi[0].A;for(var u=0;u<t.qi;u++)for(var l=0;l<t.Hi;l++){var c=i(t,u,l,a,n,r,h,o,4);const e=t.grid.get(u,l);var f=e;f=t.Fi&&0!=t.mask.get(u,l)?t.$i.P(e,f,c,t.time,t.rn):t.Gi.P(e,f,c,t.time,t.rn),Math.floor(f/t.Gi.pi)%4!=Math.floor(e/t.Gi.pi)%4?t.nn.set(u,l,1):t.nn.set(u,l,0),s.set(u,l,f);for(let t=0;t<n.length;t++)n[t].fill(0);r.fill(0)}t.on&&Q(t,s,t.t),t.grid=s}(t),W(t),t.time=(t.time+1)%166320,t.un&&function(t){Math.random()<1e-4&&(t.zi=Math.floor(Math.random()*t.Hi),console.log("Periodicity shift X: "+t.zi)),Math.random()<1e-4&&(t._i=Math.floor(Math.random()*t.qi),console.log("Periodicity shift Y: "+t._i)),Math.random()<1e-4&&(t.Ji=!t.Ji,_(t),console.log("Flip X: "+t.Ji)),Math.random()<1e-4&&(t.Ki=!t.Ki,_(t),console.log("Flip Y: "+t.Ki))}(t),"variable"==t.Xi&&function(t){Math.random()<1&&(t.Di=Y(t.Di),t.Li=Y(t.Li))}(t),setTimeout((function(){requestAnimationFrame((()=>st(t)))}),t.timeout)}function at(t,e){return console.log("Attempting to load image"),(i=t.ln,console.log("Loading image:",i),new Promise(((t,e)=>{const n=new Image;n.onload=()=>{console.log("Image loaded:",i);const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const r=e.getContext("2d");r.drawImage(n,0,0,n.width,n.height);const s=r.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<n.height;t++){const e=[];for(let i=0;i<n.width;i++){const r=4*(t*n.width+i),a=(s[r]+s[r+1]+s[r+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},n.onerror=()=>{console.error("Error loading image:",i),e(new Error("Error loading image"))},n.src=i}))).then((e=>{new S(t.Hi,t.qi);const i=new S(t.Hi,t.qi),n=e[0].length/t.Hi,r=e.length/t.qi,s=Math.max(n,r),a=Math.floor((t.Hi-e[0].length/s)/2),h=Math.floor((t.qi-e.length/s)/2);for(let n=0;n<t.qi;n++)for(let r=0;r<t.Hi;r++){if(n<h||(n-h)*s>=e.length){i.set(n,r,1);continue}let t=Math.floor((r-a)*s);0===e[Math.floor((n-h)*s)][t]?i.set(n,r,0):i.set(n,r,1)}t.mask=i})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new S(t.Hi,t.qi)}));var i}async function ht(t,e){if(null!==t.ln&&await at(t),"zero"!=t.cn)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new S(t.Hi,t.qi),t.nn=new S(t.Hi,t.qi);for(var i=0;i<t.qi;i++)for(var n=0;n<t.Hi;n++)if("gr"!=t.cn||1!==t.mask.get(i,n)){for(var r=Math.random(),s=0;s<e;s++)if(r<(s+1)/(e+1)){t.grid.set(i,n,s);break}t.nn.set(i,n,1)}else t.grid.set(i,n,0)}))}(t);t.grid=new Grid(t.Hi,t.qi),t.nn=new Grid(t.Hi,t.qi)}function ot(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){Object.keys(t).forEach((t=>{let e=document.getElementById(t);var i;e&&(i="checkbox"===e.type?e.checked:"number"===e.type||"range"===e.type?parseFloat(e.value):e.value,localStorage.setItem(t,i))})),location.reload()}(t)}))}function ut(t){document.getElementById("randomnessAmount").addEventListener("input",(function(){!function(t,e){t.Zi=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var lt={canvas:document.getElementById("gameCanvas"),tn:document.getElementById("gameCanvas").getContext("2d"),qi:128,Hi:128,timeout:20,on:!0,Zi:-1,un:!0,zi:0,_i:0,Ji:!1,Ki:!1,Xi:"black2",Pi:"VariableGR",cn:"random",ln:"grLogoLarge.png",Fi:!0},ct=new class{constructor({canvas:t,tn:e,qi:i=200,Hi:n=200,timeout:r=20,on:s=!0,Zi:a=-2,un:h=!0,zi:o=0,_i:u=0,Ji:l=!1,Ki:c=!1,Xi:f="black2",Pi:m="VariableGR",cn:d="random",fn:g=2e4,mn:M=2e3,ln:p=null,Fi:b=!1}={}){this.grid=null,this.qi=i,this.Hi=n,this.zi=o,this._i=u,this.Ji=l,this.Ki=c,this.mask=null,this.t=null,this.canvas=t,this.tn=e,this.an=0,this.hn=0,this.canvas.width=this.Hi,this.canvas.height=this.qi,this.nn=null,this.en=e.createImageData(t.width,t.height),this.Xi=f,this.cn=d,this.ln=p,this.Fi=b,this.timeout=r,this.on=s,this.Zi=a,this.un=h,this.Pi=m,this.dn=null,this.gn=null,this.fn=g,this.mn=M,this.time=0,this.xi=-25,this.Ei=-25,this.Vi=25/this.fn,this.ji=25/this.mn,this.Ai=!0,this.Oi=!1,this.rn=0,this.sn=0,this.Ti=0,this.Qi=!1}}(lt);window.onload=function(){!function(t){document.getElementById("addRandomness").addEventListener("change",(function(){t.on=this.checked}))}(ct),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(ct),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var i=t.canvas.getBoundingClientRect(),n=e.clientX-i.left,r=e.clientY-i.top,s=i.width/t.Hi,a=i.height/t.qi,h=Math.floor(n/s),o=Math.floor(r/a);t.grid.set(o,h,1)}}))}(ct),function(t){t.canvas.addEventListener("mousedown",(function(e){var i=t.canvas.getBoundingClientRect(),n=e.clientX-i.left,r=e.clientY-i.top,s=i.width/t.Hi,a=i.height/t.qi,h=Math.floor(n/s),o=Math.floor(r/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(o,(h+1)%t.Hi,1),t.grid.set(o,h,1),t.grid.set((o+1)%t.qi,h,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(o,h,1),t.grid.set((o+1)%t.qi,h,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(o,h,1),t.grid.set(o,(h+1)%t.Hi,1)):(t.grid.set((o+1)%t.qi,(h+1)%t.Hi,1),t.grid.set((o-1+t.qi)%t.qi,(h+1)%t.Hi,1),t.grid.set((o-1+t.qi)%t.qi,(h-1+t.Hi)%t.Hi,1),t.grid.set((o+1)%t.qi,(h-1+t.Hi)%t.Hi,1))}))}(ct),ot(ct),ut(ct),function(t){document.getElementById("gridPeriodicityShiftX").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.zi=e,_(t)})),document.getElementById("gridPeriodicityShiftY").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t._i=e,_(t)})),document.getElementById("gridFlipX").addEventListener("change",(function(){t.Ji=this.checked,_(t)})),document.getElementById("gridFlipY").addEventListener("change",(function(){t.Ki=this.checked,_(t)}))}(ct),function(t){document.getElementById("timeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(ct),function(t){document.getElementById("colorPalette").addEventListener("change",(function(){t.Xi=this.value,L(t)}))}(ct),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.Pi=this.value,J(t)}))}(ct),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.Ai=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.Oi=!0}))}(ct),function(t){Object.keys(t).forEach((e=>{let i=localStorage.getItem(e);null!==i&&("boolean"==typeof t[e]?t[e]="true"===i:"number"==typeof t[e]?t[e]=parseFloat(i):t[e]=i)}))}(ct),function(t){Object.keys(t).forEach((e=>{let i=document.getElementById(e);i&&("checkbox"===i.type?i.checked=t[e]:i.value=t[e])}))}(ct),function(t){t.canvas.width=Math.max(t.qi,t.Hi),t.canvas.height=Math.max(t.qi,t.Hi),t.an=0,t.hn=0;var e=document.getElementById("gameCanvas");if(t.qi>t.Hi){var i=Math.floor(t.Hi/t.qi*800);e.style.width=i+"px",e.style.height="800px",e.width=i*t.qi/800,e.height=t.qi}else{var n=Math.floor(t.qi/t.Hi*800);e.style.width="800px",e.style.height=n+"px",e.width=t.Hi,e.height=n*t.Hi/800}t.en=t.tn.createImageData(t.Hi,t.qi)}(ct),L(ct),_(ct),J(ct),ht(ct).then((()=>{st(ct)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
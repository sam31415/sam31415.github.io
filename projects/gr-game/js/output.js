(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),r=Object.values(t).reduce(((t,r,s)=>[...t,r/e+(t[s-1]||0)]),[]);return function(){let e=Math.random(),s=r.findIndex((t=>e<t));return Object.keys(t)[s]}}const e=[11,44];function r(t,e,r,s,n,i,a,o,h){const u=s.height-1,l=s.width-1,c=s.data,m=s.width;var f=n[0],d=n[1];let g;for(var M=-1;M<=1;M++)for(var p=-1;p<=1;p++){if(0==M&&0==p)continue;if(i[0]=((-1===M?1:M)+(-1===p?1:p))%2,i[2+(3&a)]=-1==M?1:0,i[(1+a)%4+1]=-1==p?1:0,i[(2+a)%4+1]=1==M?1:0,i[(3+a)%4+1]=1==p?1:0,0==e||0==r||e==u||r==l)var[S,b]=t.t(t,e,r,M,p);else var S=e+M,b=r+p;const s=c[S*m+b],n=s%o,v=Math.floor(s/o)%h;g=o;for(var w=0;w<o-1;w++)n==w+1&&(f[w]+=1,f[g+w]+=i[0],g+=o,f[g+w]+=1-i[0],f[o+g+w]+=i[1],g+=o,f[g+w]+=1-i[1],f[o+g+w]+=i[2],g+=o,f[g+w]+=1-i[2],f[o+g+w]+=i[3],g+=o,f[g+w]+=1-i[3],f[o+g+w]+=i[4],g+=o,f[g+w]+=1-i[4]),g=o;g=h;for(w=0;w<h;w++)d[w]+=1,v==w&&(d[h+w]+=i[0],g+=h,d[g+w]+=1-i[0],d[h+g+w]+=i[1],g+=h,d[g+w]+=1-i[1],d[h+g+w]+=i[2],g+=h,d[g+w]+=1-i[2],d[h+g+w]+=i[3],g+=h,d[g+w]+=1-i[3],d[h+g+w]+=i[4],g+=h,d[g+w]+=1-i[4]),g=h}return[f,d]}const s="mix",n="isotropic",i="xcross",a="vcross",o="xvcross",h="directional1",u="directional2",l="directional3",c="directional2b",m="directional",f={[s]:.2,[n]:.4,[i]:.05,[a]:.05,[o]:.05,[h]:.05,[u]:.05,[l]:.05,[c]:.05,[m]:.05};const d="A",g="C",M="E",p="B";class S{constructor(t,e,r,s,n,i=null){this.type=t,this.threshold=e,this.i=r,this.o=s,this.h=n,this.u=i,this.l=function(t,e){return t==g?function(t){return 0==t}:t==d?function(t){return t%e==0}:function(t){return!0}}(this.o,this.h),this.m=function(t,e,r){return e==M&&2==r.length?function(e){return e[r[0]][r[1]]==t}:e==p&&2==r.length?function(e){return e[r[0]][r[1]]>t}:e==M&&3==r.length?function(e){return e[r[0]][r[1]]+e[r[0]][r[2]]==t}:e==p&&3==r.length?function(e){return e[r[0]][r[1]]+e[r[0]][r[2]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(i)}test(t,e,r){var s=this.M(r);return this.m(t)&&this.l(e)&&s}name(){var t="";null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join(""));var e=this.i.join("|");return`${this.type}${this.threshold}${this.o}[${e}]${t}`}static p(t,e=4){var r=null;t.startsWith(M)?r=M:t.startsWith(p)&&(r=p);var s=t.substring(r.length),n=parseInt(s.substring(0,1)),i=null;(s=s.substring(1)).startsWith(g)?i=g:s.startsWith(d)?i=d:s.startsWith("N")&&(i="N");var a=(s=s.substring(i.length)).split("[")[1].split("]")[0].split("|").map(Number),o=null;return(s=s.split("]")[1]).length>0&&(o=s.split("").map((t=>"1"===t))),new S(r,n,a,i,e,o)}static S(e=null,r=4,f=s,b=null){const w=[M,p],v=w[Math.floor(Math.random()*w.length)],N=[g,d,"N"],B=N[Math.floor(Math.random()*N.length)];null===e&&(e={0:2/3,1:1/3});const k=t(e)(),I=function(t,e){var r=e;if(r==s){var f=Math.random();r=f<.5?n:f<.7?i:f<.9?a:m}if(r==n)return Math.floor(4*Math.random());if(r==a)return Math.floor(4*Math.random()+4);if(r==i)return Math.floor(4*Math.random()+8);if(r==o)return Math.floor(8*Math.random()+4);if(r==h)return Math.floor(4*Math.random()+12);if(r==u)return Math.floor(8*Math.random()+12);if(r==l)return Math.floor(12*Math.random()+12);if(r==c){var d=Math.floor(8*Math.random()+12);return d>=16&&(d+=4),d}return r==m?Math.floor(16*Math.random()+12):void 0}(0,f);var R=void 0;if(Math.random()<.5){R=[k,I,function(t){for(var e=4*Math.floor(t/4),r=t;r==t;)r=e+Math.floor(4*Math.random());return r}(I)]}else R=[k,I];var C=0,y=8;if(0==R[0]&&R[1]%4!=1?y=5:R[1]>4&&R[1]<=16?y=4:R[1]>16&&(y=3),C=v===p?Math.floor(Math.random()*y):Math.floor(Math.random()*y)+1,Math.random()<.2)x=null;else{var x;null==b&&(b=Math.floor(20*Math.random())+2);do{x=new Array(b).fill(0).map((()=>Math.random()<.5))}while(!x.includes(!0))}return new S(v,C,R,B,r,x)}}class b{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.v=!1,this.get=this.N,this.set=this.B}static k(t,e=!1,r=!1,s=!1){const n=t.length,i=t[0].length,a=new b(i,n);for(let e=0;e<n;e++){s&&(e=n-e-1);for(let s=0;s<i;s++)r&&(s=i-s-1),a.set(e,s,t[e][s])}return e&&a.I(),a}I(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.v?[this.N,this.B]:[this.R,this.C],this.v=!this.v}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const r=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,r)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const r=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,r)}}N(t,e){return this.data[t*this.width+e]}B(t,e,r){this.data[t*this.width+e]=r}R(t,e){return this.data[e*this.height+t]}C(t,e,r){this.data[e*this.height+t]=r}}class w{constructor(){this.A=void 0}F(t,e,r,s){throw new Error("Must override method")}G(){throw new Error("Must override method")}}class v extends w{constructor(){super(),this.P=this.U(),this.$(),this.T=0}U(){throw new Error("Must override method")}$(){this.V=Object.keys(this.P).map((t=>this.P[t].mask));let e=Object.keys(this.P).map((t=>this.P[t].X));this.Y=t(e)}}class N extends v{constructor(){super(),this.A=4}F(t,e,r,s){var n=t%4;return 1==n||3==n?e=2:2==n?e=0:0==n&&2==r[0][0]?e=1:0==n&&r[0][0]>2&&(e=3),e}G(){return"BB"}U(){return{random:{X:15,mask:null},W:{X:4,mask:b.k([[1,1],[1,1]])},O:{X:4,mask:new b([[1,0,1],[0,0,0],[1,0,1]])},H:{X:2,mask:b.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},j:{X:2,mask:b.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},L:{X:2,mask:b.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},D:{X:2,mask:b.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class B extends v{constructor(){super(),this.A=4,this.T=-1}F(t,e,r,s){var n=t%4;return 3==n&&(n=0),1==n?e=2:2==n||3==n?e=0:0!=n&&3!=n||2!=r[0][0]?0==n&&r[0][0]>2&&(e=3):e=1,e}G(){return"TBB"}U(){return{random:{X:15,mask:null},L:{X:1,mask:b.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},H:{X:2,mask:b.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},j:{X:2,mask:b.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},W:{X:4,mask:b.k([[1,1],[1,1]])},q:{X:1e4,mask:b.k([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class k extends v{constructor(){super(),this.A=4,this.T=-1}F(t,e,r,s){var n=t%4;return 1==n&&(r[0][0]<3||r[0][0]>5)?e=2:2==n?e=3:3==n?e=0:0==n&&2==r[0][0]&&(e=1),e}G(){return"SW"}U(){let t=.2;return{random:{X:6,mask:null},J:{X:1,mask:b.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},K:{X:t,mask:b.k([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},Z:{X:t,mask:b.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},_:{X:t,mask:b.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{X:t,mask:b.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{X:t,mask:b.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},rt:{X:t,mask:b.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},st:{X:t,mask:b.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},nt:{X:t,mask:b.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},it:{X:t,mask:b.k([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ot:{X:t,mask:b.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ht:{X:t,mask:b.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{X:t,mask:b.k([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{X:t,mask:b.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{X:t,mask:b.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{X:t,mask:b.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},dt:{X:t,mask:b.k([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},O:{X:2,mask:b.k([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class I extends v{constructor(t){super(),null==t&&(t=I.gt()),this.Mt(t)}F(t,e,r,s){var n=t%this.A;return 1==n&&this.St.includes(r[0][this.bt])?e=1:n>0&&n<this.A-1?e+=1:n==this.A-1?e=0:0==n&&this.wt.includes(r[0][this.bt])?e=1:0==n&&this.vt.includes(r[0][this.bt])&&(e=this.A-1),e}Mt(t){this.Nt=t;const e=this.Nt.split("/");for(var r of(this.bt=0,this.vt=[],e))"N"==r[0]?this.bt=Number(e[0].substring(1)):"B"==r[0]?this.wt=new Uint8Array(r.substring(1).split("").map(Number)):"S"==r[0]?this.St=new Uint8Array(r.substring(1).split("").map(Number)):"I"==r[0]?this.vt=new Uint8Array(e[2].substring(1).split("").map(Number)):this.A=Number(r)}static gt(t){let e=Math.floor(10*Math.random())+3;null==t&&(t=Math.floor(5*Math.random()*e));let r=Math.floor(t/e)%5;var s=8;[1,2].includes(r)?s=4:3==r?s=3:4==r&&(s=5);let n=C.Bt(1,s);0==n.length&&(n=[2]);let i=C.Bt(1,s),a=C.Bt(1,s);return a=a.filter((t=>!n.includes(t)&&!i.includes(t)&&2!=t)),`N${t}/B${n.join("")}/S${i.join("")}/I${a.join("")}/${e}`}static Bt(t,e){let r=[];for(let s=t;s<=e;s++)Math.random()<.5&&r.push(s);return r}G(){return this.Nt}U(){return{random:{X:1,mask:null}}}}class R extends I{constructor(t,e=null){if(super(t),"ships"==e){let t=R.gt(0);this.Mt(t);let e=Array.from(this.wt).indexOf(1);if(-1!==e){let t=new Uint8Array(this.wt.length-1);t.set(this.wt.subarray(0,e),0),t.set(this.wt.subarray(e+1),e),this.wt=t}if(-1===this.wt.indexOf(2)){let t=new Uint8Array(this.wt.length+1);t[0]=2,t.set(this.wt,1),this.wt=t}if(e=Array.from(this.St).indexOf(1),-1!==e){let t=new Uint8Array(this.St.length-1);t.set(this.St.subarray(0,e),0),t.set(this.St.subarray(e+1),e),this.St=t}this.vt=this.vt.filter((t=>!this.wt.includes(t)&&!this.St.includes(t)&&2!=t)),this.Nt=`N${this.bt}/B${this.wt.join("")}/S${this.St.join("")}/I${this.vt.join("")}/${this.A}`,this.kt=1,this.T=.5}else this.kt=20/this.wt[0]**3,this.T=1}F(t,e,r,s,n){var i=t%this.A;return 1==i&&this.St.includes(r[0][this.bt])?e=1:i>0&&i<this.A-1?e+=1:i==this.A-1?e=0:0==i&&this.wt.includes(r[0][this.bt])&&Math.random()>this.kt*n-.01?e=1:0==i&&this.vt.includes(r[0][this.bt])&&(e=this.A-1),e}}class C extends I{constructor(t=!0){t?super(C.It()):(super(C.gt()),this.T=0)}static It(){let e=t({Rt:5,Ct:1,yt:1,xt:1,At:1,Ft:1,Gt:1,Pt:1,Ut:1,$t:1,Tt:1,Vt:1,Xt:1,Yt:1,Et:1,Wt:1,Ot:1,Ht:1,jt:1,Lt:1,Dt:3,qt:1,zt:1,Jt:1,Kt:1,Qt:1,Zt:1,_t:1,te:1,ee:1,re:1,se:10,ne:3,ie:1,ae:1,oe:1,he:1,ue:1,le:1,ce:1,me:1,fe:1,de:1,ge:1,Me:1,pe:1,Se:1,be:1,we:1,ve:1,Ne:1,Be:1,ke:1,Ie:1,Re:1,Ce:1,ye:1,xe:1,Ae:1,Fe:1,Ge:1,Pe:1,Ue:1,$e:1,Te:1,Ve:1,Xe:1,Ye:1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}U(){return{random:{X:1,mask:null}}}}class y extends I{constructor(){super("B24/S34/I15678/4"),this.T=0}G(){return"FS"}U(){let t=.2;return{random:{X:20,mask:null},Ee:{X:1,mask:b.k([[1,1],[1,1]])},We:{X:t,mask:b.k([[1,1]])},Oe:{X:1,mask:b.k([[1,0],[1,1]])},He:{X:t,mask:b.k([[1,1],[2,2]])},je:{X:1,mask:b.k([[0,1,0],[1,1,1],[0,1,0]])},Le:{X:1,mask:b.k([[1,0,1],[0,0,0],[1,0,1]])},De:{X:t,mask:b.k([[1,0,0],[1,1,0],[0,1,1]])},qe:{X:t,mask:b.k([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},ze:{X:1,mask:b.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Je:{X:1,mask:b.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Ke:{X:1,mask:b.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Qe:{X:t,mask:b.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Ze:{X:t,mask:b.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},_e:{X:t,mask:b.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class x extends I{constructor(){super("B2/S245678/I1/4"),this.T=0}G(){return"SS"}U(){let t=.2;return{random:{X:10,mask:null},Ee:{X:1,mask:b.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},We:{X:t,mask:b.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},He:{X:t,mask:b.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},De:{X:t,mask:b.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},qe:{X:t,mask:b.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Qe:{X:t,mask:b.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},Ze:{X:t,mask:b.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},ze:{X:1,mask:b.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},_e:{X:t,mask:b.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},tr:{X:t,mask:b.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Je:{X:1,mask:b.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},er:{X:1,mask:b.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},rr:{X:1,mask:b.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class A extends v{constructor(){super(),this.A=4,this.T=.4}F(t,e,r,s){var n=t%4,i=r[0][0]+r[0][2];return 1!=n&&3!=n||!(i<2||i>3)?1!=n&&3!=n||2!=i&&3!=i?0!=n&&2!=n||3!=i?2==n&&(e=0):e=3:e=1:e=2,e}U(){return{sr:{X:1,mask:null}}}G(){return"CW"}}class F extends w{constructor(t,e,r,s,n){super(),this.nr=e,this.ir=t,this.A=this.nr,this.ar=r,this.hr=s,this.ur=n}F(t,e,r,s){e=0;for(let n=0;n<this.ir.length;n++)if(this.ir[n].test(r,t,s)){e=(n+1)%this.nr;break}return e}G(){return this.ir.map((t=>t.name())).join("||")}static lr(e=null,r=null,s=null,n=4,i=4,a=null){var o=[];null==e&&(e=Math.floor(8*Math.random())+2),null==s&&(s=t(f)()),null==a&&(a=this.cr());for(let t=0;t<e;t++)o.push(S.S(r,n,s,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+s+": "+o.map((t=>t.name())).join(", ")),new F(o,i,r,s,a)}static cr(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static mr(t,e=4){var r=t.split("||").map((t=>S.p(t)));return new F(r,e,null,s,null)}dr(t=null){var e,r=this.ir.length;null==t&&(t=this.ar),0==(e=2==r?Math.floor(2*Math.random())+1:10==r?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.gr():1==e?this.Mr(t):this.pr(t)}pr(t){var e=this.ir.slice();e.push(S.S(t,4,this.hr,this.ur)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.hr+": "+e.map((t=>t.name())).join("||")),this.ir=e}gr(){var t=this.ir.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.ir=t}Mr(t){var e=this.ir.slice(),r=Math.floor(Math.random()*e.length);e[r]=S.S(t,4,this.hr,this.ur),console.log((new Date).toLocaleTimeString()+" Changing condition "+r+" to "+this.hr+": "+e.map((t=>t.name())).join("||")),this.ir=e}}const G="gr",P="safe",U="mix",$="general",T="test";class V{Sr;br;F;wr(){throw new Error("Must override method")}vr(){return function(t,e,r,s,n){e=this.br[0].F(t%this.br[0].A,e,r,s,n);var i=this.br[0].A;for(let n=1;n<this.br.length;n++)e+=i*this.br[n].F(Math.floor(t/i)%this.br[n].A,e,r,s),e%=i*=this.br[n].A;return e%i}}Nr(){throw new Error("Must override method")}G(){return this.br.map((t=>t.G())).join("-")}}class X extends V{constructor(t){super(),this.Br=t,this.Sr=1,this.br=this.wr(),this.F=this.vr()}wr(){var t=[];return"Original"==this.Br?t.push(new B):"StarWars"==this.Br?t.push(new k):"Modified"==this.Br?t.push(new N):"Conway"==this.Br?t.push(new A):t.push(new I(this.Br)),t}Nr(){}}class Y extends V{constructor(t,e,r=null){super(),this.Br=t,this.ar=e,this.ur=null,this.kr=null,null==e&&(t==P||t==G||t==T?this.ar={0:1,1:0}:t==U?(Math.random()<.5?this.ar={0:.8,1:.2}:this.ar={0:1,1:0},this.ar={0:.8,1:.2}):this.ar={0:.5,1:.5}),t==G&&(this.ur=1),this.Sr=4,this.br=null==r?this.wr():this.Ir(r),this.F=this.vr()}Rr=[{Cr:R,yr:[null,"ships"],weight:2},{Cr:R,yr:[],weight:2},{Cr:C,yr:[],weight:2},{Cr:N,yr:[],weight:4},{Cr:B,yr:[],weight:1},{Cr:k,yr:[],weight:1},{Cr:x,yr:[],weight:1},{Cr:y,yr:[],weight:1},{Cr:A,yr:[],weight:1}];Ar=[{Cr:N,yr:[],weight:1}];wr(){let t=this.Rr;this.Br==G&&(t=this.Ar);let e=t.reduce(((t,e)=>t+e.weight),0);var r=[];let s=Math.random()*e;for(let e=0;e<t.length;e++){if(s<t[e].weight){r.push(new t[e].Cr(...t[e].yr));break}s-=t[e].weight}return r.push(F.lr(null,this.ar,this.kr,r[0].A,4,this.ur)),this.Br==T&&((r=[]).push(new R(null,"ships")),this.Sr=r[0].A,r.push(F.lr(null,this.ar,this.kr,4,4,this.ur))),r}Nr(){this.br[1]&&"function"==typeof this.br[1].dr&&this.br[1].dr(this.ar)}Ir(t){var e=[],[r,s]=t.split("-");return"BB"==r?e.push(new N):"TBB"==r?e.push(new B):"SW"==r?e.push(new k):"SS"==r?e.push(new x):"FS"==r?e.push(new y):"CW"==r?e.push(new A):e.push(new I(r)),e.push(F.mr(s)),e}}class E extends V{constructor(t,e,r=null){super(),this.Br=t,this.ar=e,this.ur=null,this.kr=null,null==e&&(t==P?this.ar={0:1,1:0}:t==U?(Math.random()<.5?this.ar={0:.8,1:.2}:this.ar={0:1,1:0},this.ar={0:.8,1:.2}):this.ar={0:.5,1:.5}),this.Sr=16,this.br=null==r?this.wr():this.Ir(r),this.F=this.vr()}wr(){var t=[];return t.push(new N),t.push(F.lr(null,this.ar,this.kr,4,4,this.u)),t.push(F.lr(null,this.ar,this.kr,16,4,this.u)),t}Nr(){this.br[1].dr(this.ar),this.br[2].dr(this.ar)}Ir(t){var e=[],r=t.split("-")[1];return e.push(new N),e.push(F.mr(r)),e}}function W(t,e=!1){Math.random()<Math.exp(t.Fr)||e||t.Gr?("VariableGR"==t.Cr?(t.Pr=new Y(G),t.Ur=new Y(G)):"VariableDemo"==t.Cr?t.Pr=new Y(G):"Variable"==t.Cr?t.Pr=new Y(P):"VariableMix"==t.Cr?t.Pr=new Y(U):"VariableUnsafe"==t.Cr?t.Pr=new Y($):"VariableTest"==t.Cr?t.Pr=new Y(T):"Variable2Unsafe"==t.Cr?t.Pr=new E($):"CustomRule"==t.Cr?t.Pr=new Y(null,null,t.$r):"OriginalBB"==t.Cr?t.Pr=new X("Original"):"ModifiedBB"==t.Cr?t.Pr=new X("Modified"):"StarWars"==t.Cr?t.Pr=new X("StarWars"):"Conway"==t.Cr?t.Pr=new X("Conway"):"SparseFourStates"==t.Cr?t.Pr=new X("B378/S124567/4"):t.Pr=new Y(U),t.Fr=-25,t.Tr=-25,t.Gr=!1,O(t)):(Math.random()<Math.exp(t.Tr)||t.Vr)&&"CustomRule"!=t.Cr&&(t.Pr.Nr(),"VariableGR"==t.Cr&&t.Ur.Nr(),t.Tr=-25,t.Vr=!1,O(t));let r=Math.max(t.Xr/200,1);t.Fr=t.Fr+t.Yr*r,t.Fr>0&&(t.Fr=0),t.Tr=t.Tr+t.Er*r,t.Tr>0&&(t.Tr=0)}function O(t){var e=document.getElementById("currentStyle");e&&(e.value=t.Pr.G())}function H(t){let e={};for(let r in t){if("t"==r)continue;let s=Math.floor(3*Math.random())-1,n=t[r]+s;n=Math.max(0,Math.min(255,n)),e[r]=n}return e.Wr=t.Wr,e}function j(t){var e={r:247,g:255,b:28,Wr:255},r={r:13,g:112,b:255,Wr:255},s={r:240,g:239,b:239,Wr:255},n={r:0,g:0,b:0,Wr:255},i={r:240,g:240,b:240,Wr:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Wr:255},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Wr:255};"yellow"==t.Or?(t.backgroundColor=e,t.Hr=n,t.jr=r,t.Lr=s):"blue"==t.Or?(t.backgroundColor=r,t.Hr=s,t.jr=n,t.Lr=e):"blue2"==t.Or?(t.backgroundColor=r,t.Hr=e,t.jr=n,t.Lr=s):"grey"==t.Or?(t.backgroundColor=s,t.Hr=n,t.jr=r,t.Lr=e):"grey2"==t.Or?(t.backgroundColor=s,t.Hr=e,t.jr=n,t.Lr=r):"black"==t.Or?(t.backgroundColor=n,t.Hr=r,t.jr=e,t.Lr=s):"black2"==t.Or?(t.backgroundColor=n,t.Hr=r,t.jr=s,t.Lr=e):"blackTrace"==t.Or?(t.backgroundColor=n,t.Hr=s,t.jr=n,t.Lr=s):"blackTrace2"==t.Or?(t.backgroundColor=n,t.Hr=n,t.jr=n,t.Lr=s):"blackTrace3"==t.Or?(t.backgroundColor=n,t.Hr=n,t.jr=s,t.Lr=s):"redblue"==t.Or?(t.backgroundColor=n,t.Hr=i,t.jr={r:221,g:85,b:12,Wr:255},t.Lr={r:49,g:130,b:189,Wr:255}):"variable"==t.Or?(t.backgroundColor=n,t.Hr=i,t.jr=a,t.Lr=o):"mouseAnimation"==t.Or&&(t.backgroundColor={r:0,g:0,b:0,Wr:0},t.Hr=r,t.jr=n,t.Lr=e)}function L(t,e,r,s,n){let i=(e+s+t.Dr)%t.Dr,a=(r+n+t.qr)%t.qr,o=i,h=a;return(i-e-s>0||i-e-s<0)&&(h=(t.qr-a-t.zr+t.qr)%t.qr),(a-r-n>0||a-r-n<0)&&(o=(t.Dr-i-t.Jr+t.Dr)%t.Dr),[o,h]}function D(t,e,r,s,n){let i=(e+s+t.Dr)%t.Dr,a=(r+n+t.qr)%t.qr,o=i,h=a;return(i-e-s>0||i-e-s<0)&&(h=(t.qr-a-t.zr+t.qr)%t.qr),a-r-n>0?o=(i+t.Jr+t.Dr)%t.Dr:a-r-n<0&&(o=(i-t.Jr+t.Dr)%t.Dr),[o,h]}function q(t,e,r,s,n){let i=(e+s+t.Dr)%t.Dr,a=(r+n+t.qr)%t.qr,o=i,h=a;return i-e-s>0?h=(a+t.zr+t.qr)%t.qr:i-e-s<0&&(h=(a-t.zr+t.qr)%t.qr),(a-r-n>0||a-r-n<0)&&(o=(t.Dr-i-t.Jr+t.Dr)%t.Dr),[o,h]}function z(t,e,r,s,n){let i=(e+s+t.Dr)%t.Dr,a=(r+n+t.qr)%t.qr,o=i,h=a;return i-e-s>0?h=(a+t.zr+t.qr)%t.qr:i-e-s<0&&(h=(a-t.zr+t.qr)%t.qr),a-r-n>0?o=(i+t.Jr+t.Dr)%t.Dr:a-r-n<0&&(o=(i-t.Jr+t.Dr)%t.Dr),[o,h]}function J(t){t.Kr&&t.Qr?t.t=L:t.Kr?t.t=D:t.Qr?t.t=q:t.t=z}function K(t){W(t,!0)}function Q(t,e){if(t.Zr){var r=t.Pr.br[0].G(),s=new Blob([r],{type:"text/plain"}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download="dataAutomata.txt",i.click()}}function Z(t,e,r){var s=function(t){var e=Math.exp(-t),r=1,s=0;do{s++,r*=Math.random()}while(r>e);return s-1}(10**(t._r+t.Pr.br[0].T));if(0!=s)for(var n=t.Pr.br[0].Y,i=t.Pr.br[0].V,a=0;a<s;a++){var o=Math.floor(Math.random()*t.Dr),h=Math.floor(Math.random()*t.qr);_(e,t,i[n()],o,h,r)}}function _(t,e,r,s,n,i){null===r?r=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?nt(t,t):e<.2?et(t,t):e<.3?tt(t,t):e<.4?function(t){let e=new b(t,t);for(let r=0;r<t;r++)for(let s=r;s<t;s++)e.set(r,s,Math.floor(1e5*Math.random())),e.set(s,r,e.get(r,s));return e}(t):e<.5?function(t){let e=new b(t,t);for(let r=0;r<t;r++)for(let s=r;s<t;s++)e.set(r,s,Math.floor(1e5*Math.random())),e.set(t-1-s,t-1-r,e.get(r,s));return e}(t):e<.6?rt(t,t):e<.7?st(t,t):e<.8?function(t){let e=new b(t,t);for(let r=0;r<t;r++)for(let s=Math.max(r,t-r);s<t;s++)e.set(r,s,Math.floor(1e5*Math.random())),e.set(s,r,e.get(r,s)),e.set(t-1-s,t-1-r,e.get(r,s)),e.set(t-1-r,t-1-s,e.get(r,s));return e}(t):e<.9?function(t){let e=new b(t,t);for(let r=0;r<Math.ceil(t/2);r++)for(let s=0;s<Math.ceil(t/2);s++)e.set(r,s,Math.floor(1e5*Math.random())),e.set(s,t-1-r,e.get(r,s)),e.set(t-1-r,t-1-s,e.get(r,s)),e.set(t-1-s,r,e.get(r,s));return e}(t):function(t){let e=new b(t,t);for(let r=0;r<Math.ceil(t/2);r++)for(let s=0;s<Math.ceil(t/2);s++)e.set(r,s,Math.floor(1e5*Math.random())),e.set(s,t-1-r,e.get(r,s)),e.set(t-1-r,t-1-s,e.get(r,s)),e.set(t-1-s,r,e.get(r,s)),e.set(t-1-r,s,e.get(r,s)),e.set(t-1-s,t-1-r,e.get(r,s)),e.set(r,t-1-s,e.get(r,s)),e.set(s,r,e.get(r,s));return e}(t)}(e);else{t=function(t,e){let r=Math.random();return r<.2?nt(t,e):r<.4?et(t,e):r<.6?tt(t,e):r<.8?rt(t,e):st(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&r.I(),Math.random()<.5&&r.flipX(),Math.random()<.75&&r.flipY());let a=r.height,o=r.width;for(let h=0;h<a;h++)for(let u=0;u<o;u++){let l=i(e,s,n,h-Math.floor(a/2),u-Math.floor(o/2));t.set(l[0],l[1],r.get(h,u))}}function tt(t,e){let r=new b(e,t);for(let s=0;s<t;s++)for(let t=0;t<Math.ceil(e/2);t++)r.set(s,t,Math.floor(1e5*Math.random())),r.set(s,e-1-t,r.get(s,t));return r}function et(t,e){let r=new b(e,t);for(let s=0;s<Math.ceil(t/2);s++)for(let n=0;n<e;n++)r.set(s,n,Math.floor(1e5*Math.random())),r.set(t-1-s,n,r.get(s,n));return r}function rt(t,e){let r=new b(e,t);for(let s=0;s<t;s++)for(let n=0;n<Math.ceil(e/2);n++)r.set(s,n,Math.floor(1e5*Math.random())),r.set(t-1-s,e-1-n,r.get(s,n));return r}function st(t,e){let r=new b(e,t);for(let s=0;s<Math.ceil(t/2);s++)for(let n=0;n<Math.ceil(e/2);n++)r.set(s,n,Math.floor(1e5*Math.random())),r.set(t-1-s,n,r.get(s,n)),r.set(s,e-1-n,r.get(s,n)),r.set(t-1-s,e-1-n,r.get(s,n));return r}function nt(t,e){let r=new b(e,t);for(let s=0;s<t;s++)for(let t=0;t<e;t++)r.set(s,t,Math.floor(1e5*Math.random()));return r}function it(t){!function(t){let e=t.ts,r=t.es;for(var s=0,n=0,i=0;i<t.Dr;i++)for(var a=0;a<t.qr;a++){if(0==t.rs.get(i,a))continue;s+=1;var o=Math.floor(t.grid.get(i,a)/t.Pr.Sr)%4;let e;if(0==o)e=t.backgroundColor;else if(1==o)e=t.Hr;else if(2==o)e=t.jr;else{if(3!=o)continue;e=t.Lr}let h=4*(i*t.qr+a);n+=Math.sqrt((r.data[h+0]-e.r)**2+(r.data[h+1]-e.g)**2+(r.data[h+2]-e.b)**2),r.data[h+0]=e.r,r.data[h+1]=e.g,r.data[h+2]=e.b,r.data[h+3]=e.Wr}t.ss=.8*t.ss+s/(t.Dr*t.qr)/5,t.ns=.01*s+.99*t.ns,t.Xr=.01*n/(s+t.Dr*t.qr/30)+.99*t.Xr,t.Xr>330&&(t.Gr=!0,t.ns,t.Dr,t.qr,console.log("Changing rule because suspected oscillation (std of color change: "+t.Xr.toFixed(1)+")."),t.ns=15,t.Xr=10,Q(t));t.ns<3&&(t.Gr=!0,console.log("Changing rule because not enough cells changed ("+t.ns+")."),t.ns=20,Q(t)),e.putImageData(r,t.os,t.hs)}(t),function(t){var s=[new Uint8Array(e[0]*t.Pr.br[0].A).fill(0),new Uint8Array(e[1]).fill(0)],n=new Uint8Array(5).fill(0),i=new b(t.qr,t.Dr),a=t.grid;const o=t.time,h=t.Pr.br[0].A;for(var u=0;u<t.Dr;u++)for(var l=0;l<t.qr;l++){var c=r(t,u,l,a,s,n,o,h,4);const e=t.grid.get(u,l);var m=e;m="VariableGR"!=t.Cr||0==t.mask.get(u,l)?t.Pr.F(e,m,c,t.time,t.ss):t.Ur.F(e,m,c,t.time,t.ss),Math.floor(m/t.Pr.Sr)%4!=Math.floor(e/t.Pr.Sr)%4?t.rs.set(u,l,1):t.rs.set(u,l,0),i.set(u,l,m);for(let t=0;t<s.length;t++)s[t].fill(0);n.fill(0)}t.us&&Z(t,i,t.t),t.grid=i}(t),W(t),t.time=(t.time+1)%166320,t.ls&&function(t){Math.random()<1e-4&&(t.zr=Math.floor(Math.random()*t.qr),console.log("Periodicity shift X: "+t.zr)),Math.random()<1e-4&&(t.Jr=Math.floor(Math.random()*t.Dr),console.log("Periodicity shift Y: "+t.Jr)),Math.random()<1e-4&&(t.Kr=!t.Kr,J(t),console.log("Flip X: "+t.Kr)),Math.random()<1e-4&&(t.Qr=!t.Qr,J(t),console.log("Flip Y: "+t.Qr))}(t),"variable"==t.Or&&function(t){Math.random()<1&&(t.Lr=H(t.Lr),t.jr=H(t.jr))}(t),setTimeout((function(){requestAnimationFrame((()=>it(t)))}),t.timeout)}function at(t,e){return console.log("Attempting to load image"),(r="grLogoLarge.png",console.log("Loading image:",r),new Promise(((t,e)=>{const s=new Image;s.onload=()=>{console.log("Image loaded:",r);const e=document.createElement("canvas");e.width=s.width,e.height=s.height;const n=e.getContext("2d");n.drawImage(s,0,0,s.width,s.height);const i=n.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<s.height;t++){const e=[];for(let r=0;r<s.width;r++){const n=4*(t*s.width+r),a=(i[n]+i[n+1]+i[n+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},s.onerror=()=>{console.error("Error loading image:",r),e(new Error("Error loading image"))},s.src=r}))).then((e=>{new b(t.qr,t.Dr);const r=new b(t.qr,t.Dr),s=e[0].length/t.qr,n=e.length/t.Dr,i=Math.max(s,n),a=Math.floor((t.qr-e[0].length/i)/2),o=Math.floor((t.Dr-e.length/i)/2);for(let s=0;s<t.Dr;s++)for(let n=0;n<t.qr;n++){if(s<o||(s-o)*i>=e.length){r.set(s,n,1);continue}let t=Math.floor((n-a)*i);0===e[Math.floor((s-o)*i)][t]?r.set(s,n,0):r.set(s,n,1)}t.mask=r})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new b(t.qr,t.Dr)}));var r}async function ot(t,e){if("VariableGR"==t.Cr&&await at(t),"zero"!=t.cs)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new b(t.qr,t.Dr),t.rs=new b(t.qr,t.Dr);for(var r=0;r<t.Dr;r++)for(var s=0;s<t.qr;s++)if("gr"!=t.cs||1!==t.mask.get(r,s)){for(var n=Math.random(),i=0;i<e;i++)if(n<(i+1)/(e+1)){t.grid.set(r,s,i);break}t.rs.set(r,s,1)}else t.grid.set(r,s,0)}))}(t);t.grid=new Grid(t.qr,t.Dr),t.rs=new Grid(t.qr,t.Dr)}function ht(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){var e=document.getElementById("userGridHeight").value,r=document.getElementById("userGridWidth").value,s=document.getElementById("userTimeout").value,n=document.getElementById("userXShift"),i=n?n.value:t.fs,a=document.getElementById("userYShift"),o=a?a.value:t.ds,h=document.getElementById("userFlipX"),u=h?h.checked:t.gs,l=document.getElementById("userFlipY"),c=l?l.checked:t.Ms,m=document.getElementById("randomnessCheckbox"),f=m?m.checked:t.us,d=document.getElementById("randomnessSlider"),g=d?parseFloat(d.value):t._r,M=document.getElementById("userColorPalette").value,p=document.getElementById("metaRule").value,S=null;document.getElementById("currentStyle")&&(S=document.getElementById("currentStyle").value),localStorage.setItem("userGridHeight",e),localStorage.setItem("userGridWidth",r),localStorage.setItem("userTimeout",s),localStorage.setItem("userXShift",i),localStorage.setItem("userYShift",o),localStorage.setItem("userFlipX",u),localStorage.setItem("userFlipY",c),localStorage.setItem("userColorPalette",M),localStorage.setItem("userRandomnessOn",f),localStorage.setItem("userRandomnessAmount",g),localStorage.setItem("metaRule",p),localStorage.setItem("currentStyle",S),location.reload()}(t)}))}function ut(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t._r=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var lt=document.getElementById("gameCanvas"),ct=lt.getContext("2d"),mt=128,ft=128,dt=20,gt=!0,Mt=-1,pt=!0,St=0,bt=0,wt=!1,vt=!1,Nt="black2",Bt="VariableGR",kt="random",It=6,Rt=new class{constructor(t,e,r=200,s=200,n=20,i=!0,a=-2,o=!0,h=0,u=0,l=!1,c=!1,m="black2",f="VariableGR",d="random",g=6,M=2e4,p=2e3){this.Dr=r,this.qr=s,this.os=0,this.hs=0,this.timeout=n,this.grid=null,this.rs=null,this.es=null,this.canvas=t,this.ts=e,this.us=i,this._r=a,this.ls=o,this.zr=h,this.Jr=u,this.Kr=l,this.Qr=c,this.Or=m,this.Cr=f,this.cs=d,this.ps=g,this.Ss=null,this.bs=null,this.t=null,this.mask=null,this.ws=M,this.vs=p,this.Fr=-25,this.Tr=-25,this.Yr=25/this.ws,this.Er=25/this.vs,this.canvas.width=this.qr,this.canvas.height=this.Dr,this.es=e.createImageData(t.width,t.height),this.Gr=!0,this.Vr=!1,this.ss=0,this.ns=0,this.Xr=0,this.Zr=!1,this.time=0}}(lt,ct,mt,ft,dt,gt,Mt,pt,St,bt,wt,vt,Nt,Bt,kt,It);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.us=this.checked}))}(Rt),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(Rt),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var r=t.canvas.getBoundingClientRect(),s=e.clientX-r.left,n=e.clientY-r.top,i=r.width/t.qr,a=r.height/t.Dr,o=Math.floor(s/i),h=Math.floor(n/a);t.grid.set(h,o,1)}}))}(Rt),function(t){t.canvas.addEventListener("mousedown",(function(e){var r=t.canvas.getBoundingClientRect(),s=e.clientX-r.left,n=e.clientY-r.top,i=r.width/t.qr,a=r.height/t.Dr,o=Math.floor(s/i),h=Math.floor(n/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(h,(o+1)%t.qr,1),t.grid.set(h,o,1),t.grid.set((h+1)%t.Dr,o,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(h,o,1),t.grid.set((h+1)%t.Dr,o,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(h,o,1),t.grid.set(h,(o+1)%t.qr,1)):(t.grid.set((h+1)%t.Dr,(o+1)%t.qr,1),t.grid.set((h-1+t.Dr)%t.Dr,(o+1)%t.qr,1),t.grid.set((h-1+t.Dr)%t.Dr,(o-1+t.qr)%t.qr,1),t.grid.set((h+1)%t.Dr,(o-1+t.qr)%t.qr,1))}))}(Rt),ht(Rt),ut(Rt),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.zr=e,J(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.Jr=e,J(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.Kr=this.checked,J(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.Qr=this.checked,J(t)}))}(Rt),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(Rt),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.Or=this.value,j(t)}))}(Rt),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.Cr=this.value,K(t)}))}(Rt),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.Gr=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.Vr=!0}))}(Rt),function(t){null!==localStorage.getItem("userGridHeight")?(t.Dr=parseInt(localStorage.getItem("userGridHeight")),t.qr=parseInt(localStorage.getItem("userGridWidth")),t.Dr>1e3&&(t.Dr=1e3),t.qr>1e3&&(t.qr=1e3),t.es=t.ts.createImageData(t.qr,t.Dr),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.zr=parseInt(localStorage.getItem("userXShift")),isNaN(t.zr)&&(t.zr=0),isNaN(t.Jr)&&(t.Jr=0),t.Jr=parseInt(localStorage.getItem("userYShift")),t.Kr="true"===localStorage.getItem("userFlipX"),t.Qr="true"===localStorage.getItem("userFlipY"),t.Or=localStorage.getItem("userColorPalette"),t.us="true"===localStorage.getItem("userRandomnessOn"),t._r=parseFloat(localStorage.getItem("userRandomnessAmount")),t.Cr=localStorage.getItem("metaRule"),t.$r=localStorage.getItem("currentStyle"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.Dr,document.getElementById("userGridWidth").value=t.qr,document.getElementById("userTimeout").value=t.timeout;let e=document.getElementById("userXShift");e&&(e.value=t.zr);let r=document.getElementById("userYShift");r&&(r.value=t.Jr);let s=document.getElementById("userFlipX");s&&(s.checked=t.Kr);let n=document.getElementById("userFlipY");n&&(n.checked=t.Qr);let i=document.getElementById("randomnessCheckbox");i&&(i.checked=t.us);let a=document.getElementById("randomnessSlider");a&&(a.value=t._r),document.getElementById("userColorPalette").value=t.Or,document.getElementById("metaRule").value=t.Cr,t.canvas.width=Math.max(t.Dr,t.qr),t.canvas.height=Math.max(t.Dr,t.qr),t.os=0,t.hs=0;var o=document.getElementById("gameCanvas");if(t.Dr>t.qr){var h=Math.floor(t.qr/t.Dr*800);o.style.width=h+"px",o.style.height="800px",o.width=h*t.Dr/800,o.height=t.Dr}else{var u=Math.floor(t.Dr/t.qr*800);o.style.width="800px",o.style.height=u+"px",o.width=t.qr,o.height=u*t.qr/800}}(Rt),j(Rt),J(Rt),K(Rt),ot(Rt).then((()=>{it(Rt)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
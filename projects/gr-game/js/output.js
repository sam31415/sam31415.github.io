(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),i=Object.values(t).reduce(((t,i,r)=>[...t,i/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=i.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[11,44];function i(t,e,i,r,o,n,a,s,l){const h=r.height-1,d=r.width-1,g=r.data,u=r.width;var c=o[0],m=o[1];let f;for(var p=-1;p<=1;p++)for(var b=-1;b<=1;b++){if(0==p&&0==b)continue;if(n[0]=((-1===p?1:p)+(-1===b?1:b))%2,n[2+(3&a)]=-1==p?1:0,n[(1+a)%4+1]=-1==b?1:0,n[(2+a)%4+1]=1==p?1:0,n[(3+a)%4+1]=1==b?1:0,0==e||0==i||e==h||i==d)var[v,y]=t.findNeighbour(t,e,i,p,b);else var v=e+p,y=i+b;const r=g[v*u+y],o=r%s,S=Math.floor(r/s)%l;f=s;for(var C=0;C<s-1;C++)o==C+1&&(c[C]+=1,c[f+C]+=n[0],f+=s,c[f+C]+=1-n[0],c[s+f+C]+=n[1],f+=s,c[f+C]+=1-n[1],c[s+f+C]+=n[2],f+=s,c[f+C]+=1-n[2],c[s+f+C]+=n[3],f+=s,c[f+C]+=1-n[3],c[s+f+C]+=n[4],f+=s,c[f+C]+=1-n[4]),f=s;f=l;for(C=0;C<l;C++)m[C]+=1,S==C&&(m[l+C]+=n[0],f+=l,m[f+C]+=1-n[0],m[l+f+C]+=n[1],f+=l,m[f+C]+=1-n[1],m[l+f+C]+=n[2],f+=l,m[f+C]+=1-n[2],m[l+f+C]+=n[3],f+=l,m[f+C]+=1-n[3],m[l+f+C]+=n[4],f+=l,m[f+C]+=1-n[4]),f=l}return[c,m]}const r="mix",o="isotropic",n="xcross",a="vcross",s="xvcross",l="directional1",h="directional2",d="directional3",g="directional2b",u="directional",c={[r]:.2,[o]:.4,[n]:.05,[a]:.05,[s]:.05,[l]:.05,[h]:.05,[d]:.05,[g]:.05,[u]:.05};const m="A",f="C",p="E",b="B";class v{constructor(t,e,i,r,o,n=null){this.type=t,this.threshold=e,this.neighbourType=i,this.inactivation=r,this.modulo=o,this.periodicity=n,this.testInactive=function(t,e){return t==f?function(t){return 0==t}:t==m?function(t){return t%e==0}:function(t){return!0}}(this.inactivation,this.modulo),this.testValue=function(t,e,i){return e==p&&2==i.length?function(e){return e[i[0]][i[1]]==t}:e==b&&2==i.length?function(e){return e[i[0]][i[1]]>t}:e==p&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]==t}:e==b&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]>t}:void 0}(this.threshold,this.type,this.neighbourType),this.testPeriodicity=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(n)}test(t,e,i){var r=this.testPeriodicity(i);return this.testValue(t)&&this.testInactive(e)&&r}name(){var t="";null!=this.periodicity&&(t=this.periodicity.map((t=>t?"1":"0")).join(""));var e=this.neighbourType.join("|");return`${this.type}${this.threshold}${this.inactivation}[${e}]${t}`}static fromName(t,e=4){var i=null;t.startsWith(p)?i=p:t.startsWith(b)&&(i=b);var r=t.substring(i.length),o=parseInt(r.substring(0,1)),n=null;(r=r.substring(1)).startsWith(f)?n=f:r.startsWith(m)?n=m:r.startsWith("N")&&(n="N");var a=(r=r.substring(n.length)).split("[")[1].split("]")[0].split("|").map(Number),s=null;return(r=r.split("]")[1]).length>0&&(s=r.split("").map((t=>"1"===t))),new v(i,o,a,n,e,s)}static randomSample(e=null,i=4,c=r,y=null){const C=[p,b],S=C[Math.floor(Math.random()*C.length)],M=[f,m,"N"],w=M[Math.floor(Math.random()*M.length)];null===e&&(e={0:2/3,1:1/3});const B=t(e)(),k=function(t,e){var i=e;if(i==r){var c=Math.random();i=c<.5?o:c<.7?n:c<.9?a:u}if(i==o)return Math.floor(4*Math.random());if(i==a)return Math.floor(4*Math.random()+4);if(i==n)return Math.floor(4*Math.random()+8);if(i==s)return Math.floor(8*Math.random()+4);if(i==l)return Math.floor(4*Math.random()+12);if(i==h)return Math.floor(8*Math.random()+12);if(i==d)return Math.floor(12*Math.random()+12);if(i==g){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return i==u?Math.floor(16*Math.random()+12):void 0}(0,c);var R=void 0;if(Math.random()<.5){R=[B,k,function(t){for(var e=4*Math.floor(t/4),i=t;i==t;)i=e+Math.floor(4*Math.random());return i}(k)]}else R=[B,k];var N=0,I=8;if(0==R[0]&&R[1]%4!=1?I=5:R[1]>4&&R[1]<=16?I=4:R[1]>16&&(I=3),N=S===b?Math.floor(Math.random()*I):Math.floor(Math.random()*I)+1,Math.random()<.2)A=null;else{var A;null==y&&(y=Math.floor(20*Math.random())+2);do{A=new Array(y).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new v(S,N,R,w,i,A)}}class y{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.transposed=!1,this.get=this.getNormal,this.set=this.setNormal}static fromArray(t,e=!1,i=!1,r=!1){const o=t.length,n=t[0].length,a=new y(n,o);for(let e=0;e<o;e++){r&&(e=o-e-1);for(let r=0;r<n;r++)i&&(r=n-r-1),a.set(e,r,t[e][r])}return e&&a.transpose(),a}transpose(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.transposed?[this.getNormal,this.setNormal]:[this.getTransposed,this.setTransposed],this.transposed=!this.transposed}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const i=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,i)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const i=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,i)}}getNormal(t,e){return this.data[t*this.width+e]}setNormal(t,e,i){this.data[t*this.width+e]=i}getTransposed(t,e){return this.data[e*this.height+t]}setTransposed(t,e,i){this.data[e*this.height+t]=i}}class C{constructor(){this.nStates=void 0}updateRule(t,e,i,r){throw new Error("Must override method")}getName(){throw new Error("Must override method")}}class S extends C{constructor(){super(),this.seedingPatterns=this.getSeedingPatterns(),this.constructSeedingSampler(),this.randomnessLogShift=0}getSeedingPatterns(){throw new Error("Must override method")}constructSeedingSampler(){this.seedMasks=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].mask));let e=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].prob));this.seedSampler=t(e)}}class M extends S{constructor(){super(),this.nStates=4}updateRule(t,e,i,r){var o=t%4;return 1==o||3==o?e=2:2==o?e=0:0==o&&2==i[0][0]?e=1:0==o&&i[0][0]>2&&(e=3),e}getName(){return"BB"}getSeedingPatterns(){return{random:{prob:15,mask:null},waveSquare:{prob:4,mask:y.fromArray([[1,1],[1,1]])},star:{prob:4,mask:new y([[1,0,1],[0,0,0],[1,0,1]])},oscillator0:{prob:2,mask:y.fromArray([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},oscillator1:{prob:2,mask:y.fromArray([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},snakeHoriz:{prob:2,mask:y.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},snakeVert:{prob:2,mask:y.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class w extends S{constructor(){super(),this.nStates=4,this.randomnessLogShift=-1}updateRule(t,e,i,r){var o=t%4;return 3==o&&(o=0),1==o?e=2:2==o||3==o?e=0:0!=o&&3!=o||2!=i[0][0]?0==o&&i[0][0]>2&&(e=3):e=1,e}getName(){return"TBB"}getSeedingPatterns(){return{random:{prob:15,mask:null},snakeHoriz:{prob:1,mask:y.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},oscillator0:{prob:2,mask:y.fromArray([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},oscillator1:{prob:2,mask:y.fromArray([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},waveSquare:{prob:4,mask:y.fromArray([[1,1],[1,1]])},butterflyGun:{prob:1e4,mask:y.fromArray([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class B extends S{constructor(){super(),this.nStates=4,this.randomnessLogShift=-1}updateRule(t,e,i,r){var o=t%4;return 1==o&&(i[0][0]<3||i[0][0]>5)?e=2:2==o?e=3:3==o?e=0:0==o&&2==i[0][0]&&(e=1),e}getName(){return"SW"}getSeedingPatterns(){let t=.2;return{random:{prob:6,mask:null},snake:{prob:1,mask:y.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},gun0:{prob:t,mask:y.fromArray([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},gun1:{prob:t,mask:y.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},gun2:{prob:t,mask:y.fromArray([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},gun3:{prob:t,mask:y.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},gun4:{prob:t,mask:y.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},gun5:{prob:t,mask:y.fromArray([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},gun6:{prob:t,mask:y.fromArray([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},gun7:{prob:t,mask:y.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},gun8:{prob:t,mask:y.fromArray([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},gun9:{prob:t,mask:y.fromArray([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},gun10:{prob:t,mask:y.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},gun11:{prob:t,mask:y.fromArray([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},gun12:{prob:t,mask:y.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},gun13:{prob:t,mask:y.fromArray([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},gun14:{prob:t,mask:y.fromArray([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},gun15:{prob:t,mask:y.fromArray([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},star:{prob:2,mask:y.fromArray([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class k extends S{constructor(t){super(),null==t&&(t=k.generateRule()),this.initialiseRule(t)}updateRule(t,e,i,r){var o=t%this.nStates;return 1==o&&this.survive.includes(i[0][this.neighbourhood])?e=1:o>0&&o<this.nStates-1?e+=1:o==this.nStates-1?e=0:0==o&&this.birth.includes(i[0][this.neighbourhood])?e=1:0==o&&this.inhibited.includes(i[0][this.neighbourhood])&&(e=this.nStates-1),e}initialiseRule(t){this.ruleString=t;const e=this.ruleString.split("/");for(var i of(this.neighbourhood=0,this.inhibited=[],e))"N"==i[0]?this.neighbourhood=Number(e[0].substring(1)):"B"==i[0]?this.birth=new Uint8Array(i.substring(1).split("").map(Number)):"S"==i[0]?this.survive=new Uint8Array(i.substring(1).split("").map(Number)):"I"==i[0]?this.inhibited=new Uint8Array(e[2].substring(1).split("").map(Number)):this.nStates=Number(i)}static generateRule(t){let e=Math.floor(10*Math.random())+3;null==t&&(t=Math.floor(5*Math.random()*e));let i=Math.floor(t/e)%5;var r=8;[1,2].includes(i)?r=4:3==i?r=3:4==i&&(r=5);let o=N.generateRandomArray(1,r);0==o.length&&(o=[2]);let n=N.generateRandomArray(1,r),a=N.generateRandomArray(1,r);return a=a.filter((t=>!o.includes(t)&&!n.includes(t)&&2!=t)),`N${t}/B${o.join("")}/S${n.join("")}/I${a.join("")}/${e}`}static generateRandomArray(t,e){let i=[];for(let r=t;r<=e;r++)Math.random()<.5&&i.push(r);return i}getName(){return this.ruleString}getSeedingPatterns(){return{random:{prob:1,mask:null}}}}class R extends k{constructor(t,e=null){if(super(t),"ships"==e){let t=R.generateRule(0);this.initialiseRule(t);let e=Array.from(this.birth).indexOf(1);if(-1!==e){let t=new Uint8Array(this.birth.length-1);t.set(this.birth.subarray(0,e),0),t.set(this.birth.subarray(e+1),e),this.birth=t}if(-1===this.birth.indexOf(2)){let t=new Uint8Array(this.birth.length+1);t[0]=2,t.set(this.birth,1),this.birth=t}if(e=Array.from(this.survive).indexOf(1),-1!==e){let t=new Uint8Array(this.survive.length-1);t.set(this.survive.subarray(0,e),0),t.set(this.survive.subarray(e+1),e),this.survive=t}this.inhibited=this.inhibited.filter((t=>!this.birth.includes(t)&&!this.survive.includes(t)&&2!=t)),this.ruleString=`N${this.neighbourhood}/B${this.birth.join("")}/S${this.survive.join("")}/I${this.inhibited.join("")}/${this.nStates}`,this.activationFactor=1,this.randomnessLogShift=.5}else this.activationFactor=20/this.birth[0]**3,this.randomnessLogShift=1}updateRule(t,e,i,r,o){var n=t%this.nStates;return 1==n&&this.survive.includes(i[0][this.neighbourhood])?e=1:n>0&&n<this.nStates-1?e+=1:n==this.nStates-1?e=0:0==n&&this.birth.includes(i[0][this.neighbourhood])&&Math.random()>this.activationFactor*o-.01?e=1:0==n&&this.inhibited.includes(i[0][this.neighbourhood])&&(e=this.nStates-1),e}getName(){return`SGen/${this.ruleString}`}initialiseRule(t){"SGen"==t.substring(0,4)?super.initialiseRule(t.substring(5)):super.initialiseRule(t)}}class N extends k{constructor(t=null,e=!0){super(null==t?e?N.getPresetRule():N.generateRule():t)}static getPresetRule(){let e=t({"N0/B2/S2/I13":5,"N0/B2/S24/I36/7":1,"N0/B2/S24/I36/9":1,"N0/B2/S24/I36/10":1,"N0/B2/S24/I36/11":1,"N0/B2/S37/I1568/3":1,"N0/B245/S347/I/5":1,"N0/B23/S3478/I1/6":3,"B234568/S2458/I1/6":1,"B234568/S2458/I1/7":1,"B234568/S2458/I1/8":1,"B234568/S2458/I1/9":1,"B234568/S2458/I1/10":1,"B234568/S2458/I1/11":1,"B234568/S2458/I1/12":1,"B234568/S2458/I1/13":1,"B234568/S2458/I1/14":1,"B234568/S4568/I1/4":1,"B234568/S4568/I1/5":1,"B234568/S458/I1/4":1,"B234568/S458/I1/5":1,"N0/B24568/S3478/I/4":3,"N0/B24568/S3478/I/5":1,"N0/B24568/S3478/I/6":1,"N0/B24568/S3478/I/7":1,"N0/B24568/S34578/I/9":1,"N0/B24568/S34578/I/12":1,"N0/B24568/S34578/I/13":1,"N0/B24568/S34578/I/14":1,"N0/B24568/S34678/I/4":3,"N0/B24568/S34678/I/5":1,"N0/B24568/S34678/I/6":1,"N0/B24568/S34678/I/7":10,"N0/B24568/S34678/I/8":3,"N0/B24568/S34678/I/9":1,"N0/B24568/S34678/I/10":1,"N0/B24568/S34678/I/11":1,"N0/B25/S345/I/4":1,"N0/B25/S345/I/5":1,"N0/B25/S345/I/6":3,"N0/B2568/S345678/I/8":1,"N0/B2568/S345678/I/10":1,"N0/B2568/S345678/I/12":1,"N0/B2568/S34578/I/4":1,"N0/B2568/S34578/I/5":1,"N0/B2568/S34578/I/6":1,"N0/B2568/S34578/I/7":1,"N0/B2568/S34578/I/8":1,"N1/B2/S3/I/11":1,"N1/B23468/S146/I5/12":1,"N15/B23/S/I/5":1,"N15/B23/S3/I/5":1,"N15/B23/S3/I45/5":1,"N15/B23/S35/I46/5":1,"N15/B23/S36/I45/5":1,"N15/B245/S347/I/5":1,"N18/B234/S45/I13/6":1,"N18/B2345/S457/I13/6":1,"N19/B248/S457/I1/6":1,"N20/B23/S3/I45/5":1,"N20/B23/S3/I/5":1,"N20/B245/S347/I/5":1,"N30/B24/S23/I1/7":1,"N30/B24/S23/I1/9":1,"N30/B24/S23/I1/10":1,"N30/B24/S23/I1/11":1,"N33/B23/S3/I/11":1,"N42/B234/S345/I1/10":1,"N47/B2/S25/I/11":1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}getSeedingPatterns(){return{random:{prob:1,mask:null}}}getName(){return`GGShips/${this.ruleString}`}initialiseRule(t){"GGShips/"==t.substring(0,7)?super.initialiseRule(t.substring(8)):super.initialiseRule(t)}}class I extends k{constructor(){super("B24/S34/I15678/4"),this.randomnessLogShift=0}getName(){return"FS"}getSeedingPatterns(){let t=.2;return{random:{prob:20,mask:null},burst1:{prob:1,mask:y.fromArray([[1,1],[1,1]])},ships1:{prob:t,mask:y.fromArray([[1,1]])},rake1:{prob:1,mask:y.fromArray([[1,0],[1,1]])},ships2:{prob:t,mask:y.fromArray([[1,1],[2,2]])},star1:{prob:1,mask:y.fromArray([[0,1,0],[1,1,1],[0,1,0]])},star2:{prob:1,mask:y.fromArray([[1,0,1],[0,0,0],[1,0,1]])},ships3:{prob:t,mask:y.fromArray([[1,0,0],[1,1,0],[0,1,1]])},ships4:{prob:t,mask:y.fromArray([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},burst2:{prob:1,mask:y.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},burst3:{prob:1,mask:y.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},rake2:{prob:1,mask:y.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},ships5:{prob:t,mask:y.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ships6:{prob:t,mask:y.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ships7:{prob:t,mask:y.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class A extends k{constructor(){super("B2/S245678/I1/4"),this.randomnessLogShift=0}getName(){return"SS"}getSeedingPatterns(){let t=.2;return{random:{prob:10,mask:null},burst1:{prob:1,mask:y.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},ships1:{prob:t,mask:y.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},ships2:{prob:t,mask:y.fromArray([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},ships3:{prob:t,mask:y.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},ships4:{prob:t,mask:y.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},ships5:{prob:t,mask:y.fromArray([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},ships6:{prob:t,mask:y.fromArray([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},burst2:{prob:1,mask:y.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ships7:{prob:t,mask:y.fromArray([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ships8:{prob:t,mask:y.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},burst3:{prob:1,mask:y.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},burst4:{prob:1,mask:y.fromArray([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},birst5:{prob:1,mask:y.fromArray([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class P extends S{constructor(){super(),this.nStates=4,this.randomnessLogShift=.4}updateRule(t,e,i,r){var o=t%4,n=i[0][0]+i[0][2];return 1!=o&&3!=o||!(n<2||n>3)?1!=o&&3!=o||2!=n&&3!=n?0!=o&&2!=o||3!=n?2==o&&(e=0):e=3:e=1:e=2,e}getSeedingPatterns(){return{void:{prob:1,mask:null}}}getName(){return"CW"}}class H extends C{constructor(t,e,i,r,o){super(),this.nColors=e,this.conditions=t,this.nStates=this.nColors,this.neighbourTypes=i,this.neighbourhoodGeometryType=r,this.periodicityLength=o}updateRule(t,e,i,r){e=0;for(let o=0;o<this.conditions.length;o++)if(this.conditions[o].test(i,t,r)){e=(o+1)%this.nColors;break}return e}getName(){return this.conditions.map((t=>t.name())).join("||")}static sampleRule(e=null,i=null,r=null,o=4,n=4,a=null){var s=[];null==e&&(e=Math.floor(8*Math.random())+2),null==r&&(r=t(c)()),null==a&&(a=this.samplePeriodicityLength());for(let t=0;t<e;t++)s.push(v.randomSample(i,o,r,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+r+": "+s.map((t=>t.name())).join(", ")),new H(s,n,i,r,a)}static samplePeriodicityLength(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static ruleFromNames(t,e=4){var i=t.split("||").map((t=>v.fromName(t)));return new H(i,e,null,r,null)}evolveRule(t=null){var e,i=this.conditions.length;null==t&&(t=this.neighbourTypes),0==(e=2==i?Math.floor(2*Math.random())+1:10==i?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.removeCondition():1==e?this.changeCondition(t):this.addCondition(t)}addCondition(t){var e=this.conditions.slice();e.push(v.randomSample(t,4,this.neighbourhoodGeometryType,this.periodicityLength)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}removeCondition(){var t=this.conditions.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.conditions=t}changeCondition(t){var e=this.conditions.slice(),i=Math.floor(Math.random()*e.length);e[i]=v.randomSample(t,4,this.neighbourhoodGeometryType,this.periodicityLength),console.log((new Date).toLocaleTimeString()+" Changing condition "+i+" to "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}}const W="gr",x="safe",L="mix",F="general",E="test";class T{colorUnit;ruleChain;updateRule;getRuleChain(){throw new Error("Must override method")}getUpdateRule(){return function(t,e,i,r,o){e=this.ruleChain[0].updateRule(t%this.ruleChain[0].nStates,e,i,r,o);var n=this.ruleChain[0].nStates;for(let o=1;o<this.ruleChain.length;o++)e+=n*this.ruleChain[o].updateRule(Math.floor(t/n)%this.ruleChain[o].nStates,e,i,r),e%=n*=this.ruleChain[o].nStates;return e%n}}evolveRuleChain(){throw new Error("Must override method")}getName(){return this.ruleChain.map((t=>t.getName())).join("-")}}class X extends T{constructor(t){super(),this.preset=t,this.colorUnit=1,this.ruleChain=this.getRuleChain(),this.updateRule=this.getUpdateRule()}getRuleChain(){var t=[];return"Original"==this.preset?t.push(new w):"StarWars"==this.preset?t.push(new B):"Modified"==this.preset?t.push(new M):"Conway"==this.preset?t.push(new P):t.push(new k(this.preset)),t}evolveRuleChain(){}}class Y extends T{constructor(t,e,i=null){super(),this.preset=t,this.neighbourTypes=e,this.periodicityLength=null,this.neighbourGeometryType=null,null==e&&(t==x||t==W||t==E?this.neighbourTypes={0:1,1:0}:t==L?(Math.random()<.5?this.neighbourTypes={0:.8,1:.2}:this.neighbourTypes={0:1,1:0},this.neighbourTypes={0:.8,1:.2}):this.neighbourTypes={0:.5,1:.5}),t==W&&(this.periodicityLength=1),this.colorUnit=4,this.ruleChain=null==i?this.getRuleChain():this.getRuleChainfromName(i),this.updateRule=this.getUpdateRule()}rulesGeneral=[{rule:R,args:[null,"ships"],weight:4},{rule:R,args:[],weight:2},{rule:N,args:[],weight:2},{rule:M,args:[],weight:4},{rule:w,args:[],weight:1},{rule:B,args:[],weight:1},{rule:A,args:[],weight:1},{rule:I,args:[],weight:1},{rule:P,args:[],weight:1}];rulesGR=[{rule:M,args:[],weight:1}];getRuleChain(){let t=this.rulesGeneral;this.preset==W&&(t=this.rulesGR);let e=t.reduce(((t,e)=>t+e.weight),0);var i=[];let r=Math.random()*e;for(let e=0;e<t.length;e++){if(r<t[e].weight){i.push(new t[e].rule(...t[e].args));break}r-=t[e].weight}return i.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,i[0].nStates,4,this.periodicityLength)),this.preset==E&&((i=[]).push(new R(null,"ships")),this.colorUnit=i[0].nStates,i.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,4,4,this.periodicityLength))),i}evolveRuleChain(){this.ruleChain[1]&&"function"==typeof this.ruleChain[1].evolveRule&&this.ruleChain[1].evolveRule(this.neighbourTypes)}getRuleChainfromName(t){var e=[],[i,r]=t.split("-");return"BB"==i?e.push(new M):"TBB"==i?e.push(new w):"SW"==i?e.push(new B):"SS"==i?e.push(new A):"FS"==i?e.push(new I):"CW"==i?e.push(new P):i.startsWith("SGen")?e.push(new R(i,"ships")):i.startsWith("GGShips")?e.push(new N(i)):e.push(new k(i)),e.push(H.ruleFromNames(r)),e}}class G extends T{constructor(t,e,i=null){super(),this.preset=t,this.neighbourTypes=e,this.periodicityLength=null,this.neighbourGeometryType=null,null==e&&(t==x?this.neighbourTypes={0:1,1:0}:t==L?(Math.random()<.5?this.neighbourTypes={0:.8,1:.2}:this.neighbourTypes={0:1,1:0},this.neighbourTypes={0:.8,1:.2}):this.neighbourTypes={0:.5,1:.5}),this.colorUnit=16,this.ruleChain=null==i?this.getRuleChain():this.getRuleChainfromName(i),this.updateRule=this.getUpdateRule()}getRuleChain(){var t=[];return t.push(new M),t.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,4,4,this.periodicity)),t.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,16,4,this.periodicity)),t}evolveRuleChain(){this.ruleChain[1].evolveRule(this.neighbourTypes),this.ruleChain[2].evolveRule(this.neighbourTypes)}getRuleChainfromName(t){var e=[],i=t.split("-")[1];return e.push(new M),e.push(H.ruleFromNames(i)),e}}function U(t,e=!1){Math.random()<Math.exp(t.ruleLogSwitchProbability)||e||t.changeColoringRuleFlag?("VariableGR"==t.metaRule?(t.ruleClass=new Y(W),t.ruleClass2=new Y(W),t.useLogo=!0):"VariableDemo"==t.metaRule?(t.ruleClass=new Y(W),t.ruleClass2=null,t.useLogo=!1):"Variable"==t.metaRule?t.ruleClass=new Y(x):"VariableMix"==t.metaRule?t.ruleClass=new Y(L):"VariableUnsafe"==t.metaRule?t.ruleClass=new Y(F):"VariableTest"==t.metaRule?t.ruleClass=new Y(E):"Variable2Unsafe"==t.metaRule?t.ruleClass=new G(F):"CustomRule"==t.metaRule?t.ruleClass=new Y(null,null,t.tempRuleStorage):"OriginalBB"==t.metaRule?t.ruleClass=new X("Original"):"ModifiedBB"==t.metaRule?t.ruleClass=new X("Modified"):"StarWars"==t.metaRule?t.ruleClass=new X("StarWars"):"Conway"==t.metaRule?t.ruleClass=new X("Conway"):"SparseFourStates"==t.metaRule?t.ruleClass=new X("B378/S124567/4"):t.ruleClass=new Y(L),t.ruleLogSwitchProbability=-25,t.ruleLogEvolveProbability=-25,t.changeColoringRuleFlag=!1,t.time=0,j(t)):(Math.random()<Math.exp(t.ruleLogEvolveProbability)||t.evolveColoringRuleFlag)&&"CustomRule"!=t.metaRule&&(t.ruleClass.evolveRuleChain(),t.useLogo&&null!==t.ruleClass2&&t.ruleClass2.evolveRuleChain(),t.ruleLogEvolveProbability=-25,t.evolveColoringRuleFlag=!1,t.time=0,j(t));let i=Math.max(t.meanColorChangeHistoric/200,1);t.ruleLogSwitchProbability=t.ruleLogSwitchProbability+t.logMultiplicativeFactor*i,t.ruleLogSwitchProbability>0&&(t.ruleLogSwitchProbability=0),t.ruleLogEvolveProbability=t.ruleLogEvolveProbability+t.logMultiplicativeEvolveFactor*i,t.ruleLogEvolveProbability>0&&(t.ruleLogEvolveProbability=0)}function j(t){var e=document.getElementById("currentStyle");e&&(t.useLogo&&null!==t.ruleClass2?e.value=t.ruleClass.getName()+"__"+t.ruleClass2.getName():e.value=t.ruleClass.getName())}function $(t){let e={};for(let i in t){if("t"==i)continue;let r=Math.floor(3*Math.random())-1,o=t[i]+r;o=Math.max(0,Math.min(255,o)),e[i]=o}return e.t=t.t,e}function O(t){var e={r:247,g:255,b:28,t:255},i={r:13,g:112,b:255,t:255},r={r:240,g:239,b:239,t:255},o={r:0,g:0,b:0,t:255},n={r:240,g:240,b:240,t:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),t:255},s={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),t:255};"yellow"==t.colorPalette?(t.backgroundColor=e,t.activatedColor=o,t.deadColor=i,t.superActivatedColor=r):"blue"==t.colorPalette?(t.backgroundColor=i,t.activatedColor=r,t.deadColor=o,t.superActivatedColor=e):"blue2"==t.colorPalette?(t.backgroundColor=i,t.activatedColor=e,t.deadColor=o,t.superActivatedColor=r):"grey"==t.colorPalette?(t.backgroundColor=r,t.activatedColor=o,t.deadColor=i,t.superActivatedColor=e):"grey2"==t.colorPalette?(t.backgroundColor=r,t.activatedColor=e,t.deadColor=o,t.superActivatedColor=i):"black"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=i,t.deadColor=e,t.superActivatedColor=r):"black2"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=i,t.deadColor=r,t.superActivatedColor=e):"blackTrace"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=r,t.deadColor=o,t.superActivatedColor=r):"blackTrace2"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=o,t.deadColor=o,t.superActivatedColor=r):"blackTrace3"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=o,t.deadColor=r,t.superActivatedColor=r):"redBlue"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor={r:221,g:12,b:12,t:255},t.superActivatedColor={r:29,g:29,b:189,t:255}):"turquoiseRed"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor={r:39,g:192,b:177,t:255},t.superActivatedColor={r:252,g:53,b:47,t:255}):"magentaCyan"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor={r:156,g:36,b:150,t:255},t.superActivatedColor={r:114,g:223,b:174,t:255}):"variable"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor=a,t.superActivatedColor=s):"mouseAnimation"==t.colorPalette&&(t.backgroundColor={r:0,g:0,b:0,t:0},t.activatedColor=i,t.deadColor=o,t.superActivatedColor=e)}function V(t,e,i,r,o){let n=(e+r+t.gridHeight)%t.gridHeight,a=(i+o+t.gridWidth)%t.gridWidth,s=n,l=a;return(n-e-r>0||n-e-r<0)&&(l=(t.gridWidth-a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(a-i-o>0||a-i-o<0)&&(s=(t.gridHeight-n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function D(t,e,i,r,o){let n=(e+r+t.gridHeight)%t.gridHeight,a=(i+o+t.gridWidth)%t.gridWidth,s=n,l=a;return(n-e-r>0||n-e-r<0)&&(l=(t.gridWidth-a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),a-i-o>0?s=(n+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:a-i-o<0&&(s=(n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function q(t,e,i,r,o){let n=(e+r+t.gridHeight)%t.gridHeight,a=(i+o+t.gridWidth)%t.gridWidth,s=n,l=a;return n-e-r>0?l=(a+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:n-e-r<0&&(l=(a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(a-i-o>0||a-i-o<0)&&(s=(t.gridHeight-n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function K(t,e,i,r,o){let n=(e+r+t.gridHeight)%t.gridHeight,a=(i+o+t.gridWidth)%t.gridWidth,s=n,l=a;return n-e-r>0?l=(a+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:n-e-r<0&&(l=(a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),a-i-o>0?s=(n+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:a-i-o<0&&(s=(n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function z(t){t.gridFlipX&&t.gridFlipY?t.findNeighbour=V:t.gridFlipX?t.findNeighbour=D:t.gridFlipY?t.findNeighbour=q:t.findNeighbour=K}function _(t){U(t,!0)}function J(t){let e=t.ctx,i=t.imageData;for(var r=0,o=0,n=0,a=0;a<t.gridHeight;a++)for(var s=0;s<t.gridWidth;s++){if(0==t.redraw.get(a,s))continue;r+=1;var l=Math.floor(t.grid.get(a,s)/t.ruleClass.colorUnit)%4;let e;if(0==l)e=t.backgroundColor;else if(1==l)e=t.activatedColor;else if(2==l)e=t.deadColor;else{if(3!=l)continue;e=t.superActivatedColor}let h=4*(a*t.gridWidth+s);o+=Math.sqrt((i.data[h+0]-e.r)**2+(i.data[h+1]-e.g)**2+(i.data[h+2]-e.b)**2),n+=e.r+e.g+e.b,i.data[h+0]=e.r,i.data[h+1]=e.g,i.data[h+2]=e.b,i.data[h+3]=e.t}!function(t,e,i,r){t.activityLevel=.8*t.activityLevel+e/(t.gridHeight*t.gridWidth)/5,t.nCellChangedHistoric=.01*e+.99*t.nCellChangedHistoric,t.meanColorChangeHistoric=.01*i/(e+t.gridHeight*t.gridWidth/30)+.99*t.meanColorChangeHistoric,0==e?r=127:r/=3*e,t.brightness=1/30*r+29/30*t.brightness,t.maxBrightness=29/30*(t.maxBrightness-t.brightness)+t.brightness,t.minBrightness=29/30*(t.minBrightness-t.brightness)+t.brightness,t.relCellChanged=e/(t.gridHeight*t.gridWidth),t.diffBrightness=t.maxBrightness-t.minBrightness,t.flickerIndex=t.diffBrightness*t.relCellChanged,t.maxBrightness<r?t.maxBrightness+=3:t.minBrightness>r&&(t.minBrightness-=3)}(t,r,o,n),function(t){t.time%200==21&&(isNaN(t.brightness)&&(t.brightness=127,t.maxBrightness=130,t.minBrightness=124),isNaN(t.maxBrightness)&&(t.maxBrightness=130),isNaN(t.minBrightness)&&(t.minBrightness=124),console.log("Activity level: "+t.activityLevel.toFixed(2)+"."),console.log("Cells changed: "+t.relCellChanged.toFixed(4)+"."),console.log("Mean color change: "+t.meanColorChangeHistoric.toFixed(1)+"."),console.log("Brightness: "+t.brightness.toFixed(1)+"."),console.log("Max - min brightness: "+t.diffBrightness+"."),console.log("Flicker index: "+t.flickerIndex.toFixed(2)+"."))}(t),e.putImageData(i,t.canvasCornerX,t.canvasCornerY)}function Q(t,e,i){var r=function(t){var e=Math.exp(-t),i=1,r=0;do{r++,i*=Math.random()}while(i>e);return r-1}(10**(t.randomnessAmount+t.ruleClass.ruleChain[0].randomnessLogShift));if(0!=r)for(var o=t.ruleClass.ruleChain[0].seedSampler,n=t.ruleClass.ruleChain[0].seedMasks,a=0;a<r;a++){var s=Math.floor(Math.random()*t.gridHeight),l=Math.floor(Math.random()*t.gridWidth);Z(e,t,n[o()],s,l,i)}}function Z(t,e,i,r,o,n){null===i?i=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?ot(t,t):e<.2?et(t,t):e<.3?tt(t,t):e<.4?function(t){let e=new y(t,t);for(let i=0;i<t;i++)for(let r=i;r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,i,e.get(i,r));return e}(t):e<.5?function(t){let e=new y(t,t);for(let i=0;i<t;i++)for(let r=i;r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(t-1-r,t-1-i,e.get(i,r));return e}(t):e<.6?it(t,t):e<.7?rt(t,t):e<.8?function(t){let e=new y(t,t);for(let i=0;i<t;i++)for(let r=Math.max(i,t-i);r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,i,e.get(i,r)),e.set(t-1-r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r));return e}(t):e<.9?function(t){let e=new y(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let r=0;r<Math.ceil(t/2);r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r)),e.set(t-1-r,i,e.get(i,r));return e}(t):function(t){let e=new y(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let r=0;r<Math.ceil(t/2);r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r)),e.set(t-1-r,i,e.get(i,r)),e.set(t-1-i,r,e.get(i,r)),e.set(t-1-r,t-1-i,e.get(i,r)),e.set(i,t-1-r,e.get(i,r)),e.set(r,i,e.get(i,r));return e}(t)}(e);else{t=function(t,e){let i=Math.random();return i<.2?ot(t,e):i<.4?et(t,e):i<.6?tt(t,e):i<.8?it(t,e):rt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&i.transpose(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let a=i.height,s=i.width;for(let l=0;l<a;l++)for(let h=0;h<s;h++){let d=n(e,r,o,l-Math.floor(a/2),h-Math.floor(s/2));t.set(d[0],d[1],i.get(l,h))}}function tt(t,e){let i=new y(e,t);for(let r=0;r<t;r++)for(let t=0;t<Math.ceil(e/2);t++)i.set(r,t,Math.floor(1e5*Math.random())),i.set(r,e-1-t,i.get(r,t));return i}function et(t,e){let i=new y(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let o=0;o<e;o++)i.set(r,o,Math.floor(1e5*Math.random())),i.set(t-1-r,o,i.get(r,o));return i}function it(t,e){let i=new y(e,t);for(let r=0;r<t;r++)for(let o=0;o<Math.ceil(e/2);o++)i.set(r,o,Math.floor(1e5*Math.random())),i.set(t-1-r,e-1-o,i.get(r,o));return i}function rt(t,e){let i=new y(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let o=0;o<Math.ceil(e/2);o++)i.set(r,o,Math.floor(1e5*Math.random())),i.set(t-1-r,o,i.get(r,o)),i.set(r,e-1-o,i.get(r,o)),i.set(t-1-r,e-1-o,i.get(r,o));return i}function ot(t,e){let i=new y(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)i.set(r,t,Math.floor(1e5*Math.random()));return i}function nt(t,e){if(t.saveEventData){var i=t.ruleClass.ruleChain[0].getName(),r=new Blob([i],{type:"text/plain"}),o=URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download="dataAutomata.txt",n.click()}}function at(t){!function(t){t.time>20&&(t.meanColorChangeHistoric>330||t.relCellChanged>.4||t.flickerIndex>3)&&(t.changeColoringRuleFlag=!0,console.log("Changing rule because suspected oscillation:"),console.log("Std of color change: "+t.meanColorChangeHistoric.toFixed(1)),console.log("Proportion of cell changed: "+t.relCellChanged.toFixed(4)),console.log("Flicker index: "+t.flickerIndex.toFixed(2)+"."),t.nCellChangedHistoric=15,t.meanColorChangeHistoric=10,t.brightness=127,t.maxBrightness=130,t.minBrightness=124,nt(t))}(t),function(t){t.nCellChangedHistoric<3&&(t.changeColoringRuleFlag=!0,console.log("Changing rule because not enough cells changed ("+t.nCellChangedHistoric+")."),t.nCellChangedHistoric=20,nt(t))}(t)}function st(t){J(t),at(t),function(t){var r=[new Uint8Array(e[0]*t.ruleClass.ruleChain[0].nStates).fill(0),new Uint8Array(e[1]).fill(0)],o=new Uint8Array(5).fill(0),n=new y(t.gridWidth,t.gridHeight),a=t.grid;const s=t.time,l=t.ruleClass.ruleChain[0].nStates;for(var h=0;h<t.gridHeight;h++)for(var d=0;d<t.gridWidth;d++){var g=i(t,h,d,a,r,o,s,l,4);const e=t.grid.get(h,d);var u=e;u=t.useLogo&&0!=t.mask.get(h,d)?t.ruleClass2.updateRule(e,u,g,t.time,t.activityLevel):t.ruleClass.updateRule(e,u,g,t.time,t.activityLevel),Math.floor(u/t.ruleClass.colorUnit)%4!=Math.floor(e/t.ruleClass.colorUnit)%4?t.redraw.set(h,d,1):t.redraw.set(h,d,0),n.set(h,d,u);for(let t=0;t<r.length;t++)r[t].fill(0);o.fill(0)}t.addRandomness&&Q(t,n,t.findNeighbour),t.grid=n}(t),U(t),t.time=(t.time+1)%166320,t.randomisePeriodicityShiftAndTopology&&function(t){Math.random()<1e-4&&(t.gridPeriodicityShiftX=Math.floor(Math.random()*t.gridWidth),console.log("Periodicity shift X: "+t.gridPeriodicityShiftX)),Math.random()<1e-4&&(t.gridPeriodicityShiftY=Math.floor(Math.random()*t.gridHeight),console.log("Periodicity shift Y: "+t.gridPeriodicityShiftY)),Math.random()<1e-4&&(t.gridFlipX=!t.gridFlipX,z(t),console.log("Flip X: "+t.gridFlipX)),Math.random()<1e-4&&(t.gridFlipY=!t.gridFlipY,z(t),console.log("Flip Y: "+t.gridFlipY))}(t),"variable"==t.colorPalette&&function(t){Math.random()<1&&(t.superActivatedColor=$(t.superActivatedColor),t.deadColor=$(t.deadColor))}(t),setTimeout((function(){requestAnimationFrame((()=>st(t)))}),t.timeout)}function lt(t,e){return console.log("Attempting to load image"),(i=t.logo,console.log("Loading image:",i),new Promise(((t,e)=>{const r=new Image;r.onload=()=>{console.log("Image loaded:",i);const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const o=e.getContext("2d");o.drawImage(r,0,0,r.width,r.height);const n=o.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<r.height;t++){const e=[];for(let i=0;i<r.width;i++){const o=4*(t*r.width+i),a=(n[o]+n[o+1]+n[o+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},r.onerror=()=>{console.error("Error loading image:",i),e(new Error("Error loading image"))},r.src=i}))).then((e=>{new y(t.gridWidth,t.gridHeight);const i=new y(t.gridWidth,t.gridHeight),r=e[0].length/t.gridWidth,o=e.length/t.gridHeight,n=Math.max(r,o),a=Math.floor((t.gridWidth-e[0].length/n)/2),s=Math.floor((t.gridHeight-e.length/n)/2);for(let r=0;r<t.gridHeight;r++)for(let o=0;o<t.gridWidth;o++){if(r<s||(r-s)*n>=e.length){i.set(r,o,1);continue}let t=Math.floor((o-a)*n);0===e[Math.floor((r-s)*n)][t]?i.set(r,o,0):i.set(r,o,1)}t.mask=i})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new y(t.gridWidth,t.gridHeight)}));var i}async function ht(t,e){if(null!==t.logo&&await lt(t),"zero"!=t.initialisation)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new y(t.gridWidth,t.gridHeight),t.redraw=new y(t.gridWidth,t.gridHeight);for(var i=0;i<t.gridHeight;i++)for(var r=0;r<t.gridWidth;r++)if("gr"!=t.initialisation||1!==t.mask.get(i,r)){for(var o=Math.random(),n=0;n<e;n++)if(o<(n+1)/(e+1)){t.grid.set(i,r,n);break}t.redraw.set(i,r,1)}else t.grid.set(i,r,0)}))}(t);t.grid=new Grid(t.gridWidth,t.gridHeight),t.redraw=new Grid(t.gridWidth,t.gridHeight)}function dt(t){document.getElementById("submitButton").addEventListener("click",(function(){!function(t){Object.keys(t).forEach((t=>{let e=document.getElementById(t);var i;e&&(i="checkbox"===e.type?e.checked:"number"===e.type||"range"===e.type?parseFloat(e.value):e.value,localStorage.setItem(t,i))})),location.reload()}(t)}))}function gt(t){document.getElementById("randomnessAmount").addEventListener("input",(function(){!function(t,e){t.randomnessAmount=parseFloat(e),document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var ut={canvas:document.getElementById("gameCanvas"),ctx:document.getElementById("gameCanvas").getContext("2d"),gridHeight:128,gridWidth:128,timeout:20,addRandomness:!0,randomnessAmount:-1,randomisePeriodicityShiftAndTopology:!0,gridPeriodicityShiftX:0,gridPeriodicityShiftY:0,gridFlipX:!1,gridFlipY:!1,colorPalette:"black2",metaRule:"VariableGR",initialisation:"random",logo:"grLogoLarge.png",useLogo:!0},ct=new class{constructor({canvas:t,ctx:e,gridHeight:i=200,gridWidth:r=200,timeout:o=20,addRandomness:n=!0,randomnessAmount:a=-2,randomisePeriodicityShiftAndTopology:s=!0,gridPeriodicityShiftX:l=0,gridPeriodicityShiftY:h=0,gridFlipX:d=!1,gridFlipY:g=!1,colorPalette:u="black2",metaRule:c="VariableGR",initialisation:m="random",ruleSwitchPeriod:f=2e4,ruleEvolvePeriod:p=2e3,logo:b=null,useLogo:v=!1}={}){this.grid=null,this.gridHeight=i,this.gridWidth=r,this.gridPeriodicityShiftX=l,this.gridPeriodicityShiftY=h,this.gridFlipX=d,this.gridFlipY=g,this.mask=null,this.findNeighbour=null,this.canvas=t,this.ctx=e,this.canvasCornerX=0,this.canvasCornerY=0,this.canvas.width=this.gridWidth,this.canvas.height=this.gridHeight,this.redraw=null,this.imageData=e.createImageData(t.width,t.height),this.colorPalette=u,this.initialisation=m,this.logo=b,this.useLogo=v,this.timeout=o,this.addRandomness=n,this.randomnessAmount=a,this.randomisePeriodicityShiftAndTopology=s,this.metaRule=c,this.updateCellValue=null,this.updateCellValueAuxiliary=null,this.ruleSwitchPeriod=f,this.ruleEvolvePeriod=p,this.time=0,this.ruleLogSwitchProbability=-25,this.ruleLogEvolveProbability=-25,this.logMultiplicativeFactor=25/this.ruleSwitchPeriod,this.logMultiplicativeEvolveFactor=25/this.ruleEvolvePeriod,this.changeColoringRuleFlag=!0,this.evolveColoringRuleFlag=!1,this.activityLevel=0,this.nCellChangedHistoric=0,this.meanColorChangeHistoric=0,this.brightness=127,this.maxBrightness=130,this.minBrightness=124,this.diffBrightness=0,this.relCellChanged=0,this.flickerIndex=0,this.saveEventData=!1}}(ut);window.onload=function(){!function(t){document.getElementById("addRandomness").addEventListener("change",(function(){t.addRandomness=this.checked}))}(ct),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(ct),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var i=t.canvas.getBoundingClientRect(),r=e.clientX-i.left,o=e.clientY-i.top,n=i.width/t.gridWidth,a=i.height/t.gridHeight,s=Math.floor(r/n),l=Math.floor(o/a);t.grid.set(l,s,1)}}))}(ct),function(t){t.canvas.addEventListener("mousedown",(function(e){var i=t.canvas.getBoundingClientRect(),r=e.clientX-i.left,o=e.clientY-i.top,n=i.width/t.gridWidth,a=i.height/t.gridHeight,s=Math.floor(r/n),l=Math.floor(o/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(l,(s+1)%t.gridWidth,1),t.grid.set(l,s,1),t.grid.set((l+1)%t.gridHeight,s,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(l,s,1),t.grid.set((l+1)%t.gridHeight,s,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(l,s,1),t.grid.set(l,(s+1)%t.gridWidth,1)):(t.grid.set((l+1)%t.gridHeight,(s+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(s+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(s-1+t.gridWidth)%t.gridWidth,1),t.grid.set((l+1)%t.gridHeight,(s-1+t.gridWidth)%t.gridWidth,1))}))}(ct),dt(ct),gt(ct),function(t){document.getElementById("gridPeriodicityShiftX").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.gridPeriodicityShiftX=e,z(t)})),document.getElementById("gridPeriodicityShiftY").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.gridPeriodicityShiftY=e,z(t)})),document.getElementById("gridFlipX").addEventListener("change",(function(){t.gridFlipX=this.checked,z(t)})),document.getElementById("gridFlipY").addEventListener("change",(function(){t.gridFlipY=this.checked,z(t)}))}(ct),function(t){document.getElementById("timeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(ct),function(t){document.getElementById("colorPalette").addEventListener("change",(function(){t.colorPalette=this.value,O(t)}))}(ct),function(t){document.getElementById("metaRule").addEventListener("change",(async function(){t.metaRule=this.value,_(t)}))}(ct),function(t){document.getElementById("changeColoringRule").addEventListener("click",(function(){t.changeColoringRuleFlag=!0})),document.getElementById("evolveColoringRule").addEventListener("click",(function(){t.evolveColoringRuleFlag=!0}))}(ct),function(t){Object.keys(t).forEach((e=>{let i=localStorage.getItem(e);null!==i&&("boolean"==typeof t[e]?t[e]="true"===i:"number"==typeof t[e]?t[e]=parseFloat(i):t[e]=i)}))}(ct),function(t){Object.keys(t).forEach((e=>{let i=document.getElementById(e);i&&("checkbox"===i.type?i.checked=t[e]:i.value=t[e])}))}(ct),function(t){t.canvas.width=Math.max(t.gridHeight,t.gridWidth),t.canvas.height=Math.max(t.gridHeight,t.gridWidth),t.canvasCornerX=0,t.canvasCornerY=0;var e=document.getElementById("gameCanvas");if(t.gridHeight>t.gridWidth){var i=Math.floor(t.gridWidth/t.gridHeight*800);e.style.width=i+"px",e.style.height="800px",e.width=i*t.gridHeight/800,e.height=t.gridHeight}else{var r=Math.floor(t.gridHeight/t.gridWidth*800);e.style.width="800px",e.style.height=r+"px",e.width=t.gridWidth,e.height=r*t.gridWidth/800}t.imageData=t.ctx.createImageData(t.gridWidth,t.gridHeight)}(ct),O(ct),z(ct),_(ct),ht(ct).then((()=>{st(ct)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),n=Object.values(t).reduce(((t,n,r)=>[...t,n/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=n.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[44,44];function n(t,e,n,r,i){for(var o=-1;o<=1;o++)for(var a=-1;a<=1;a++){if(0==o&&0==a)continue;i[0]=(Math.abs(o)+Math.abs(a))%2,i[t.time%4+1]=-1==o?1:0,i[(1+t.time)%4+1]=-1==a?1:0,i[(2+t.time)%4+1]=1==o?1:0,i[(3+t.time)%4+1]=1==a?1:0;let u=t.t(t,e,n,o,a),l=u[0],h=u[1],c=t.grid.get(l,h),f=c%4,d=Math.floor(c%16/4);if(1==f){r[0][0]+=1;for(var s=0;s<i.length;s++)r[0][4+8*s]+=i[s],r[0][8*(s+1)]+=1-i[s]}else if(2==f){r[0][2]+=1;for(s=0;s<i.length;s++)r[0][4+8*s+2]+=i[s],r[0][8*(s+1)+2]+=1-i[s]}else if(3==f){r[0][3]+=1;for(s=0;s<i.length;s++)r[0][4+8*s+3]+=i[s],r[0][8*(s+1)+3]+=1-i[s]}if(Math.floor(0==d)){r[1][0]+=1;for(s=0;s<i.length;s++)r[1][4+8*s]+=i[s],r[1][8*(s+1)]+=1-i[s]}else if(Math.floor(1==d)){r[1][1]+=1;for(s=0;s<i.length;s++)r[1][4+8*s+1]+=i[s],r[1][8*(s+1)+1]+=1-i[s]}else if(Math.floor(2==d)){r[1][2]+=1;for(s=0;s<i.length;s++)r[1][4+8*s+2]+=i[s],r[1][8*(s+1)+2]+=1-i[s]}else if(Math.floor(3==d)){r[1][3]+=1;for(s=0;s<i.length;s++)r[1][4+8*s+3]+=i[s],r[1][8*(s+1)+3]+=1-i[s]}}r[0][1]=r[0][0]+r[0][3];for(s=0;s<i.length+1;s++)r[0][4*s+1]+=r[0][4*s]+r[0][4*s+3];return r}const r={i:.3,o:.3,u:.05,l:.05,h:.05,M:.05,m:.05,v:.05,p:.05,S:.05};class i{constructor(t,e,n,r,i,o=null){this.type=t,this.threshold=e,this.R=n,this.C=r,this.N=i,this.k=o,this.F=function(t,e){return"Cond"==t?function(t){return 0==t}:"Abs"==t?function(t){return t%e==0}:function(t){return!0}}(this.C,this.N),this.A=function(t,e,n){return"Eq"==e?function(e){return e[n[0]][n[1]]==t}:"Bigger"==e?function(e){return e[n[0]][n[1]]>t}:void 0}(this.threshold,this.type,this.R),this.G=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(o)}test(t,e,n){var r=this.G(n);return this.A(t)&&this.F(e)&&r}name(){var t="";return null!=this.k&&(t=this.k.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.C}NT${this.R[0]}|${this.R[1]}P${t}`}static I(t,e=4){var n=null;t.startsWith("Eq")?n="Eq":t.startsWith("Bigger")&&(n="Bigger");var r=t.substring(n.length),o=parseInt(r.substring(0,1)),a=null;(r=r.substring(1)).startsWith("Cond")?a="Cond":r.startsWith("Abs")?a="Abs":r.startsWith("None")&&(a="None");var s=(r=r.substring(a.length)).split("|").map(Number);return new i(n,o,s,a,e)}static X(n=null,r=4,o="mix",a=null){const s=["Eq","Bigger"],u=s[Math.floor(Math.random()*s.length)];var l=0;l="Eq"===u?Math.floor(8*Math.random())+1:Math.floor(9*Math.random());const h=["Cond","Abs","None"],c=h[Math.floor(Math.random()*h.length)];null===n&&(n={0:2/3,1:1/3});const f=t(n)(),d=function(t,n){var r=n;if("mix"==r){var i=Math.random();return r=i<.5?"isotropic":i<.7?"xcross":i<.9?"vcross":"directional",Math.floor(Math.random()*e[t])}if("isotropic"==r)return Math.floor(4*Math.random());if("vcross"==r)return Math.floor(4*Math.random()+4);if("xcross"==r)return Math.floor(4*Math.random()+8);if("xvcross"==r)return Math.floor(8*Math.random()+4);if("directional1"==r)return Math.floor(4*Math.random()+12);if("directional2"==r)return Math.floor(8*Math.random()+12);if("directional3"==r)return Math.floor(12*Math.random()+12);if("directional2b"==r){var o=Math.floor(8*Math.random()+12);return o>=16&&(o+=4),o}return"directional"==r?Math.floor(16*Math.random()+12):void 0}(f,o),M=[f,d];if(Math.random()<.5)m=null;else{var m;null==a&&(a=Math.floor(4*Math.random())+2);do{m=new Array(a).fill(0).map((()=>Math.random()<.5))}while(!m.includes(!0))}return new i(u,l,M,c,r,m)}}class o{constructor(){this.Y}P(t,e,n,r){throw new Error("Must override method")}}class a extends o{constructor(){super(),this.Y=4}P(t,e,n,r){var i=t%4;return 1==i||3==i?e=2:2==i?e=0:0==i&&2==n[0][0]?e=1:0==i&&n[0][0]>2&&(e=3),e}}class s extends o{constructor(t,e,n,r){super(),this.j=e,this.T=t,this.Y=this.j,this.O=n,this.V=r}P(t,e,n,r){e=0;for(let i=0;i<this.T.length;i++)if(this.T[i].test(n,t,r)){e=(i+1)%this.j;break}return e}q(){return this.T.map((t=>t.name())).join(", ")}static B(e=null,n=null,o=4,a=4){var u=[];null==e&&(e=Math.floor(8*Math.random())+2);var l=t(r)(),h=this.L();for(let t=0;t<e;t++)u.push(i.X(n,o,l,h));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+l+": "+u.map((t=>t.name())).join(", ")),new s(u,a,l,h)}static L(){var t=Math.random();return t<.3?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(5*Math.random())+5}static $(t){var e=t.split(", ").map((t=>i.I(t)));return new s(e,nColors,"mix",null)}H(){var t,e=this.T.length;0==(t=2==e?Math.floor(2*Math.random())+1:10==e?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.D():1==t?this.U():this.W()}W(){var t=this.T.slice();t.push(i.X(null,4,this.O,this.V)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.O+": "+t.map((t=>t.name())).join(", ")),this.T=t}D(){var t=this.T.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join(", ")),this.T=t}U(){var t=this.T.slice(),e=Math.floor(Math.random()*t.length);t[e]=i.X(null,4,this.O,this.V),console.log((new Date).toLocaleTimeString()+" Changing condition "+e+" to "+this.O+": "+t.map((t=>t.name())).join(", ")),this.T=t}}class u extends o{constructor(t,e){super(),this.j=e,this.T=t,this.Y=this.j}P(t,e,n,r){e=0;var i=this.T[t%4];for(let r=0;r<i.length;r++)if(i[r].test(n,t)){e=(r+1)%this.j;break}return e}q(){return this.T.map((t=>t.map((t=>t.name())).join(", "))).join(" || ")}static B(t=null,e=null,n=4,r=4){var o=[];for(let r=0;r<4;r++){o.push([]),null==t&&(t=Math.floor(8*Math.random())+2);for(let a=0;a<t;a++)o[r].push(i.X(e,n))}return console.log("Sampling sparse four state rule: "+o.map((t=>t.map((t=>t.name())).join(", "))).join(" || ")),new u(o,r)}static $(t,e=4){var n=[],r=t.split(" || ");for(let t=0;t<r.length;t++){n.push([]);var o=r[t].split(", ");n[t]=o.map((t=>i.I(t)))}return new u(n,e)}}class l{J(){throw new Error("Must override method")}K(){return function(t,e,n,r){e=this.Z[0].P(t%this.Z[0].Y,e,n,r);var i=this.Z[0].Y;for(let o=1;o<this.Z.length;o++)e+=i*this.Z[o].P(Math.floor(t/i)%this.Z[o].Y,e,n,r),e%=i*=this.Z[o].Y;return e%i}}_(){throw new Error("Must override method")}}class h extends l{constructor(t,e){super(),this.tt=t,this.et=e,null==e&&(this.et="safe"==t?{0:1,1:0}:"mix"==t?{0:.8,1:.2}:{0:.5,1:.5}),this.nt=4,this.Z=this.J(),this.P=this.K()}J(){var t=[];return t.push(new a),t.push(s.B(null,this.et)),t}_(){this.Z[1].H()}}class c extends l{constructor(t){super(),this.et=t,null==t&&(this.et={0:1/3,1:1/3,2:1/3}),this.nt=1,this.Z=this.J(),this.P=this.K()}J(){var t=[];return t.push(u.B(4,this.et)),t}_(){}}function f(t,e=!1){Math.random()<Math.exp(t.rt)||e||t.it?("VariableGR"==t.ot?(t.st=new h("safe"),t.ut=new h("safe")):"Variable"==t.ot?t.st=new h("safe"):"VariableMix"==t.ot?t.st=new h("mix"):"VariableUnsafe"==t.ot?t.st=new h("general"):"SparseFourStates"==t.ot&&(t.st=new c),t.rt=-25):Math.random()<Math.exp(t.lt)&&(t.st._(),t.lt=-25),t.rt=t.rt+t.ht,t.rt>0&&(t.rt=0),t.lt=t.lt+t.ct,t.lt>0&&(t.lt=0),t.it=!1}function d(t){let e={};for(let n in t){let r=Math.floor(3*Math.random())-1,i=t[n]+r;i=Math.max(0,Math.min(255,i)),e[n]=i}return e}function M(t){var e={r:247,g:255,b:28},n={r:13,g:112,b:255},r={r:240,g:239,b:239},i={r:0,g:0,b:0},o={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random())};"yellow"==t.ft?(t.backgroundColor=e,t.dt=i,t.Mt=n,t.gt=r):"blue"==t.ft?(t.backgroundColor=n,t.dt=r,t.Mt=i,t.gt=e):"blue2"==t.ft?(t.backgroundColor=n,t.dt=e,t.Mt=i,t.gt=r):"grey"==t.ft?(t.backgroundColor=r,t.dt=i,t.Mt=n,t.gt=e):"grey2"==t.ft?(t.backgroundColor=r,t.dt=e,t.Mt=i,t.gt=n):"black"==t.ft?(t.backgroundColor=i,t.dt=n,t.Mt=e,t.gt=r):"black2"==t.ft?(t.backgroundColor=i,t.dt=n,t.Mt=r,t.gt=e):"blackTrace"==t.ft?(t.backgroundColor=i,t.dt=r,t.Mt=i,t.gt=r):"blackTrace2"==t.ft?(t.backgroundColor=i,t.dt=i,t.Mt=i,t.gt=r):"blackTrace3"==t.ft?(t.backgroundColor=i,t.dt=i,t.Mt=r,t.gt=r):"variable"==t.ft&&(t.backgroundColor=i,t.dt={r:240,g:240,b:240},t.Mt=o,t.gt=a)}function m(t,e,n,r,i){let o=(e+r+t.vt)%t.vt,a=(n+i+t.bt)%t.bt,s=o,u=a;return(o-e-r>0||o-e-r<0)&&(u=(t.bt-a-t.wt+t.bt)%t.bt),(a-n-i>0||a-n-i<0)&&(s=(t.vt-o-t.St+t.vt)%t.vt),[s,u]}function g(t,e,n,r,i){let o=(e+r+t.vt)%t.vt,a=(n+i+t.bt)%t.bt,s=o,u=a;return(o-e-r>0||o-e-r<0)&&(u=(t.bt-a-t.wt+t.bt)%t.bt),a-n-i>0?s=(o+t.St+t.vt)%t.vt:a-n-i<0&&(s=(o-t.St+t.vt)%t.vt),[s,u]}function v(t,e,n,r,i){let o=(e+r+t.vt)%t.vt,a=(n+i+t.bt)%t.bt,s=o,u=a;return o-e-r>0?u=(a+t.wt+t.bt)%t.bt:o-e-r<0&&(u=(a-t.wt+t.bt)%t.bt),(a-n-i>0||a-n-i<0)&&(s=(t.vt-o-t.St+t.vt)%t.vt),[s,u]}function p(t,e,n,r,i){let o=(e+r+t.vt)%t.vt,a=(n+i+t.bt)%t.bt,s=o,u=a;return o-e-r>0?u=(a+t.wt+t.bt)%t.bt:o-e-r<0&&(u=(a-t.wt+t.bt)%t.bt),a-n-i>0?s=(o+t.St+t.vt)%t.vt:a-n-i<0&&(s=(o-t.St+t.vt)%t.vt),[s,u]}function b(t){t.Rt&&t.Ct?t.t=m:t.Rt?t.t=g:t.Ct?t.t=v:t.t=p}function w(t){f(t,!0)}function S(t,e){if(t.xt){var n={...t.Nt};delete n.kt,delete n.T;var r={...n,event:e},i=Object.keys(r).join(",")+"\n";i+=Object.values(r).join(",");var o=new Blob([i],{type:"text/csv"}),a=URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download="dataAutomata.csv",s.click()}}class R{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(t*e),this.rows=new Array(e)}get(t,e){return this.data[t*this.width+e]}set(t,e,n){this.data[t*this.width+e]=n}}let C={Ft:{At:2,mask:[[1,1],[1,1]]},yt:{At:1,mask:[[1,0,1],[0,0,0],[1,0,1]]},Et:{At:40,mask:null}},x=Object.keys(C).map((t=>C[t].mask)),N=t(Object.keys(C).map((t=>C[t].At)));function k(t,e,n,r,i){for(var o=function(t){var e=Math.exp(-t),n=1,r=0;do{r++,n*=Math.random()}while(n>e);return r-1}(10**t.Gt),a=0;a<o;a++){e=Math.floor(Math.random()*t.vt),n=Math.floor(Math.random()*t.bt);F(r,t,x[N()],e,n,i)}return{It:e,Xt:n}}function F(t,e,n,r,i,o){null===n&&(n=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,n=[];for(let r=0;r<t;r++){n.push([]);for(let t=0;t<e;t++)n[r].push(Math.floor(4*Math.random()))}return n}());let a=n.length,s=n[0].length;for(let u=0;u<a;u++)for(let l=0;l<s;l++){let h=o(e,r,i,u-Math.floor(a/2),l-Math.floor(s/2));t.set(h[0],h[1],n[u][l])}}function A(t){!function(t){let e=t.Yt,n=t.Pt;for(var r=0,i=0;i<t.vt;i++)for(var o=0;o<t.bt;o++){if(0==t.jt.get(i,o))continue;r+=1;var a=Math.floor(t.grid.get(i,o)/t.st.nt)%4;let e;if(0==a)e=t.backgroundColor;else if(1==a)e=t.dt;else if(2==a)e=t.Mt;else{if(3!=a)continue;e=t.gt}let s=4*(i*t.bt+o);n.data[s+0]=e.r,n.data[s+1]=e.g,n.data[s+2]=e.b,n.data[s+3]=255}if(t.Tt=.01*r+.99*t.Tt,t.Tt>.5*t.vt*t.bt){t.it=!0;var s=t.Tt/(t.vt*t.bt);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+s.toFixed(1)+")."),t.Tt=15,S(t,"oscillation")}t.Tt<3&&(t.it=!0,console.log("Changing rule because not enough cells changed ("+t.Tt+")."),t.Tt=20,S(t,"blackout")),e.putImageData(n,t.Ot,t.Vt)}(t),function(t){for(var r=[new Array(e[0]).fill(0),new Array(e[1]).fill(0)],i=[0,0,0,0,0],o=new R(t.bt,t.vt),a=0;a<t.vt;a++)for(var s=0;s<t.bt;s++){var u=n(t,a,s,r,i);let e=t.grid.get(a,s);var l=e;l="VariableGR"!=t.ot||0==t.mask.get(a,s)?t.st.P(e,l,u,t.time):t.ut.P(e,l,u,t.time),Math.floor(l/t.st.nt)%4!=Math.floor(e/t.st.nt)%4?t.jt.set(a,s,1):t.jt.set(a,s,0),o.set(a,s,l);for(let t=0;t<r.length;t++)r[t].fill(0);i.fill(0)}if(t.qt)var{It:a,Xt:s}=k(t,a,s,o,t.t);t.grid=o}(t),f(t),t.time=(t.time+1)%166320,function(t){Math.random()<1e-4&&(t.wt=Math.floor(Math.random()*t.bt),console.log("Periodicity shift X: "+t.wt)),Math.random()<1e-4&&(t.St=Math.floor(Math.random()*t.vt),console.log("Periodicity shift Y: "+t.St)),Math.random()<1e-4&&(t.Rt=!t.Rt,b(t),console.log("Flip X: "+t.Rt)),Math.random()<1e-4&&(t.Ct=!t.Ct,b(t),console.log("Flip Y: "+t.Ct))}(t),"variable"==t.ft&&function(t){Math.random()<1&&(t.gt=d(t.gt),t.Mt=d(t.Mt))}(t),setTimeout((function(){requestAnimationFrame((()=>A(t)))}),t.timeout)}function y(t,e){return console.log("Attempting to load image"),(n="grLogoLarge.png",console.log("Loading image:",n),new Promise(((t,e)=>{const r=new Image;r.onload=()=>{console.log("Image loaded:",n);const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height);const o=i.getImageData(0,0,e.width,e.height).data,a=[];for(let t=0;t<r.height;t++){const e=[];for(let n=0;n<r.width;n++){const i=4*(t*r.width+n),a=(o[i]+o[i+1]+o[i+2])/3;e.push(a>128?1:0)}a.push(e)}t(a)},r.onerror=()=>{console.error("Error loading image:",n),e(new Error("Error loading image"))},r.src=n}))).then((e=>{new R(t.bt,t.vt);const n=new R(t.bt,t.vt),r=e[0].length/t.bt,i=e.length/t.vt,o=Math.max(r,i),a=Math.floor((t.bt-e[0].length/o)/2),s=Math.floor((t.vt-e.length/o)/2);for(let r=0;r<t.vt;r++)for(let i=0;i<t.bt;i++){if(r<s||(r-s)*o>=e.length){n.set(r,i,1);continue}let t=Math.floor((i-a)*o);0===e[Math.floor((r-s)*o)][t]?n.set(r,i,0):n.set(r,i,1)}t.mask=n})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new R(t.bt,t.vt)}));var n}async function E(t,e){return await y(t),function(t,e=64){return Promise.resolve().then((()=>{t.grid=new R(t.bt,t.vt),t.jt=new R(t.bt,t.vt);for(var n=0;n<t.vt;n++)for(var r=0;r<t.bt;r++)if("gr"!=t.Bt||1!==t.mask.get(n,r)){for(var i=Math.random(),o=0;o<e;o++)if(i<(o+1)/(e+1)){t.grid.set(n,r,o);break}t.jt.set(n,r,1)}else t.grid.set(n,r,0)}))}(t)}function G(t){document.getElementById("submitButton").addEventListener("click",(function(){var t,e,n,r,i,o,a,s,u,l,h;t=document.getElementById("userGridHeight").value,e=document.getElementById("userGridWidth").value,n=document.getElementById("userTimeout").value,r=document.getElementById("userXShift").value,i=document.getElementById("userYShift").value,o=document.getElementById("userFlipX").checked,a=document.getElementById("userFlipY").checked,s=document.getElementById("userColorPalette").value,u=document.getElementById("randomnessCheckbox").checked,l=document.getElementById("randomnessSlider").value,h=document.getElementById("userRule").value,localStorage.setItem("userGridHeight",t),localStorage.setItem("userGridWidth",e),localStorage.setItem("userTimeout",n),localStorage.setItem("userXShift",r),localStorage.setItem("userYShift",i),localStorage.setItem("userFlipX",o),localStorage.setItem("userFlipY",a),localStorage.setItem("userColorPalette",s),localStorage.setItem("userRandomnessOn",u),localStorage.setItem("userRandomnessAmount",l),localStorage.setItem("userRule",h),location.reload()}))}function I(t){document.getElementById("randomnessSlider").addEventListener("input",(function(){!function(t,e){t.Gt=e,document.getElementById("randomnessAmountValue").textContent=e}(t,this.value)}))}console.log("Loading main.js");var X=document.getElementById("gameCanvas"),Y=X.getContext("2d"),P=128,j=128,T=20,O=!0,V=-1,q=0,B=0,L=!1,$=!1,H="black2",D="VariableGR",U="random",W=6,z=new class{constructor(t,e,n=200,r=200,i=20,o=!0,a=-2,s=0,u=0,l=!1,h=!1,c="black2",f="VariableGR",d="random",M=6,m=3e4,g=3e3){this.vt=n,this.bt=r,this.Ot=0,this.Vt=0,this.timeout=i,this.grid=null,this.jt=null,this.Pt=null,this.canvas=t,this.Yt=e,this.qt=o,this.Gt=a,this.wt=s,this.St=u,this.Rt=l,this.Ct=h,this.ft=c,this.ot=f,this.Bt=d,this.Lt=M,this.$t=null,this.Ht=null,this.t=null,this.mask=null,this.Dt=m,this.Ut=g,this.rt=-25,this.lt=-25,this.ht=25/this.Dt,this.ct=25/this.Ut,this.canvas.width=this.bt,this.canvas.height=this.vt,this.Pt=e.createImageData(t.width,t.height),this.it=!0,this.Tt=0,this.xt=!1,this.time=0}}(X,Y,P,j,T,O,V,q,B,L,$,H,D,U,W);window.onload=function(){!function(t){document.getElementById("randomnessCheckbox").addEventListener("change",(function(){t.qt=this.checked}))}(z),function(t){document.getElementById("fullscreenButton").addEventListener("click",(function(){t.canvas.requestFullscreen?t.canvas.requestFullscreen():t.canvas.mozRequestFullScreen?t.canvas.mozRequestFullScreen():t.canvas.webkitRequestFullscreen?t.canvas.webkitRequestFullscreen():t.canvas.msRequestFullscreen&&t.canvas.msRequestFullscreen()}))}(z),function(t){t.canvas.addEventListener("mousemove",(function(e){if(e.shiftKey){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,o=n.width/t.bt,a=n.height/t.vt,s=Math.floor(r/o),u=Math.floor(i/a);t.grid.set(u,s,1)}}))}(z),function(t){t.canvas.addEventListener("mousedown",(function(e){var n=t.canvas.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,o=n.width/t.bt,a=n.height/t.vt,s=Math.floor(r/o),u=Math.floor(i/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(u,(s+1)%t.bt,1),t.grid.set(u,s,1),t.grid.set((u+1)%t.vt,s,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(u,s,1),t.grid.set((u+1)%t.vt,s,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(u,s,1),t.grid.set(u,(s+1)%t.bt,1)):(t.grid.set((u+1)%t.vt,(s+1)%t.bt,1),t.grid.set((u-1+t.vt)%t.vt,(s+1)%t.bt,1),t.grid.set((u-1+t.vt)%t.vt,(s-1+t.bt)%t.bt,1),t.grid.set((u+1)%t.vt,(s-1+t.bt)%t.bt,1))}))}(z),G(),I(z),function(t){document.getElementById("userXShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.wt=e,b(t)})),document.getElementById("userYShift").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.St=e,b(t)})),document.getElementById("userFlipX").addEventListener("change",(function(){t.Rt=this.checked,b(t)})),document.getElementById("userFlipY").addEventListener("change",(function(){t.Ct=this.checked,b(t)}))}(z),function(t){document.getElementById("userTimeout").addEventListener("input",(function(){let e=parseInt(this.value);isNaN(e)&&(e=0),t.timeout=e}))}(z),function(t){document.getElementById("userColorPalette").addEventListener("change",(function(){t.ft=this.value,M(t)}))}(z),function(t){document.getElementById("userRule").addEventListener("change",(async function(){t.ot=this.value,w(t)}))}(z),function(t){null!==localStorage.getItem("userGridHeight")?(t.vt=parseInt(localStorage.getItem("userGridHeight")),t.bt=parseInt(localStorage.getItem("userGridWidth")),t.vt>1e3&&(t.vt=1e3),t.bt>1e3&&(t.bt=1e3),t.Pt=t.Yt.createImageData(t.bt,t.vt),t.timeout=parseInt(localStorage.getItem("userTimeout")),t.wt=parseInt(localStorage.getItem("userXShift")),isNaN(t.wt)&&(t.wt=0),isNaN(t.St)&&(t.St=0),t.St=parseInt(localStorage.getItem("userYShift")),t.Rt="true"===localStorage.getItem("userFlipX"),t.Ct="true"===localStorage.getItem("userFlipY"),t.ft=localStorage.getItem("userColorPalette"),t.qt="true"===localStorage.getItem("userRandomnessOn"),t.Gt=parseFloat(localStorage.getItem("userRandomnessAmount")),t.ot=localStorage.getItem("userRule"),console.log("Retrieved value from previous session: ...")):console.log("No value in localStorage"),document.getElementById("userGridHeight").value=t.vt,document.getElementById("userGridWidth").value=t.bt,document.getElementById("userTimeout").value=t.timeout,document.getElementById("userXShift").value=t.wt,document.getElementById("userYShift").value=t.St,document.getElementById("userFlipX").checked=t.Rt,document.getElementById("userFlipY").checked=t.Ct,document.getElementById("userColorPalette").value=t.ft,document.getElementById("randomnessCheckbox").checked=t.qt,document.getElementById("randomnessSlider").value=t.Gt,document.getElementById("userRule").value=t.ot,t.canvas.width=Math.max(t.vt,t.bt),t.canvas.height=Math.max(t.vt,t.bt),t.Ot=0,t.Vt=0;var e=document.getElementById("gameCanvas");if(t.vt>t.bt){var n=Math.floor(t.bt/t.vt*800);e.style.width=n+"px",e.style.height="800px",e.width=n*t.vt/800,e.height=t.vt}else{var r=Math.floor(t.vt/t.bt*800);e.style.width="800px",e.style.height=r+"px",e.width=t.bt,e.height=r*t.bt/800}}(z),M(z),b(z),w(z),E(z).then((()=>{A(z)})).catch((t=>{console.error("Error initialising the grid: ",t)}))}})();
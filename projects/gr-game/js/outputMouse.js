(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),s=Object.values(t).reduce(((t,s,n)=>[...t,s/e+(t[n-1]||0)]),[]);return function(){let e=Math.random(),n=s.findIndex((t=>e<t));return Object.keys(t)[n]}}const e=[44,44];function s(t,e,s,n,i,r,a){const h=n.height-1,o=n.width-1,u=n.data,l=n.width;for(var c=i[0],f=i[1],M=-1;M<=1;M++)for(var m=-1;m<=1;m++){if(0==M&&0==m)continue;if(r[0]=((-1===M?1:M)+(-1===m?1:m))%2,r[1+(3&a)]=-1==M?1:0,r[1+(1+a&3)]=-1==m?1:0,r[1+(2+a&3)]=1==M?1:0,r[1+(3+a&3)]=1==m?1:0,0==e||0==s||e==h||s==o)var[d,b]=t.t(t,e,s,M,m);else var d=e+M,b=s+m;const n=u[d*l+b],i=3&n,v=(15&n)>>2;if(1==i){c[0]+=1;for(var g=0;g<r.length;g++)c[4+8*g]+=r[g],c[8*(g+1)]+=1-r[g]}else if(2==i){c[2]+=1;for(g=0;g<r.length;g++)c[4+8*g+2]+=r[g],c[8*(g+1)+2]+=1-r[g]}else if(3==i){c[3]+=1;for(g=0;g<r.length;g++)c[4+8*g+3]+=r[g],c[8*(g+1)+3]+=1-r[g]}if(0==v){f[0]+=1;for(g=0;g<r.length;g++)f[4+8*g]+=r[g],f[8*(g+1)]+=1-r[g]}else if(1==v){f[1]+=1;for(g=0;g<r.length;g++)f[4+8*g+1]+=r[g],f[8*(g+1)+1]+=1-r[g]}else if(2==v){f[2]+=1;for(g=0;g<r.length;g++)f[4+8*g+2]+=r[g],f[8*(g+1)+2]+=1-r[g]}else if(3==v){f[3]+=1;for(g=0;g<r.length;g++)f[4+8*g+3]+=r[g],f[8*(g+1)+3]+=1-r[g]}}for(g=0;g<r.length+1;g++)c[4*g+1]+=c[4*g]+c[4*g+3];return[c,f]}const n="mix",i="isotropic",r="xcross",a="vcross",h="xvcross",o="directional1",u="directional2",l="directional3",c="directional2b",f="directional",M={[n]:.2,[i]:.4,[r]:.05,[a]:.05,[h]:.05,[o]:.05,[u]:.05,[l]:.05,[c]:.05,[f]:.05};const m="A",d="C",b="E",g="B";class v{constructor(t,e,s,n,i,r=null){this.type=t,this.threshold=e,this.i=s,this.h=n,this.o=i,this.u=r,this.l=function(t,e){return t==d?function(t){return 0==t}:t==m?function(t){return t%e==0}:function(t){return!0}}(this.h,this.o),this.M=function(t,e,s){return e==b?function(e){return e[s[0]][s[1]]==t}:e==g?function(e){return e[s[0]][s[1]]>t}:void 0}(this.threshold,this.type,this.i),this.m=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(r)}test(t,e,s){var n=this.m(s);return this.M(t)&&this.l(e)&&n}name(){var t="";return null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.h}[${this.i[0]}|${this.i[1]}]${t}`}static v(t,e=4){var s=null;t.startsWith(b)?s=b:t.startsWith(g)&&(s=g);var n=t.substring(s.length),i=parseInt(n.substring(0,1)),r=null;(n=n.substring(1)).startsWith(d)?r=d:n.startsWith(m)?r=m:n.startsWith("N")&&(r="N");var a=(n=n.substring(r.length)).split("[")[1].split("]")[0].split("|").map(Number),h=null;return(n=n.split("]")[1]).length>0&&(h=n.split("").map((t=>"1"===t))),new v(s,i,a,r,e,h)}static p(e=null,s=4,M=n,w=null){const p=[b,g],k=p[Math.floor(Math.random()*p.length)],R=[d,m,"N"],C=R[Math.floor(Math.random()*R.length)];null===e&&(e={0:2/3,1:1/3});const S=t(e)(),y=function(t,e){var s=e;if(s==n){var M=Math.random();s=M<.5?i:M<.7?r:M<.9?a:f}if(s==i)return Math.floor(4*Math.random());if(s==a)return Math.floor(4*Math.random()+4);if(s==r)return Math.floor(4*Math.random()+8);if(s==h)return Math.floor(8*Math.random()+4);if(s==o)return Math.floor(4*Math.random()+12);if(s==u)return Math.floor(8*Math.random()+12);if(s==l)return Math.floor(12*Math.random()+12);if(s==c){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return s==f?Math.floor(16*Math.random()+12):void 0}(0,M),N=[S,y];var B=0,x=8;if(0==N[0]&&N[1]%4!=1?x=5:N[1]>4&&N[1]<=16?x=4:N[1]>16&&(x=3),B=k===g?Math.floor(Math.random()*x):Math.floor(Math.random()*x)+1,Math.random()<.2)A=null;else{var A;null==w&&(w=Math.floor(20*Math.random())+2);do{A=new Array(w).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new v(k,B,N,C,s,A)}}class w{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.k=!1,this.get=this.R,this.set=this.C}static S(t,e=!1,s=!1,n=!1){const i=t.length,r=t[0].length,a=new w(r,i);for(let e=0;e<i;e++){n&&(e=i-e-1);for(let n=0;n<r;n++)s&&(n=r-n-1),a.set(e,n,t[e][n])}return e&&a.N(),a}N(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.k?[this.R,this.C]:[this.B,this.A],this.k=!this.k}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const s=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,s)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const s=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,s)}}R(t,e){return this.data[t*this.width+e]}C(t,e,s){this.data[t*this.width+e]=s}B(t,e){return this.data[e*this.height+t]}A(t,e,s){this.data[e*this.height+t]=s}}class p{constructor(){this.U=void 0}V(t,e,s,n){throw new Error("Must override method")}O(){throw new Error("Must override method")}}class k extends p{constructor(){super(),this.T=this.P(),this.j(),this.W=0}P(){throw new Error("Must override method")}j(){this.D=Object.keys(this.T).map((t=>this.T[t].mask));let e=Object.keys(this.T).map((t=>this.T[t].$));this.F=t(e)}}class R extends k{constructor(){super(),this.U=4}V(t,e,s,n){var i=t%4;return 1==i||3==i?e=2:2==i?e=0:0==i&&2==s[0][0]?e=1:0==i&&s[0][0]>2&&(e=3),e}O(){return"BB"}P(){return{random:{$:10,mask:null},G:{$:2,mask:w.S([[1,0],[0,1]])},q:{$:2,mask:w.S([[0,1],[1,0]])},L:{$:2,mask:w.S([[1,0],[0,1]])},X:{$:4,mask:w.S([[1,1],[1,1]])},Y:{$:4,mask:new w([[1,0,1],[0,0,0],[1,0,1]])},H:{$:2,mask:w.S([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},I:{$:2,mask:w.S([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},J:{$:2,mask:w.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},K:{$:2,mask:w.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class C extends k{constructor(){super(),this.U=4,this.W=-1}V(t,e,s,n){var i=t%4;return 3==i&&(i=0),1==i?e=2:2==i||3==i?e=0:0!=i&&3!=i||2!=s[0][0]?0==i&&s[0][0]>2&&(e=3):e=1,e}O(){return"TBB"}P(){return{random:{$:10,mask:null},J:{$:1,mask:w.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},H:{$:2,mask:w.S([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},I:{$:2,mask:w.S([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},X:{$:4,mask:w.S([[1,1],[1,1]])},Z:{$:1e4,mask:w.S([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class S extends k{constructor(){super(),this.U=4,this.W=-1}V(t,e,s,n){var i=t%4;return 1==i&&(s[0][0]<3||s[0][0]>5)?e=2:2==i?e=3:3==i?e=0:0==i&&2==s[0][0]&&(e=1),e}O(){return"SW"}P(){let t=.2;return{random:{$:3,mask:null},_:{$:1,mask:w.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},tt:{$:t,mask:w.S([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},et:{$:t,mask:w.S([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},st:{$:t,mask:w.S([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},nt:{$:t,mask:w.S([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},it:{$:t,mask:w.S([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},rt:{$:t,mask:w.S([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},ht:{$:t,mask:w.S([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},ot:{$:t,mask:w.S([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ut:{$:t,mask:w.S([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},lt:{$:t,mask:w.S([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ct:{$:t,mask:w.S([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ft:{$:t,mask:w.S([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},Mt:{$:t,mask:w.S([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},dt:{$:t,mask:w.S([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},bt:{$:t,mask:w.S([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},gt:{$:t,mask:w.S([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},Y:{$:2,mask:w.S([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class y extends k{constructor(t){super(),this.vt=t;const e=this.vt.split("/");this.wt=new Uint8Array(e[0].substring(1).split("").map(Number)),this.kt=new Uint8Array(e[1].substring(1).split("").map(Number)),this.U=Number(e[2])}V(t,e,s,n){var i=t%this.U;return 1==i&&this.kt.includes(s[0][0])?e=1:i>0&&i<this.U-1?e+=1:i==this.U-1?e=0:0==i&&this.wt.includes(s[0][0])&&(e=1),e}O(){return this.vt}P(){return{random:{$:1,mask:null}}}}class N extends k{constructor(){super(),this.U=4,this.W=.4}V(t,e,s,n){var i=t%4,r=s[0][1];return 1!=i&&3!=i||!(r<2||r>3)?1!=i&&3!=i||2!=r&&3!=r?0!=i&&2!=i||3!=r?2==i&&(e=0):e=3:e=1:e=2,e}P(){return{Rt:{$:1,mask:null}}}O(){return"CW"}}class B extends p{constructor(t,e,s,n,i){super(),this.Ct=e,this.St=t,this.U=this.Ct,this.yt=s,this.Nt=n,this.Bt=i}V(t,e,s,n){e=0;for(let i=0;i<this.St.length;i++)if(this.St[i].test(s,t,n)){e=(i+1)%this.Ct;break}return e}O(){return this.St.map((t=>t.name())).join("||")}static xt(e=null,s=null,n=null,i=4,r=4,a=null){var h=[];null==e&&(e=Math.floor(8*Math.random())+2),null==n&&(n=t(M)()),null==a&&(a=this.At());for(let t=0;t<e;t++)h.push(v.p(s,i,n,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+h.map((t=>t.name())).join(", ")),new B(h,r,s,n,a)}static At(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Ut(t,e=4){var s=t.split("||").map((t=>v.v(t)));return new B(s,e,null,n,null)}Vt(t=null){var e,s=this.St.length;null==t&&(t=this.yt),0==(e=2==s?Math.floor(2*Math.random())+1:10==s?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.Ot():1==e?this.Tt(t):this.Pt(t)}Pt(t){var e=this.St.slice();e.push(v.p(t,4,this.Nt,this.Bt)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.Nt+": "+e.map((t=>t.name())).join("||")),this.St=e}Ot(){var t=this.St.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.St=t}Tt(t){var e=this.St.slice(),s=Math.floor(Math.random()*e.length);e[s]=v.p(t,4,this.Nt,this.Bt),console.log((new Date).toLocaleTimeString()+" Changing condition "+s+" to "+this.Nt+": "+e.map((t=>t.name())).join("||")),this.St=e}}const x="gr",A="safe",U="mix",V="general",O="test";class T{jt;Wt;V;Dt(){throw new Error("Must override method")}Et(){return function(t,e,s,n){e=this.Wt[0].V(t%this.Wt[0].U,e,s,n);var i=this.Wt[0].U;for(let r=1;r<this.Wt.length;r++)e+=i*this.Wt[r].V(Math.floor(t/i)%this.Wt[r].U,e,s,n),e%=i*=this.Wt[r].U;return e%i}}$t(){throw new Error("Must override method")}O(){return this.Wt.map((t=>t.O())).join("-")}}class P extends T{constructor(t){super(),this.Ft=t,this.jt=1,this.Wt=this.Dt(),this.V=this.Et()}Dt(){var t=[];return"Original"==this.Ft?t.push(new C):"StarWars"==this.Ft?t.push(new S):"Modified"==this.Ft?t.push(new R):"Conway"==this.Ft?t.push(new N):t.push(new y(this.Ft)),t}$t(){}}class j extends T{constructor(t,e,s=null){super(),this.Ft=t,this.yt=e,this.Bt=null,this.Gt=null,null==e&&(t==A||t==x||t==O?this.yt={0:1,1:0}:t==U?(Math.random()<.5?this.yt={0:.8,1:.2}:this.yt={0:1,1:0},this.yt={0:.8,1:.2}):this.yt={0:.5,1:.5}),t==x&&(this.Bt=1),this.jt=4,this.Wt=null==s?this.Dt():this.qt(s),this.V=this.Et()}Dt(){var t=[],e=Math.random();return this.Ft==x?t.push(new R):this.Ft==A?e<.3?t.push(new R):e<.4?t.push(new C):e<.7?t.push(new S):t.push(new N):(e<.3?t.push(new R):e<.4?t.push(new C):e<.7?t.push(new S):e<1?t.push(new N):this.Ft,0==t.length&&t.push(new R)),t.push(B.xt(null,this.yt,this.Gt,4,4,this.Bt)),this.Ft==O&&(t=[]).push(new y("B378/S124567/4")),t}$t(){this.Wt[1].Vt(this.yt)}qt(t){var e=[],[s,n]=t.split("-");return"BB"==s?e.push(new R):"TBB"==s?e.push(new C):"SW"==s&&e.push(new S),e.push(new S),e.push(B.Ut(n)),e}}class W extends T{constructor(t,e,s=null){super(),this.Ft=t,this.yt=e,this.Bt=null,this.Gt=null,null==e&&(t==A?this.yt={0:1,1:0}:t==U?(Math.random()<.5?this.yt={0:.8,1:.2}:this.yt={0:1,1:0},this.yt={0:.8,1:.2}):this.yt={0:.5,1:.5}),this.jt=16,this.Wt=null==s?this.Dt():this.qt(s),this.V=this.Et()}Dt(){var t=[];return t.push(new R),t.push(B.xt(null,this.yt,this.Gt,4,4,this.u)),t.push(B.xt(null,this.yt,this.Gt,16,4,this.u)),t}$t(){this.Wt[1].Vt(this.yt),this.Wt[2].Vt(this.yt)}qt(t){var e=[],s=t.split("-")[1];return e.push(new R),e.push(B.Ut(s)),e}}function D(t,e=!1){Math.random()<Math.exp(t.zt)||e||t.Lt?("VariableGR"==t.Xt?(t.Yt=new j(x),t.Ht=new j(x)):"VariableDemo"==t.Xt?t.Yt=new j(x):"Variable"==t.Xt?t.Yt=new j(A):"VariableMix"==t.Xt?t.Yt=new j(U):"VariableUnsafe"==t.Xt?t.Yt=new j(V):"VariableTest"==t.Xt?t.Yt=new j(O):"Variable2Unsafe"==t.Xt?t.Yt=new W(V):"CustomRule"==t.Xt?t.Yt=new j(null,null,t.It):"OriginalBB"==t.Xt?t.Yt=new P("Original"):"ModifiedBB"==t.Xt?t.Yt=new P("Modified"):"StarWars"==t.Xt?t.Yt=new P("StarWars"):"Conway"==t.Xt?t.Yt=new P("Conway"):"SparseFourStates"==t.Xt?t.Yt=new P("B378/S124567/4"):t.Yt=new j(U),t.zt=-25,t.Jt=-25,t.Lt=!1,E(t)):(Math.random()<Math.exp(t.Jt)||t.Kt)&&"CustomRule"!=t.Xt&&(t.Yt.$t(),"VariableGR"==t.Xt&&t.Ht.$t(),t.Jt=-25,t.Kt=!1,E(t)),t.zt=t.zt+t.Qt,t.zt>0&&(t.zt=0),t.Jt=t.Jt+t.Zt,t.Jt>0&&(t.Jt=0)}function E(t){var e=document.getElementById("currentStyle");e&&(e.value=t.Yt.O())}function $(t){let e={};for(let s in t){if("t"==s)continue;let n=Math.floor(3*Math.random())-1,i=t[s]+n;i=Math.max(0,Math.min(255,i)),e[s]=i}return e}function F(t,e,s,n,i){let r=(e+n+t._t)%t._t,a=(s+i+t.te)%t.te,h=r,o=a;return(r-e-n>0||r-e-n<0)&&(o=(t.te-a-t.ee+t.te)%t.te),(a-s-i>0||a-s-i<0)&&(h=(t._t-r-t.se+t._t)%t._t),[h,o]}function G(t,e,s,n,i){let r=(e+n+t._t)%t._t,a=(s+i+t.te)%t.te,h=r,o=a;return(r-e-n>0||r-e-n<0)&&(o=(t.te-a-t.ee+t.te)%t.te),a-s-i>0?h=(r+t.se+t._t)%t._t:a-s-i<0&&(h=(r-t.se+t._t)%t._t),[h,o]}function q(t,e,s,n,i){let r=(e+n+t._t)%t._t,a=(s+i+t.te)%t.te,h=r,o=a;return r-e-n>0?o=(a+t.ee+t.te)%t.te:r-e-n<0&&(o=(a-t.ee+t.te)%t.te),(a-s-i>0||a-s-i<0)&&(h=(t._t-r-t.se+t._t)%t._t),[h,o]}function z(t,e,s,n,i){let r=(e+n+t._t)%t._t,a=(s+i+t.te)%t.te,h=r,o=a;return r-e-n>0?o=(a+t.ee+t.te)%t.te:r-e-n<0&&(o=(a-t.ee+t.te)%t.te),a-s-i>0?h=(r+t.se+t._t)%t._t:a-s-i<0&&(h=(r-t.se+t._t)%t._t),[h,o]}function L(t){t.ne&&t.ie?t.t=F:t.ne?t.t=G:t.ie?t.t=q:t.t=z}function X(t,e){if(t.re){var s={...t.ae};delete s.he,delete s.St;var n={...s,event:e},i=Object.keys(n).join(",")+"\n";i+=Object.values(n).join(",");var r=new Blob([i],{type:"text/csv"}),a=URL.createObjectURL(r),h=document.createElement("a");h.href=a,h.download="dataAutomata.csv",h.click()}}function Y(t,e,s){for(var n=function(t){var e=Math.exp(-t),s=1,n=0;do{n++,s*=Math.random()}while(s>e);return n-1}(10**(t.oe+t.Yt.Wt[0].W)),i=t.Yt.Wt[0].F,r=t.Yt.Wt[0].D,a=0;a<n;a++){var h=Math.floor(Math.random()*t._t),o=Math.floor(Math.random()*t.te);H(e,t,r[i()],h,o,s)}}function H(t,e,s,n,i,r){null===s?s=function(){let t=Math.floor(10*Math.random())+1,e=Math.floor(10*Math.random())+1,s=new w(e,t);for(let n=0;n<t;n++)for(let t=0;t<e;t++)s.set(n,t,Math.floor(1e5*Math.random()));return s}():(Math.random()<.5&&s.N(),Math.random()<.5&&s.flipX(),Math.random()<.5&&s.flipY());let a=s.height,h=s.width;for(let o=0;o<a;o++)for(let u=0;u<h;u++){let l=r(e,n,i,o-Math.floor(a/2),u-Math.floor(h/2));t.set(l[0],l[1],s.get(o,u))}}function I(t){!function(t){let e=t.ue,s=t.le;for(var n=0,i=0;i<t._t;i++)for(var r=0;r<t.te;r++){if(0==t.ce.get(i,r))continue;n+=1;var a=Math.floor(t.grid.get(i,r)/t.Yt.jt)%4;let e;if(0==a)e=t.backgroundColor;else if(1==a)e=t.fe;else if(2==a)e=t.Me;else{if(3!=a)continue;e=t.me}let h=4*(i*t.te+r);s.data[h+0]=e.r,s.data[h+1]=e.g,s.data[h+2]=e.b,s.data[h+3]=e.de}if(t.be=.01*n+.99*t.be,t.be>.5*t._t*t.te){t.Lt=!0;var h=t.be/(t._t*t.te);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+h.toFixed(1)+")."),t.be=15,X(t,"oscillation")}t.be<3&&(t.Lt=!0,console.log("Changing rule because not enough cells changed ("+t.be+")."),t.be=20,X(t,"blackout")),e.putImageData(s,t.ge,t.ve)}(t),function(t){var n=[new Uint8Array(e[0]).fill(0),new Uint8Array(e[1]).fill(0)],i=new Uint8Array(5).fill(0),r=new w(t.te,t._t),a=t.grid;const h=t.time;for(var o=0;o<t._t;o++)for(var u=0;u<t.te;u++){var l=s(t,o,u,a,n,i,h);const e=t.grid.get(o,u);var c=e;c="VariableGR"!=t.Xt||0==t.mask.get(o,u)?t.Yt.V(e,c,l,t.time):t.Ht.V(e,c,l,t.time),Math.floor(c/t.Yt.jt)%4!=Math.floor(e/t.Yt.jt)%4?t.ce.set(o,u,1):t.ce.set(o,u,0),r.set(o,u,c);for(let t=0;t<n.length;t++)n[t].fill(0);i.fill(0)}t.we&&Y(t,r,t.t),t.grid=r}(t),D(t),t.time=(t.time+1)%166320,t.pe&&function(t){Math.random()<1e-4&&(t.ee=Math.floor(Math.random()*t.te),console.log("Periodicity shift X: "+t.ee)),Math.random()<1e-4&&(t.se=Math.floor(Math.random()*t._t),console.log("Periodicity shift Y: "+t.se)),Math.random()<1e-4&&(t.ne=!t.ne,L(t),console.log("Flip X: "+t.ne)),Math.random()<1e-4&&(t.ie=!t.ie,L(t),console.log("Flip Y: "+t.ie))}(t),"variable"==t.ke&&function(t){Math.random()<1&&(t.me=$(t.me),t.Me=$(t.Me))}(t),setTimeout((function(){requestAnimationFrame((()=>I(t)))}),t.timeout)}console.log("Loading main.js");var J=document.getElementById("gameCanvas"),K=J.getContext("2d"),Q=29,Z=78,_=80,tt=!1,et=-0,st=!1,nt=0,it=0,rt=!1,at=!1,ht="mouseAnimation",ot="ModifiedBB",ut="zero",lt=6,ct=new class{constructor(t,e,s=200,n=200,i=20,r=!0,a=-2,h=!0,o=0,u=0,l=!1,c=!1,f="black2",M="VariableGR",m="random",d=6,b=2e4,g=2e3){this._t=s,this.te=n,this.ge=0,this.ve=0,this.timeout=i,this.grid=null,this.ce=null,this.le=null,this.canvas=t,this.ue=e,this.we=r,this.oe=a,this.pe=h,this.ee=o,this.se=u,this.ne=l,this.ie=c,this.ke=f,this.Xt=M,this.Re=m,this.Ce=d,this.Se=null,this.ye=null,this.t=null,this.mask=null,this.Ne=b,this.Be=g,this.zt=-25,this.Jt=-25,this.Qt=25/this.Ne,this.Zt=25/this.Be,this.canvas.width=this.te,this.canvas.height=this._t,this.le=e.createImageData(t.width,t.height),this.Lt=!0,this.Kt=!1,this.be=0,this.re=!1,this.time=0}}(J,K,Q,Z,_,tt,et,st,nt,it,rt,at,ht,ot,ut,lt);window.onload=function(){ct.grid=new w(ct.te,ct._t),ct.ce=new w(ct.te,ct._t);const t=document.getElementById("background"),e=t.getContext("2d");ct.xe=t;const s=new Image;s.src="./grWebsiteBackgroundTransp.png?"+(new Date).getTime(),s.onload=function(){e.drawImage(s,0,0,t.width,t.height)},function(t){t.xe.addEventListener("mousemove",(function(e){var s=t.canvas.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top,r=s.width/t.te,a=s.height/t._t,h=Math.floor(n/r),o=Math.floor(i/a);t.grid.set(o,h,1)}))}(ct),function(t){t.xe.addEventListener("mousedown",(function(e){var s=t.canvas.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top,r=s.width/t.te,a=s.height/t._t,h=Math.floor(n/r),o=Math.floor(i/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(o,(h+1)%t.te,1),t.grid.set(o,h,1),t.grid.set((o+1)%t._t,h,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(o,h,1),t.grid.set((o+1)%t._t,h,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(o,h,1),t.grid.set(o,(h+1)%t.te,1)):(t.grid.set((o+1)%t._t,(h+1)%t.te,1),t.grid.set((o-1+t._t)%t._t,(h+1)%t.te,1),t.grid.set((o-1+t._t)%t._t,(h-1+t.te)%t.te,1),t.grid.set((o+1)%t._t,(h-1+t.te)%t.te,1))}))}(ct),function(t){var e={r:247,g:255,b:28,de:255},s={r:13,g:112,b:255,de:255},n={r:240,g:239,b:239,de:255},i={r:0,g:0,b:0,de:255},r={r:240,g:240,b:240,de:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),de:255},h={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),de:255};"yellow"==t.ke?(t.backgroundColor=e,t.fe=i,t.Me=s,t.me=n):"blue"==t.ke?(t.backgroundColor=s,t.fe=n,t.Me=i,t.me=e):"blue2"==t.ke?(t.backgroundColor=s,t.fe=e,t.Me=i,t.me=n):"grey"==t.ke?(t.backgroundColor=n,t.fe=i,t.Me=s,t.me=e):"grey2"==t.ke?(t.backgroundColor=n,t.fe=e,t.Me=i,t.me=s):"black"==t.ke?(t.backgroundColor=i,t.fe=s,t.Me=e,t.me=n):"black2"==t.ke?(t.backgroundColor=i,t.fe=s,t.Me=n,t.me=e):"blackTrace"==t.ke?(t.backgroundColor=i,t.fe=n,t.Me=i,t.me=n):"blackTrace2"==t.ke?(t.backgroundColor=i,t.fe=i,t.Me=i,t.me=n):"blackTrace3"==t.ke?(t.backgroundColor=i,t.fe=i,t.Me=n,t.me=n):"redblue"==t.ke?(t.backgroundColor=i,t.fe=r,t.Me={r:221,g:85,b:12,de:255},t.me={r:49,g:130,b:189,de:255}):"variable"==t.ke?(t.backgroundColor=i,t.fe=r,t.Me=a,t.me=h):"mouseAnimation"==t.ke&&(t.backgroundColor={r:0,g:0,b:0,de:0},t.fe=s,t.Me=i,t.me=e)}(ct),L(ct),function(t){D(t,!0)}(ct),I(ct)}})();
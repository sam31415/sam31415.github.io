(()=>{"use strict";class t{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.transposed=!1,this.get=this.getNormal,this.set=this.setNormal}static fromArray(e,r=!1,i=!1,o=!1){const n=e.length,a=e[0].length,s=new t(a,n);for(let t=0;t<n;t++){o&&(t=n-t-1);for(let r=0;r<a;r++)i&&(r=a-r-1),s.set(t,r,e[t][r])}return r&&s.transpose(),s}transpose(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.transposed?[this.getNormal,this.setNormal]:[this.getTransposed,this.setTransposed],this.transposed=!this.transposed}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const r=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,r)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const r=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,r)}}getNormal(t,e){return this.data[t*this.width+e]}setNormal(t,e,r){this.data[t*this.width+e]=r}getTransposed(t,e){return this.data[e*this.height+t]}setTransposed(t,e,r){this.data[e*this.height+t]=r}}function e(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),r=Object.values(t).reduce(((t,r,i)=>[...t,r/e+(t[i-1]||0)]),[]);return function(){let e=Math.random(),i=r.findIndex((t=>e<t));return Object.keys(t)[i]}}const r=[15,60];function i(t,e,r,i,o,n,a,s,l){const h=i.height-1,u=i.width-1,g=i.data,d=i.width;var c=o[0],m=o[1];let f;for(var p=-1;p<=1;p++)for(var b=-1;b<=1;b++){if(0==p&&0==b)continue;if(n[0]=((-1===p?1:p)+(-1===b?1:b))%2,n[a%4+1]=-1==p?1:0,n[(1+a)%4+1]=-1==b?1:0,n[(2+a)%4+1]=1==p?1:0,n[(3+a)%4+1]=1==b?1:0,n[(1+a)%2+5]=p*b==1?0:1,n[a%2+5]=p*b==-1?0:1,0==e||0==r||e==h||r==u)var[C,v]=t.findNeighbour(t,e,r,p,b);else var C=e+p,v=r+b;const i=g[C*d+v],o=i%s,S=Math.floor(i/s)%l;f=0;for(var y=0;y<s-1;y++)o==y+1&&(c[y]+=1,f+=s,c[f+y]+=n[0],f+=s,c[f+y]+=1-n[0],f+=s,c[f+y]+=n[1],f+=s,c[f+y]+=1-n[1],f+=s,c[f+y]+=n[2],f+=s,c[f+y]+=1-n[2],f+=s,c[f+y]+=n[3],f+=s,c[f+y]+=1-n[3],f+=s,c[f+y]+=n[4],f+=s,c[f+y]+=1-n[4],f+=s,c[f+y]+=n[5],f+=s,c[f+y]+=1-n[5],f+=s,c[f+y]+=n[6],f+=s,c[f+y]+=1-n[6]),f=0;for(f=0,y=0;y<l;y++)S==y&&(m[y]+=1,f+=l,m[f+y]+=n[0],f+=l,m[f+y]+=1-n[0],f+=l,m[f+y]+=n[1],f+=l,m[f+y]+=1-n[1],f+=l,m[f+y]+=n[2],f+=l,m[f+y]+=1-n[2],f+=l,m[f+y]+=n[3],f+=l,m[f+y]+=1-n[3],f+=l,m[f+y]+=n[4],f+=l,m[f+y]+=1-n[4],f+=l,m[f+y]+=n[5],f+=l,m[f+y]+=1-n[5],f+=l,m[f+y]+=n[6],f+=l,m[f+y]+=1-n[6]),f=0}return[c,m]}const o="mix",n="isotropic",a="xcross",s="vcross",l="xvcross",h="directional1",u="directional2",g="directional3",d="directional2b",c="directional",m={[o]:.2,[n]:.4,[a]:.05,[s]:.05,[l]:.05,[h]:.05,[u]:.05,[g]:.05,[d]:.05,[c]:.05};const f="A",p="C",b="E",C="B";class v{constructor(t,e,r,i,o,n=null){this.type=t,this.threshold=e,this.neighbourType=r,this.inactivation=i,this.modulo=o,this.periodicity=n,this.testInactive=function(t,e){return t==p?function(t){return 0==t}:t==f?function(t){return t%e==0}:function(t){return!0}}(this.inactivation,this.modulo),this.testValue=function(t,e,r){return e==b&&2==r.length?function(e){return e[r[0]][r[1]]==t}:e==C&&2==r.length?function(e){return e[r[0]][r[1]]>t}:e==b&&3==r.length?function(e){return e[r[0]][r[1]]+e[r[0]][r[2]]==t}:e==C&&3==r.length?function(e){return e[r[0]][r[1]]+e[r[0]][r[2]]>t}:void 0}(this.threshold,this.type,this.neighbourType),this.testPeriodicity=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(n)}test(t,e,r){var i=this.testPeriodicity(r);return this.testValue(t)&&this.testInactive(e)&&i}name(){var t="";null!=this.periodicity&&(t=this.periodicity.map((t=>t?"1":"0")).join(""));var e=this.neighbourType.join("|");return`${this.type}${this.threshold}${this.inactivation}[${e}]${t}`}static fromName(t,e=4){var r=null;t.startsWith(b)?r=b:t.startsWith(C)&&(r=C);var i=t.substring(r.length),o=parseInt(i.substring(0,1)),n=null;(i=i.substring(1)).startsWith(p)?n=p:i.startsWith(f)?n=f:i.startsWith("N")&&(n="N");var a=(i=i.substring(n.length)).split("[")[1].split("]")[0].split("|").map(Number),s=null;return(i=i.split("]")[1]).length>0&&(s=i.split("").map((t=>"1"===t))),new v(r,o,a,n,e,s)}static randomSample(t=null,r=4,i=o,m=null){const y=[b,C],S=y[Math.floor(Math.random()*y.length)],M=[p,f,"N"],w=M[Math.floor(Math.random()*M.length)];null===t&&(t={0:2/3,1:1/3});const k=e(t)(),R=function(t,e){var r=e;if(r==o){var i=Math.random();r=i<.5?n:i<.7?a:i<.9?s:c}if(r==n)return Math.floor(4*Math.random());if(r==s)return Math.floor(4*Math.random()+4);if(r==a)return Math.floor(4*Math.random()+8);if(r==l)return Math.floor(8*Math.random()+4);if(r==h)return Math.floor(4*Math.random()+12);if(r==u)return Math.floor(8*Math.random()+12);if(r==g)return Math.floor(12*Math.random()+12);if(r==d){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return r==c?Math.floor(16*Math.random()+12):void 0}(0,i);var P=void 0;if(Math.random()<.5){P=[k,R,function(t){for(var e=4*Math.floor(t/4),r=t;r==t;)r=e+Math.floor(4*Math.random());return r}(R)]}else P=[k,R];var A=0,N=8;if(0==P[0]&&P[1]%4!=1?N=5:P[1]>4&&P[1]<=16?N=4:P[1]>16&&(N=3),A=S===C?Math.floor(Math.random()*N):Math.floor(Math.random()*N)+1,Math.random()<.2)B=null;else{var B;null==m&&(m=Math.floor(20*Math.random())+2);do{B=new Array(m).fill(0).map((()=>Math.random()<.5))}while(!B.includes(!0))}return new v(S,A,P,w,r,B)}}class y{constructor(){this.nStates=void 0}updateRule(t,e,r,i){throw new Error("Must override method")}getName(){throw new Error("Must override method")}}class S extends y{constructor(){super(),this.seedingPatterns=this.getSeedingPatterns(),this.constructSeedingSampler(),this.randomnessLogShift=0}getSeedingPatterns(){throw new Error("Must override method")}constructSeedingSampler(){this.seedMasks=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].mask));let t=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].prob));this.seedSampler=e(t)}}class M extends S{constructor(){super(),this.nStates=4}updateRule(t,e,r,i){var o=t%4;return 1==o||3==o?e=2:2==o?e=0:0==o&&2==r[0][0]?e=1:0==o&&r[0][0]>2&&(e=3),e}getName(){return"BB"}getSeedingPatterns(){return{random:{prob:15,mask:null},waveSquare:{prob:4,mask:t.fromArray([[1,1],[1,1]])},star:{prob:4,mask:new t([[1,0,1],[0,0,0],[1,0,1]])},oscillator0:{prob:2,mask:t.fromArray([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},oscillator1:{prob:2,mask:t.fromArray([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},snakeHoriz:{prob:2,mask:t.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},snakeVert:{prob:2,mask:t.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class w extends S{constructor(){super(),this.nStates=4,this.randomnessLogShift=-1}updateRule(t,e,r,i){var o=t%4;return 3==o&&(o=0),1==o?e=2:2==o||3==o?e=0:0!=o&&3!=o||2!=r[0][0]?0==o&&r[0][0]>2&&(e=3):e=1,e}getName(){return"TBB"}getSeedingPatterns(){return{random:{prob:15,mask:null},snakeHoriz:{prob:1,mask:t.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},oscillator0:{prob:2,mask:t.fromArray([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},oscillator1:{prob:2,mask:t.fromArray([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},waveSquare:{prob:4,mask:t.fromArray([[1,1],[1,1]])},butterflyGun:{prob:1e4,mask:t.fromArray([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class k extends S{constructor(){super(),this.nStates=4,this.randomnessLogShift=-1}updateRule(t,e,r,i){var o=t%4;return 1==o&&(r[0][0]<3||r[0][0]>5)?e=2:2==o?e=3:3==o?e=0:0==o&&2==r[0][0]&&(e=1),e}getName(){return"SW"}getSeedingPatterns(){let e=.2;return{random:{prob:6,mask:null},snake:{prob:1,mask:t.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},gun0:{prob:e,mask:t.fromArray([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},gun1:{prob:e,mask:t.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},gun2:{prob:e,mask:t.fromArray([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},gun3:{prob:e,mask:t.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},gun4:{prob:e,mask:t.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},gun5:{prob:e,mask:t.fromArray([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},gun6:{prob:e,mask:t.fromArray([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},gun7:{prob:e,mask:t.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},gun8:{prob:e,mask:t.fromArray([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},gun9:{prob:e,mask:t.fromArray([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},gun10:{prob:e,mask:t.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},gun11:{prob:e,mask:t.fromArray([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},gun12:{prob:e,mask:t.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},gun13:{prob:e,mask:t.fromArray([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},gun14:{prob:e,mask:t.fromArray([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},gun15:{prob:e,mask:t.fromArray([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},star:{prob:2,mask:t.fromArray([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class R extends S{constructor(t){super(),null==t&&(t=R.generateRule()),this.initialiseRule(t)}updateRule(t,e,r,i){var o=t%this.nStates;return 1==o&&this.survive.includes(r[0][this.neighbourhood[0]])?e=1:o>0&&o<this.nStates-1?e+=1:o==this.nStates-1?e=0:0==o&&this.birth.includes(r[0][this.neighbourhood[1]])?e=1:0==o&&this.inhibited.includes(r[0][this.neighbourhood[2]])&&(e=this.nStates-1),e}sampleDigitsInBrackets(t){return t.replace(/\[([0-9]+)\]|\{([0-9|]+)\}/g,((t,e,r)=>{if(e){let t="";for(const r of e)Math.random()>.5&&(t+=r);return t}if(r){const t=r.split("|");return t[Math.floor(Math.random()*t.length)]}}))}initialiseRule(t){this.ruleString=this.sampleDigitsInBrackets(t),console.log("Sampled rulestring: ",this.ruleString);const e=this.ruleString.split("/");for(var r of(this.neighbourhood=[0,0,0],this.inhibited=[],this.nStates=Number(e[e.length-1]),e))"N"==r[0]?(this.neighbourhood=r.substring(1).split("|").map((t=>{const[e,r]=t.split(":");return r?parseInt(e)*this.nStates+parseInt(r):parseInt(e)})),this.neighbourhood.length<3&&(this.neighbourhood=[this.neighbourhood[0],this.neighbourhood[0],this.neighbourhood[0]])):"B"==r[0]?this.birth=new Uint8Array(r.substring(1).split("").map(Number)):"S"==r[0]?this.survive=new Uint8Array(r.substring(1).split("").map(Number)):"I"==r[0]&&(this.inhibited=new Uint8Array(r.substring(1).split("").map(Number)))}static generateRule(t){let e=Math.floor(10*Math.random())+3,i=[8,8,8];null==t&&(t=[Math.floor(Math.random()*r[0]*e),Math.floor(Math.random()*r[0]*e),Math.floor(Math.random()*r[0]*e)]);let o=[Math.floor(t[0]/e)%r[0],Math.floor(t[1]/e)%r[0],Math.floor(t[2]/e)%r[0]];for(let t=0;t<3;t++)[1,2].includes(o[t])?i[t]=4:3==o[t]?i[t]=3:4==o[t]?i[t]=5:5==o[t]?i[t]=6:6==o[t]&&(i[t]=2);let n=this.generateRandomArray(1,i[0]);0==n.length&&(n=[2]);let a=this.generateRandomArray(1,i[1]),s=this.generateRandomArray(1,i[2]);return s=s.filter((t=>!n.includes(t)&&!a.includes(t)&&2!=t)),this.getRuleString(t,n,a,s,e)}static getRuleString(t,e,i,o,n){return`N${t.map((t=>Math.floor(t/n)%r[0]+":"+t%n)).join("|")}/B${e.join("")}/S${i.join("")}/I${o.join("")}/${n}`}static generateRandomArray(t,e){let r=[];for(let i=t;i<=e;i++)Math.random()<.5&&r.push(i);return r}getName(){return this.ruleString}getSeedingPatterns(){return{random:{prob:1,mask:null}}}}class P extends R{constructor(t,e=null){if(super(t),"ships"==e){this.initialiseRule(this.ruleString),this.neighbourhood[0]=0;let t=Array.from(this.birth).indexOf(1);if(-1!==t){let e=new Uint8Array(this.birth.length-1);e.set(this.birth.subarray(0,t),0),e.set(this.birth.subarray(t+1),t),this.birth=e}if(-1===this.birth.indexOf(2)){let t=new Uint8Array(this.birth.length+1);t[0]=2,t.set(this.birth,1),this.birth=t}if(t=Array.from(this.survive).indexOf(1),-1!==t){let e=new Uint8Array(this.survive.length-1);e.set(this.survive.subarray(0,t),0),e.set(this.survive.subarray(t+1),t),this.survive=e}this.inhibited=this.inhibited.filter((t=>!this.birth.includes(t)&&!this.survive.includes(t)&&2!=t)),this.ruleString=R.getRuleString(this.neighbourhood,this.birth,this.survive,this.inhibited,this.nStates),this.activationFactor=1,this.randomnessLogShift=.5}else this.activationFactor=20/this.birth[0]**3,this.randomnessLogShift=1.5}updateRule(t,e,r,i,o){var n=t%this.nStates;return 1==n&&this.survive.includes(r[0][this.neighbourhood[0]])?e=1:n>0&&n<this.nStates-1?e+=1:n==this.nStates-1?e=0:0==n&&this.birth.includes(r[0][this.neighbourhood[1]])&&Math.random()>this.activationFactor*o-.05?e=1:0==n&&this.inhibited.includes(r[0][this.neighbourhood[2]])&&(e=this.nStates-1),e}getName(){return`SGen/${this.ruleString}`}initialiseRule(t){"SGen"==t.substring(0,4)?super.initialiseRule(t.substring(5)):super.initialiseRule(t)}}class A extends R{constructor(t=null,e=!0){super(null),this.ruleString=null==t?e?A.getPresetRule():A.generateRule(null):t,this.initialiseRule(this.ruleString)}static getPresetRule(){let t=e({"N0/B2/S2/I13":5,"N0/B2/S24/I36/{5|6|7|8|9|10|11|12|13|14}":1,"N0/B245/S34[678]/I/{5|6|7|8}":4,"N0/B23/S34[678]/I1/{6|7|8|9|10|11|12|13}":3,"N0/B234[5678]/S2[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":12,"N0/B234[5678]/S3[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234[5678]/S[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234578/S37/I/11":1,"N0/B23[45678]/S3[5678]/I[45678]/{5|6|7|8|9|10|11|12}":8,"N0/B2368/S358/I/5":1,"N0/B24[5678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":12,"N0/B24568/S3478/I34578/5":1,"N0/B24568/S3478/I34578/6":1,"N0/B24568/S3478/I34578/7":3,"N0/B24568/S34578/I34578/9":1,"N0/B24568/S34578/I34578/12":1,"N0/B24568/S34578/I34578/13":1,"N0/B24568/S34578/I34578/14":1,"N0/B24568/S34678/I34678/4":3,"N0/B24568/S34678/I34678/5":3,"N0/B24568/S34678/I34678/6":3,"N0/B24568/S34678/I34678/7":10,"N0/B24568/S34678/I34678/8":3,"N0/B24568/S34678/I34678/9":3,"N0/B24568/S34678/I34678/10":1,"N0/B24568/S34678/I34678/11":1,"N0/B25[678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":12,"N0/B25/S345/I/4":1,"N0/B25/S345/I/5":1,"N0:0/B2[5678]/S34567/I1[345678]/{5|6|7|8|9|10|11|12|13|14}":5,"N0/B2[5678]/S34[5678]/I[5678]/{5|6}":15,"N0/B25678/S2478/I345678/12":1,"N0/B2568/S345678/I345678/8":1,"N0/B2568/S345678/I345678/10":1,"N0/B2568/S345678/I345678/12":1,"N0/B2568/S34578/I34578/4":1,"N0/B2568/S34578/I34578/5":1,"N0/B2568/S34578/I34578/6":1,"N0/B2568/S34578/I34578/7":1,"N0/B2568/S34578/I34578/8":1,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B2[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":15,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B23[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":6,"N1/B2[45678]/S3[45678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N1/B23[45678]/S1[2345678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N5|1|18/B2[345678]/S1[345678]/I[345678]/{7|7|7|8|8|8|11|12|13|14|15}":8,"N45|0|33/B2/S/I34/7":1,"N58|0|16/B24568/S/I1/{5|6|7|8}":3,"N66|0|67/B2/S23/I23/6":3,"N66|0|0/B2/S1/I1/6":2,"N67|0|0/B2/S1/I1/6":2})();for(;t.split("/").length<5;)if("N"!=t[0])t="N0/"+t;else{t=t+"/"+(Math.floor(10*Math.random())+3)}return t}getSeedingPatterns(){return{random:{prob:1,mask:null}}}getName(){return"GGShips"==this.ruleString.substring(0,7)?this.ruleString:`GGShips/${this.ruleString}`}initialiseRule(t){"GGShips/"==t.substring(0,8)?super.initialiseRule(t.substring(8)):super.initialiseRule(t)}}class N extends R{constructor(){super("B24/S34/I15678/4"),this.randomnessLogShift=0}getName(){return"FS"}getSeedingPatterns(){let e=.2;return{random:{prob:20,mask:null},burst1:{prob:1,mask:t.fromArray([[1,1],[1,1]])},ships1:{prob:e,mask:t.fromArray([[1,1]])},rake1:{prob:1,mask:t.fromArray([[1,0],[1,1]])},ships2:{prob:e,mask:t.fromArray([[1,1],[2,2]])},star1:{prob:1,mask:t.fromArray([[0,1,0],[1,1,1],[0,1,0]])},star2:{prob:1,mask:t.fromArray([[1,0,1],[0,0,0],[1,0,1]])},ships3:{prob:e,mask:t.fromArray([[1,0,0],[1,1,0],[0,1,1]])},ships4:{prob:e,mask:t.fromArray([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},burst2:{prob:1,mask:t.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},burst3:{prob:1,mask:t.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},rake2:{prob:1,mask:t.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},ships5:{prob:e,mask:t.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ships6:{prob:e,mask:t.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ships7:{prob:e,mask:t.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class B extends R{constructor(){super("B2/S245678/I1/4"),this.randomnessLogShift=0}getName(){return"SS"}getSeedingPatterns(){let e=.2;return{random:{prob:10,mask:null},burst1:{prob:1,mask:t.fromArray([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},ships1:{prob:e,mask:t.fromArray([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},ships2:{prob:e,mask:t.fromArray([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},ships3:{prob:e,mask:t.fromArray([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},ships4:{prob:e,mask:t.fromArray([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},ships5:{prob:e,mask:t.fromArray([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},ships6:{prob:e,mask:t.fromArray([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},burst2:{prob:1,mask:t.fromArray([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},ships7:{prob:e,mask:t.fromArray([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ships8:{prob:e,mask:t.fromArray([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},burst3:{prob:1,mask:t.fromArray([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},burst4:{prob:1,mask:t.fromArray([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},birst5:{prob:1,mask:t.fromArray([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class I extends S{constructor(){super(),this.nStates=4,this.randomnessLogShift=.4}updateRule(t,e,r,i){var o=t%4,n=r[0][0]+r[0][2];return 1!=o&&3!=o||!(n<2||n>3)?1!=o&&3!=o||2!=n&&3!=n?0!=o&&2!=o||3!=n?2==o&&(e=0):e=3:e=1:e=2,e}getSeedingPatterns(){return{void:{prob:1,mask:null}}}getName(){return"CW"}}class H extends y{constructor(t,e,r,i,o){super(),this.nColors=e,this.conditions=t,this.nStates=this.nColors,this.neighbourTypes=r,this.neighbourhoodGeometryType=i,this.periodicityLength=o}updateRule(t,e,r,i){e=0;for(let o=0;o<this.conditions.length;o++)if(this.conditions[o].test(r,t,i)){e=(o+1)%this.nColors;break}return e}getName(){return this.conditions.map((t=>t.name())).join("||")}static sampleRule(t=null,r=null,i=null,o=4,n=4,a=null){var s=[];null==t&&(t=Math.floor(8*Math.random())+2),null==i&&(i=e(m)()),null==a&&(a=this.samplePeriodicityLength());for(let e=0;e<t;e++)s.push(v.randomSample(r,o,i,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+i+": "+s.map((t=>t.name())).join(", ")),new H(s,n,r,i,a)}static samplePeriodicityLength(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static ruleFromNames(t,e=4){var r=t.split("||").map((t=>v.fromName(t)));return new H(r,e,null,o,null)}evolveRule(t=null){var e,r=this.conditions.length;null==t&&(t=this.neighbourTypes),0==(e=2==r?Math.floor(2*Math.random())+1:10==r?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.removeCondition():1==e?this.changeCondition(t):this.addCondition(t)}addCondition(t){var e=this.conditions.slice();e.push(v.randomSample(t,4,this.neighbourhoodGeometryType,this.periodicityLength)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}removeCondition(){var t=this.conditions.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.conditions=t}changeCondition(t){var e=this.conditions.slice(),r=Math.floor(Math.random()*e.length);e[r]=v.randomSample(t,4,this.neighbourhoodGeometryType,this.periodicityLength),console.log((new Date).toLocaleTimeString()+" Changing condition "+r+" to "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}}const W="gr",x="safe",T="mix",L="general",F="test";class G{colorUnit;ruleChain;updateRule;getRuleChain(){throw new Error("Must override method")}getUpdateRule(){return function(t,e,r,i,o){e=this.ruleChain[0].updateRule(t%this.ruleChain[0].nStates,e,r,i,o);var n=this.ruleChain[0].nStates;for(let o=1;o<this.ruleChain.length;o++)e+=n*this.ruleChain[o].updateRule(Math.floor(t/n)%this.ruleChain[o].nStates,e,r,i),e%=n*=this.ruleChain[o].nStates;return e%n}}evolveRuleChain(){throw new Error("Must override method")}getName(){return this.ruleChain.map((t=>t.getName())).join("-")}}class E extends G{constructor(t){super(),this.preset=t,this.colorUnit=1,this.ruleChain=this.getRuleChain(),this.updateRule=this.getUpdateRule()}getRuleChain(){var t=[];return"Original"==this.preset?t.push(new w):"StarWars"==this.preset?t.push(new k):"Modified"==this.preset?t.push(new M):"Conway"==this.preset?t.push(new I):t.push(new R(this.preset)),t}evolveRuleChain(){}}class X extends G{constructor(t,e,r=null){if(super(),this.preset=t,this.neighbourTypes=e,this.periodicityLength=null,this.neighbourGeometryType=null,null==e)if(t==x||t==W)this.neighbourTypes={0:1,1:0};else if(t==T){let t=Math.random();this.neighbourTypes=t<.3?{0:1,1:0}:t<.6?{0:.8,1:.2}:t<.8?{0:.5,1:.5}:{0:0,1:1}}else{let t=Math.random();this.neighbourTypes=t<.5?{0:.5,1:.5}:{0:0,1:1}}t==W&&(this.periodicityLength=1),this.colorUnit=4,this.ruleChain=null==r?this.getRuleChain():this.getRuleChainfromName(r),this.updateRule=this.getUpdateRule()}rulesGeneral=[{rule:P,args:[null,"ships"],weight:2},{rule:P,args:[],weight:2},{rule:A,args:[],weight:6},{rule:M,args:[],weight:4},{rule:w,args:[],weight:1},{rule:k,args:[],weight:1},{rule:B,args:[],weight:1},{rule:N,args:[],weight:1},{rule:I,args:[],weight:1}];rulesGR=[{rule:M,args:[],weight:1}];getRuleChain(){let t=this.rulesGeneral;this.preset==W&&(t=this.rulesGR);let e=t.reduce(((t,e)=>t+e.weight),0);var r=[];let i=Math.random()*e;for(let e=0;e<t.length;e++){if(i<t[e].weight){r.push(new t[e].rule(...t[e].args));break}i-=t[e].weight}return r.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,r[0].nStates,4,this.periodicityLength)),this.preset==F&&((r=[]).push(new A(null,!0)),this.colorUnit=r[0].nStates,this.neighbourTypes={0:.8,1:.2},r.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,4,4,this.periodicityLength))),r}evolveRuleChain(){this.ruleChain[1]&&"function"==typeof this.ruleChain[1].evolveRule&&this.ruleChain[1].evolveRule(this.neighbourTypes)}getRuleChainfromName(t){var e=[],[r,i]=t.split("-");return"BB"==r?e.push(new M):"TBB"==r?e.push(new w):"SW"==r?e.push(new k):"SS"==r?e.push(new B):"FS"==r?e.push(new N):"CW"==r?e.push(new I):r.startsWith("SGen")?(e.push(new P(r)),e[e.length-1].activationFactor=0,e[e.length-1].randomnessLogShift=0):r.startsWith("GGShips")?e.push(new A(r)):e.push(new R(r)),i&&e.push(H.ruleFromNames(i)),e}}class Y extends G{constructor(t,e,r=null){if(super(),this.preset=t,this.neighbourTypes=e,this.periodicityLength=null,this.neighbourGeometryType=null,null==e)if(t==x)this.neighbourTypes={0:1,1:0};else if(t==T){Math.random();this.neighbourTypes={0:0,1:1}}else this.neighbourTypes={0:.5,1:.5};this.colorUnit=16,this.ruleChain=null==r?this.getRuleChain():this.getRuleChainfromName(r),this.updateRule=this.getUpdateRule()}getRuleChain(){var t=[];return t.push(new M),t.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,4,4,this.periodicity)),t.push(H.sampleRule(null,this.neighbourTypes,this.neighbourGeometryType,16,4,this.periodicity)),t}evolveRuleChain(){this.ruleChain[1].evolveRule(this.neighbourTypes),this.ruleChain[2].evolveRule(this.neighbourTypes)}getRuleChainfromName(t){var e=[],r=t.split("-")[1];return e.push(new M),e.push(H.ruleFromNames(r)),e}}function U(t,e=!1){Math.random()<Math.exp(t.ruleLogSwitchProbability)||e||t.changeColoringRuleFlag?("VariableGR"==t.metaRule?(t.ruleClass=new X(W),t.ruleClass2=new X(W),t.useLogo=!0):"VariableDemo"==t.metaRule?(t.ruleClass=new X(W),t.ruleClass2=null,t.useLogo=!1):"Variable"==t.metaRule?t.ruleClass=new X(x):"VariableMix"==t.metaRule?t.ruleClass=new X(T):"VariableUnsafe"==t.metaRule?t.ruleClass=new X(L):"VariableTest"==t.metaRule?t.ruleClass=new X(F):"Variable2Unsafe"==t.metaRule?t.ruleClass=new Y(L):"CustomRule"==t.metaRule?t.ruleClass=new X(null,null,t.currentStyle):"OriginalBB"==t.metaRule?t.ruleClass=new E("Original"):"ModifiedBB"==t.metaRule?t.ruleClass=new E("Modified"):"StarWars"==t.metaRule?t.ruleClass=new E("StarWars"):"Conway"==t.metaRule?t.ruleClass=new E("Conway"):"SparseFourStates"==t.metaRule?t.ruleClass=new E("B378/S124567/4"):t.ruleClass=new X(T),t.ruleLogSwitchProbability=-25,t.ruleLogEvolveProbability=-25,t.changeColoringRuleFlag=!1,t.time=0,j(t),"VariableGR"!=t.metaRule&&(t.redPerturbationStrength=Math.floor(21*Math.random()),t.greenPerturbationStrength=Math.floor(21*Math.random()),t.bluePerturbationStrength=Math.floor(21*Math.random()),t.brightnessPerturbationStrength=Math.floor(21*Math.random()))):(Math.random()<Math.exp(t.ruleLogEvolveProbability)||t.evolveColoringRuleFlag)&&"CustomRule"!=t.metaRule&&(t.ruleClass.evolveRuleChain(),t.useLogo&&null!==t.ruleClass2&&t.ruleClass2.evolveRuleChain(),t.ruleLogEvolveProbability=-25,t.evolveColoringRuleFlag=!1,t.time=0,j(t),"VariableGR"!=t.metaRule&&(t.redPerturbationStrength=Math.floor(21*Math.random()),t.greenPerturbationStrength=Math.floor(21*Math.random()),t.bluePerturbationStrength=Math.floor(21*Math.random()),t.brightnessPerturbationStrength=Math.floor(21*Math.random())));t.ruleLogSwitchProbability=t.ruleLogSwitchProbability+1*t.logMultiplicativeFactor,t.ruleLogSwitchProbability>0&&(t.ruleLogSwitchProbability=0),t.ruleLogEvolveProbability=t.ruleLogEvolveProbability+1*t.logMultiplicativeEvolveFactor,t.ruleLogEvolveProbability>0&&(t.ruleLogEvolveProbability=0)}function j(t){if("undefined"!=typeof document){var e=document.getElementById("currentStyle");e&&(t.useLogo&&null!==t.ruleClass2?e.value=t.ruleClass.getName()+"__"+t.ruleClass2.getName():e.value=t.ruleClass.getName())}}function V(t){let e={};for(let r in t){if("t"==r)continue;let i=Math.floor(3*Math.random())-1,o=t[r]+i;o=Math.max(0,Math.min(255,o)),e[r]=o}return e.t=t.t,e}function D(t,e,r,i,o){let n=(e+i+t.gridHeight)%t.gridHeight,a=(r+o+t.gridWidth)%t.gridWidth,s=n,l=a;return(n-e-i>0||n-e-i<0)&&(l=(t.gridWidth-a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(a-r-o>0||a-r-o<0)&&(s=(t.gridHeight-n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function $(t,e,r,i,o){let n=(e+i+t.gridHeight)%t.gridHeight,a=(r+o+t.gridWidth)%t.gridWidth,s=n,l=a;return(n-e-i>0||n-e-i<0)&&(l=(t.gridWidth-a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),a-r-o>0?s=(n+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:a-r-o<0&&(s=(n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function O(t,e,r,i,o){let n=(e+i+t.gridHeight)%t.gridHeight,a=(r+o+t.gridWidth)%t.gridWidth,s=n,l=a;return n-e-i>0?l=(a+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:n-e-i<0&&(l=(a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(a-r-o>0||a-r-o<0)&&(s=(t.gridHeight-n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function K(t,e,r,i,o){let n=(e+i+t.gridHeight)%t.gridHeight,a=(r+o+t.gridWidth)%t.gridWidth,s=n,l=a;return n-e-i>0?l=(a+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:n-e-i<0&&(l=(a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),a-r-o>0?s=(n+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:a-r-o<0&&(s=(n-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function q(t){t.gridFlipX&&t.gridFlipY?t.findNeighbour=D:t.gridFlipX?t.findNeighbour=$:t.gridFlipY?t.findNeighbour=O:t.findNeighbour=K}function z(t,e=!1){(t.time%200==0||e)&&(isNaN(t.brightness)&&(t.brightness=127,t.maxBrightness=130,t.minBrightness=124),isNaN(t.maxBrightness)&&(t.maxBrightness=130),isNaN(t.minBrightness)&&(t.minBrightness=124),console.log("Activity level: "+t.activityLevel.toFixed(2)+"."),console.log("Proportion of cells changed: "+t.relCellChanged.toFixed(4)+"."),console.log("Mean color change magnitude: "+t.meanColorChangeHistoric.toFixed(1)+"."),console.log("Brightness: "+t.brightness.toFixed(1)+"."),console.log("Max - min brightness: "+t.diffBrightness+"."),console.log("Flicker index: "+t.flickerIndex.toFixed(2)+"."),console.log("Color count: "+t.colorCount.map((t=>t.toFixed(3)))+"."))}function _(t,e,r){var i=function(t){var e=Math.exp(-t),r=1,i=0;do{i++,r*=Math.random()}while(r>e);return i-1}(10**(t.randomnessAmount+t.ruleClass.ruleChain[0].randomnessLogShift));if(0!=i)for(var o=t.ruleClass.ruleChain[0].seedSampler,n=t.ruleClass.ruleChain[0].seedMasks,a=0;a<i;a++){var s=Math.floor(Math.random()*t.gridHeight),l=Math.floor(Math.random()*t.gridWidth);J(e,t,n[o()],s,l,r)}}function J(e,r,i,o,n,a){null===i?i=function(){let e,r=Math.floor(10*Math.random())+1;if(Math.random()<.7)e=function(e){let r=Math.random();return r<.1?rt(e,e):r<.2?Z(e,e):r<.3?Q(e,e):r<.4?function(e){let r=new t(e,e);for(let t=0;t<e;t++)for(let i=t;i<e;i++)r.set(t,i,Math.floor(1e5*Math.random())),r.set(i,t,r.get(t,i));return r}(e):r<.5?function(e){let r=new t(e,e);for(let t=0;t<e;t++)for(let i=t;i<e;i++)r.set(t,i,Math.floor(1e5*Math.random())),r.set(e-1-i,e-1-t,r.get(t,i));return r}(e):r<.6?tt(e,e):r<.7?et(e,e):r<.8?function(e){let r=new t(e,e);for(let t=0;t<e;t++)for(let i=Math.max(t,e-t);i<e;i++)r.set(t,i,Math.floor(1e5*Math.random())),r.set(i,t,r.get(t,i)),r.set(e-1-i,e-1-t,r.get(t,i)),r.set(e-1-t,e-1-i,r.get(t,i));return r}(e):r<.9?function(e){let r=new t(e,e);for(let t=0;t<Math.ceil(e/2);t++)for(let i=0;i<Math.ceil(e/2);i++)r.set(t,i,Math.floor(1e5*Math.random())),r.set(i,e-1-t,r.get(t,i)),r.set(e-1-t,e-1-i,r.get(t,i)),r.set(e-1-i,t,r.get(t,i));return r}(e):function(e){let r=new t(e,e);for(let t=0;t<Math.ceil(e/2);t++)for(let i=0;i<Math.ceil(e/2);i++)r.set(t,i,Math.floor(1e5*Math.random())),r.set(i,e-1-t,r.get(t,i)),r.set(e-1-t,e-1-i,r.get(t,i)),r.set(e-1-i,t,r.get(t,i)),r.set(e-1-t,i,r.get(t,i)),r.set(e-1-i,e-1-t,r.get(t,i)),r.set(t,e-1-i,r.get(t,i)),r.set(i,t,r.get(t,i));return r}(e)}(r);else{e=function(t,e){let r=Math.random();return r<.2?rt(t,e):r<.4?Z(t,e):r<.6?Q(t,e):r<.8?tt(t,e):et(t,e)}(r,Math.floor(10*Math.random())+1)}return e}():(Math.random()<.25&&i.transpose(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let s=i.height,l=i.width;for(let t=0;t<s;t++)for(let h=0;h<l;h++){let u=a(r,o,n,t-Math.floor(s/2),h-Math.floor(l/2));e.set(u[0],u[1],i.get(t,h))}}function Q(e,r){let i=new t(r,e);for(let t=0;t<e;t++)for(let e=0;e<Math.ceil(r/2);e++)i.set(t,e,Math.floor(1e5*Math.random())),i.set(t,r-1-e,i.get(t,e));return i}function Z(e,r){let i=new t(r,e);for(let t=0;t<Math.ceil(e/2);t++)for(let o=0;o<r;o++)i.set(t,o,Math.floor(1e5*Math.random())),i.set(e-1-t,o,i.get(t,o));return i}function tt(e,r){let i=new t(r,e);for(let t=0;t<e;t++)for(let o=0;o<Math.ceil(r/2);o++)i.set(t,o,Math.floor(1e5*Math.random())),i.set(e-1-t,r-1-o,i.get(t,o));return i}function et(e,r){let i=new t(r,e);for(let t=0;t<Math.ceil(e/2);t++)for(let o=0;o<Math.ceil(r/2);o++)i.set(t,o,Math.floor(1e5*Math.random())),i.set(e-1-t,o,i.get(t,o)),i.set(t,r-1-o,i.get(t,o)),i.set(e-1-t,r-1-o,i.get(t,o));return i}function rt(e,r){let i=new t(r,e);for(let t=0;t<e;t++)for(let e=0;e<r;e++)i.set(t,e,Math.floor(1e5*Math.random()));return i}function it(t){!function(t){t.time>100&&(t.meanColorChangeHistoric>330||t.flickerIndex>15)&&(t.changeColoringRuleFlag=!0,t.meanColorChangeHistoric>330?console.log("Changing rule because of suspected oscillations (meanColorChangeHistoric: "+t.meanColorChangeHistoric+")."):console.log("Changing rule because of suspected oscillations (flickerIndex: "+t.flickerIndex+")."),z(t,!0),t.nCellChangedHistoric=15,t.meanColorChangeHistoric=10,t.brightness=127,t.maxBrightness=130,t.minBrightness=124)}(t),function(t){t.nCellChangedHistoric<3&&(t.changeColoringRuleFlag=!0,console.log("Changing rule because not enough cells changed ("+t.nCellChangedHistoric+")."),z(t,!0),t.nCellChangedHistoric=20)}(t),function(t){var e=.99;t.time>100&&(t.colorCount[1]>e||t.colorCount[2]>e||t.colorCount[3]>e)&&(t.changeColoringRuleFlag=!0,console.log("Changing rule because the canvas is too plainly colored."),z(t,!0),t.colorCount=[0,0,0,0])}(t)}var ot=166320;function nt(t,e=null){const r=performance.now();t.paused?t.step&&(at(t,e),t.step=!1):at(t,e);const i=performance.now();t.frameExecutionTime=i-r,setTimeout((function(){requestAnimationFrame((()=>nt(t,e)))}),Math.max(0,t.targetCycleTime-t.frameExecutionTime))}function at(e,o){!function(t){let e=t.imageData;var r=0,i=0,o=0,n=[0,0,0,0];const a=2*t.redPerturbationStrength+1,s=2*t.greenPerturbationStrength+1,l=2*t.bluePerturbationStrength+1,h=2*t.brightnessPerturbationStrength+1;for(var u=0;u<t.gridHeight;u++)for(var g=0;g<t.gridWidth;g++){var d=Math.floor(t.grid.get(u,g)/t.ruleClass.colorUnit)%4;if(n[d]+=1,0==t.redraw.get(u,g))continue;let c;if(r+=1,0==d)c=t.backgroundColor;else if(1==d)c=t.activatedColor;else if(2==d)c=t.deadColor;else{if(3!=d)continue;c=t.superActivatedColor}let m=4*(u*t.gridWidth+g);i+=Math.sqrt((e[m+0]-c.r)**2+(e[m+1]-c.g)**2+(e[m+2]-c.b)**2),o+=c.r+c.g+c.b;const f=Math.floor(Math.random()*a)-t.redPerturbationStrength,p=Math.floor(Math.random()*s)-t.greenPerturbationStrength,b=Math.floor(Math.random()*l)-t.bluePerturbationStrength,C=Math.floor(Math.random()*h)-t.brightnessPerturbationStrength;e[m+0]=c.r+f+C,e[m+1]=c.g+p+C,e[m+2]=c.b+b+C,e[m+3]=c.t}!function(t,e,r,i,o){var n=t.gridHeight*t.gridWidth;t.activityLevel=.8*t.activityLevel+e/n/5,t.nCellChangedHistoric=.01*e+.99*t.nCellChangedHistoric,t.meanColorChangeHistoric=.01*r/(e+n/30)+.99*t.meanColorChangeHistoric,0==e?i=127:i/=3*e,t.brightness=.01*i+.99*t.brightness,t.maxBrightness=.99*(t.maxBrightness-t.brightness)+t.brightness,t.minBrightness=.99*(t.minBrightness-t.brightness)+t.brightness,t.relCellChanged=e/n,t.diffBrightness=t.maxBrightness-t.minBrightness,t.flickerIndex=t.diffBrightness*t.relCellChanged,t.maxBrightness<i?t.maxBrightness+=3:t.minBrightness>i&&(t.minBrightness-=3);for(var a=0;a<4;a++)t.colorCount[a]=.01*t.colorCount[a]+.99*o[a]/n}(t,r,i,o,n),z(t),t.imageData=e}(e),null!=o&&o(e),it(e),function(e){var o=[new Uint8Array(r[0]*e.ruleClass.ruleChain[0].nStates).fill(0),new Uint8Array(r[1]).fill(0)],n=new Uint8Array(Math.floor(r[0]/2)).fill(0),a=new t(e.gridWidth,e.gridHeight),s=e.grid;const l=e.time,h=e.ruleClass.ruleChain[0].nStates;for(var u=0;u<e.gridHeight;u++)for(var g=0;g<e.gridWidth;g++){var d=i(e,u,g,s,o,n,l,h,4);const t=e.grid.get(u,g);var c=t;c=e.useLogo&&0!=e.mask.get(u,g)?e.ruleClass2.updateRule(t,c,d,e.time,e.activityLevel):e.ruleClass.updateRule(t,c,d,e.time,e.activityLevel),Math.floor(c/e.ruleClass.colorUnit)%4!=Math.floor(t/e.ruleClass.colorUnit)%4?e.redraw.set(u,g,1):e.redraw.set(u,g,0),a.set(u,g,c);for(let t=0;t<o.length;t++)o[t].fill(0);n.fill(0)}e.addRandomness&&_(e,a,e.findNeighbour),e.grid=a}(e),U(e),e.time=(e.time+1)%ot,e.randomisePeriodicityShiftAndTopology&&function(t){Math.random()<1e-4&&(t.gridPeriodicityShiftX=Math.floor(Math.random()*t.gridWidth),console.log("Periodicity shift X: "+t.gridPeriodicityShiftX)),Math.random()<1e-4&&(t.gridPeriodicityShiftY=Math.floor(Math.random()*t.gridHeight),console.log("Periodicity shift Y: "+t.gridPeriodicityShiftY)),Math.random()<1e-4&&(t.gridFlipX=!t.gridFlipX,q(t),console.log("Flip X: "+t.gridFlipX)),Math.random()<1e-4&&(t.gridFlipY=!t.gridFlipY,q(t),console.log("Flip Y: "+t.gridFlipY))}(e),"variable"==e.colorPalette&&function(t){Math.random()<1&&(t.superActivatedColor=V(t.superActivatedColor),t.deadColor=V(t.deadColor))}(e)}function st(t){let e=new ImageData(t.imageData,t.gridWidth,t.gridHeight);t.ctx.putImageData(e,t.canvasCornerX,t.canvasCornerY)}console.log("Loading main.js");var lt=new class{constructor({gridHeight:e=200,gridWidth:r=200,targetCycleTime:i=100,addRandomness:o=!0,randomnessAmount:n=-2,randomisePeriodicityShiftAndTopology:a=!0,gridPeriodicityShiftX:s=0,gridPeriodicityShiftY:l=0,gridFlipX:h=!1,gridFlipY:u=!1,colorPalette:g="black2",metaRule:d="VariableGR",initialisation:c="random",ruleSwitchPeriod:m=2e4,ruleEvolvePeriod:f=2e3,logo:p=null,useLogo:b=!1}={}){this.paused=!1,this.step=!1,this.targetCycleTime=100,this.gridHeight=e,this.gridWidth=r,this.grid=new t(this.gridWidth,this.gridHeight),this.gridPeriodicityShiftX=s,this.gridPeriodicityShiftY=l,this.gridFlipX=h,this.gridFlipY=u,this.mask=null,this.findNeighbour=null,this.imageData=new Uint8ClampedArray(4*this.gridWidth*this.gridHeight).fill(0),this.redraw=new t(this.gridWidth,this.gridHeight),this.colorPalette=g,this.initialisation=c,this.logo=p,this.useLogo=b,this.redPerturbationStrength=0,this.greenPerturbationStrength=0,this.bluePerturbationStrength=0,this.brightnessPerturbationStrength=0,this.addRandomness=o,this.randomnessAmount=n,this.randomisePeriodicityShiftAndTopology=a,this.metaRule=d,this.updateCellValue=null,this.updateCellValueAuxiliary=null,this.ruleSwitchPeriod=m,this.ruleEvolvePeriod=f,this.currentStyle=null,this.time=0,this.ruleLogSwitchProbability=-25,this.ruleLogEvolveProbability=-25,this.logMultiplicativeFactor=25/this.ruleSwitchPeriod,this.logMultiplicativeEvolveFactor=25/this.ruleEvolvePeriod,this.changeColoringRuleFlag=!0,this.evolveColoringRuleFlag=!1,this.activityLevel=0,this.nCellChangedHistoric=0,this.meanColorChangeHistoric=0,this.brightness=127,this.maxBrightness=130,this.minBrightness=124,this.diffBrightness=0,this.relCellChanged=0,this.flickerIndex=0,this.colorCount=[0,0,0,0],this.saveEventData=!1}}({gridHeight:29,gridWidth:78,targetCycleTime:100,addRandomness:!1,randomisePeriodicityShiftAndTopology:!1,gridPeriodicityShiftX:0,gridPeriodicityShiftY:0,gridFlipX:!1,gridFlipY:!1,colorPalette:"mouseAnimation",metaRule:"Variable",initialisation:"zero"});!function(t){t.canvasCornerX=0,t.canvasCornerY=0,t.canvas=document.getElementById("gameCanvas"),t.canvas.width=t.gridWidth,t.canvas.height=t.gridHeight,t.ctx=t.canvas.getContext("2d")}(lt),window.onload=function(){lt.grid=new t(lt.gridWidth,lt.gridHeight),lt.redraw=new t(lt.gridWidth,lt.gridHeight);const e=document.getElementById("background"),r=e.getContext("2d");lt.backgroundCanvas=e;const i=new Image;i.src="./grWebsiteBackgroundTransp.png?"+(new Date).getTime(),i.onload=function(){r.drawImage(i,0,0,e.width,e.height)},function(t){t.backgroundCanvas.addEventListener("mousemove",(function(e){var r=t.canvas.getBoundingClientRect(),i=e.clientX-r.left,o=e.clientY-r.top,n=r.width/t.gridWidth,a=r.height/t.gridHeight,s=Math.floor(i/n),l=Math.floor(o/a);t.grid.set(l,s,1)}))}(lt),function(t){t.backgroundCanvas.addEventListener("mousedown",(function(e){var r=t.canvas.getBoundingClientRect(),i=e.clientX-r.left,o=e.clientY-r.top,n=r.width/t.gridWidth,a=r.height/t.gridHeight,s=Math.floor(i/n),l=Math.floor(o/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(l,(s+1)%t.gridWidth,1),t.grid.set(l,s,1),t.grid.set((l+1)%t.gridHeight,s,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(l,s,1),t.grid.set((l+1)%t.gridHeight,s,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(l,s,1),t.grid.set(l,(s+1)%t.gridWidth,1)):(t.grid.set((l+1)%t.gridHeight,(s+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(s+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(s-1+t.gridWidth)%t.gridWidth,1),t.grid.set((l+1)%t.gridHeight,(s-1+t.gridWidth)%t.gridWidth,1))}))}(lt),function(t){var e={r:247,g:255,b:28,t:255},r={r:13,g:112,b:255,t:255},i={r:240,g:239,b:239,t:255},o={r:0,g:0,b:0,t:255},n={r:240,g:240,b:240,t:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),t:255},s={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),t:255};"yellow"==t.colorPalette?(t.backgroundColor=e,t.activatedColor=o,t.deadColor=r,t.superActivatedColor=i):"blue"==t.colorPalette?(t.backgroundColor=r,t.activatedColor=i,t.deadColor=o,t.superActivatedColor=e):"blue2"==t.colorPalette?(t.backgroundColor=r,t.activatedColor=e,t.deadColor=o,t.superActivatedColor=i):"grey"==t.colorPalette?(t.backgroundColor=i,t.activatedColor=o,t.deadColor=r,t.superActivatedColor=e):"grey2"==t.colorPalette?(t.backgroundColor=i,t.activatedColor=e,t.deadColor=o,t.superActivatedColor=r):"black"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=r,t.deadColor=e,t.superActivatedColor=i):"black2"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=r,t.deadColor=i,t.superActivatedColor=e):"blackTrace"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=i,t.deadColor=o,t.superActivatedColor=i):"blackTrace2"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=o,t.deadColor=o,t.superActivatedColor=i):"blackTrace3"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=o,t.deadColor=i,t.superActivatedColor=i):"redBlue"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor={r:221,g:12,b:12,t:255},t.superActivatedColor={r:29,g:29,b:189,t:255}):"turquoiseRed"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor={r:39,g:192,b:177,t:255},t.superActivatedColor={r:252,g:53,b:47,t:255}):"magentaCyan"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor={r:156,g:36,b:150,t:255},t.superActivatedColor={r:114,g:223,b:174,t:255}):"variable"==t.colorPalette?(t.backgroundColor=o,t.activatedColor=n,t.deadColor=a,t.superActivatedColor=s):"mouseAnimation"==t.colorPalette&&(t.backgroundColor={r:0,g:0,b:0,t:0},t.activatedColor=r,t.deadColor=o,t.superActivatedColor=e)}(lt),q(lt),function(t){U(t,!0)}(lt),nt(lt,st)}})();
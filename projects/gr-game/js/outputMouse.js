(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),s=Object.values(t).reduce(((t,s,r)=>[...t,s/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=s.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[44,44];function s(t,e,s,r,n,i,a){const h=r.height-1,o=r.width-1,u=r.data,l=r.width;for(var c=n[0],f=n[1],m=-1;m<=1;m++)for(var M=-1;M<=1;M++){if(0==m&&0==M)continue;if(i[0]=((-1===m?1:m)+(-1===M?1:M))%2,i[1+(3&a)]=-1==m?1:0,i[1+(1+a&3)]=-1==M?1:0,i[1+(2+a&3)]=1==m?1:0,i[1+(3+a&3)]=1==M?1:0,0==e||0==s||e==h||s==o)var[p,b]=t.t(t,e,s,m,M);else var p=e+m,b=s+M;const r=u[p*l+b],n=3&r,w=(15&r)>>2;if(1==n){c[0]+=1;for(var d=0;d<i.length;d++)c[4+8*d]+=i[d],c[8*(d+1)]+=1-i[d]}else if(2==n){c[2]+=1;for(d=0;d<i.length;d++)c[4+8*d+2]+=i[d],c[8*(d+1)+2]+=1-i[d]}else if(3==n){c[3]+=1;for(d=0;d<i.length;d++)c[4+8*d+3]+=i[d],c[8*(d+1)+3]+=1-i[d]}if(0==w){f[0]+=1;for(d=0;d<i.length;d++)f[4+8*d]+=i[d],f[8*(d+1)]+=1-i[d]}else if(1==w){f[1]+=1;for(d=0;d<i.length;d++)f[4+8*d+1]+=i[d],f[8*(d+1)+1]+=1-i[d]}else if(2==w){f[2]+=1;for(d=0;d<i.length;d++)f[4+8*d+2]+=i[d],f[8*(d+1)+2]+=1-i[d]}else if(3==w){f[3]+=1;for(d=0;d<i.length;d++)f[4+8*d+3]+=i[d],f[8*(d+1)+3]+=1-i[d]}}for(d=0;d<i.length+1;d++)c[4*d+1]+=c[4*d]+c[4*d+3];return[c,f]}const r="mix",n="isotropic",i="xcross",a="vcross",h="xvcross",o="directional1",u="directional2",l="directional3",c="directional2b",f="directional",m={[r]:.2,[n]:.4,[i]:.05,[a]:.05,[h]:.05,[o]:.05,[u]:.05,[l]:.05,[c]:.05,[f]:.05};const M="A",p="C",b="E",d="B";class w{constructor(t,e,s,r,n,i=null){this.type=t,this.threshold=e,this.i=s,this.h=r,this.o=n,this.u=i,this.l=function(t,e){return t==p?function(t){return 0==t}:t==M?function(t){return t%e==0}:function(t){return!0}}(this.h,this.o),this.m=function(t,e,s){return e==b?function(e){return e[s[0]][s[1]]==t}:e==d?function(e){return e[s[0]][s[1]]>t}:void 0}(this.threshold,this.type,this.i),this.M=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(i)}test(t,e,s){var r=this.M(s);return this.m(t)&&this.l(e)&&r}name(){var t="";return null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.h}[${this.i[0]}|${this.i[1]}]${t}`}static p(t,e=4){var s=null;t.startsWith(b)?s=b:t.startsWith(d)&&(s=d);var r=t.substring(s.length),n=parseInt(r.substring(0,1)),i=null;(r=r.substring(1)).startsWith(p)?i=p:r.startsWith(M)?i=M:r.startsWith("N")&&(i="N");var a=(r=r.substring(i.length)).split("[")[1].split("]")[0].split("|").map(Number),h=null;return(r=r.split("]")[1]).length>0&&(h=r.split("").map((t=>"1"===t))),new w(s,n,a,i,e,h)}static k(e=null,s=4,m=r,g=null){const k=[b,d],v=k[Math.floor(Math.random()*k.length)],R=[p,M,"N"],S=R[Math.floor(Math.random()*R.length)];null===e&&(e={0:2/3,1:1/3});const C=t(e)(),N=function(t,e){var s=e;if(s==r){var m=Math.random();s=m<.5?n:m<.7?i:m<.9?a:f}if(s==n)return Math.floor(4*Math.random());if(s==a)return Math.floor(4*Math.random()+4);if(s==i)return Math.floor(4*Math.random()+8);if(s==h)return Math.floor(8*Math.random()+4);if(s==o)return Math.floor(4*Math.random()+12);if(s==u)return Math.floor(8*Math.random()+12);if(s==l)return Math.floor(12*Math.random()+12);if(s==c){var M=Math.floor(8*Math.random()+12);return M>=16&&(M+=4),M}return s==f?Math.floor(16*Math.random()+12):void 0}(0,m),y=[C,N];var x=0,B=8;if(0==y[0]&&y[1]%4!=1?B=5:y[1]>4&&y[1]<=16?B=4:y[1]>16&&(B=3),x=v===d?Math.floor(Math.random()*B):Math.floor(Math.random()*B)+1,Math.random()<.2)A=null;else{var A;null==g&&(g=Math.floor(20*Math.random())+2);do{A=new Array(g).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new w(v,x,y,S,s,A)}}class g{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.v=!1,this.get=this.R,this.set=this.S}static C(t,e=!1,s=!1,r=!1){const n=t.length,i=t[0].length,a=new g(i,n);for(let e=0;e<n;e++){r&&(e=n-e-1);for(let r=0;r<i;r++)s&&(r=i-r-1),a.set(e,r,t[e][r])}return e&&a.N(),a}N(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.v?[this.R,this.S]:[this.B,this.A],this.v=!this.v}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const s=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,s)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const s=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,s)}}R(t,e){return this.data[t*this.width+e]}S(t,e,s){this.data[t*this.width+e]=s}B(t,e){return this.data[e*this.height+t]}A(t,e,s){this.data[e*this.height+t]=s}}class k{constructor(){this.P=void 0}U(t,e,s,r){throw new Error("Must override method")}V(){throw new Error("Must override method")}}class v extends k{constructor(){super(),this.O=this.T(),this.$(),this.j=0}T(){throw new Error("Must override method")}$(){this.W=Object.keys(this.O).map((t=>this.O[t].mask));let e=Object.keys(this.O).map((t=>this.O[t].D));this.F=t(e)}}class R extends v{constructor(){super(),this.P=4}U(t,e,s,r){var n=t%4;return 1==n||3==n?e=2:2==n?e=0:0==n&&2==s[0][0]?e=1:0==n&&s[0][0]>2&&(e=3),e}V(){return"BB"}T(){return{random:{D:15,mask:null},I:{D:4,mask:g.C([[1,1],[1,1]])},G:{D:4,mask:new g([[1,0,1],[0,0,0],[1,0,1]])},q:{D:2,mask:g.C([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{D:2,mask:g.C([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},X:{D:2,mask:g.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Y:{D:2,mask:g.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class S extends v{constructor(){super(),this.P=4,this.j=-1}U(t,e,s,r){var n=t%4;return 3==n&&(n=0),1==n?e=2:2==n||3==n?e=0:0!=n&&3!=n||2!=s[0][0]?0==n&&s[0][0]>2&&(e=3):e=1,e}V(){return"TBB"}T(){return{random:{D:15,mask:null},X:{D:1,mask:g.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},q:{D:2,mask:g.C([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{D:2,mask:g.C([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},I:{D:4,mask:g.C([[1,1],[1,1]])},H:{D:1e4,mask:g.C([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class C extends v{constructor(){super(),this.P=4,this.j=-1}U(t,e,s,r){var n=t%4;return 1==n&&(s[0][0]<3||s[0][0]>5)?e=2:2==n?e=3:3==n?e=0:0==n&&2==s[0][0]&&(e=1),e}V(){return"SW"}T(){let t=.2;return{random:{D:6,mask:null},J:{D:1,mask:g.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},K:{D:t,mask:g.C([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},Z:{D:t,mask:g.C([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},_:{D:t,mask:g.C([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{D:t,mask:g.C([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{D:t,mask:g.C([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},st:{D:t,mask:g.C([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},rt:{D:t,mask:g.C([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},nt:{D:t,mask:g.C([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},it:{D:t,mask:g.C([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ht:{D:t,mask:g.C([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ot:{D:t,mask:g.C([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{D:t,mask:g.C([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{D:t,mask:g.C([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{D:t,mask:g.C([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{D:t,mask:g.C([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},Mt:{D:t,mask:g.C([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},G:{D:2,mask:g.C([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class N extends v{constructor(t){super(),this.bt=t;const e=this.bt.split("/");this.dt=new Uint8Array(e[0].substring(1).split("").map(Number)),this.wt=new Uint8Array(e[1].substring(1).split("").map(Number)),"I"==e[2][0]?(this.gt=new Uint8Array(e[2].substring(1).split("").map(Number)),this.P=Number(e[3])):(this.gt=[],this.P=Number(e[2]))}U(t,e,s,r){var n=t%this.P;return 1==n&&this.wt.includes(s[0][0])?e=1:n>0&&n<this.P-1?e+=1:n==this.P-1?e=0:0==n&&this.dt.includes(s[0][0])?e=1:0==n&&this.gt.includes(s[0][0])&&(e=this.P-1),e}V(){return this.bt}T(){return{random:{D:1,mask:null}}}}class y extends N{constructor(){super(y.kt()),this.j=0}static kt(){let t=y.vt(3,8),e=y.vt(2,8),s=y.vt(1,8),r=e.reduce(((t,e)=>t+(8-e)),0),n=t.reduce(((t,e)=>t+(8-e)),0);for(;r>8||2*r+n>30;)e=y.vt(4,8),t=y.vt(4,8),n=t.reduce(((t,e)=>t+(8-e)),0),r=e.reduce(((t,e)=>t+(8-e)),0);return console.log(r+n,r,n),s=s.filter((s=>!t.includes(s)&&!e.includes(s)&&2!=s)),`B2${t.join("")}/S${e.join("")}/I${s.join("")}/4`}static vt(t,e){let s=[];for(let r=t;r<=e;r++)Math.random()<.5&&s.push(r);return s}T(){let t=.2;return{random:{D:20,mask:null},Rt:{D:1,mask:g.C([[1,1],[1,1]])},St:{D:t,mask:g.C([[1,1]])},Ct:{D:1,mask:g.C([[1,0],[1,1]])},Nt:{D:t,mask:g.C([[1,1],[2,2]])},yt:{D:1,mask:g.C([[0,1,0],[1,1,1],[0,1,0]])},xt:{D:1,mask:g.C([[1,0,1],[0,0,0],[1,0,1]])},Bt:{D:t,mask:g.C([[1,0,0],[1,1,0],[0,1,1]])},At:{D:t,mask:g.C([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},Pt:{D:1,mask:g.C([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Ut:{D:1,mask:g.C([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Vt:{D:1,mask:g.C([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Ot:{D:t,mask:g.C([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Tt:{D:t,mask:g.C([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},$t:{D:t,mask:g.C([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class x extends N{constructor(){super("B24/S34/I15678/4"),this.j=0}V(){return"FS"}T(){let t=.2;return{random:{D:20,mask:null},Rt:{D:1,mask:g.C([[1,1],[1,1]])},St:{D:t,mask:g.C([[1,1]])},Ct:{D:1,mask:g.C([[1,0],[1,1]])},Nt:{D:t,mask:g.C([[1,1],[2,2]])},yt:{D:1,mask:g.C([[0,1,0],[1,1,1],[0,1,0]])},xt:{D:1,mask:g.C([[1,0,1],[0,0,0],[1,0,1]])},Bt:{D:t,mask:g.C([[1,0,0],[1,1,0],[0,1,1]])},At:{D:t,mask:g.C([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},Pt:{D:1,mask:g.C([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Ut:{D:1,mask:g.C([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Vt:{D:1,mask:g.C([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Ot:{D:t,mask:g.C([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Tt:{D:t,mask:g.C([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},$t:{D:t,mask:g.C([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class B extends N{constructor(){super("B2/S245678/I1/4"),this.j=0}V(){return"SS"}T(){let t=.2;return{random:{D:10,mask:null},Rt:{D:1,mask:g.C([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},St:{D:t,mask:g.C([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Nt:{D:t,mask:g.C([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},Bt:{D:t,mask:g.C([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},At:{D:t,mask:g.C([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Ot:{D:t,mask:g.C([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},Tt:{D:t,mask:g.C([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},Pt:{D:1,mask:g.C([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},$t:{D:t,mask:g.C([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},jt:{D:t,mask:g.C([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Ut:{D:1,mask:g.C([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},Wt:{D:1,mask:g.C([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Dt:{D:1,mask:g.C([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class A extends v{constructor(){super(),this.P=4,this.j=.4}U(t,e,s,r){var n=t%4,i=s[0][1];return 1!=n&&3!=n||!(i<2||i>3)?1!=n&&3!=n||2!=i&&3!=i?0!=n&&2!=n||3!=i?2==n&&(e=0):e=3:e=1:e=2,e}T(){return{Et:{D:1,mask:null}}}V(){return"CW"}}class P extends k{constructor(t,e,s,r,n){super(),this.Ft=e,this.It=t,this.P=this.Ft,this.Gt=s,this.qt=r,this.zt=n}U(t,e,s,r){e=0;for(let n=0;n<this.It.length;n++)if(this.It[n].test(s,t,r)){e=(n+1)%this.Ft;break}return e}V(){return this.It.map((t=>t.name())).join("||")}static Lt(e=null,s=null,r=null,n=4,i=4,a=null){var h=[];null==e&&(e=Math.floor(8*Math.random())+2),null==r&&(r=t(m)()),null==a&&(a=this.Xt());for(let t=0;t<e;t++)h.push(w.k(s,n,r,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+r+": "+h.map((t=>t.name())).join(", ")),new P(h,i,s,r,a)}static Xt(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Yt(t,e=4){var s=t.split("||").map((t=>w.p(t)));return new P(s,e,null,r,null)}Ht(t=null){var e,s=this.It.length;null==t&&(t=this.Gt),0==(e=2==s?Math.floor(2*Math.random())+1:10==s?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.Jt():1==e?this.Kt(t):this.Qt(t)}Qt(t){var e=this.It.slice();e.push(w.k(t,4,this.qt,this.zt)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.qt+": "+e.map((t=>t.name())).join("||")),this.It=e}Jt(){var t=this.It.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.It=t}Kt(t){var e=this.It.slice(),s=Math.floor(Math.random()*e.length);e[s]=w.k(t,4,this.qt,this.zt),console.log((new Date).toLocaleTimeString()+" Changing condition "+s+" to "+this.qt+": "+e.map((t=>t.name())).join("||")),this.It=e}}const U="gr",V="safe",O="mix",T="general",$="test";class j{Zt;_t;U;te(){throw new Error("Must override method")}ee(){return function(t,e,s,r){e=this._t[0].U(t%this._t[0].P,e,s,r);var n=this._t[0].P;for(let i=1;i<this._t.length;i++)e+=n*this._t[i].U(Math.floor(t/n)%this._t[i].P,e,s,r),e%=n*=this._t[i].P;return e%n}}se(){throw new Error("Must override method")}V(){return this._t.map((t=>t.V())).join("-")}}class W extends j{constructor(t){super(),this.re=t,this.Zt=1,this._t=this.te(),this.U=this.ee()}te(){var t=[];return"Original"==this.re?t.push(new S):"StarWars"==this.re?t.push(new C):"Modified"==this.re?t.push(new R):"Conway"==this.re?t.push(new A):t.push(new N(this.re)),t}se(){}}class D extends j{constructor(t,e,s=null){super(),this.re=t,this.Gt=e,this.zt=null,this.ne=null,null==e&&(t==V||t==U||t==$?this.Gt={0:1,1:0}:t==O?(Math.random()<.5?this.Gt={0:.8,1:.2}:this.Gt={0:1,1:0},this.Gt={0:.8,1:.2}):this.Gt={0:.5,1:.5}),t==U&&(this.zt=1),this.Zt=4,this._t=null==s?this.te():this.ie(s),this.U=this.ee()}te(){var t=[],e=Math.random();return this.re==U?t.push(new R):this.re==V?e<.5?t.push(new y):e<.65?t.push(new R):e<.7?t.push(new S):e<.8?t.push(new C):e<.85?t.push(new B):e<.9?t.push(new x):t.push(new A):(e<.5?t.push(new y):e<.65?t.push(new R):e<.7?t.push(new S):e<.8?t.push(new C):e<.85?t.push(new B):e<.9?t.push(new x):t.push(new A),0==t.length&&t.push(new y)),t.push(P.Lt(null,this.Gt,this.ne,4,4,this.zt)),this.re==$&&((t=[]).push(new y),this.Zt=4,t.push(P.Lt(null,this.Gt,this.ne,4,4,this.zt))),t}se(){this._t[1]&&"function"==typeof this._t[1].Ht&&this._t[1].Ht(this.Gt)}ie(t){var e=[],[s,r]=t.split("-");return"BB"==s?e.push(new R):"TBB"==s?e.push(new S):"SW"==s?e.push(new C):e.push(new N(s)),e.push(new C),e.push(P.Yt(r)),e}}class E extends j{constructor(t,e,s=null){super(),this.re=t,this.Gt=e,this.zt=null,this.ne=null,null==e&&(t==V?this.Gt={0:1,1:0}:t==O?(Math.random()<.5?this.Gt={0:.8,1:.2}:this.Gt={0:1,1:0},this.Gt={0:.8,1:.2}):this.Gt={0:.5,1:.5}),this.Zt=16,this._t=null==s?this.te():this.ie(s),this.U=this.ee()}te(){var t=[];return t.push(new R),t.push(P.Lt(null,this.Gt,this.ne,4,4,this.u)),t.push(P.Lt(null,this.Gt,this.ne,16,4,this.u)),t}se(){this._t[1].Ht(this.Gt),this._t[2].Ht(this.Gt)}ie(t){var e=[],s=t.split("-")[1];return e.push(new R),e.push(P.Yt(s)),e}}function F(t,e=!1){Math.random()<Math.exp(t.ae)||e||t.he?("VariableGR"==t.oe?(t.ue=new D(U),t.le=new D(U)):"VariableDemo"==t.oe?t.ue=new D(U):"Variable"==t.oe?t.ue=new D(V):"VariableMix"==t.oe?t.ue=new D(O):"VariableUnsafe"==t.oe?t.ue=new D(T):"VariableTest"==t.oe?t.ue=new D($):"Variable2Unsafe"==t.oe?t.ue=new E(T):"CustomRule"==t.oe?t.ue=new D(null,null,t.ce):"OriginalBB"==t.oe?t.ue=new W("Original"):"ModifiedBB"==t.oe?t.ue=new W("Modified"):"StarWars"==t.oe?t.ue=new W("StarWars"):"Conway"==t.oe?t.ue=new W("Conway"):"SparseFourStates"==t.oe?t.ue=new W("B378/S124567/4"):t.ue=new D(O),t.ae=-25,t.fe=-25,t.he=!1,I(t)):(Math.random()<Math.exp(t.fe)||t.me)&&"CustomRule"!=t.oe&&(t.ue.se(),"VariableGR"==t.oe&&t.le.se(),t.fe=-25,t.me=!1,I(t));let s=Math.max(t.Me/30,1);t.ae=t.ae+t.pe*s,t.ae>0&&(t.ae=0),t.fe=t.fe+t.be*s,t.fe>0&&(t.fe=0)}function I(t){var e=document.getElementById("currentStyle");e&&(e.value=t.ue.V())}function G(t){let e={};for(let s in t){if("t"==s)continue;let r=Math.floor(3*Math.random())-1,n=t[s]+r;n=Math.max(0,Math.min(255,n)),e[s]=n}return e.de=t.de,e}function q(t,e,s,r,n){let i=(e+r+t.we)%t.we,a=(s+n+t.ge)%t.ge,h=i,o=a;return(i-e-r>0||i-e-r<0)&&(o=(t.ge-a-t.ke+t.ge)%t.ge),(a-s-n>0||a-s-n<0)&&(h=(t.we-i-t.ve+t.we)%t.we),[h,o]}function z(t,e,s,r,n){let i=(e+r+t.we)%t.we,a=(s+n+t.ge)%t.ge,h=i,o=a;return(i-e-r>0||i-e-r<0)&&(o=(t.ge-a-t.ke+t.ge)%t.ge),a-s-n>0?h=(i+t.ve+t.we)%t.we:a-s-n<0&&(h=(i-t.ve+t.we)%t.we),[h,o]}function L(t,e,s,r,n){let i=(e+r+t.we)%t.we,a=(s+n+t.ge)%t.ge,h=i,o=a;return i-e-r>0?o=(a+t.ke+t.ge)%t.ge:i-e-r<0&&(o=(a-t.ke+t.ge)%t.ge),(a-s-n>0||a-s-n<0)&&(h=(t.we-i-t.ve+t.we)%t.we),[h,o]}function X(t,e,s,r,n){let i=(e+r+t.we)%t.we,a=(s+n+t.ge)%t.ge,h=i,o=a;return i-e-r>0?o=(a+t.ke+t.ge)%t.ge:i-e-r<0&&(o=(a-t.ke+t.ge)%t.ge),a-s-n>0?h=(i+t.ve+t.we)%t.we:a-s-n<0&&(h=(i-t.ve+t.we)%t.we),[h,o]}function Y(t){t.Re&&t.Se?t.t=q:t.Re?t.t=z:t.Se?t.t=L:t.t=X}function H(t,e){if(t.Ce){var s={...t.Ne};delete s.ye,delete s.It;var r={...s,event:e},n=Object.keys(r).join(",")+"\n";n+=Object.values(r).join(",");var i=new Blob([n],{type:"text/csv"}),a=URL.createObjectURL(i),h=document.createElement("a");h.href=a,h.download="dataAutomata.csv",h.click()}}function J(t,e,s){var r=function(t){var e=Math.exp(-t),s=1,r=0;do{r++,s*=Math.random()}while(s>e);return r-1}(10**(t.xe+t.ue._t[0].j));if(0!=r)for(var n=t.ue._t[0].F,i=t.ue._t[0].W,a=0;a<r;a++){var h=Math.floor(Math.random()*t.we),o=Math.floor(Math.random()*t.ge);K(e,t,i[n()],h,o,s)}}function K(t,e,s,r,n,i){null===s?s=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?et(t,t):e<.2?Z(t,t):e<.3?Q(t,t):e<.4?function(t){let e=new g(t,t);for(let s=0;s<t;s++)for(let r=s;r<t;r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,s,e.get(s,r));return e}(t):e<.5?function(t){let e=new g(t,t);for(let s=0;s<t;s++)for(let r=s;r<t;r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(t-1-r,t-1-s,e.get(s,r));return e}(t):e<.6?_(t,t):e<.7?tt(t,t):e<.8?function(t){let e=new g(t,t);for(let s=0;s<t;s++)for(let r=Math.max(s,t-s);r<t;r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,s,e.get(s,r)),e.set(t-1-r,t-1-s,e.get(s,r)),e.set(t-1-s,t-1-r,e.get(s,r));return e}(t):e<.9?function(t){let e=new g(t,t);for(let s=0;s<Math.ceil(t/2);s++)for(let r=0;r<Math.ceil(t/2);r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,t-1-s,e.get(s,r)),e.set(t-1-s,t-1-r,e.get(s,r)),e.set(t-1-r,s,e.get(s,r));return e}(t):function(t){let e=new g(t,t);for(let s=0;s<Math.ceil(t/2);s++)for(let r=0;r<Math.ceil(t/2);r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,t-1-s,e.get(s,r)),e.set(t-1-s,t-1-r,e.get(s,r)),e.set(t-1-r,s,e.get(s,r)),e.set(t-1-s,r,e.get(s,r)),e.set(t-1-r,t-1-s,e.get(s,r)),e.set(s,t-1-r,e.get(s,r)),e.set(r,s,e.get(s,r));return e}(t)}(e);else{t=function(t,e){let s=Math.random();return s<.2?et(t,e):s<.4?Z(t,e):s<.6?Q(t,e):s<.8?_(t,e):tt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&s.N(),Math.random()<.5&&s.flipX(),Math.random()<.75&&s.flipY());let a=s.height,h=s.width;for(let o=0;o<a;o++)for(let u=0;u<h;u++){let l=i(e,r,n,o-Math.floor(a/2),u-Math.floor(h/2));t.set(l[0],l[1],s.get(o,u))}}function Q(t,e){let s=new g(e,t);for(let r=0;r<t;r++)for(let t=0;t<Math.ceil(e/2);t++)s.set(r,t,Math.floor(1e5*Math.random())),s.set(r,e-1-t,s.get(r,t));return s}function Z(t,e){let s=new g(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<e;n++)s.set(r,n,Math.floor(1e5*Math.random())),s.set(t-1-r,n,s.get(r,n));return s}function _(t,e){let s=new g(e,t);for(let r=0;r<t;r++)for(let n=0;n<Math.ceil(e/2);n++)s.set(r,n,Math.floor(1e5*Math.random())),s.set(t-1-r,e-1-n,s.get(r,n));return s}function tt(t,e){let s=new g(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(e/2);n++)s.set(r,n,Math.floor(1e5*Math.random())),s.set(t-1-r,n,s.get(r,n)),s.set(r,e-1-n,s.get(r,n)),s.set(t-1-r,e-1-n,s.get(r,n));return s}function et(t,e){let s=new g(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)s.set(r,t,Math.floor(1e5*Math.random()));return s}function st(t){!function(t){let e=t.Be,s=t.Ae;for(var r=0,n=0,i=0;i<t.we;i++)for(var a=0;a<t.ge;a++){if(0==t.Pe.get(i,a))continue;r+=1;var h=Math.floor(t.grid.get(i,a)/t.ue.Zt)%4;let e;if(0==h)e=t.backgroundColor;else if(1==h)e=t.Ue;else if(2==h)e=t.Ve;else{if(3!=h)continue;e=t.Oe}let o=4*(i*t.ge+a);n+=Math.sqrt((s.data[o+0]-e.r)**2+(s.data[o+1]-e.g)**2+(s.data[o+2]-e.b)**2),s.data[o+0]=e.r,s.data[o+1]=e.g,s.data[o+2]=e.b,s.data[o+3]=e.de}if(t.Te=.01*r+.99*t.Te,t.Me=.01*n/(t.ge*t.we)+.99*t.Me,t.time%30==0&&console.log("Mean color change: "+t.Me.toFixed(1)+"."),t.Me>130){t.he=!0;var o=t.Te/(t.we*t.ge);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+o.toFixed(1)+")."),console.log("Changing rule because suspected oscillation (std of color change: "+t.Me.toFixed(1)+")."),t.Te=15,t.Me=10,H(t,"oscillation")}t.Te<3&&(t.he=!0,console.log("Changing rule because not enough cells changed ("+t.Te+")."),t.Te=20,H(t,"blackout")),e.putImageData(s,t.$e,t.je)}(t),function(t){var r=[new Uint8Array(e[0]).fill(0),new Uint8Array(e[1]).fill(0)],n=new Uint8Array(5).fill(0),i=new g(t.ge,t.we),a=t.grid;const h=t.time;for(var o=0;o<t.we;o++)for(var u=0;u<t.ge;u++){var l=s(t,o,u,a,r,n,h);const e=t.grid.get(o,u);var c=e;c="VariableGR"!=t.oe||0==t.mask.get(o,u)?t.ue.U(e,c,l,t.time):t.le.U(e,c,l,t.time),Math.floor(c/t.ue.Zt)%4!=Math.floor(e/t.ue.Zt)%4?t.Pe.set(o,u,1):t.Pe.set(o,u,0),i.set(o,u,c);for(let t=0;t<r.length;t++)r[t].fill(0);n.fill(0)}t.We&&J(t,i,t.t),t.grid=i}(t),F(t),t.time=(t.time+1)%166320,t.De&&function(t){Math.random()<1e-4&&(t.ke=Math.floor(Math.random()*t.ge),console.log("Periodicity shift X: "+t.ke)),Math.random()<1e-4&&(t.ve=Math.floor(Math.random()*t.we),console.log("Periodicity shift Y: "+t.ve)),Math.random()<1e-4&&(t.Re=!t.Re,Y(t),console.log("Flip X: "+t.Re)),Math.random()<1e-4&&(t.Se=!t.Se,Y(t),console.log("Flip Y: "+t.Se))}(t),"variable"==t.Ee&&function(t){Math.random()<1&&(t.Oe=G(t.Oe),t.Ve=G(t.Ve))}(t),setTimeout((function(){requestAnimationFrame((()=>st(t)))}),t.timeout)}console.log("Loading main.js");var rt=document.getElementById("gameCanvas"),nt=rt.getContext("2d"),it=29,at=78,ht=80,ot=!1,ut=-0,lt=!1,ct=0,ft=0,mt=!1,Mt=!1,pt="mouseAnimation",bt="Variable",dt="zero",wt=6,gt=new class{constructor(t,e,s=200,r=200,n=20,i=!0,a=-2,h=!0,o=0,u=0,l=!1,c=!1,f="black2",m="VariableGR",M="random",p=6,b=2e4,d=2e3){this.we=s,this.ge=r,this.$e=0,this.je=0,this.timeout=n,this.grid=null,this.Pe=null,this.Ae=null,this.canvas=t,this.Be=e,this.We=i,this.xe=a,this.De=h,this.ke=o,this.ve=u,this.Re=l,this.Se=c,this.Ee=f,this.oe=m,this.Fe=M,this.Ie=p,this.Ge=null,this.qe=null,this.t=null,this.mask=null,this.ze=b,this.Le=d,this.ae=-25,this.fe=-25,this.pe=25/this.ze,this.be=25/this.Le,this.canvas.width=this.ge,this.canvas.height=this.we,this.Ae=e.createImageData(t.width,t.height),this.he=!0,this.me=!1,this.Te=0,this.Me=0,this.Ce=!1,this.time=0}}(rt,nt,it,at,ht,ot,ut,lt,ct,ft,mt,Mt,pt,bt,dt,wt);window.onload=function(){gt.grid=new g(gt.ge,gt.we),gt.Pe=new g(gt.ge,gt.we);const t=document.getElementById("background"),e=t.getContext("2d");gt.Xe=t;const s=new Image;s.src="./grWebsiteBackgroundTransp.png?"+(new Date).getTime(),s.onload=function(){e.drawImage(s,0,0,t.width,t.height)},function(t){t.Xe.addEventListener("mousemove",(function(e){var s=t.canvas.getBoundingClientRect(),r=e.clientX-s.left,n=e.clientY-s.top,i=s.width/t.ge,a=s.height/t.we,h=Math.floor(r/i),o=Math.floor(n/a);t.grid.set(o,h,1)}))}(gt),function(t){t.Xe.addEventListener("mousedown",(function(e){var s=t.canvas.getBoundingClientRect(),r=e.clientX-s.left,n=e.clientY-s.top,i=s.width/t.ge,a=s.height/t.we,h=Math.floor(r/i),o=Math.floor(n/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(o,(h+1)%t.ge,1),t.grid.set(o,h,1),t.grid.set((o+1)%t.we,h,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(o,h,1),t.grid.set((o+1)%t.we,h,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(o,h,1),t.grid.set(o,(h+1)%t.ge,1)):(t.grid.set((o+1)%t.we,(h+1)%t.ge,1),t.grid.set((o-1+t.we)%t.we,(h+1)%t.ge,1),t.grid.set((o-1+t.we)%t.we,(h-1+t.ge)%t.ge,1),t.grid.set((o+1)%t.we,(h-1+t.ge)%t.ge,1))}))}(gt),function(t){var e={r:247,g:255,b:28,de:255},s={r:13,g:112,b:255,de:255},r={r:240,g:239,b:239,de:255},n={r:0,g:0,b:0,de:255},i={r:240,g:240,b:240,de:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),de:255},h={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),de:255};"yellow"==t.Ee?(t.backgroundColor=e,t.Ue=n,t.Ve=s,t.Oe=r):"blue"==t.Ee?(t.backgroundColor=s,t.Ue=r,t.Ve=n,t.Oe=e):"blue2"==t.Ee?(t.backgroundColor=s,t.Ue=e,t.Ve=n,t.Oe=r):"grey"==t.Ee?(t.backgroundColor=r,t.Ue=n,t.Ve=s,t.Oe=e):"grey2"==t.Ee?(t.backgroundColor=r,t.Ue=e,t.Ve=n,t.Oe=s):"black"==t.Ee?(t.backgroundColor=n,t.Ue=s,t.Ve=e,t.Oe=r):"black2"==t.Ee?(t.backgroundColor=n,t.Ue=s,t.Ve=r,t.Oe=e):"blackTrace"==t.Ee?(t.backgroundColor=n,t.Ue=r,t.Ve=n,t.Oe=r):"blackTrace2"==t.Ee?(t.backgroundColor=n,t.Ue=n,t.Ve=n,t.Oe=r):"blackTrace3"==t.Ee?(t.backgroundColor=n,t.Ue=n,t.Ve=r,t.Oe=r):"redblue"==t.Ee?(t.backgroundColor=n,t.Ue=i,t.Ve={r:221,g:85,b:12,de:255},t.Oe={r:49,g:130,b:189,de:255}):"variable"==t.Ee?(t.backgroundColor=n,t.Ue=i,t.Ve=a,t.Oe=h):"mouseAnimation"==t.Ee&&(t.backgroundColor={r:0,g:0,b:0,de:0},t.Ue=s,t.Ve=n,t.Oe=e)}(gt),Y(gt),function(t){F(t,!0)}(gt),st(gt)}})();
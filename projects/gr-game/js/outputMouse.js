(()=>{"use strict";var t={},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,i),o.exports}class r{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.transposed=!1,this.get=this.getNormal,this.set=this.setNormal}static fromArray(t,e=!1,i=!1,n=!1){const o=t.length,a=t[0].length,s=new r(a,o);for(let e=0;e<o;e++){n&&(e=o-e-1);for(let r=0;r<a;r++)i&&(r=a-r-1),s.set(e,r,t[e][r])}return e&&s.transpose(),s}transpose(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.transposed?[this.getNormal,this.setNormal]:[this.getTransposed,this.setTransposed],this.transposed=!this.transposed}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const i=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,i)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const i=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,i)}}getNormal(t,e){return this.data[t*this.width+e]}setNormal(t,e,i){this.data[t*this.width+e]=i}getTransposed(t,e){return this.data[e*this.height+t]}setTransposed(t,e,i){this.data[e*this.height+t]=i}}class n{constructor({r:t=0,g:e=0,b:i=0,t:r=255,drift:n=0,redPerturbationStrength:o=0,greenPerturbationStrength:a=0,bluePerturbationStrength:s=0,brightnessPerturbationStrength:l=0}={}){this.r=t,this.g=e,this.b=i,this.t=r,this.drift=n,this.redPerturbationStrength=o,this.greenPerturbationStrength=a,this.bluePerturbationStrength=s,this.brightnessPerturbationStrength=l,this.updateDoubles()}updateDoubles(){this.redPertStrength2=2*this.redPerturbationStrength,this.greenPertStrength2=2*this.greenPerturbationStrength,this.bluePertStrength2=2*this.bluePerturbationStrength,this.brightnessPertStrength2=2*this.brightnessPerturbationStrength}}function o(t){let e=t;for(let i of["r","g","b"]){let r=Math.round(2*Math.random()*t.drift-t.drift),n=t[i]+r;n=Math.max(0,Math.min(255,n)),e[i]=n}return e}function a(){return 10**(1.5*Math.random()-.5)}function s(){return Math.floor(256*Math.random())}function l(){return 21*Math.random()}function h(){return new n({r:s(),g:s(),b:s(),t:255,drift:a(),redPerturbationStrength:l(),greenPerturbationStrength:l(),bluePerturbationStrength:l(),brightnessPerturbationStrength:l()})}function g(t){return new n({r:t.r,g:t.g,b:t.b,t:t.t,drift:t.drift,redPerturbationStrength:l(),greenPerturbationStrength:l(),bluePerturbationStrength:l(),brightnessPerturbationStrength:l()})}function d(t){var e=new n({r:13,g:112,b:255}),i=new n({r:240,g:239,b:239}),r=new n({r:0,g:0,b:0}),o=new n({r:247,g:255,b:28}),a=new n({r:255,g:255,b:255}),s=new n({r:240,g:240,b:240}),l=new n({r:221,g:12,b:12}),d=new n({r:29,g:29,b:189}),u=new n({r:39,g:192,b:177}),c=new n({r:252,g:53,b:47}),f=new n({r:156,g:36,b:150}),m=new n({r:114,g:223,b:174}),b=new n({r:0,g:0,b:0,t:0}),w=new n({r:75,g:75,b:75}),y=new n({r:175,g:175,b:175}),S=[new n({r:255,g:0,b:0}),new n({r:0,g:255,b:0}),new n({r:0,g:0,b:255}),new n({r:255,g:255,b:0}),new n({r:255,g:0,b:255}),new n({r:0,g:255,b:255})],p=new n({r:0,g:0,b:0}),C=new n({r:85,g:85,b:85}),M=new n({r:0,g:0,b:170}),v=new n({r:85,g:85,b:255}),B=new n({r:0,g:170,b:0}),I=new n({r:85,g:255,b:85}),N=new n({r:0,g:170,b:170}),P=new n({r:85,g:255,b:255}),R=new n({r:170,g:0,b:0}),x=new n({r:255,g:85,b:85}),F=new n({r:170,g:0,b:170}),H=new n({r:255,g:85,b:255}),W=new n({r:170,g:85,b:0}),A=new n({r:255,g:255,b:85}),L=new n({r:170,g:170,b:170}),k=new n({r:255,g:255,b:255}),T=[p,C,M,v,B,I,N,P,R,x,F,H,W,A,L,k];if(t.driftColors=[!1,!1,!1,!1],"variable"==t.colorPalette){t.nColors=Math.floor(6*Math.random())+2,t.colors=[g(r),g(s)];for(var G=t.nColors-t.colors.length,E=0;E<G;E++)t.colors.push(h())}if("allRandom"==t.colorPalette){t.nColors=Math.floor(6*Math.random())+2,t.colors=[];for(E=0;E<t.nColors;E++)t.colors.push(h())}else if("monochrome"==t.colorPalette)t.colors=[r,a,w,y];else if("basic"==t.colorPalette){let e=S[Math.floor(Math.random()*S.length)],i=S[Math.floor(Math.random()*S.length)];for(;e==i;)i=S[Math.floor(Math.random()*S.length)];t.colors=[r,a,e,i]}else if("cga-4"==t.colorPalette)t.colors=[p,k,P,H];else if("cga-16"==t.colorPalette){t.nColors=Math.floor(6*Math.random())+2;var U=T.slice();!function(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}(U),t.colors=U.slice(0,t.nColors)}else"blackwhite"==t.colorPalette?t.colors=[r,a,r,a]:"yellow"==t.colorPalette?t.colors=[o,r,e,i]:"blue"==t.colorPalette?t.colors=[e,i,r,o]:"blue2"==t.colorPalette?t.colors=[e,o,r,i]:"grey2"==t.colorPalette?t.colors=[i,o,r,e]:"black2"==t.colorPalette?t.colors=[r,e,i,o]:"blackTrace"==t.colorPalette?t.colors=[r,i,r,i]:"redBlue"==t.colorPalette?t.colors=[r,s,l,d]:"turquoiseRed"==t.colorPalette?t.colors=[r,s,u,c]:"magentaCyan"==t.colorPalette?t.colors=[r,s,f,m]:"mouseAnimation"==t.colorPalette&&(t.colors=[b,e,r,o]);t.nColors=t.colors.length,t.colorCount=new Array(t.nColors).fill(0)}function u(t){if("VariableGR"!=t.metaRule)for(var e of t.colors)0!=e.redPerturbationStrength&&(e.redPerturbationStrength=l()),0!=e.greenPerturbationStrength&&(e.greenPerturbationStrength=l()),0!=e.bluePerturbationStrength&&(e.bluePerturbationStrength=l()),0!=e.brightnessPerturbationStrength&&(e.brightnessPerturbationStrength=l()),e.updateDoubles()}function c(t){for(var e of t.colors)0!=e.drift&&(e.drift=a())}function f(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),i=Object.values(t).reduce(((t,i,r)=>[...t,i/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=i.findIndex((t=>e<t));return Object.keys(t)[r]}}const m=15;function b(t,e,i,r,n,o,a,s,l){const h=r.height-1,g=r.width-1,d=r.data,u=r.width;var c=n[0],f=n[1];let m;for(var b=-1;b<=1;b++)for(var w=-1;w<=1;w++){if(0==b&&0==w)continue;if(o[0]=((-1===b?1:b)+(-1===w?1:w))%2,o[a%4+1]=-1==b?1:0,o[(1+a)%4+1]=-1==w?1:0,o[(2+a)%4+1]=1==b?1:0,o[(3+a)%4+1]=1==w?1:0,o[(1+a)%2+5]=b*w==1?0:1,o[a%2+5]=b*w==-1?0:1,0==e||0==i||e==h||i==g)var[y,S]=t.findNeighbour(t,e,i,b,w);else var y=e+b,S=i+w;const r=d[y*u+S],n=r%s,C=Math.floor(r/s)%l;m=0;for(var p=0;p<s-1;p++)n==p+1&&(c[p]+=1,m+=s,c[m+p]+=o[0],m+=s,c[m+p]+=1-o[0],m+=s,c[m+p]+=o[1],m+=s,c[m+p]+=1-o[1],m+=s,c[m+p]+=o[2],m+=s,c[m+p]+=1-o[2],m+=s,c[m+p]+=o[3],m+=s,c[m+p]+=1-o[3],m+=s,c[m+p]+=o[4],m+=s,c[m+p]+=1-o[4],m+=s,c[m+p]+=o[5],m+=s,c[m+p]+=1-o[5],m+=s,c[m+p]+=o[6],m+=s,c[m+p]+=1-o[6]),m=0;for(m=0,p=0;p<l;p++)C==p&&(f[p]+=1,m+=l,f[m+p]+=o[0],m+=l,f[m+p]+=1-o[0],m+=l,f[m+p]+=o[1],m+=l,f[m+p]+=1-o[1],m+=l,f[m+p]+=o[2],m+=l,f[m+p]+=1-o[2],m+=l,f[m+p]+=o[3],m+=l,f[m+p]+=1-o[3],m+=l,f[m+p]+=o[4],m+=l,f[m+p]+=1-o[4],m+=l,f[m+p]+=o[5],m+=l,f[m+p]+=1-o[5],m+=l,f[m+p]+=o[6],m+=l,f[m+p]+=1-o[6]),m=0}return[c,f]}const w="mix",y="isotropic",S="xcross",p="vcross",C="xvcross",M="directional1",v="directional2",B="directional3",I="directional2b",N="directional",P="hexagonal1",R="hexagonal2",x={[w]:.2,[y]:.4,[S]:.05,[p]:.05,[C]:.05,[M]:.05,[v]:.05,[B]:.05,[I]:.05,[N]:.05,[P]:.05,[R]:.05};function F(t,e){var i,r=e;if(r==w){var n=Math.random();r=n<.5?y:n<.7?S:n<.9?p:N}return r==y?Math.floor(Math.random()*t):r==p?Math.floor(Math.random()*t+t):r==S?Math.floor(Math.random()*t+2*t):r==C?Math.floor(2*Math.random()*t+t):r==M?Math.floor(2*Math.random()*t+3*t):r==v?Math.floor(4*Math.random()*t+3*t):r==B?Math.floor(6*Math.random()*t+3*t):r==I?((i=Math.floor(4*Math.random()*t+3*t))>=5*t&&(i+=2*t),i):r==N?Math.floor(8*Math.random()*t+3*t):r==P?((i=Math.floor(2*Math.random()*t+11*t))>=12*t&&(i+=t),i):r==R?((i=Math.floor(2*Math.random()*t+12*t))>=13*t&&(i+=t),i):void 0}function H(t){var e=8;return[1,2].includes(t)?e=4:[3,5,7,9].includes(t)?e=3:[4,6,8,10].includes(t)?e=5:[11,13].includes(t)?e=6:[12,14].includes(t)&&(e=2),e}const W="A",A="C",L="E",k="B";class T{constructor(t,e,i,r,n,o=null,a=4){this.type=t,this.threshold=e,this.neighbourType=i,this.inactivation=r,this.modulo=n,this.periodicity=o,this.nStatesPrimary=a,this.testInactive=function(t,e){return t==A?function(t){return 0==t}:t==W?function(t){return t%e==0}:function(t){return!0}}(this.inactivation,this.modulo);var s=[i[0],i[1][0]*a+i[1][1]];this.neighbourType.length>2&&s.push(i[2][0]*a+i[2][1]),this.testValue=function(t,e,i){return e==L&&2==i.length?function(e){return e[i[0]][i[1]]==t}:e==k&&2==i.length?function(e){return e[i[0]][i[1]]>t}:e==L&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]==t}:e==k&&3==i.length?function(e){return e[i[0]][i[1]]+e[i[0]][i[2]]>t}:void 0}(this.threshold,this.type,s),this.testPeriodicity=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(o)}test(t,e,i){var r=this.testPeriodicity(i);return this.testValue(t)&&this.testInactive(e)&&r}name(){var t="";null!=this.periodicity&&(t=this.periodicity.map((t=>t?"1":"0")).join(""));var e=`${this.neighbourType[0]}|`;e+=`${this.neighbourType[1][0]}:${this.neighbourType[1][1]}`,this.neighbourType.length>2&&(e+=`|${this.neighbourType[2][0]}:${this.neighbourType[2][1]}`);var i=this.inactivation;return this.inactivation==W&&(i+=this.modulo),`${this.type}${this.threshold}${i}[${e}]${t}`}static fromName(t){var e=null,i=4;t.startsWith(L)?e=L:t.startsWith(k)&&(e=k);var r=t.substring(e.length),n=parseInt(r.substring(0,1)),o=null;(r=r.substring(1)).startsWith(A)?o=A:r.startsWith(W)?(isNaN(r.charAt(1))||(i=parseInt(r.charAt(1)),r=r.substring(1)),o=W):r.startsWith("N")&&(o="N");var a=(r=r.substring(o.length)).split("[")[1].split("]")[0].split("|"),s=[parseInt(a[0])],l=a[1].split(":").map((t=>parseInt(t)));if(s.push(l),a.length>2){var h=a[2].split(":").map((t=>parseInt(t)));s.push(h)}var g=null;return(r=r.split("]")[1]).length>0&&(g=r.split("").map((t=>"1"===t))),new T(e,n,s,o,i,g)}static randomSample(t,e,i=null,r=w,n=null){var o=[t,e];const a=[L,k],s=a[Math.floor(Math.random()*a.length)],l=[A,W,"N"],h=l[Math.floor(Math.random()*l.length)];null===i&&(i={0:2/3,1:1/3});const g=f(i)(),d=F(o[g],r),u=[Math.floor(d/o[g]),d%o[g]];var c=void 0;if(Math.random()<.5){for(var m=F(o[g],r);d==m;)m=F(o[g],r);c=[g,u,[Math.floor(m/o[g]),m%o[g]]]}else c=[g,u];var b=0,y=H(c[1][0]);c.length>2&&H(c[2][0])>y&&(y=H(c[2][0])),b=s===k?Math.floor(Math.random()*y):Math.floor(Math.random()*y)+1;var S=Math.floor(5*Math.random())+2;if(Math.random()<.2)p=null;else{var p;null==n&&(n=Math.floor(20*Math.random())+2);do{p=new Array(n).fill(0).map((()=>Math.random()<.5))}while(!p.includes(!0))}return new T(s,b,c,h,S,p,t)}}class G{constructor(){this.nStates=void 0}updateRule(t,e,i,r){throw new Error("Must override method")}getName(){throw new Error("Must override method")}}class E extends G{constructor(){super(),this.seedingPatterns=this.getSeedingPatterns(),this.constructSeedingSampler(),this.randomnessLogShift=0}getSeedingPatterns(){throw new Error("Must override method")}constructSeedingSampler(){this.seedMasks=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].mask));let t=Object.keys(this.seedingPatterns).map((t=>this.seedingPatterns[t].prob));this.seedSampler=f(t)}}class U extends E{constructor(t){super(),null==t&&(t=U.generateRule()),this.initialiseRule(t)}updateRule(t,e,i,r){var n=t%this.nStates;return 1==n&&this.survive.includes(i[0][this.neighbourhood[0]])?e=1:n>0&&n<this.nStates-1?e+=1:n==this.nStates-1?e=0:0==n&&this.birth.includes(i[0][this.neighbourhood[1]])?e=1:0==n&&this.inhibited.includes(i[0][this.neighbourhood[2]])&&(e=this.nStates-1),e}sampleDigitsInBrackets(t){return t.replace(/\[([0-9]+)\]|\{([0-9|]+)\}/g,((t,e,i)=>{if(e){let t="";for(const i of e)Math.random()>.5&&(t+=i);return t}if(i){const t=i.split("|");return t[Math.floor(Math.random()*t.length)]}}))}initialiseRule(t){this.ruleString=this.sampleDigitsInBrackets(t),console.log("Sampled rulestring: ",this.ruleString);const e=this.ruleString.split("/");for(var i of(this.neighbourhood=[0,0,0],this.inhibited=[],this.nStates=Number(e[e.length-1]),e))"N"==i[0]?(this.neighbourhood=i.substring(1).split("|").map((t=>{const[e,i]=t.split(":");return i?parseInt(e)*this.nStates+parseInt(i):parseInt(e)})),this.neighbourhood.length<3&&(this.neighbourhood=[this.neighbourhood[0],this.neighbourhood[0],this.neighbourhood[0]])):"B"==i[0]?this.birth=new Uint8Array(i.substring(1).split("").map(Number)):"S"==i[0]?this.survive=new Uint8Array(i.substring(1).split("").map(Number)):"I"==i[0]&&(this.inhibited=new Uint8Array(i.substring(1).split("").map(Number)))}static generateRule(t){let e=Math.floor(10*Math.random())+3,i=[8,8,8];null==t&&(t=[Math.floor(Math.random()*m*e),Math.floor(Math.random()*m*e),Math.floor(Math.random()*m*e)]);let r=[Math.floor(t[0]/e)%m,Math.floor(t[1]/e)%m,Math.floor(t[2]/e)%m];for(let t=0;t<3;t++)i[t]=H(r[t]);let n=this.generateRandomArray(1,i[0]);0==n.length&&(n=[2]);let o=this.generateRandomArray(1,i[1]),a=this.generateRandomArray(1,i[2]);return a=a.filter((t=>!n.includes(t)&&!o.includes(t)&&2!=t)),this.getRuleString(t,n,o,a,e)}static getRuleString(t,e,i,r,n){return`N${t.map((t=>Math.floor(t/n)%m+":"+t%n)).join("|")}/B${e.join("")}/S${i.join("")}/I${r.join("")}/${n}`}static generateRandomArray(t,e){let i=[];for(let r=t;r<=e;r++)Math.random()<.5&&i.push(r);return i}getName(){return this.ruleString}getSeedingPatterns(){return{random:{prob:1,mask:null}}}}class D extends U{constructor(t,e=null){if(super(t),"ships"==e){this.initialiseRule(this.ruleString),this.neighbourhood[0]=0;let t=Array.from(this.birth).indexOf(1);if(-1!==t){let e=new Uint8Array(this.birth.length-1);e.set(this.birth.subarray(0,t),0),e.set(this.birth.subarray(t+1),t),this.birth=e}if(-1===this.birth.indexOf(2)){let t=new Uint8Array(this.birth.length+1);t[0]=2,t.set(this.birth,1),this.birth=t}if(t=Array.from(this.survive).indexOf(1),-1!==t){let e=new Uint8Array(this.survive.length-1);e.set(this.survive.subarray(0,t),0),e.set(this.survive.subarray(t+1),t),this.survive=e}this.inhibited=this.inhibited.filter((t=>!this.birth.includes(t)&&!this.survive.includes(t)&&2!=t)),this.ruleString=U.getRuleString(this.neighbourhood,this.birth,this.survive,this.inhibited,this.nStates),this.activationFactor=1,this.randomnessLogShift=.5}else this.activationFactor=20/this.birth[0]**3,this.randomnessLogShift=1.5}updateRule(t,e,i,r,n){var o=t%this.nStates;return 1==o&&this.survive.includes(i[0][this.neighbourhood[0]])?e=1:o>0&&o<this.nStates-1?e+=1:o==this.nStates-1?e=0:0==o&&this.birth.includes(i[0][this.neighbourhood[1]])&&Math.random()>this.activationFactor*n-.05?e=1:0==o&&this.inhibited.includes(i[0][this.neighbourhood[2]])&&(e=this.nStates-1),e}getName(){return`SGen/${this.ruleString}`}initialiseRule(t){"SGen"==t.substring(0,4)?super.initialiseRule(t.substring(5)):super.initialiseRule(t)}}class X extends G{constructor(t,e,i,r,n=4){super(),this.conditions=t,this.nStates=this.conditions.length+1,this.nStatesPrimary=n,this.conditionLevels=e,this.neighbourhoodGeometryType=i,this.periodicityLength=r}updateRule(t,e,i,r){e=0;for(let n=0;n<this.conditions.length;n++)if(this.conditions[n].test(i,t,r)){e=n+1;break}return e}getName(){return this.conditions.map((t=>t.name())).join("||")}static sampleRule(t,e){var i=t.nConditions,r=t.chosenConditionLevels,n=t.neighbourhoodGeometryType,o=t.periodicityLength,a=[];null==i&&(i=Math.floor(8*Math.random())+2),null==n&&(n=f(x)()),null==o&&(o=this.samplePeriodicityLength());var s=i+1;for(let t=0;t<i;t++)a.push(T.randomSample(e,s,r,n,o));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+a.map((t=>t.name())).join(", ")),new X(a,r,n,o,e)}static samplePeriodicityLength(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static ruleFromNames(t){var e=t.split("||").map((t=>T.fromName(t)));return new X(e,null,w,null)}evolveRule(t=null){var e,i=this.conditions.length;null==t&&(t=this.conditionLevels),0==(e=2==i?Math.floor(2*Math.random())+1:10==i?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.removeCondition():1==e?this.changeCondition(t):this.addCondition(t)}addCondition(t){var e=this.conditions.slice();e.push(T.randomSample(this.nStatesPrimary,this.nStates,this.conditionLevels,this.neighbourhoodGeometryType,this.periodicityLength)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}removeCondition(){var t=this.conditions.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.conditions=t}changeCondition(t){var e=this.conditions.slice(),i=Math.floor(Math.random()*e.length);e[i]=T.randomSample(this.nStatesPrimary,this.nStates,t,this.neighbourhoodGeometryType,this.periodicityLength),console.log((new Date).toLocaleTimeString()+" Changing condition "+i+" to "+this.neighbourhoodGeometryType+": "+e.map((t=>t.name())).join("||")),this.conditions=e}}class Y{colorUnit;ruleChain;updateRule;setRuleChain(){throw new Error("Must override method")}setUpdateRule(){this.updateRule=function(t,e,i,r,n){e=this.ruleChain[0].updateRule(t%this.ruleChain[0].nStates,e,i,r,n);var o=this.ruleChain[0].nStates;for(let n=1;n<this.ruleChain.length;n++)e+=o*this.ruleChain[n].updateRule(Math.floor(t/o)%this.ruleChain[n].nStates,e,i,r),e%=o*=this.ruleChain[n].nStates;return e%o}}setBaseRule(){throw new Error("Must override method")}setStyleRule(){throw new Error("Must override method")}getName(){return this.ruleChain.map((t=>t.getName())).join("-")}}class V extends Y{constructor(t){super(),this.ruleConfig=t.config.ruleConfig,this.styleConfig=t.config.styleConfig,this.coloringConfig=t.config.coloringConfig,this.randomnessConfig=t.config.randomnessConfig,this.sanityConfig=t.config.sanityConfig,this.currentGenerationsRule=null,this.setRuleChain(t),this.setUpdateRule()}setRuleChain(t){this.ruleChain=[null],this.setBaseRule(t),this.setStyleRule(t)}setBaseRule(t){this.ruleConfig=t.config.ruleConfig;let e=f(this.ruleConfig.rules)();var i=U;if("SGen"==e.substring(0,4)&&(e=e.substring(5),i=D),["Random","andom"].includes(e))e=null;else for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}this.ruleChain[0]=new i(e),this.colorUnit=this.ruleChain[0].nStates}setStyleRule(t){if(this.styleConfig=t.config.styleConfig,0===Object.keys(this.styleConfig).length||"No style"==this.styleConfig.name)return this.colorUnit=1,void(this.ruleChain=this.ruleChain.slice(0,1));for(;this.ruleChain.length>1;)this.ruleChain.pop();if(this.styleConfig.style)return this.ruleChain.push(X.ruleFromNames(this.styleConfig.style)),void(this.colorUnit=this.ruleChain[0].nStates);var e=this.styleConfig.conditionLevels,i=f(e.reduce(((t,e,i)=>(t[i]=e.weight,t)),{}))();this.styleConfig.chosenConditionLevels=e[i].probabilities;var r=this.ruleChain[0].nStates;this.ruleChain.push(X.sampleRule(this.styleConfig,r)),this.colorUnit=this.ruleChain[0].nStates}updateGlobalDataWithConfig(t){}}var j=2e4;const O={Test:{name:"Test",rules:{"SGen/N0/B234/S2345[678]/I[12345678]/{25|30|35|40}":1},timeBetweenRuleChanges:j},Custom:{name:"Custom",rules:{}},"Asteroid fields family":{name:"Asteroid fields family",rules:{"N0/B2[5678]/S0[5678]/I[2345678]/4":1},timeBetweenRuleChanges:j},"Bloomerang family":{name:"Bloomerang family",rules:{"N0/B34[5678]/S234[678]/I[12345678]/{9|10|11|12|13|14|24}":1},timeBetweenRuleChanges:j},"Bombers family":{name:"Bombers family",rules:{"N0/B24[5678]/S345[678]/I[12345678]/{11|12|13|14}":1},timeBetweenRuleChanges:j},"Brian's brain":{name:"Brian's brain",rules:{"N0/B2/S/I345678/3":1},timeBetweenRuleChanges:j},"Modified Brian's brain":{name:"Modified Brian's brain",rules:{"N0/B2/S/I345678/3":1},timeBetweenRuleChanges:j},"Brian's brain family":{name:"Brian's brain family",rules:{"N0/B2[45678]/S[45678]/I[345678]/{3|4}":1},timeBetweenRuleChanges:j},"Brian's brain S0 family":{name:"Brian's brain S0 family",rules:{"N0/B2[45678]/S0[45678]/I[345678]/{4|5}":1},timeBetweenRuleChanges:j},"Burst family":{name:"Burst family",rules:{"N0/B34[568]/S0235[678]/I[345678]/5":1,"N0/B34[568]/S235[678]/I[345678]/5":1},timeBetweenRuleChanges:j},"Caterpillars family":{name:"Caterpillars family",rules:{"N0/B378/S124567/I1345678/3":5},timeBetweenRuleChanges:j},"Conway's game of life":{name:"Conway's game of life",rules:{"N0/B3/S23/I/2":1},timeBetweenRuleChanges:j},Crawlers:{name:"Crawlers",rules:{"N11:1|0:0|0:0/B2/S1/I1/6":1},timeBetweenRuleChanges:j},"Flaming ships":{name:"Flaming ships",rules:{"B24/S34/I15678/4":1},timeBetweenRuleChanges:j},"Flaming ships family":{name:"Flaming ships family",rules:{"N0/B24[678]/S34[678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":1},timeBetweenRuleChanges:j},"Leggy ships family":{name:"Leggy ships family",rules:{"N0/B23[5678]/S14[5678]/I1[2345678]/{5|6|7|8|9|10}":1},timeBetweenRuleChanges:j},"Life-like family":{name:"Life-like family",rules:{"N0/B34[5678]/S235[678]/I[45678]/5":1},timeBetweenRuleChanges:j},"Slow growth":{name:"Slow growth",rules:{"N0/B34[5678]/S234[678]/I2[45678]/{10|11|12|13|14|15|16|17|18|19|20}":1}},"Star wars":{name:"Star wars",rules:{"N0/B2/S345/I/4":1},timeBetweenRuleChanges:j},"Star wars family":{name:"Star wars family",rules:{"N0/B2[5678]/S345[78]/I[12345678]/{3|4}":6,"N0/B2[5678]/S345[678]/I[12345678]/{5|6|7|8|9|10}":1},timeBetweenRuleChanges:j},"Star wars S0 family":{name:"Star wars S0 family",rules:{"N0/B2[5678]/S0345[678]/I[12345678]/{7|8}":8},timeBetweenRuleChanges:j},"Star cruiser family":{name:"Star cruiser family",rules:{"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":15},timeBetweenRuleChanges:j},"Straight ships":{name:"Straight ships",rules:{"B2/S245678/I1/4":1},timeBetweenRuleChanges:j},"Straight ships family":{name:"Straight ships family",rules:{"N0/B2[5678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":1},timeBetweenRuleChanges:j},"Straight ships S0 family":{name:"Straight ships S0 family",rules:{"N0/B2[5678]/S02[45678]/I1[345678]/5":1},timeBetweenRuleChanges:j},"Trains family":{name:"Trains family",rules:{"N1:0|1:0|0:0/B14/S[34]/I1[345678]/{12|13|14|15|16|17|18|19|20}":1},timeBetweenRuleChanges:j},"Wiggly ships":{name:"Wiggly ships",rules:{"N0/B24568/S34678/I34678/7":1},timeBetweenRuleChanges:j},"Wiggly ships family":{name:"Wiggly ships family",rules:{"N0/B24568/S34678/I3[45678]/{4|5|6|7|8|9|10|11}":1},timeBetweenRuleChanges:j},"Safe mixed generations":{name:"Safe mixed generations",rules:{"N0/B2/S/I345678/3":20,"N0/B2/S/I/3":4,"N0/B2/S345/I/4":5,"B2/S245678/I1/4":5,"B24/S34/I15678/4":5,"N0/B3/S23/I/2":8,"N0/B2[45678]/S[45678]/I[345678]/{3|4}":12,"N0/B2[5678]/S345[78]/I[12345678]/{3|4}":6,"N0/B27/S345/I12357/5":4,"N0/B2[5678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":12,"N0/B24[678]/S34[678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":15,"N0/B34[5678]/S235[678]/I[45678]/5":15,"N0/B24568/S34678/I34678/7":5,"N0/B24568/S34678/I3[45678]/{4|5|6|7|8|9|10|11}":15,"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":15},timeBetweenRuleChanges:j},"Mixed generations":{name:"Mixed generations",rules:{"N0/B2/S/I345678/3":20,"N0/B2/S/I/3":4,"N0/B2/S345/I/4":5,"B2/S245678/I1/4":5,"B24/S34/I15678/4":5,"N0/B3/S23/I/2":8,"N0/B2[45678]/S[45678]/I[345678]/{3|4}":12,"N0/B2[5678]/S345[678]/I[12345678]/{5|6|7|8|9|10}":9,"N0/B2[5678]/S345[78]/I[12345678]/{3|4}":6,"N0/B2[5678]/S2[45678]/I1[345678]/{3|4|5|6|7|8}":12,"N0/B24[678]/S34[678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":15,"N0/B34[5678]/S235[678]/I[45678]/5":15,"N0/B23[5678]/S14[5678]/I1[2345678]/{5|6|7|8|9|10}":10,"N0/B34[5678]/S234[678]/I2[45678]/{10|11|12|13|14|15|16|17|18|19|20}":12,"N0/B34[5678]/S234[678]/I[12345678]/{9|10|11|12|13|14|24}":12,"N0/B24[5678]/S345[678]/I[12345678]/{11|12|13|14}":8,"N0/B34[568]/S0235[678]/I[345678]/5":8,"N0/B34[568]/S235[678]/I[345678]/5":8,"N0/B378/S124567/I1345678/3":5,"N0/B2[5678]/S0[5678]/I[2345678]/4":8,"N0/B2[5678]/S02[45678]/I1[345678]/5":8,"N0/B2[45678]/S0[45678]/I[345678]/{4|5}":8,"N0/B2[5678]/S0345[678]/I[12345678]/{7|8}":8,"N0/B27/S345/I12357/5":2,"N0/B245[678]/S34[678]/I[12345678]/{5|6|7|8}":15,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:{0|1}|0:0/B2[45678]/S2[45678]/I1[345678]/{9|10|11|12|13|14}":6,"N0/B23/S34[678]/I1[2345678]/{6|7|8|9|10|11|12|13}":3,"N0/B234[5678]/S2[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":12,"N0/B234[5678]/S3[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234[5678]/S[45678]/I1[5678]/{6|7|8|9|10|11|12|13|14}":8,"N0/B234578/S37/I/11":1,"N0/B23[45678]/S3[5678]/I[45678]/{5|6|7|8|9|10|11|12}":8,"N0/B2368/S358/I/5":1,"N0/B24[5678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":5,"N0/B24568/S3478/I34578/5":1,"N0/B24568/S3478/I34578/6":1,"N0/B24568/S3478/I34578/7":3,"N0/B24568/S34578/I34578/9":1,"N0/B24568/S34578/I34578/12":1,"N0/B24568/S34578/I34578/13":1,"N0/B24568/S34578/I34578/14":1,"N0/B24568/S34678/I34678/7":5,"N0/B24568/S34678/I3[45678]/{4|5|6|7|8|9|10|11}":15,"N0/B245[678]/S346[78]/I123[45678]/{4|5|6|7|8|9|10|11}":8,"N0/B25[678]/S3[45678]/I[5678]/{5|6|7|8|9|10|11|12|13|14}":12,"N0/B25/S345/I/4":1,"N0/B25/S345/I/5":1,"N0:0/B2[5678]/S34567/I1[345678]/{5|6|7|8|9|10|11|12|13|14}":5,"N0/B2[5678]/S34[5678]/I[5678]/{5|6}":15,"N0/B25678/S2478/I345678/12":1,"N0/B2568/S345678/I345678/8":1,"N0/B2568/S345678/I345678/10":1,"N0/B2568/S345678/I345678/12":1,"N0/B2568/S34578/I34578/4":1,"N0/B2568/S34578/I34578/5":1,"N0/B2568/S34578/I34578/6":1,"N0/B2568/S34578/I34578/7":1,"N0/B2568/S34578/I34578/8":1,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B2[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":15,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:{0|1}|0:0|0:0/B23[45678]/S1[345678]/I1[2345678]/{5|6|7|8|9|10|11|12|13|14|15}":6,"N1/B2[45678]/S3[45678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N1/B23[45678]/S1[2345678]/I[12345678]/{5|6|7|8|9|10|11|12|13|14}":3,"N5|1|18/B2[345678]/S1[345678]/I[345678]/{7|7|7|8|8|8|11|12|13|14|15}":8,"N11:1|0:0|0:0/B245/S1/I12357/6":3,"SGen/N0/B2[345678]/S[2345678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":20,"SGen/N0/B[12345678]/S[012345678]/I[12345678]/{3|4|5|6|7|8|9|10|11|12|13|14}":20,"N0/B1[2345678]/S[12345678]/I[12345678]/{25|50|75|100}":12,"N0/B1/S[5678]/I[2345678]/{25|50|75|100}":12,"N{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:0|{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:0|{0|1|2|3|4|5|6|7|8|9|10|11|12|13|14}:0/B1[2345678]/S[12345678]/I[12345678]/{25|50|75|100}":20,"N45|0|33/B2/S/I34/7":1,"N58|0|16/B24568/S/I1/{5|6|7|8}":3,"N66|0|67/B2/S23/I23/6":3,"N66|0|0/B2/S1/I1/6":2,"N67|0|0/B2/S1/I1/6":2},timeBetweenRuleChanges:j}};function $(t,e,i){return{probabilities:{0:t,1:e},weight:i}}const z={Mixed:[$(1,0,3),$(.8,.2,3),$(.5,.5,2),$(0,1,2)],Static:[$(1,0,1)],Dynamic:[$(0,1,1)]},q={Mixed:{name:"Mixed",nConditions:null,conditionLevels:z.Mixed,neighbourhoodGeometryType:null,periodicityLength:null,timeBetweenStyleChanges:2e3},"Mixed static":{name:"Mixed static",nConditions:null,conditionLevels:z.Static,neighbourhoodGeometryType:null,periodicityLength:null,timeBetweenStyleChanges:2e3},"Mixed constant":{name:"Mixed constant",nConditions:null,conditionLevels:z.Mixed,neighbourhoodGeometryType:null,periodicityLength:1,timeBetweenStyleChanges:2e3},"Mixed safe":{name:"Mixed safe",nConditions:null,conditionLevels:z.Static,neighbourhoodGeometryType:null,periodicityLength:1,timeBetweenStyleChanges:2e3},Custom:{name:"Custom",style:null},"No style":{name:"No style"}},K={Mixed:{ruleConfig:O["Mixed generations"],styleConfig:q.Mixed},"Mixed safe":{ruleConfig:O["Mixed generations"],styleConfig:q["Mixed safe"]},Safe:{ruleConfig:O["Modified Brian's brain"],styleConfig:q["Mixed safe"]},"Test rule":{ruleConfig:O.Test,styleConfig:q.Mixed},Custom:{ruleConfig:O.Custom,styleConfig:q.Custom}};function _(t,e=!1){if(Math.random()<Math.exp(t.ruleLogSwitchProbability)||e||t.changeRuleFlag){if(t.colorCount=new Array(t.nColors).fill(0),"VariableGR"==t.metaRule)t.nColors=4,t.config=K.Safe,t.ruleClass=new V(t),t.ruleClass2=new V(t),t.useLogo=!0;else if("VariableDemo"==t.metaRule)t.config=K["Mixed safe"],t.ruleClass=new V(t),t.useLogo=!1;else if("Variable"==t.metaRule)t.config=K["Mixed safe"],t.ruleClass=new V(t);else if("VariableMix"==t.metaRule)t.config=K.Mixed,t.ruleClass=new V(t);else if("VariableUnsafe"==t.metaRule)t.config=K.Mixed,t.ruleClass=new V(t);else if("VariableTest"==t.metaRule)t.config=K["Test rule"],t.ruleClass=new V(t);else if("CustomRule"==t.metaRule){t.config=K.Custom;var[i,r]=t.currentStyle.split("-");t.config.ruleConfig.rules={[i]:1},r?t.config.styleConfig.style=r:t.config.styleConfig={},t.ruleClass=new V(t)}else t.config=K["Default mixed"],t.ruleClass=new V(t);t.ruleLogSwitchProbability=-25,t.ruleLogEvolveProbability=-25,t.changeRuleFlag=!1,t.time=0,J(t),d(t)}t.changeBaseRuleFlag&&(t.ruleClass.setBaseRule(t),t.ruleLogSwitchProbability=-25,t.changeBaseRuleFlag=!1,t.time=0,J(t),u(t),c(t)),t.changeStyleFlag&&(t.ruleClass.setStyleRule(t),t.ruleLogEvolveProbability=-25,t.changeStyleFlag=!1,t.time=0,J(t),u(t),c(t)),(Math.random()<Math.exp(t.ruleLogEvolveProbability)||t.evolveColoringRuleFlag)&&"CustomRule"!=t.metaRule&&(Q(t.ruleClass),t.useLogo&&null!==t.ruleClass2&&Q(t.ruleClass2),t.ruleLogEvolveProbability=-25,t.evolveColoringRuleFlag=!1,t.time=0,J(t),u(t),c(t));t.ruleLogSwitchProbability=t.ruleLogSwitchProbability+1*t.logMultiplicativeFactor,t.ruleLogSwitchProbability>0&&(t.ruleLogSwitchProbability=0),t.ruleLogEvolveProbability=t.ruleLogEvolveProbability+1*t.logMultiplicativeEvolveFactor,t.ruleLogEvolveProbability>0&&(t.ruleLogEvolveProbability=0)}function J(t){if("undefined"!=typeof document){var e=document.getElementById("currentStyle");e&&(t.useLogo&&null!==t.ruleClass2?e.value=t.ruleClass.getName()+"__"+t.ruleClass2.getName():e.value=t.ruleClass.getName())}}function Q(t){t.ruleChain[1]&&"function"==typeof t.ruleChain[1].evolveRule&&t.ruleChain[1].evolveRule(t.conditionLevels)}function Z(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,a=(i+n+t.gridWidth)%t.gridWidth,s=o,l=a;return(o-e-r>0||o-e-r<0)&&(l=(t.gridWidth-a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(a-i-n>0||a-i-n<0)&&(s=(t.gridHeight-o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function tt(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,a=(i+n+t.gridWidth)%t.gridWidth,s=o,l=a;return(o-e-r>0||o-e-r<0)&&(l=(t.gridWidth-a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),a-i-n>0?s=(o+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:a-i-n<0&&(s=(o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function et(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,a=(i+n+t.gridWidth)%t.gridWidth,s=o,l=a;return o-e-r>0?l=(a+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:o-e-r<0&&(l=(a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),(a-i-n>0||a-i-n<0)&&(s=(t.gridHeight-o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function it(t,e,i,r,n){let o=(e+r+t.gridHeight)%t.gridHeight,a=(i+n+t.gridWidth)%t.gridWidth,s=o,l=a;return o-e-r>0?l=(a+t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth:o-e-r<0&&(l=(a-t.gridPeriodicityShiftX+t.gridWidth)%t.gridWidth),a-i-n>0?s=(o+t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight:a-i-n<0&&(s=(o-t.gridPeriodicityShiftY+t.gridHeight)%t.gridHeight),[s,l]}function rt(t){t.gridFlipX&&t.gridFlipY?t.findNeighbour=Z:t.gridFlipX?t.findNeighbour=tt:t.gridFlipY?t.findNeighbour=et:t.findNeighbour=it}function nt(t,e=!1){(t.time%200==0||e)&&(isNaN(t.brightness)&&(t.brightness=127,t.maxBrightness=130,t.minBrightness=124),isNaN(t.maxBrightness)&&(t.maxBrightness=130),isNaN(t.minBrightness)&&(t.minBrightness=124),console.log("Activity level: "+t.activityLevel.toFixed(2)+"."),console.log("Proportion of cells changed: "+t.relCellChanged.toFixed(4)+"."),console.log("Mean color change magnitude: "+t.meanColorChangeHistoric.toFixed(1)+"."),console.log("Brightness: "+t.brightness.toFixed(1)+"."),console.log("Max - min brightness: "+t.diffBrightness+"."),console.log("Flicker index: "+t.flickerIndex.toFixed(2)+"."),console.log("Color count: "+t.colorCount.map((t=>t.toFixed(3)))+"."))}function ot(t,e,i){var r=function(t){var e=Math.exp(-t),i=1,r=0;do{r++,i*=Math.random()}while(i>e);return r-1}(10**(t.randomnessAmount+t.ruleClass.ruleChain[0].randomnessLogShift));if(0!=r)for(var n=t.ruleClass.ruleChain[0].seedSampler,o=t.ruleClass.ruleChain[0].seedMasks,a=0;a<r;a++){var s=Math.floor(Math.random()*t.gridHeight),l=Math.floor(Math.random()*t.gridWidth);at(e,t,o[n()],s,l,i)}}function at(t,e,i,n,o,a){null===i?i=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?dt(t,t):e<.2?lt(t,t):e<.3?st(t,t):e<.4?function(t){let e=new r(t,t);for(let i=0;i<t;i++)for(let r=i;r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,i,e.get(i,r));return e}(t):e<.5?function(t){let e=new r(t,t);for(let i=0;i<t;i++)for(let r=i;r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(t-1-r,t-1-i,e.get(i,r));return e}(t):e<.6?ht(t,t):e<.7?gt(t,t):e<.8?function(t){let e=new r(t,t);for(let i=0;i<t;i++)for(let r=Math.max(i,t-i);r<t;r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,i,e.get(i,r)),e.set(t-1-r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r));return e}(t):e<.9?function(t){let e=new r(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let r=0;r<Math.ceil(t/2);r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r)),e.set(t-1-r,i,e.get(i,r));return e}(t):function(t){let e=new r(t,t);for(let i=0;i<Math.ceil(t/2);i++)for(let r=0;r<Math.ceil(t/2);r++)e.set(i,r,Math.floor(1e5*Math.random())),e.set(r,t-1-i,e.get(i,r)),e.set(t-1-i,t-1-r,e.get(i,r)),e.set(t-1-r,i,e.get(i,r)),e.set(t-1-i,r,e.get(i,r)),e.set(t-1-r,t-1-i,e.get(i,r)),e.set(i,t-1-r,e.get(i,r)),e.set(r,i,e.get(i,r));return e}(t)}(e);else{t=function(t,e){let i=Math.random();return i<.2?dt(t,e):i<.4?lt(t,e):i<.6?st(t,e):i<.8?ht(t,e):gt(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&i.transpose(),Math.random()<.5&&i.flipX(),Math.random()<.75&&i.flipY());let s=i.height,l=i.width;for(let r=0;r<s;r++)for(let h=0;h<l;h++){let g=a(e,n,o,r-Math.floor(s/2),h-Math.floor(l/2));t.set(g[0],g[1],i.get(r,h))}}function st(t,e){let i=new r(e,t);for(let r=0;r<t;r++)for(let t=0;t<Math.ceil(e/2);t++)i.set(r,t,Math.floor(1e5*Math.random())),i.set(r,e-1-t,i.get(r,t));return i}function lt(t,e){let i=new r(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<e;n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(t-1-r,n,i.get(r,n));return i}function ht(t,e){let i=new r(e,t);for(let r=0;r<t;r++)for(let n=0;n<Math.ceil(e/2);n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(t-1-r,e-1-n,i.get(r,n));return i}function gt(t,e){let i=new r(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(e/2);n++)i.set(r,n,Math.floor(1e5*Math.random())),i.set(t-1-r,n,i.get(r,n)),i.set(r,e-1-n,i.get(r,n)),i.set(t-1-r,e-1-n,i.get(r,n));return i}function dt(t,e){let i=new r(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)i.set(r,t,Math.floor(1e5*Math.random()));return i}function ut(t){!function(t){t.time>100&&(t.meanColorChangeHistoric>330||t.flickerIndex>10)&&(t.changeRuleFlag=!0,t.meanColorChangeHistoric>330?console.log("Changing rule because of suspected oscillations (meanColorChangeHistoric: "+t.meanColorChangeHistoric+")."):console.log("Changing rule because of suspected oscillations (flickerIndex: "+t.flickerIndex+")."),nt(t,!0),t.nCellChangedHistoric=15,t.meanColorChangeHistoric=10,t.brightness=127,t.maxBrightness=130,t.minBrightness=124,t.flickerIndex=0)}(t),function(t){t.nCellChangedHistoric<3&&(t.changeRuleFlag=!0,console.log("Changing rule because not enough cells changed ("+t.nCellChangedHistoric+")."),nt(t,!0),t.nCellChangedHistoric=20)}(t),function(t){const e=t.colorCount.slice(1).some((t=>t>.99));t.time>100&&e&&(t.changeRuleFlag=!0,console.log("Changing rule because the canvas is too plainly colored."),nt(t,!0),t.colorCount=new Array(t.nColors).fill(0))}(t)}function ct(t){return console.log("Loading image:",t),new Promise(((e,r)=>{const n=function(){if("undefined"!=typeof window)return new window.Image;try{const{Image:t}=i(Object(function(){var t=new Error("Cannot find module 'canvas'");throw t.code="MODULE_NOT_FOUND",t}()));return new t}catch(t){throw console.error('The canvas module is not installed. Please run "npm install canvas" to install it.'),t}}();n.onload=()=>{console.log("Image loaded:",t);const r=function(t,e){if("undefined"!=typeof window){const i=document.createElement("canvas");return i.width=t,i.height=e,i}try{const{createCanvas:r}=i(Object(function(){var t=new Error("Cannot find module 'canvas'");throw t.code="MODULE_NOT_FOUND",t}()));return r(t,e)}catch(t){throw console.error('The canvas module is not installed. Please run "npm install canvas" to install it.'),t}}(n.width,n.height),o=r.getContext("2d");o.drawImage(n,0,0,n.width,n.height);const a=o.getImageData(0,0,r.width,r.height).data,s=[];for(let t=0;t<n.height;t++){const e=[];for(let i=0;i<n.width;i++){const r=4*(t*n.width+i),o=(a[r]+a[r+1]+a[r+2])/3;e.push(o>128?1:0)}s.push(e)}e(s)},n.onerror=()=>{console.error("Error loading image:",t),r(new Error("Error loading image"))},n.src=t}))}async function ft(t,e){if(null!==t.logo&&await function(t,e){return console.log("Attempting to load image"),ct(t.logo).then((e=>{new r(t.gridWidth,t.gridHeight);const i=new r(t.gridWidth,t.gridHeight),n=e[0].length/t.gridWidth,o=e.length/t.gridHeight,a=Math.max(n,o),s=Math.floor((t.gridWidth-e[0].length/a)/2),l=Math.floor((t.gridHeight-e.length/a)/2);for(let r=0;r<t.gridHeight;r++)for(let n=0;n<t.gridWidth;n++){if(r<l||(r-l)*a>=e.length){i.set(r,n,1);continue}let t=Math.floor((n-s)*a);0===e[Math.floor((r-l)*a)][t]?i.set(r,n,0):i.set(r,n,1)}t.mask=i})).catch((e=>{console.log("Image loading failed, not using a mask."),console.error("Error loading image:",e),t.mask=new r(t.gridWidth,t.gridHeight)}))}(t),"zero"!=t.initialisation)return function(t,e=1e4){return Promise.resolve().then((()=>{t.grid=new r(t.gridWidth,t.gridHeight),t.redraw=new r(t.gridWidth,t.gridHeight);for(var i=0;i<t.gridHeight;i++)for(var n=0;n<t.gridWidth;n++)if("gr"!=t.initialisation||1!==t.mask.get(i,n)){for(var o=Math.random(),a=0;a<e;a++)if(o<(a+1)/(e+1)){t.grid.set(i,n,a);break}t.redraw.set(i,n,1)}else t.grid.set(i,n,0)}))}(t);t.grid=new r(t.gridWidth,t.gridHeight),t.redraw=new r(t.gridWidth,t.gridHeight)}var mt={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function bt(t=256){let e=0,i=new Uint8Array(t);return{get buffer(){return i.buffer},reset(){e=0},bytesView:()=>i.subarray(0,e),bytes:()=>i.slice(0,e),writeByte(t){r(e+1),i[e]=t,e++},writeBytes(t,n=0,o=t.length){r(e+o);for(let r=0;r<o;r++)i[e++]=t[r+n]},writeBytesView(t,n=0,o=t.byteLength){r(e+o),i.set(t.subarray(n,n+o),e),e+=o}};function r(t){var r=i.length;if(r>=t)return;t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));let n=i;i=new Uint8Array(t),e>0&&i.set(n.subarray(0,e),0)}}var wt=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var yt=function(t,e,i,r,n=bt(512),o=new Uint8Array(256),a=new Int32Array(5003),s=new Int32Array(5003)){let l=a.length,h=Math.max(2,r);o.fill(0),s.fill(0),a.fill(-1);let g=0,d=0,u=h+1,c=u,f=!1,m=c,b=(1<<m)-1,w=1<<u-1,y=w+1,S=w+2,p=0,C=i[0],M=0;for(let t=l;t<65536;t*=2)++M;M=8-M,n.writeByte(h),B(w);let v=i.length;for(let t=1;t<v;t++)t:{let e=i[t],r=(e<<12)+C,n=e<<M^C;if(a[n]===r){C=s[n];break t}let o=0===n?1:l-n;for(;a[n]>=0;)if(n-=o,n<0&&(n+=l),a[n]===r){C=s[n];break t}B(C),C=e,S<4096?(s[n]=S++,a[n]=r):(a.fill(-1),S=w+2,f=!0,B(w))}return B(C),B(y),n.writeByte(0),n.bytesView();function B(t){for(g&=wt[d],d>0?g|=t<<d:g=t,d+=m;d>=8;)o[p++]=255&g,p>=254&&(n.writeByte(p),n.writeBytesView(o,0,p),p=0),g>>=8,d-=8;if((S>b||f)&&(f?(m=c,b=(1<<m)-1,f=!1):(++m,b=12===m?1<<m:(1<<m)-1)),t==y){for(;d>0;)o[p++]=255&g,p>=254&&(n.writeByte(p),n.writeBytesView(o,0,p),p=0),g>>=8,d-=8;p>0&&(n.writeByte(p),n.writeBytesView(o,0,p),p=0)}}};function St(t,e,i){return t<<8&63488|e<<2&992|i>>3}function pt(t,e,i,r){return t>>4|240&e|(240&i)<<4|(240&r)<<8}function Ct(t,e,i){return t>>4<<8|240&e|i>>4}function Mt(t,e,i){return t<e?e:t>i?i:t}function vt(t){return t*t}function Bt(t,e,i){var r=0,n=1e100;let o=t[e],a=o.cnt,s=o.ac,l=o.rc,h=o.gc,g=o.bc;for(var d=o.fw;0!=d;d=t[d].fw){let e=t[d],o=e.cnt,c=a*o/(a+o);if(!(c>=n)){var u=0;i&&(u+=c*vt(e.ac-s))>=n||!((u+=c*vt(e.rc-l))>=n)&&(!((u+=c*vt(e.gc-h))>=n)&&(!((u+=c*vt(e.bc-g))>=n)&&(n=u,r=d)))}}o.err=n,o.nn=r}function It(t,e,i={}){let{format:r="rgb565",clearAlpha:n=!0,clearAlphaColor:o=0,clearAlphaThreshold:a=0,oneBitAlpha:s=!1}=i;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let l=new Uint32Array(t.buffer),h=!1!==i.useSqrt,g="rgba4444"===r,d=function(t,e){let i=new Array("rgb444"===e?4096:65536),r=t.length;if("rgba4444"===e)for(let e=0;e<r;++e){let r=t[e],n=r>>24&255,o=r>>16&255,a=r>>8&255,s=255&r,l=pt(s,a,o,n),h=l in i?i[l]:i[l]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};h.rc+=s,h.gc+=a,h.bc+=o,h.ac+=n,h.cnt++}else if("rgb444"===e)for(let e=0;e<r;++e){let r=t[e],n=r>>16&255,o=r>>8&255,a=255&r,s=Ct(a,o,n),l=s in i?i[s]:i[s]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};l.rc+=a,l.gc+=o,l.bc+=n,l.cnt++}else for(let e=0;e<r;++e){let r=t[e],n=r>>16&255,o=r>>8&255,a=255&r,s=St(a,o,n),l=s in i?i[s]:i[s]={ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0};l.rc+=a,l.gc+=o,l.bc+=n,l.cnt++}return i}(l,r),u=d.length,c=u-1,f=new Uint32Array(u+1);for(var m=0,b=0;b<u;++b){let t=d[b];if(null!=t){var w=1/t.cnt;g&&(t.ac*=w),t.rc*=w,t.gc*=w,t.bc*=w,d[m++]=t}}vt(e)/m<.022&&(h=!1);for(b=0;b<m-1;++b)d[b].fw=b+1,d[b+1].bk=b,h&&(d[b].cnt=Math.sqrt(d[b].cnt));var y,S,p;for(h&&(d[b].cnt=Math.sqrt(d[b].cnt)),b=0;b<m;++b){Bt(d,b,!1);var C=d[b].err;for(S=++f[0];S>1&&!(d[y=f[p=S>>1]].err<=C);S=p)f[S]=y;f[S]=b}var M=m-e;for(b=0;b<M;){for(var v;;){var B=f[1];if((v=d[B]).tm>=v.mtm&&d[v.nn].mtm<=v.tm)break;v.mtm==c?B=f[1]=f[f[0]--]:(Bt(d,B,!1),v.tm=b);C=d[B].err;for(S=1;(p=S+S)<=f[0]&&(p<f[0]&&d[f[p]].err>d[f[p+1]].err&&p++,!(C<=d[y=f[p]].err));S=p)f[S]=y;f[S]=B}var I=d[v.nn],N=v.cnt,P=I.cnt;w=1/(N+P);g&&(v.ac=w*(N*v.ac+P*I.ac)),v.rc=w*(N*v.rc+P*I.rc),v.gc=w*(N*v.gc+P*I.gc),v.bc=w*(N*v.bc+P*I.bc),v.cnt+=I.cnt,v.mtm=++b,d[I.bk].fw=I.fw,d[I.fw].bk=I.bk,I.mtm=c}let R=[];var x=0;for(b=0;;++x){let t=Mt(Math.round(d[b].rc),0,255),e=Mt(Math.round(d[b].gc),0,255),i=Mt(Math.round(d[b].bc),0,255),r=255;if(g){if(r=Mt(Math.round(d[b].ac),0,255),s){r=r<=("number"==typeof s?s:127)?0:255}n&&r<=a&&(t=e=i=o,r=0)}let l=g?[t,e,i,r]:[t,e,i];if(Nt(R,l)||R.push(l),0==(b=d[b].fw))break}return R}function Nt(t,e){for(let i=0;i<t.length;i++){let r=t[i],n=r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2],o=!(r.length>=4&&e.length>=4)||r[3]===e[3];if(n&&o)return!0}return!1}function Pt(t,e,i,r,n){let o=0,a=1e100;for(let s=0;s<n.length;s++){let l=n[s],h=xt(l[3]-r);h>a||(h+=xt(l[0]-t),h>a||(h+=xt(l[1]-e),h>a||(h+=xt(l[2]-i),!(h>a)&&(a=h,o=s))))}return o}function Rt(t,e,i,r){let n=0,o=1e100;for(let a=0;a<r.length;a++){let s=r[a],l=xt(s[0]-t);l>o||(l+=xt(s[1]-e),l>o||(l+=xt(s[2]-i),!(l>o)&&(o=l,n=a)))}return n}function xt(t){return t*t}function Ft(t={}){let{initialCapacity:e=4096,auto:i=!0}=t,r=bt(e),n=new Uint8Array(256),o=new Int32Array(5003),a=new Int32Array(5003),s=!1;return{reset(){r.reset(),s=!1},finish(){r.writeByte(mt.trailer)},bytes:()=>r.bytes(),bytesView:()=>r.bytesView(),get buffer(){return r.buffer},get stream(){return r},writeHeader:l,writeFrame(t,e,h,g={}){let{transparent:d=!1,transparentIndex:u=0,delay:c=0,palette:f=null,repeat:m=0,colorDepth:b=8,dispose:w=-1}=g,y=!1;if(i?s||(y=!0,l(),s=!0):y=Boolean(g.first),e=Math.max(0,Math.floor(e)),h=Math.max(0,Math.floor(h)),y){if(!f)throw new Error("First frame must include a { palette } option");(function(t,e,i,r,n=8){let o=1,a=0,s=Lt(r.length)-1,l=o<<7|n-1<<4|a<<3|s,h=0,g=0;Wt(t,e),Wt(t,i),t.writeBytes([l,h,g])})(r,e,h,f,b),Ht(r,f),m>=0&&function(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),At(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),Wt(t,e),t.writeByte(0)}(r,m)}let S=Math.round(c/10);!function(t,e,i,r,n){var o,a;t.writeByte(33),t.writeByte(249),t.writeByte(4),n<0&&(n=0,r=!1),r?(o=1,a=2):(o=0,a=0),e>=0&&(a=7&e),a<<=2;let s=0;t.writeByte(a|s|o),Wt(t,i),t.writeByte(n||0),t.writeByte(0)}(r,w,S,d,u);let p=Boolean(f)&&!y;(function(t,e,i,r){if(t.writeByte(44),Wt(t,0),Wt(t,0),Wt(t,e),Wt(t,i),r){let e=0,i=0,n=Lt(r.length)-1;t.writeByte(128|e|i|n)}else t.writeByte(0)})(r,e,h,p?f:null),p&&Ht(r,f),function(t,e,i,r,n=8,o,a,s){yt(i,r,e,n,t,o,a,s)}(r,t,e,h,b,n,o,a)}};function l(){At(r,"GIF89a")}}function Ht(t,e){let i=1<<Lt(e.length);for(let r=0;r<i;r++){let i=[0,0,0];r<e.length&&(i=e[r]),t.writeByte(i[0]),t.writeByte(i[1]),t.writeByte(i[2])}}function Wt(t,e){t.writeByte(255&e),t.writeByte(e>>8&255)}function At(t,e){for(var i=0;i<e.length;i++)t.writeByte(e.charCodeAt(i))}function Lt(t){return Math.max(Math.ceil(Math.log2(t)),1)}function kt(t){if(t.startRecordingGifFlag){console.log("Starting GIF recording...");const{data:e,width:i,height:r}=t.ctx.getImageData(0,0,3*t.gridWidth,3*t.gridHeight);t.gifPalette=It(e,16),t.gif=Ft(),t.recordingGif=!0,t.startRecordingGifFlag=!1}if(t.stopRecordingGifFlag){t.gif.finish(),t.gifOutput=t.gif.bytes();const n=new Blob([t.gifOutput],{type:"image/gif"}),o=URL.createObjectURL(n);if("Download"==t.gifMode){const t=document.createElement("a");t.href=o,t.download="output.gif",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else"InAppWebView"==t.gifMode&&(e=n,i=function(t){window.flutter_inappwebview.callHandler("saveGif",t)},(r=new FileReader).onload=function(t){i(t.target.result)},r.readAsDataURL(e));t.recordingGif=!1,t.stopRecordingGifFlag=!1,console.log("Stopped recording gif")}var e,i,r;if(t.recordingGif){const{data:e,width:i,height:r}=t.ctx.getImageData(0,0,t.gridWidth,t.gridHeight),n=function(t,e,i="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");let r=new Uint32Array(t.buffer),n=r.length,o="rgb444"===i?4096:65536,a=new Uint8Array(n),s=new Array(o);if("rgba4444"===i)for(let t=0;t<n;t++){let i=r[t],n=i>>24&255,o=i>>16&255,l=i>>8&255,h=255&i,g=pt(h,l,o,n),d=g in s?s[g]:s[g]=Pt(h,l,o,n,e);a[t]=d}else{let t="rgb444"===i?Ct:St;for(let i=0;i<n;i++){let n=r[i],o=n>>16&255,l=n>>8&255,h=255&n,g=t(h,l,o),d=g in s?s[g]:s[g]=Rt(h,l,o,e);a[i]=d}}return a}(e,t.gifPalette),o=t.gifPalette;t.gif.writeFrame(n,i,r,{palette:o}),t.nRecordedFrames=t.nRecordedFrames+1,t.nRecordedFrames>1e3&&(t.stopRecordingGifFlag=!0,t.paused=!0,console.log("Stopped recording gif after 1000 frames."))}}var Tt=166320;function Gt(t,e=null){performance.now();t.paused?(t.step&&(Et(t,e),t.step=!1),t.recordingGif&&kt(t)):Et(t,e),t.reinitialiseGridFlag&&(ft(t),t.reinitialiseGridFlag=!1),t.changeGridSizeFlag&&(t.gridHeight=t.tempGridHeight,t.gridWidth=t.tempGridWidth,t.imageData=new Uint8ClampedArray(4*t.gridWidth*t.gridHeight),t.redraw=new r(t.gridWidth,t.gridHeight),t.canvas=document.getElementById("gameCanvas"),t.canvas.width=t.gridWidth,t.canvas.height=t.gridHeight,t.ctx=t.canvas.getContext("2d"),ft(t),t.changeGridSizeFlag=!1),setTimeout((function(){requestAnimationFrame((()=>Gt(t,e)))}),Math.max(0,t.targetCycleTime-t.frameExecutionTime))}function Et(t,e){!function(t){let e=t.imageData;for(var i=0,r=0,n=0,o=t.colors.length,a=new Array(o).fill(0),s=0;s<t.gridHeight;s++)for(var l=0;l<t.gridWidth;l++){var h=Math.floor(t.grid.get(s,l)/t.ruleClass.colorUnit)%o;if(a[h]+=1,0==t.redraw.get(s,l))continue;i+=1;let g=t.colors[h],d=4*(s*t.gridWidth+l);r+=Math.sqrt((e[d+0]-g.r)**2+(e[d+1]-g.g)**2+(e[d+2]-g.b)**2),n+=g.r+g.g+g.b;const u=Math.round(Math.random()*g.redPertStrength2-g.redPerturbationStrength),c=Math.round(Math.random()*g.greenPertStrength2-g.greenPerturbationStrength),f=Math.round(Math.random()*g.bluePertStrength2-g.bluePerturbationStrength),m=Math.round(Math.random()*g.brightnessPertStrength2-g.brightnessPerturbationStrength);e[d+0]=g.r+u+m,e[d+1]=g.g+c+m,e[d+2]=g.b+f+m,e[d+3]=g.t}!function(t,e,i,r,n){var o=t.gridHeight*t.gridWidth;t.activityLevel=.8*t.activityLevel+e/o/5,t.nCellChangedHistoric=.01*e+.99*t.nCellChangedHistoric,t.meanColorChangeHistoric=.01*i/(e+o/30)+.99*t.meanColorChangeHistoric,0==e?r=127:r/=3*e,t.brightness=.01*r+.99*t.brightness,t.maxBrightness=.99*(t.maxBrightness-t.brightness)+t.brightness,t.minBrightness=.99*(t.minBrightness-t.brightness)+t.brightness,t.relCellChanged=e/o,t.diffBrightness=t.maxBrightness-t.minBrightness,t.flickerIndex=.99*t.flickerIndex+t.diffBrightness*t.relCellChanged*.01,t.maxBrightness<r?t.maxBrightness+=3:t.minBrightness>r&&(t.minBrightness-=3);for(var a=0;a<t.colorCount.length;a++)t.colorCount[a]=.01*t.colorCount[a]+.99*n[a]/o}(t,i,r,n,a),nt(t),t.imageData=e}(t),null!=e&&e(t),ut(t),function(t){const e=t.ruleClass.ruleChain[0].nStates;var i=0;t.ruleClass.ruleChain.length>1&&(i=t.ruleClass.ruleChain[1].nStates);var n=m*e,o=m*i,a=Math.floor(m/2),s=[new Uint8Array(n),new Uint8Array(o)],l=new Uint8Array(a),h=new r(t.gridWidth,t.gridHeight),g=t.grid;const d=t.time;for(var u=0;u<t.gridHeight;u++)for(var c=0;c<t.gridWidth;c++){var f=b(t,u,c,g,s,l,d,e,i);const r=t.grid.get(u,c);var w=r;w=t.useLogo&&0!=t.mask.get(u,c)?t.ruleClass2.updateRule(r,w,f,t.time,t.activityLevel):t.ruleClass.updateRule(r,w,f,t.time,t.activityLevel),Math.floor(w/t.ruleClass.colorUnit)%t.nColors!=Math.floor(r/t.ruleClass.colorUnit)%t.nColors?t.redraw.set(u,c,1):t.redraw.set(u,c,0),h.set(u,c,w),s[0]=s[0].fill(0),s[1]=s[1].fill(0),l=l.fill(0)}t.addRandomness&&ot(t,h,t.findNeighbour),t.grid=h}(t),_(t),kt(t),t.time=(t.time+1)%Tt,t.randomisePeriodicityShiftAndTopology&&function(t){Math.random()<1e-4&&(t.gridPeriodicityShiftX=Math.floor(Math.random()*t.gridWidth),console.log("Periodicity shift X: "+t.gridPeriodicityShiftX)),Math.random()<1e-4&&(t.gridPeriodicityShiftY=Math.floor(Math.random()*t.gridHeight),console.log("Periodicity shift Y: "+t.gridPeriodicityShiftY)),Math.random()<1e-4&&(t.gridFlipX=!t.gridFlipX,rt(t),console.log("Flip X: "+t.gridFlipX)),Math.random()<1e-4&&(t.gridFlipY=!t.gridFlipY,rt(t),console.log("Flip Y: "+t.gridFlipY))}(t),t.reloadColorPaletteFlag&&(d(t),t.reloadColorPaletteFlag=!1),function(t){for(var e=0;e<t.colors.length;e++){var i=t.colors[e];i.drift>0&&(t.colors[e]=o(i))}}(t)}function Ut(t){let e=new ImageData(t.imageData,t.gridWidth,t.gridHeight);t.ctx.putImageData(e,t.canvasCornerX,t.canvasCornerY)}console.log("Loading main.js");var Dt=new class{constructor({gridHeight:t=200,gridWidth:e=200,targetCycleTime:i=100,addRandomness:n=!0,randomnessAmount:o=-2,randomisePeriodicityShiftAndTopology:a=!0,gridPeriodicityShiftX:s=0,gridPeriodicityShiftY:l=0,gridFlipX:h=!1,gridFlipY:g=!1,colorPalette:d="black2",metaRule:u="VariableGR",initialisation:c="random",ruleSwitchPeriod:f=2e4,ruleEvolvePeriod:m=2e3,logo:b=null,useLogo:w=!1,config:y=null}={}){this.config=y,this.paused=!1,this.step=!1,this.targetCycleTime=i,this.gridHeight=t,this.gridWidth=e,this.grid=new r(this.gridWidth,this.gridHeight),this.gridPeriodicityShiftX=s,this.gridPeriodicityShiftY=l,this.gridFlipX=h,this.gridFlipY=g,this.mask=null,this.findNeighbour=null,this.tempGridHeight=null,this.tempGridWidth=null,this.imageData=new Uint8ClampedArray(4*this.gridWidth*this.gridHeight).fill(0),this.redraw=new r(this.gridWidth,this.gridHeight),this.colorPalette=d,this.initialisation=c,this.logo=b,this.useLogo=w,this.colors=[],this.nColors=4,this.addRandomness=n,this.randomnessAmount=o,this.randomisePeriodicityShiftAndTopology=a,this.reinitialiseGridFlag=!1,this.changeGridSizeFlag=!1,this.metaRule=u,this.ruleClass=null,this.updateCellValue=null,this.updateCellValueAuxiliary=null,this.ruleSwitchPeriod=f,this.ruleEvolvePeriod=m,this.currentStyle=null,this.time=0,this.ruleLogSwitchProbability=-25,this.ruleLogEvolveProbability=-25,this.logMultiplicativeFactor=25/this.ruleSwitchPeriod,this.logMultiplicativeEvolveFactor=25/this.ruleEvolvePeriod,this.changeRuleFlag=!0,this.changeBaseRuleFlag=!1,this.changeStyleFlag=!1,this.evolveColoringRuleFlag=!1,this.reloadColorPaletteFlag=!1,this.activityLevel=0,this.nCellChangedHistoric=0,this.meanColorChangeHistoric=0,this.brightness=127,this.maxBrightness=130,this.minBrightness=124,this.diffBrightness=0,this.relCellChanged=0,this.flickerIndex=0,this.colorCount=[0,0,0,0],this.frameExecutionTime=0,this.gif=null,this.gifMode="Download",this.startRecordingGifFlag=!1,this.stopRecordingGifFlag=!1,this.recordingGif=!1,this.nRecordedFrames=0,this.saveEventData=!1}}({gridHeight:29,gridWidth:78,targetCycleTime:100,addRandomness:!1,randomisePeriodicityShiftAndTopology:!1,gridPeriodicityShiftX:0,gridPeriodicityShiftY:0,gridFlipX:!1,gridFlipY:!1,colorPalette:"mouseAnimation",metaRule:"Variable",initialisation:"zero"});!function(t){t.canvasCornerX=0,t.canvasCornerY=0,t.canvas=document.getElementById("gameCanvas"),t.canvas.width=t.gridWidth,t.canvas.height=t.gridHeight,t.ctx=t.canvas.getContext("2d")}(Dt),window.onload=function(){Dt.grid=new r(Dt.gridWidth,Dt.gridHeight),Dt.redraw=new r(Dt.gridWidth,Dt.gridHeight);const t=document.getElementById("background"),e=t.getContext("2d");Dt.backgroundCanvas=t;const i=new Image;i.src="./grWebsiteBackgroundTransp.png?"+(new Date).getTime(),i.onload=function(){e.drawImage(i,0,0,t.width,t.height)},function(t){t.backgroundCanvas.addEventListener("mousemove",(function(e){var i=t.canvas.getBoundingClientRect(),r=e.clientX-i.left,n=e.clientY-i.top,o=i.width/t.gridWidth,a=i.height/t.gridHeight,s=Math.floor(r/o),l=Math.floor(n/a);t.grid.set(l,s,1)}))}(Dt),function(t){t.backgroundCanvas.addEventListener("mousedown",(function(e){var i=t.canvas.getBoundingClientRect(),r=e.clientX-i.left,n=e.clientY-i.top,o=i.width/t.gridWidth,a=i.height/t.gridHeight,s=Math.floor(r/o),l=Math.floor(n/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(l,(s+1)%t.gridWidth,1),t.grid.set(l,s,1),t.grid.set((l+1)%t.gridHeight,s,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(l,s,1),t.grid.set((l+1)%t.gridHeight,s,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(l,s,1),t.grid.set(l,(s+1)%t.gridWidth,1)):(t.grid.set((l+1)%t.gridHeight,(s+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(s+1)%t.gridWidth,1),t.grid.set((l-1+t.gridHeight)%t.gridHeight,(s-1+t.gridWidth)%t.gridWidth,1),t.grid.set((l+1)%t.gridHeight,(s-1+t.gridWidth)%t.gridWidth,1))}))}(Dt),d(Dt),rt(Dt),function(t){_(t,!0)}(Dt),Gt(Dt,Ut)}})();
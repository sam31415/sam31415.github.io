(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),r=Object.values(t).reduce(((t,r,n)=>[...t,r/e+(t[n-1]||0)]),[]);return function(){let e=Math.random(),n=r.findIndex((t=>e<t));return Object.keys(t)[n]}}const e=[44,44];function r(t,e,r,n,s,i,a){const h=n.height-1,o=n.width-1,u=n.data,l=n.width;for(var c=s[0],f=s[1],M=-1;M<=1;M++)for(var m=-1;m<=1;m++){if(0==M&&0==m)continue;if(i[0]=((-1===M?1:M)+(-1===m?1:m))%2,i[1+(3&a)]=-1==M?1:0,i[1+(1+a&3)]=-1==m?1:0,i[1+(2+a&3)]=1==M?1:0,i[1+(3+a&3)]=1==m?1:0,0==e||0==r||e==h||r==o)var[b,p]=t.t(t,e,r,M,m);else var b=e+M,p=r+m;const n=u[b*l+p],s=3&n,d=(15&n)>>2;if(1==s){c[0]+=1;for(var w=0;w<i.length;w++)c[4+8*w]+=i[w],c[8*(w+1)]+=1-i[w]}else if(2==s){c[2]+=1;for(w=0;w<i.length;w++)c[4+8*w+2]+=i[w],c[8*(w+1)+2]+=1-i[w]}else if(3==s){c[3]+=1;for(w=0;w<i.length;w++)c[4+8*w+3]+=i[w],c[8*(w+1)+3]+=1-i[w]}if(0==d){f[0]+=1;for(w=0;w<i.length;w++)f[4+8*w]+=i[w],f[8*(w+1)]+=1-i[w]}else if(1==d){f[1]+=1;for(w=0;w<i.length;w++)f[4+8*w+1]+=i[w],f[8*(w+1)+1]+=1-i[w]}else if(2==d){f[2]+=1;for(w=0;w<i.length;w++)f[4+8*w+2]+=i[w],f[8*(w+1)+2]+=1-i[w]}else if(3==d){f[3]+=1;for(w=0;w<i.length;w++)f[4+8*w+3]+=i[w],f[8*(w+1)+3]+=1-i[w]}}for(w=0;w<i.length+1;w++)c[4*w+1]+=c[4*w]+c[4*w+3];return[c,f]}const n="mix",s="isotropic",i="xcross",a="vcross",h="xvcross",o="directional1",u="directional2",l="directional3",c="directional2b",f="directional",M={[n]:.2,[s]:.4,[i]:.05,[a]:.05,[h]:.05,[o]:.05,[u]:.05,[l]:.05,[c]:.05,[f]:.05};const m="A",b="C",p="E",w="B";class d{constructor(t,e,r,n,s,i=null){this.type=t,this.threshold=e,this.i=r,this.h=n,this.o=s,this.u=i,this.l=function(t,e){return t==b?function(t){return 0==t}:t==m?function(t){return t%e==0}:function(t){return!0}}(this.h,this.o),this.M=function(t,e,r){return e==p?function(e){return e[r[0]][r[1]]==t}:e==w?function(e){return e[r[0]][r[1]]>t}:void 0}(this.threshold,this.type,this.i),this.m=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(i)}test(t,e,r){var n=this.m(r);return this.M(t)&&this.l(e)&&n}name(){var t="";return null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join("")),`${this.type}${this.threshold}${this.h}[${this.i[0]}|${this.i[1]}]${t}`}static p(t,e=4){var r=null;t.startsWith(p)?r=p:t.startsWith(w)&&(r=w);var n=t.substring(r.length),s=parseInt(n.substring(0,1)),i=null;(n=n.substring(1)).startsWith(b)?i=b:n.startsWith(m)?i=m:n.startsWith("N")&&(i="N");var a=(n=n.substring(i.length)).split("[")[1].split("]")[0].split("|").map(Number),h=null;return(n=n.split("]")[1]).length>0&&(h=n.split("").map((t=>"1"===t))),new d(r,s,a,i,e,h)}static v(e=null,r=4,M=n,g=null){const v=[p,w],k=v[Math.floor(Math.random()*v.length)],R=[b,m,"N"],C=R[Math.floor(Math.random()*R.length)];null===e&&(e={0:2/3,1:1/3});const S=t(e)(),N=function(t,e){var r=e;if(r==n){var M=Math.random();r=M<.5?s:M<.7?i:M<.9?a:f}if(r==s)return Math.floor(4*Math.random());if(r==a)return Math.floor(4*Math.random()+4);if(r==i)return Math.floor(4*Math.random()+8);if(r==h)return Math.floor(8*Math.random()+4);if(r==o)return Math.floor(4*Math.random()+12);if(r==u)return Math.floor(8*Math.random()+12);if(r==l)return Math.floor(12*Math.random()+12);if(r==c){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return r==f?Math.floor(16*Math.random()+12):void 0}(0,M),y=[S,N];var x=0,B=8;if(0==y[0]&&y[1]%4!=1?B=5:y[1]>4&&y[1]<=16?B=4:y[1]>16&&(B=3),x=k===w?Math.floor(Math.random()*B):Math.floor(Math.random()*B)+1,Math.random()<.2)A=null;else{var A;null==g&&(g=Math.floor(20*Math.random())+2);do{A=new Array(g).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new d(k,x,y,C,r,A)}}class g{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.k=!1,this.get=this.R,this.set=this.C}static S(t,e=!1,r=!1,n=!1){const s=t.length,i=t[0].length,a=new g(i,s);for(let e=0;e<s;e++){n&&(e=s-e-1);for(let n=0;n<i;n++)r&&(n=i-n-1),a.set(e,n,t[e][n])}return e&&a.N(),a}N(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.k?[this.R,this.C]:[this.B,this.A],this.k=!this.k}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const r=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,r)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const r=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,r)}}R(t,e){return this.data[t*this.width+e]}C(t,e,r){this.data[t*this.width+e]=r}B(t,e){return this.data[e*this.height+t]}A(t,e,r){this.data[e*this.height+t]=r}}class v{constructor(){this.U=void 0}V(t,e,r,n){throw new Error("Must override method")}O(){throw new Error("Must override method")}}class k extends v{constructor(){super(),this.P=this.T(),this.j(),this.W=0}T(){throw new Error("Must override method")}j(){this.D=Object.keys(this.P).map((t=>this.P[t].mask));let e=Object.keys(this.P).map((t=>this.P[t].$));this.F=t(e)}}class R extends k{constructor(){super(),this.U=4}V(t,e,r,n){var s=t%4;return 1==s||3==s?e=2:2==s?e=0:0==s&&2==r[0][0]?e=1:0==s&&r[0][0]>2&&(e=3),e}O(){return"BB"}T(){return{random:{$:15,mask:null},G:{$:4,mask:g.S([[1,1],[1,1]])},I:{$:4,mask:new g([[1,0,1],[0,0,0],[1,0,1]])},q:{$:2,mask:g.S([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{$:2,mask:g.S([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},X:{$:2,mask:g.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Y:{$:2,mask:g.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class C extends k{constructor(){super(),this.U=4,this.W=-1}V(t,e,r,n){var s=t%4;return 3==s&&(s=0),1==s?e=2:2==s||3==s?e=0:0!=s&&3!=s||2!=r[0][0]?0==s&&r[0][0]>2&&(e=3):e=1,e}O(){return"TBB"}T(){return{random:{$:15,mask:null},X:{$:1,mask:g.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},q:{$:2,mask:g.S([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{$:2,mask:g.S([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},G:{$:4,mask:g.S([[1,1],[1,1]])},H:{$:1e4,mask:g.S([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class S extends k{constructor(){super(),this.U=4,this.W=-1}V(t,e,r,n){var s=t%4;return 1==s&&(r[0][0]<3||r[0][0]>5)?e=2:2==s?e=3:3==s?e=0:0==s&&2==r[0][0]&&(e=1),e}O(){return"SW"}T(){let t=.2;return{random:{$:6,mask:null},J:{$:1,mask:g.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},K:{$:t,mask:g.S([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},Z:{$:t,mask:g.S([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},_:{$:t,mask:g.S([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{$:t,mask:g.S([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{$:t,mask:g.S([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},rt:{$:t,mask:g.S([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},nt:{$:t,mask:g.S([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},st:{$:t,mask:g.S([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},it:{$:t,mask:g.S([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ht:{$:t,mask:g.S([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ot:{$:t,mask:g.S([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{$:t,mask:g.S([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{$:t,mask:g.S([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{$:t,mask:g.S([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ft:{$:t,mask:g.S([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},Mt:{$:t,mask:g.S([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},I:{$:2,mask:g.S([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class N extends k{constructor(t){super(),this.bt=t;const e=this.bt.split("/");this.wt=new Uint8Array(e[0].substring(1).split("").map(Number)),this.dt=new Uint8Array(e[1].substring(1).split("").map(Number)),"I"==e[2][0]?(this.gt=new Uint8Array(e[2].substring(1).split("").map(Number)),this.U=Number(e[3])):this.U=Number(e[2])}V(t,e,r,n){var s=t%this.U;return 1==s&&this.dt.includes(r[0][0])?e=1:s>0&&s<this.U-1?e+=1:s==this.U-1?e=0:0==s&&this.wt.includes(r[0][0])?e=1:0==s&&this.gt.includes(r[0][0])&&(e=this.U-1),e}O(){return this.bt}T(){return{random:{$:1,mask:null}}}}class y extends N{constructor(){super("B2/S245678/I1/4"),this.W=0}O(){return"SS"}T(){let t=.2;return{random:{$:10,mask:null},vt:{$:1,mask:g.S([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},kt:{$:t,mask:g.S([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Rt:{$:t,mask:g.S([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},Ct:{$:t,mask:g.S([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},St:{$:t,mask:g.S([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Nt:{$:t,mask:g.S([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},yt:{$:t,mask:g.S([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},xt:{$:1,mask:g.S([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Bt:{$:t,mask:g.S([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},At:{$:t,mask:g.S([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Ut:{$:1,mask:g.S([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},Vt:{$:1,mask:g.S([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Ot:{$:1,mask:g.S([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class x extends k{constructor(){super(),this.U=4,this.W=.4}V(t,e,r,n){var s=t%4,i=r[0][1];return 1!=s&&3!=s||!(i<2||i>3)?1!=s&&3!=s||2!=i&&3!=i?0!=s&&2!=s||3!=i?2==s&&(e=0):e=3:e=1:e=2,e}T(){return{Pt:{$:1,mask:null}}}O(){return"CW"}}class B extends v{constructor(t,e,r,n,s){super(),this.Tt=e,this.jt=t,this.U=this.Tt,this.Wt=r,this.Dt=n,this.Et=s}V(t,e,r,n){e=0;for(let s=0;s<this.jt.length;s++)if(this.jt[s].test(r,t,n)){e=(s+1)%this.Tt;break}return e}O(){return this.jt.map((t=>t.name())).join("||")}static $t(e=null,r=null,n=null,s=4,i=4,a=null){var h=[];null==e&&(e=Math.floor(8*Math.random())+2),null==n&&(n=t(M)()),null==a&&(a=this.Ft());for(let t=0;t<e;t++)h.push(d.v(r,s,n,a));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+n+": "+h.map((t=>t.name())).join(", ")),new B(h,i,r,n,a)}static Ft(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static Gt(t,e=4){var r=t.split("||").map((t=>d.p(t)));return new B(r,e,null,n,null)}It(t=null){var e,r=this.jt.length;null==t&&(t=this.Wt),0==(e=2==r?Math.floor(2*Math.random())+1:10==r?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.qt():1==e?this.zt(t):this.Lt(t)}Lt(t){var e=this.jt.slice();e.push(d.v(t,4,this.Dt,this.Et)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.Dt+": "+e.map((t=>t.name())).join("||")),this.jt=e}qt(){var t=this.jt.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.jt=t}zt(t){var e=this.jt.slice(),r=Math.floor(Math.random()*e.length);e[r]=d.v(t,4,this.Dt,this.Et),console.log((new Date).toLocaleTimeString()+" Changing condition "+r+" to "+this.Dt+": "+e.map((t=>t.name())).join("||")),this.jt=e}}const A="gr",U="safe",V="mix",O="general",P="test";class T{Xt;Yt;V;Ht(){throw new Error("Must override method")}Jt(){return function(t,e,r,n){e=this.Yt[0].V(t%this.Yt[0].U,e,r,n);var s=this.Yt[0].U;for(let i=1;i<this.Yt.length;i++)e+=s*this.Yt[i].V(Math.floor(t/s)%this.Yt[i].U,e,r,n),e%=s*=this.Yt[i].U;return e%s}}Kt(){throw new Error("Must override method")}O(){return this.Yt.map((t=>t.O())).join("-")}}class j extends T{constructor(t){super(),this.Qt=t,this.Xt=1,this.Yt=this.Ht(),this.V=this.Jt()}Ht(){var t=[];return"Original"==this.Qt?t.push(new C):"StarWars"==this.Qt?t.push(new S):"Modified"==this.Qt?t.push(new R):"Conway"==this.Qt?t.push(new x):t.push(new N(this.Qt)),t}Kt(){}}class W extends T{constructor(t,e,r=null){super(),this.Qt=t,this.Wt=e,this.Et=null,this.Zt=null,null==e&&(t==U||t==A||t==P?this.Wt={0:1,1:0}:t==V?(Math.random()<.5?this.Wt={0:.8,1:.2}:this.Wt={0:1,1:0},this.Wt={0:.8,1:.2}):this.Wt={0:.5,1:.5}),t==A&&(this.Et=1),this.Xt=4,this.Yt=null==r?this.Ht():this._t(r),this.V=this.Jt()}Ht(){var t=[],e=Math.random();return this.Qt==A?t.push(new R):this.Qt==U?e<.3?t.push(new R):e<.4?t.push(new C):e<.6?t.push(new S):e<.8?t.push(new y):t.push(new x):(e<.3?t.push(new R):e<.4?t.push(new C):e<.6?t.push(new S):e<.8?t.push(new y):e<1?t.push(new x):this.Qt,0==t.length&&t.push(new R)),t.push(B.$t(null,this.Wt,this.Zt,4,4,this.Et)),this.Qt==P&&((t=[]).push(new y),this.Xt=1,t.push(B.$t(null,this.Wt,this.Zt,4,4,this.Et))),t}Kt(){this.Yt[1].It(this.Wt)}_t(t){var e=[],[r,n]=t.split("-");return"BB"==r?e.push(new R):"TBB"==r?e.push(new C):"SW"==r&&e.push(new S),e.push(new S),e.push(B.Gt(n)),e}}class D extends T{constructor(t,e,r=null){super(),this.Qt=t,this.Wt=e,this.Et=null,this.Zt=null,null==e&&(t==U?this.Wt={0:1,1:0}:t==V?(Math.random()<.5?this.Wt={0:.8,1:.2}:this.Wt={0:1,1:0},this.Wt={0:.8,1:.2}):this.Wt={0:.5,1:.5}),this.Xt=16,this.Yt=null==r?this.Ht():this._t(r),this.V=this.Jt()}Ht(){var t=[];return t.push(new R),t.push(B.$t(null,this.Wt,this.Zt,4,4,this.u)),t.push(B.$t(null,this.Wt,this.Zt,16,4,this.u)),t}Kt(){this.Yt[1].It(this.Wt),this.Yt[2].It(this.Wt)}_t(t){var e=[],r=t.split("-")[1];return e.push(new R),e.push(B.Gt(r)),e}}function E(t,e=!1){Math.random()<Math.exp(t.te)||e||t.ee?("VariableGR"==t.re?(t.ne=new W(A),t.se=new W(A)):"VariableDemo"==t.re?t.ne=new W(A):"Variable"==t.re?t.ne=new W(U):"VariableMix"==t.re?t.ne=new W(V):"VariableUnsafe"==t.re?t.ne=new W(O):"VariableTest"==t.re?t.ne=new W(P):"Variable2Unsafe"==t.re?t.ne=new D(O):"CustomRule"==t.re?t.ne=new W(null,null,t.ie):"OriginalBB"==t.re?t.ne=new j("Original"):"ModifiedBB"==t.re?t.ne=new j("Modified"):"StarWars"==t.re?t.ne=new j("StarWars"):"Conway"==t.re?t.ne=new j("Conway"):"SparseFourStates"==t.re?t.ne=new j("B378/S124567/4"):t.ne=new W(V),t.te=-25,t.ae=-25,t.ee=!1,$(t)):(Math.random()<Math.exp(t.ae)||t.he)&&"CustomRule"!=t.re&&(t.ne.Kt(),"VariableGR"==t.re&&t.se.Kt(),t.ae=-25,t.he=!1,$(t)),t.te=t.te+t.oe,t.te>0&&(t.te=0),t.ae=t.ae+t.ue,t.ae>0&&(t.ae=0)}function $(t){var e=document.getElementById("currentStyle");e&&(e.value=t.ne.O())}function F(t){let e={};for(let r in t){if("t"==r)continue;let n=Math.floor(3*Math.random())-1,s=t[r]+n;s=Math.max(0,Math.min(255,s)),e[r]=s}return e.le=t.le,e}function G(t,e,r,n,s){let i=(e+n+t.ce)%t.ce,a=(r+s+t.fe)%t.fe,h=i,o=a;return(i-e-n>0||i-e-n<0)&&(o=(t.fe-a-t.Me+t.fe)%t.fe),(a-r-s>0||a-r-s<0)&&(h=(t.ce-i-t.me+t.ce)%t.ce),[h,o]}function I(t,e,r,n,s){let i=(e+n+t.ce)%t.ce,a=(r+s+t.fe)%t.fe,h=i,o=a;return(i-e-n>0||i-e-n<0)&&(o=(t.fe-a-t.Me+t.fe)%t.fe),a-r-s>0?h=(i+t.me+t.ce)%t.ce:a-r-s<0&&(h=(i-t.me+t.ce)%t.ce),[h,o]}function q(t,e,r,n,s){let i=(e+n+t.ce)%t.ce,a=(r+s+t.fe)%t.fe,h=i,o=a;return i-e-n>0?o=(a+t.Me+t.fe)%t.fe:i-e-n<0&&(o=(a-t.Me+t.fe)%t.fe),(a-r-s>0||a-r-s<0)&&(h=(t.ce-i-t.me+t.ce)%t.ce),[h,o]}function z(t,e,r,n,s){let i=(e+n+t.ce)%t.ce,a=(r+s+t.fe)%t.fe,h=i,o=a;return i-e-n>0?o=(a+t.Me+t.fe)%t.fe:i-e-n<0&&(o=(a-t.Me+t.fe)%t.fe),a-r-s>0?h=(i+t.me+t.ce)%t.ce:a-r-s<0&&(h=(i-t.me+t.ce)%t.ce),[h,o]}function L(t){t.be&&t.pe?t.t=G:t.be?t.t=I:t.pe?t.t=q:t.t=z}function X(t,e){if(t.we){var r={...t.de};delete r.ge,delete r.jt;var n={...r,event:e},s=Object.keys(n).join(",")+"\n";s+=Object.values(n).join(",");var i=new Blob([s],{type:"text/csv"}),a=URL.createObjectURL(i),h=document.createElement("a");h.href=a,h.download="dataAutomata.csv",h.click()}}function Y(t,e,r){for(var n=function(t){var e=Math.exp(-t),r=1,n=0;do{n++,r*=Math.random()}while(r>e);return n-1}(10**(t.ve+t.ne.Yt[0].W)),s=t.ne.Yt[0].F,i=t.ne.Yt[0].D,a=0;a<n;a++){var h=Math.floor(Math.random()*t.ce),o=Math.floor(Math.random()*t.fe);H(e,t,i[s()],h,o,r)}}function H(t,e,r,n,s,i){null===r?r=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?_(t,t):e<.2?K(t,t):e<.3?J(t,t):e<.4?function(t){let e=new g(t,t);for(let r=0;r<t;r++)for(let n=r;n<t;n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,r,e.get(r,n));return e}(t):e<.5?function(t){let e=new g(t,t);for(let r=0;r<t;r++)for(let n=r;n<t;n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(t-1-n,t-1-r,e.get(r,n));return e}(t):e<.6?Q(t,t):e<.7?Z(t,t):e<.8?function(t){let e=new g(t,t);for(let r=0;r<t;r++)for(let n=Math.max(r,t-r);n<t;n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,r,e.get(r,n)),e.set(t-1-n,t-1-r,e.get(r,n)),e.set(t-1-r,t-1-n,e.get(r,n));return e}(t):e<.9?function(t){let e=new g(t,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(t/2);n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,t-1-r,e.get(r,n)),e.set(t-1-r,t-1-n,e.get(r,n)),e.set(t-1-n,r,e.get(r,n));return e}(t):function(t){let e=new g(t,t);for(let r=0;r<Math.ceil(t/2);r++)for(let n=0;n<Math.ceil(t/2);n++)e.set(r,n,Math.floor(1e5*Math.random())),e.set(n,t-1-r,e.get(r,n)),e.set(t-1-r,t-1-n,e.get(r,n)),e.set(t-1-n,r,e.get(r,n)),e.set(t-1-r,n,e.get(r,n)),e.set(t-1-n,t-1-r,e.get(r,n)),e.set(r,t-1-n,e.get(r,n)),e.set(n,r,e.get(r,n));return e}(t)}(e);else{t=function(t,e){let r=Math.random();return r<.2?_(t,e):r<.4?K(t,e):r<.6?J(t,e):r<.8?Q(t,e):Z(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.5&&r.N(),Math.random()<.5&&r.flipX(),Math.random()<.5&&r.flipY());let a=r.height,h=r.width;for(let o=0;o<a;o++)for(let u=0;u<h;u++){let l=i(e,n,s,o-Math.floor(a/2),u-Math.floor(h/2));t.set(l[0],l[1],r.get(o,u))}}function J(t,e){let r=new g(e,t);for(let n=0;n<t;n++)for(let t=0;t<Math.ceil(e/2);t++)r.set(n,t,Math.floor(1e5*Math.random())),r.set(n,e-1-t,r.get(n,t));return r}function K(t,e){let r=new g(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let s=0;s<e;s++)r.set(n,s,Math.floor(1e5*Math.random())),r.set(t-1-n,s,r.get(n,s));return r}function Q(t,e){let r=new g(e,t);for(let n=0;n<t;n++)for(let s=0;s<Math.ceil(e/2);s++)r.set(n,s,Math.floor(1e5*Math.random())),r.set(t-1-n,e-1-s,r.get(n,s));return r}function Z(t,e){let r=new g(e,t);for(let n=0;n<Math.ceil(t/2);n++)for(let s=0;s<Math.ceil(e/2);s++)r.set(n,s,Math.floor(1e5*Math.random())),r.set(t-1-n,s,r.get(n,s)),r.set(n,e-1-s,r.get(n,s)),r.set(t-1-n,e-1-s,r.get(n,s));return r}function _(t,e){let r=new g(e,t);for(let n=0;n<t;n++)for(let t=0;t<e;t++)r.set(n,t,Math.floor(1e5*Math.random()));return r}function tt(t){!function(t){let e=t.ke,r=t.Re;for(var n=0,s=0;s<t.ce;s++)for(var i=0;i<t.fe;i++){if(0==t.Ce.get(s,i))continue;n+=1;var a=Math.floor(t.grid.get(s,i)/t.ne.Xt)%4;let e;if(0==a)e=t.backgroundColor;else if(1==a)e=t.Se;else if(2==a)e=t.Ne;else{if(3!=a)continue;e=t.ye}let h=4*(s*t.fe+i);r.data[h+0]=e.r,r.data[h+1]=e.g,r.data[h+2]=e.b,r.data[h+3]=e.le}if(t.xe=.01*n+.99*t.xe,t.xe>.5*t.ce*t.fe){t.ee=!0;var h=t.xe/(t.ce*t.fe);console.log("Changing rule because suspected oscillation (running proportion of cells changed: "+h.toFixed(1)+")."),t.xe=15,X(t,"oscillation")}t.xe<3&&(t.ee=!0,console.log("Changing rule because not enough cells changed ("+t.xe+")."),t.xe=20,X(t,"blackout")),e.putImageData(r,t.Be,t.Ae)}(t),function(t){var n=[new Uint8Array(e[0]).fill(0),new Uint8Array(e[1]).fill(0)],s=new Uint8Array(5).fill(0),i=new g(t.fe,t.ce),a=t.grid;const h=t.time;for(var o=0;o<t.ce;o++)for(var u=0;u<t.fe;u++){var l=r(t,o,u,a,n,s,h);const e=t.grid.get(o,u);var c=e;c="VariableGR"!=t.re||0==t.mask.get(o,u)?t.ne.V(e,c,l,t.time):t.se.V(e,c,l,t.time),Math.floor(c/t.ne.Xt)%4!=Math.floor(e/t.ne.Xt)%4?t.Ce.set(o,u,1):t.Ce.set(o,u,0),i.set(o,u,c);for(let t=0;t<n.length;t++)n[t].fill(0);s.fill(0)}t.Ue&&Y(t,i,t.t),t.grid=i}(t),E(t),t.time=(t.time+1)%166320,t.Ve&&function(t){Math.random()<1e-4&&(t.Me=Math.floor(Math.random()*t.fe),console.log("Periodicity shift X: "+t.Me)),Math.random()<1e-4&&(t.me=Math.floor(Math.random()*t.ce),console.log("Periodicity shift Y: "+t.me)),Math.random()<1e-4&&(t.be=!t.be,L(t),console.log("Flip X: "+t.be)),Math.random()<1e-4&&(t.pe=!t.pe,L(t),console.log("Flip Y: "+t.pe))}(t),"variable"==t.Oe&&function(t){Math.random()<1&&(t.ye=F(t.ye),t.Ne=F(t.Ne))}(t),setTimeout((function(){requestAnimationFrame((()=>tt(t)))}),t.timeout)}console.log("Loading main.js");var et=document.getElementById("gameCanvas"),rt=et.getContext("2d"),nt=29,st=78,it=80,at=!1,ht=-0,ot=!1,ut=0,lt=0,ct=!1,ft=!1,Mt="mouseAnimation",mt="Variable",bt="zero",pt=6,wt=new class{constructor(t,e,r=200,n=200,s=20,i=!0,a=-2,h=!0,o=0,u=0,l=!1,c=!1,f="black2",M="VariableGR",m="random",b=6,p=2e4,w=2e3){this.ce=r,this.fe=n,this.Be=0,this.Ae=0,this.timeout=s,this.grid=null,this.Ce=null,this.Re=null,this.canvas=t,this.ke=e,this.Ue=i,this.ve=a,this.Ve=h,this.Me=o,this.me=u,this.be=l,this.pe=c,this.Oe=f,this.re=M,this.Pe=m,this.Te=b,this.je=null,this.We=null,this.t=null,this.mask=null,this.De=p,this.Ee=w,this.te=-25,this.ae=-25,this.oe=25/this.De,this.ue=25/this.Ee,this.canvas.width=this.fe,this.canvas.height=this.ce,this.Re=e.createImageData(t.width,t.height),this.ee=!0,this.he=!1,this.xe=0,this.we=!1,this.time=0}}(et,rt,nt,st,it,at,ht,ot,ut,lt,ct,ft,Mt,mt,bt,pt);window.onload=function(){wt.grid=new g(wt.fe,wt.ce),wt.Ce=new g(wt.fe,wt.ce);const t=document.getElementById("background"),e=t.getContext("2d");wt.$e=t;const r=new Image;r.src="./grWebsiteBackgroundTransp.png?"+(new Date).getTime(),r.onload=function(){e.drawImage(r,0,0,t.width,t.height)},function(t){t.$e.addEventListener("mousemove",(function(e){var r=t.canvas.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top,i=r.width/t.fe,a=r.height/t.ce,h=Math.floor(n/i),o=Math.floor(s/a);t.grid.set(o,h,1)}))}(wt),function(t){t.$e.addEventListener("mousedown",(function(e){var r=t.canvas.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top,i=r.width/t.fe,a=r.height/t.ce,h=Math.floor(n/i),o=Math.floor(s/a);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(o,(h+1)%t.fe,1),t.grid.set(o,h,1),t.grid.set((o+1)%t.ce,h,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(o,h,1),t.grid.set((o+1)%t.ce,h,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(o,h,1),t.grid.set(o,(h+1)%t.fe,1)):(t.grid.set((o+1)%t.ce,(h+1)%t.fe,1),t.grid.set((o-1+t.ce)%t.ce,(h+1)%t.fe,1),t.grid.set((o-1+t.ce)%t.ce,(h-1+t.fe)%t.fe,1),t.grid.set((o+1)%t.ce,(h-1+t.fe)%t.fe,1))}))}(wt),function(t){var e={r:247,g:255,b:28,le:255},r={r:13,g:112,b:255,le:255},n={r:240,g:239,b:239,le:255},s={r:0,g:0,b:0,le:255},i={r:240,g:240,b:240,le:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),le:255},h={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),le:255};"yellow"==t.Oe?(t.backgroundColor=e,t.Se=s,t.Ne=r,t.ye=n):"blue"==t.Oe?(t.backgroundColor=r,t.Se=n,t.Ne=s,t.ye=e):"blue2"==t.Oe?(t.backgroundColor=r,t.Se=e,t.Ne=s,t.ye=n):"grey"==t.Oe?(t.backgroundColor=n,t.Se=s,t.Ne=r,t.ye=e):"grey2"==t.Oe?(t.backgroundColor=n,t.Se=e,t.Ne=s,t.ye=r):"black"==t.Oe?(t.backgroundColor=s,t.Se=r,t.Ne=e,t.ye=n):"black2"==t.Oe?(t.backgroundColor=s,t.Se=r,t.Ne=n,t.ye=e):"blackTrace"==t.Oe?(t.backgroundColor=s,t.Se=n,t.Ne=s,t.ye=n):"blackTrace2"==t.Oe?(t.backgroundColor=s,t.Se=s,t.Ne=s,t.ye=n):"blackTrace3"==t.Oe?(t.backgroundColor=s,t.Se=s,t.Ne=n,t.ye=n):"redblue"==t.Oe?(t.backgroundColor=s,t.Se=i,t.Ne={r:221,g:85,b:12,le:255},t.ye={r:49,g:130,b:189,le:255}):"variable"==t.Oe?(t.backgroundColor=s,t.Se=i,t.Ne=a,t.ye=h):"mouseAnimation"==t.Oe&&(t.backgroundColor={r:0,g:0,b:0,le:0},t.Se=r,t.Ne=s,t.ye=e)}(wt),L(wt),function(t){E(t,!0)}(wt),tt(wt)}})();
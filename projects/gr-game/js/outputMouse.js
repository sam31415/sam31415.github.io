(()=>{"use strict";function t(t){let e=Object.values(t).reduce(((t,e)=>t+e),0),s=Object.values(t).reduce(((t,s,r)=>[...t,s/e+(t[r-1]||0)]),[]);return function(){let e=Math.random(),r=s.findIndex((t=>e<t));return Object.keys(t)[r]}}const e=[11,44];function s(t,e,s,r,i,n,h,a,o){const u=r.height-1,l=r.width-1,c=r.data,M=r.width;var f=i[0],m=i[1];let p;for(var b=-1;b<=1;b++)for(var g=-1;g<=1;g++){if(0==b&&0==g)continue;if(n[0]=((-1===b?1:b)+(-1===g?1:g))%2,n[2+(3&h)]=-1==b?1:0,n[(1+h)%4+1]=-1==g?1:0,n[(2+h)%4+1]=1==b?1:0,n[(3+h)%4+1]=1==g?1:0,0==e||0==s||e==u||s==l)var[d,S]=t.t(t,e,s,b,g);else var d=e+b,S=s+g;const r=c[d*M+S],i=r%a,B=Math.floor(r/a)%o;p=a;for(var w=0;w<a-1;w++)i==w+1&&(f[w]+=1,f[p+w]+=n[0],p+=a,f[p+w]+=1-n[0],f[a+p+w]+=n[1],p+=a,f[p+w]+=1-n[1],f[a+p+w]+=n[2],p+=a,f[p+w]+=1-n[2],f[a+p+w]+=n[3],p+=a,f[p+w]+=1-n[3],f[a+p+w]+=n[4],p+=a,f[p+w]+=1-n[4]),p=a;p=o;for(w=0;w<o;w++)m[w]+=1,B==w&&(m[o+w]+=n[0],p+=o,m[p+w]+=1-n[0],m[o+p+w]+=n[1],p+=o,m[p+w]+=1-n[1],m[o+p+w]+=n[2],p+=o,m[p+w]+=1-n[2],m[o+p+w]+=n[3],p+=o,m[p+w]+=1-n[3],m[o+p+w]+=n[4],p+=o,m[p+w]+=1-n[4]),p=o}return[f,m]}const r="mix",i="isotropic",n="xcross",h="vcross",a="xvcross",o="directional1",u="directional2",l="directional3",c="directional2b",M="directional",f={[r]:.2,[i]:.4,[n]:.05,[h]:.05,[a]:.05,[o]:.05,[u]:.05,[l]:.05,[c]:.05,[M]:.05};const m="A",p="C",b="E",g="B";class d{constructor(t,e,s,r,i,n=null){this.type=t,this.threshold=e,this.i=s,this.h=r,this.o=i,this.u=n,this.l=function(t,e){return t==p?function(t){return 0==t}:t==m?function(t){return t%e==0}:function(t){return!0}}(this.h,this.o),this.M=function(t,e,s){return e==b&&2==s.length?function(e){return e[s[0]][s[1]]==t}:e==g&&2==s.length?function(e){return e[s[0]][s[1]]>t}:e==b&&3==s.length?function(e){return e[s[0]][s[1]]+e[s[0]][s[2]]==t}:e==g&&3==s.length?function(e){return e[s[0]][s[1]]+e[s[0]][s[2]]>t}:void 0}(this.threshold,this.type,this.i),this.m=function(t){let e;return e=null==t?function(t){return!0}:function(e){return t[e%t.length]},e}(n)}test(t,e,s){var r=this.m(s);return this.M(t)&&this.l(e)&&r}name(){var t="";null!=this.u&&(t=this.u.map((t=>t?"1":"0")).join(""));var e=this.i.join("|");return`${this.type}${this.threshold}${this.h}[${e}]${t}`}static p(t,e=4){var s=null;t.startsWith(b)?s=b:t.startsWith(g)&&(s=g);var r=t.substring(s.length),i=parseInt(r.substring(0,1)),n=null;(r=r.substring(1)).startsWith(p)?n=p:r.startsWith(m)?n=m:r.startsWith("N")&&(n="N");var h=(r=r.substring(n.length)).split("[")[1].split("]")[0].split("|").map(Number),a=null;return(r=r.split("]")[1]).length>0&&(a=r.split("").map((t=>"1"===t))),new d(s,i,h,n,e,a)}static S(e=null,s=4,f=r,S=null){const w=[b,g],B=w[Math.floor(Math.random()*w.length)],v=[p,m,"N"],N=v[Math.floor(Math.random()*v.length)];null===e&&(e={0:2/3,1:1/3});const k=t(e)(),I=function(t,e){var s=e;if(s==r){var f=Math.random();s=f<.5?i:f<.7?n:f<.9?h:M}if(s==i)return Math.floor(4*Math.random());if(s==h)return Math.floor(4*Math.random()+4);if(s==n)return Math.floor(4*Math.random()+8);if(s==a)return Math.floor(8*Math.random()+4);if(s==o)return Math.floor(4*Math.random()+12);if(s==u)return Math.floor(8*Math.random()+12);if(s==l)return Math.floor(12*Math.random()+12);if(s==c){var m=Math.floor(8*Math.random()+12);return m>=16&&(m+=4),m}return s==M?Math.floor(16*Math.random()+12):void 0}(0,f);var R=void 0;if(Math.random()<.5){R=[k,I,function(t){for(var e=4*Math.floor(t/4),s=t;s==t;)s=e+Math.floor(4*Math.random());return s}(I)]}else R=[k,I];var y=0,C=8;if(0==R[0]&&R[1]%4!=1?C=5:R[1]>4&&R[1]<=16?C=4:R[1]>16&&(C=3),y=B===g?Math.floor(Math.random()*C):Math.floor(Math.random()*C)+1,Math.random()<.2)A=null;else{var A;null==S&&(S=Math.floor(20*Math.random())+2);do{A=new Array(S).fill(0).map((()=>Math.random()<.5))}while(!A.includes(!0))}return new d(B,y,R,N,s,A)}}class S{constructor(t,e){this.width=t,this.height=e,this.data=new Uint8Array(this.width*this.height),this.rows=new Array(this.height),this.B=!1,this.get=this.v,this.set=this.N}static k(t,e=!1,s=!1,r=!1){const i=t.length,n=t[0].length,h=new S(n,i);for(let e=0;e<i;e++){r&&(e=i-e-1);for(let r=0;r<n;r++)s&&(r=n-r-1),h.set(e,r,t[e][r])}return e&&h.I(),h}I(){[this.width,this.height]=[this.height,this.width],[this.get,this.set]=this.B?[this.v,this.N]:[this.R,this.C],this.B=!this.B}flipX(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width/2;e++){const s=this.get(t,e);this.set(t,e,this.get(t,this.width-e-1)),this.set(t,this.width-e-1,s)}}flipY(){for(let t=0;t<this.height/2;t++)for(let e=0;e<this.width;e++){const s=this.get(t,e);this.set(t,e,this.get(this.height-t-1,e)),this.set(this.height-t-1,e,s)}}v(t,e){return this.data[t*this.width+e]}N(t,e,s){this.data[t*this.width+e]=s}R(t,e){return this.data[e*this.height+t]}C(t,e,s){this.data[e*this.height+t]=s}}class w{constructor(){this.A=void 0}U(t,e,s,r){throw new Error("Must override method")}$(){throw new Error("Must override method")}}class B extends w{constructor(){super(),this.P=this.V(),this.T(),this.O=0}V(){throw new Error("Must override method")}T(){this.W=Object.keys(this.P).map((t=>this.P[t].mask));let e=Object.keys(this.P).map((t=>this.P[t].F));this.G=t(e)}}class v extends B{constructor(){super(),this.A=4}U(t,e,s,r){var i=t%4;return 1==i||3==i?e=2:2==i?e=0:0==i&&2==s[0][0]?e=1:0==i&&s[0][0]>2&&(e=3),e}$(){return"BB"}V(){return{random:{F:15,mask:null},j:{F:4,mask:S.k([[1,1],[1,1]])},D:{F:4,mask:new S([[1,0,1],[0,0,0],[1,0,1]])},q:{F:2,mask:S.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{F:2,mask:S.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},X:{F:2,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},Y:{F:2,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]],!0)}}}}class N extends B{constructor(){super(),this.A=4,this.O=-1}U(t,e,s,r){var i=t%4;return 3==i&&(i=0),1==i?e=2:2==i||3==i?e=0:0!=i&&3!=i||2!=s[0][0]?0==i&&s[0][0]>2&&(e=3):e=1,e}$(){return"TBB"}V(){return{random:{F:15,mask:null},X:{F:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},q:{F:2,mask:S.k([[0,0,1,0],[1,2,2,0],[0,2,2,1],[0,1,0,0]])},L:{F:2,mask:S.k([[0,0,2,0,0,0,0],[0,1,1,0,0,1,0],[0,0,2,1,2,1,2],[0,0,1,0,1,0,0],[2,1,2,1,2,0,0],[0,1,0,0,1,1,0],[0,0,0,0,2,0,0]])},j:{F:4,mask:S.k([[1,1],[1,1]])},H:{F:1e4,mask:S.k([[0,2,1,0,0,0,0,0],[0,0,2,1,0,0,0,0],[2,0,0,2,1,0,0,0],[1,2,0,0,2,1,0,0],[0,1,0,2,1,0,2,1],[0,0,2,1,0,0,2,1]])}}}}class k extends B{constructor(){super(),this.A=4,this.O=-1}U(t,e,s,r){var i=t%4;return 1==i&&(s[0][0]<3||s[0][0]>5)?e=2:2==i?e=3:3==i?e=0:0==i&&2==s[0][0]&&(e=1),e}$(){return"SW"}V(){let t=.2;return{random:{F:6,mask:null},J:{F:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},K:{F:t,mask:S.k([[1,2,3],[0,1,0],[1,1,0],[0,1,0],[0,1,0],[1,1,0],[0,1,2],[3,0,1]])},Z:{F:t,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},_:{F:t,mask:S.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},tt:{F:t,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},et:{F:t,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},st:{F:t,mask:S.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},rt:{F:t,mask:S.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},it:{F:t,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},nt:{F:t,mask:S.k([[0,0,0,0,3,2,0,0],[0,0,0,0,1,0,3,0],[0,0,1,2,0,1,0,0],[0,0,2,3,1,1,0,0],[3,1,0,1,0,1,1,1],[2,0,1,1,1,0,1,3],[0,3,0,0,1,1,1,0],[0,0,0,0,1,3,0,0]])},ht:{F:t,mask:S.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ot:{F:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},ut:{F:t,mask:S.k([[0,3,2,1,1,2,3,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[2,3,0,0,0,0,3,2]])},lt:{F:t,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},ct:{F:t,mask:S.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},Mt:{F:t,mask:S.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])},ft:{F:t,mask:S.k([[0,1,0,0,0,0],[1,1,1,0,0,0],[0,1,0,0,1,0],[0,0,0,1,1,1],[0,0,0,0,1,0]])},D:{F:2,mask:S.k([[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0],[0,0,0,1,0,0,0]])}}}}class I extends B{constructor(t){super(),null==t&&(t=I.bt()),this.gt(t)}U(t,e,s,r){var i=t%this.A;return 1==i&&this.dt.includes(s[0][this.St])?e=1:i>0&&i<this.A-1?e+=1:i==this.A-1?e=0:0==i&&this.wt.includes(s[0][this.St])?e=1:0==i&&this.Bt.includes(s[0][this.St])&&(e=this.A-1),e}gt(t){this.vt=t;const e=this.vt.split("/");for(var s of(this.St=0,this.Bt=[],e))"N"==s[0]?this.St=Number(e[0].substring(1)):"B"==s[0]?this.wt=new Uint8Array(s.substring(1).split("").map(Number)):"S"==s[0]?this.dt=new Uint8Array(s.substring(1).split("").map(Number)):"I"==s[0]?this.Bt=new Uint8Array(e[2].substring(1).split("").map(Number)):this.A=Number(s)}static bt(t){let e=Math.floor(10*Math.random())+3;null==t&&(t=Math.floor(5*Math.random()*e));let s=Math.floor(t/e)%5;var r=8;[1,2].includes(s)?r=4:3==s?r=3:4==s&&(r=5);let i=y.Nt(1,r);0==i.length&&(i=[2]);let n=y.Nt(1,r),h=y.Nt(1,r);return h=h.filter((t=>!i.includes(t)&&!n.includes(t)&&2!=t)),`N${t}/B${i.join("")}/S${n.join("")}/I${h.join("")}/${e}`}static Nt(t,e){let s=[];for(let r=t;r<=e;r++)Math.random()<.5&&s.push(r);return s}$(){return this.vt}V(){return{random:{F:1,mask:null}}}}class R extends I{constructor(t,e=null){if(super(t),"ships"==e){let t=R.bt(0);this.gt(t);let e=Array.from(this.wt).indexOf(1);if(-1!==e){let t=new Uint8Array(this.wt.length-1);t.set(this.wt.subarray(0,e),0),t.set(this.wt.subarray(e+1),e),this.wt=t}if(-1===this.wt.indexOf(2)){let t=new Uint8Array(this.wt.length+1);t[0]=2,t.set(this.wt,1),this.wt=t}if(e=Array.from(this.dt).indexOf(1),-1!==e){let t=new Uint8Array(this.dt.length-1);t.set(this.dt.subarray(0,e),0),t.set(this.dt.subarray(e+1),e),this.dt=t}this.Bt=this.Bt.filter((t=>!this.wt.includes(t)&&!this.dt.includes(t)&&2!=t)),this.vt=`N${this.St}/B${this.wt.join("")}/S${this.dt.join("")}/I${this.Bt.join("")}/${this.A}`,this.kt=1,this.O=.5}else this.kt=20/this.wt[0]**3,this.O=1}U(t,e,s,r,i){var n=t%this.A;return 1==n&&this.dt.includes(s[0][this.St])?e=1:n>0&&n<this.A-1?e+=1:n==this.A-1?e=0:0==n&&this.wt.includes(s[0][this.St])&&Math.random()>this.kt*i-.01?e=1:0==n&&this.Bt.includes(s[0][this.St])&&(e=this.A-1),e}}class y extends I{constructor(t=!0){t?super(y.It()):(super(y.bt()),this.O=0)}static It(){let e=t({Rt:5,yt:1,Ct:1,At:1,xt:1,Ut:1,$t:1,Pt:1,Vt:1,Tt:1,Ot:1,Wt:1,Ft:1,Gt:1,jt:1,Dt:1,Et:1,qt:1,zt:1,Lt:1,Xt:3,Yt:1,Ht:1,Jt:1,Kt:1,Qt:1,Zt:1,_t:1,te:1,ee:1,se:1,re:10,ie:3,ne:1,he:1,ae:1,oe:1,ue:1,le:1,ce:1,Me:1,fe:1,me:1,pe:1,be:1,ge:1,de:1,Se:1,we:1,Be:1,ve:1,Ne:1,ke:1,Ie:1,Re:1,ye:1,Ce:1,Ae:1,xe:1,Ue:1,$e:1,Pe:1,Ve:1,Te:1,Oe:1,We:1,Fe:1,Ge:1})();for(;e.split("/").length<5;)if("N"!=e[0])e="N0/"+e;else{e=e+"/"+(Math.floor(10*Math.random())+3)}return e}V(){return{random:{F:1,mask:null}}}}class C extends I{constructor(){super("B24/S34/I15678/4"),this.O=0}$(){return"FS"}V(){let t=.2;return{random:{F:20,mask:null},je:{F:1,mask:S.k([[1,1],[1,1]])},De:{F:t,mask:S.k([[1,1]])},Ee:{F:1,mask:S.k([[1,0],[1,1]])},qe:{F:t,mask:S.k([[1,1],[2,2]])},ze:{F:1,mask:S.k([[0,1,0],[1,1,1],[0,1,0]])},Le:{F:1,mask:S.k([[1,0,1],[0,0,0],[1,0,1]])},Xe:{F:t,mask:S.k([[1,0,0],[1,1,0],[0,1,1]])},Ye:{F:t,mask:S.k([[0,1,1,1,1,1,0],[1,1,0,1,0,1,1],[1,1,0,1,0,1,1],[0,1,1,1,1,1,0]])},He:{F:1,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},Je:{F:1,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Ke:{F:1,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Qe:{F:t,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},Ze:{F:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},_e:{F:t,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])}}}}class A extends I{constructor(){super("B2/S245678/I1/4"),this.O=0}$(){return"SS"}V(){let t=.2;return{random:{F:10,mask:null},je:{F:1,mask:S.k([[0,1,2,1,2,1,0],[1,2,0,1,0,2,1],[1,2,0,1,0,2,1],[0,1,2,1,2,1,0]])},De:{F:t,mask:S.k([[0,0,1,0,0,0,0,0,0],[0,1,1,1,0,0,1,2,0],[3,0,1,0,0,0,1,0,3],[0,0,1,1,0,1,1,1,0],[0,0,1,1,0,0,1,0,0],[0,0,2,0,0,3,2,1,0]])},qe:{F:t,mask:S.k([[0,0,0,1,0,1,0,0],[0,1,2,0,1,1,1,0],[1,2,3,1,1,0,1,1],[1,2,3,0,0,1,1,0],[0,0,0,0,1,2,0,0]])},Xe:{F:t,mask:S.k([[0,0,0,0,0,3,2,0],[0,0,1,0,0,1,0,0],[1,1,1,1,1,1,1,1],[0,1,0,0,0,0,1,0],[0,1,0,0,0,0,1,0],[1,1,1,0,0,1,1,1],[0,1,0,0,0,0,1,0]])},Ye:{F:t,mask:S.k([[0,0,0,1,0,0],[0,0,1,1,1,3],[0,0,0,1,0,2],[0,0,0,0,0,1],[0,1,0,1,1,0],[1,1,1,1,1,1],[0,1,0,0,1,0]])},Qe:{F:t,mask:S.k([[0,1,1,2,0],[2,0,1,0,3],[3,1,1,1,0],[0,1,0,2,1]])},Ze:{F:t,mask:S.k([[0,0,0,2,0],[3,0,1,1,0],[2,1,1,1,3],[1,0,1,0,2],[0,0,0,1,0]])},He:{F:1,mask:S.k([[0,1,0,0,1,0,0,0,0,0],[1,1,1,2,2,1,0,3,2,0],[0,1,0,2,0,1,0,0,1,0],[0,1,2,2,1,1,1,1,1,1],[0,0,1,0,0,1,0,0,1,0]])},_e:{F:t,mask:S.k([[0,0,0,1,0,3,0,0],[0,0,2,0,1,0,2,1],[0,0,3,1,1,1,2,1],[0,0,1,0,1,0,3,0],[3,0,1,0,1,0,0,0],[2,1,1,1,3,0,0,0],[1,0,1,0,2,0,0,0],[0,0,0,0,1,3,0,0]])},ts:{F:t,mask:S.k([[0,0,1,1,3,0,1,0],[0,1,0,2,2,1,1,1],[1,1,1,0,0,0,1,0],[0,1,0,0,0,0,3,0]])},Je:{F:1,mask:S.k([[0,2,3,0,0,1,0,0,0],[1,0,1,1,1,1,0,3,0],[0,1,1,0,0,1,1,2,1],[0,0,1,1,1,1,0,2,1],[0,1,2,0,0,0,3,0,0]])},es:{F:1,mask:S.k([[0,0,0,0,3,0,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,1,0,1,0,1,0,0],[0,2,3,1,1,1,3,2,0],[1,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1],[2,0,1,0,2,0,1,0,2],[0,3,0,1,0,1,0,3,0]])},ss:{F:1,mask:S.k([[0,0,0,1,0,1,0,0,0],[1,0,1,0,1,0,1,0,1],[2,1,1,1,1,1,1,1,2],[0,1,0,1,0,1,0,1,0],[0,1,0,0,1,0,0,1,0],[1,1,1,1,1,1,1,1,1],[0,1,0,0,1,0,0,1,0]])}}}}class x extends B{constructor(){super(),this.A=4,this.O=.4}U(t,e,s,r){var i=t%4,n=s[0][0]+s[0][2];return 1!=i&&3!=i||!(n<2||n>3)?1!=i&&3!=i||2!=n&&3!=n?0!=i&&2!=i||3!=n?2==i&&(e=0):e=3:e=1:e=2,e}V(){return{rs:{F:1,mask:null}}}$(){return"CW"}}class U extends w{constructor(t,e,s,r,i){super(),this.ns=e,this.hs=t,this.A=this.ns,this.os=s,this.us=r,this.ls=i}U(t,e,s,r){e=0;for(let i=0;i<this.hs.length;i++)if(this.hs[i].test(s,t,r)){e=(i+1)%this.ns;break}return e}$(){return this.hs.map((t=>t.name())).join("||")}static cs(e=null,s=null,r=null,i=4,n=4,h=null){var a=[];null==e&&(e=Math.floor(8*Math.random())+2),null==r&&(r=t(f)()),null==h&&(h=this.Ms());for(let t=0;t<e;t++)a.push(d.S(s,i,r,h));return console.log((new Date).toLocaleTimeString()+" Sampling coloring rule "+r+": "+a.map((t=>t.name())).join(", ")),new U(a,n,s,r,h)}static Ms(){var t=Math.random();return t<.2?null:t<.6?1:t<.7?2:t<.8?3:t<.9?4:Math.floor(20*Math.random())+5}static fs(t,e=4){var s=t.split("||").map((t=>d.p(t)));return new U(s,e,null,r,null)}ps(t=null){var e,s=this.hs.length;null==t&&(t=this.os),0==(e=2==s?Math.floor(2*Math.random())+1:10==s?Math.floor(2*Math.random()):Math.floor(3*Math.random()))?this.bs():1==e?this.gs(t):this.ds(t)}ds(t){var e=this.hs.slice();e.push(d.S(t,4,this.us,this.ls)),console.log((new Date).toLocaleTimeString()+" Adding condition "+this.us+": "+e.map((t=>t.name())).join("||")),this.hs=e}bs(){var t=this.hs.slice(),e=Math.floor(Math.random()*t.length);t.splice(e,1)[0],console.log((new Date).toLocaleTimeString()+" Removing condition: "+t.map((t=>t.name())).join("||")),this.hs=t}gs(t){var e=this.hs.slice(),s=Math.floor(Math.random()*e.length);e[s]=d.S(t,4,this.us,this.ls),console.log((new Date).toLocaleTimeString()+" Changing condition "+s+" to "+this.us+": "+e.map((t=>t.name())).join("||")),this.hs=e}}const $="gr",P="safe",V="mix",T="general",O="test";class W{Ss;ws;U;Bs(){throw new Error("Must override method")}vs(){return function(t,e,s,r,i){e=this.ws[0].U(t%this.ws[0].A,e,s,r,i);var n=this.ws[0].A;for(let i=1;i<this.ws.length;i++)e+=n*this.ws[i].U(Math.floor(t/n)%this.ws[i].A,e,s,r),e%=n*=this.ws[i].A;return e%n}}Ns(){throw new Error("Must override method")}$(){return this.ws.map((t=>t.$())).join("-")}}class F extends W{constructor(t){super(),this.ks=t,this.Ss=1,this.ws=this.Bs(),this.U=this.vs()}Bs(){var t=[];return"Original"==this.ks?t.push(new N):"StarWars"==this.ks?t.push(new k):"Modified"==this.ks?t.push(new v):"Conway"==this.ks?t.push(new x):t.push(new I(this.ks)),t}Ns(){}}class G extends W{constructor(t,e,s=null){super(),this.ks=t,this.os=e,this.ls=null,this.Is=null,null==e&&(t==P||t==$||t==O?this.os={0:1,1:0}:t==V?(Math.random()<.5?this.os={0:.8,1:.2}:this.os={0:1,1:0},this.os={0:.8,1:.2}):this.os={0:.5,1:.5}),t==$&&(this.ls=1),this.Ss=4,this.ws=null==s?this.Bs():this.Rs(s),this.U=this.vs()}ys=[{Cs:R,As:[null,"ships"],weight:2},{Cs:R,As:[],weight:2},{Cs:y,As:[],weight:2},{Cs:v,As:[],weight:4},{Cs:N,As:[],weight:1},{Cs:k,As:[],weight:1},{Cs:A,As:[],weight:1},{Cs:C,As:[],weight:1},{Cs:x,As:[],weight:1}];xs=[{Cs:v,As:[],weight:1}];Bs(){let t=this.ys;this.ks==$&&(t=this.xs);let e=t.reduce(((t,e)=>t+e.weight),0);var s=[];let r=Math.random()*e;for(let e=0;e<t.length;e++){if(r<t[e].weight){s.push(new t[e].Cs(...t[e].As));break}r-=t[e].weight}return s.push(U.cs(null,this.os,this.Is,s[0].A,4,this.ls)),this.ks==O&&((s=[]).push(new R(null,"ships")),this.Ss=s[0].A,s.push(U.cs(null,this.os,this.Is,4,4,this.ls))),s}Ns(){this.ws[1]&&"function"==typeof this.ws[1].ps&&this.ws[1].ps(this.os)}Rs(t){var e=[],[s,r]=t.split("-");return"BB"==s?e.push(new v):"TBB"==s?e.push(new N):"SW"==s?e.push(new k):"SS"==s?e.push(new A):"FS"==s?e.push(new C):"CW"==s?e.push(new x):e.push(new I(s)),e.push(U.fs(r)),e}}class j extends W{constructor(t,e,s=null){super(),this.ks=t,this.os=e,this.ls=null,this.Is=null,null==e&&(t==P?this.os={0:1,1:0}:t==V?(Math.random()<.5?this.os={0:.8,1:.2}:this.os={0:1,1:0},this.os={0:.8,1:.2}):this.os={0:.5,1:.5}),this.Ss=16,this.ws=null==s?this.Bs():this.Rs(s),this.U=this.vs()}Bs(){var t=[];return t.push(new v),t.push(U.cs(null,this.os,this.Is,4,4,this.u)),t.push(U.cs(null,this.os,this.Is,16,4,this.u)),t}Ns(){this.ws[1].ps(this.os),this.ws[2].ps(this.os)}Rs(t){var e=[],s=t.split("-")[1];return e.push(new v),e.push(U.fs(s)),e}}function D(t,e=!1){Math.random()<Math.exp(t.Us)||e||t.$s?("VariableGR"==t.Cs?(t.Ps=new G($),t.Vs=new G($)):"VariableDemo"==t.Cs?t.Ps=new G($):"Variable"==t.Cs?t.Ps=new G(P):"VariableMix"==t.Cs?t.Ps=new G(V):"VariableUnsafe"==t.Cs?t.Ps=new G(T):"VariableTest"==t.Cs?t.Ps=new G(O):"Variable2Unsafe"==t.Cs?t.Ps=new j(T):"CustomRule"==t.Cs?t.Ps=new G(null,null,t.Ts):"OriginalBB"==t.Cs?t.Ps=new F("Original"):"ModifiedBB"==t.Cs?t.Ps=new F("Modified"):"StarWars"==t.Cs?t.Ps=new F("StarWars"):"Conway"==t.Cs?t.Ps=new F("Conway"):"SparseFourStates"==t.Cs?t.Ps=new F("B378/S124567/4"):t.Ps=new G(V),t.Us=-25,t.Os=-25,t.$s=!1,E(t)):(Math.random()<Math.exp(t.Os)||t.Ws)&&"CustomRule"!=t.Cs&&(t.Ps.Ns(),"VariableGR"==t.Cs&&t.Vs.Ns(),t.Os=-25,t.Ws=!1,E(t));let s=Math.max(t.Fs/200,1);t.Us=t.Us+t.Gs*s,t.Us>0&&(t.Us=0),t.Os=t.Os+t.js*s,t.Os>0&&(t.Os=0)}function E(t){var e=document.getElementById("currentStyle");e&&(e.value=t.Ps.$())}function q(t){let e={};for(let s in t){if("t"==s)continue;let r=Math.floor(3*Math.random())-1,i=t[s]+r;i=Math.max(0,Math.min(255,i)),e[s]=i}return e.Ds=t.Ds,e}function z(t,e,s,r,i){let n=(e+r+t.Es)%t.Es,h=(s+i+t.qs)%t.qs,a=n,o=h;return(n-e-r>0||n-e-r<0)&&(o=(t.qs-h-t.zs+t.qs)%t.qs),(h-s-i>0||h-s-i<0)&&(a=(t.Es-n-t.Ls+t.Es)%t.Es),[a,o]}function L(t,e,s,r,i){let n=(e+r+t.Es)%t.Es,h=(s+i+t.qs)%t.qs,a=n,o=h;return(n-e-r>0||n-e-r<0)&&(o=(t.qs-h-t.zs+t.qs)%t.qs),h-s-i>0?a=(n+t.Ls+t.Es)%t.Es:h-s-i<0&&(a=(n-t.Ls+t.Es)%t.Es),[a,o]}function X(t,e,s,r,i){let n=(e+r+t.Es)%t.Es,h=(s+i+t.qs)%t.qs,a=n,o=h;return n-e-r>0?o=(h+t.zs+t.qs)%t.qs:n-e-r<0&&(o=(h-t.zs+t.qs)%t.qs),(h-s-i>0||h-s-i<0)&&(a=(t.Es-n-t.Ls+t.Es)%t.Es),[a,o]}function Y(t,e,s,r,i){let n=(e+r+t.Es)%t.Es,h=(s+i+t.qs)%t.qs,a=n,o=h;return n-e-r>0?o=(h+t.zs+t.qs)%t.qs:n-e-r<0&&(o=(h-t.zs+t.qs)%t.qs),h-s-i>0?a=(n+t.Ls+t.Es)%t.Es:h-s-i<0&&(a=(n-t.Ls+t.Es)%t.Es),[a,o]}function H(t){t.Xs&&t.Ys?t.t=z:t.Xs?t.t=L:t.Ys?t.t=X:t.t=Y}function J(t,e){if(t.Hs){var s=t.Ps.ws[0].$(),r=new Blob([s],{type:"text/plain"}),i=URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download="dataAutomata.txt",n.click()}}function K(t,e,s){var r=function(t){var e=Math.exp(-t),s=1,r=0;do{r++,s*=Math.random()}while(s>e);return r-1}(10**(t.Js+t.Ps.ws[0].O));if(0!=r)for(var i=t.Ps.ws[0].G,n=t.Ps.ws[0].W,h=0;h<r;h++){var a=Math.floor(Math.random()*t.Es),o=Math.floor(Math.random()*t.qs);Q(e,t,n[i()],a,o,s)}}function Q(t,e,s,r,i,n){null===s?s=function(){let t,e=Math.floor(10*Math.random())+1;if(Math.random()<.7)t=function(t){let e=Math.random();return e<.1?st(t,t):e<.2?_(t,t):e<.3?Z(t,t):e<.4?function(t){let e=new S(t,t);for(let s=0;s<t;s++)for(let r=s;r<t;r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,s,e.get(s,r));return e}(t):e<.5?function(t){let e=new S(t,t);for(let s=0;s<t;s++)for(let r=s;r<t;r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(t-1-r,t-1-s,e.get(s,r));return e}(t):e<.6?tt(t,t):e<.7?et(t,t):e<.8?function(t){let e=new S(t,t);for(let s=0;s<t;s++)for(let r=Math.max(s,t-s);r<t;r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,s,e.get(s,r)),e.set(t-1-r,t-1-s,e.get(s,r)),e.set(t-1-s,t-1-r,e.get(s,r));return e}(t):e<.9?function(t){let e=new S(t,t);for(let s=0;s<Math.ceil(t/2);s++)for(let r=0;r<Math.ceil(t/2);r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,t-1-s,e.get(s,r)),e.set(t-1-s,t-1-r,e.get(s,r)),e.set(t-1-r,s,e.get(s,r));return e}(t):function(t){let e=new S(t,t);for(let s=0;s<Math.ceil(t/2);s++)for(let r=0;r<Math.ceil(t/2);r++)e.set(s,r,Math.floor(1e5*Math.random())),e.set(r,t-1-s,e.get(s,r)),e.set(t-1-s,t-1-r,e.get(s,r)),e.set(t-1-r,s,e.get(s,r)),e.set(t-1-s,r,e.get(s,r)),e.set(t-1-r,t-1-s,e.get(s,r)),e.set(s,t-1-r,e.get(s,r)),e.set(r,s,e.get(s,r));return e}(t)}(e);else{t=function(t,e){let s=Math.random();return s<.2?st(t,e):s<.4?_(t,e):s<.6?Z(t,e):s<.8?tt(t,e):et(t,e)}(e,Math.floor(10*Math.random())+1)}return t}():(Math.random()<.25&&s.I(),Math.random()<.5&&s.flipX(),Math.random()<.75&&s.flipY());let h=s.height,a=s.width;for(let o=0;o<h;o++)for(let u=0;u<a;u++){let l=n(e,r,i,o-Math.floor(h/2),u-Math.floor(a/2));t.set(l[0],l[1],s.get(o,u))}}function Z(t,e){let s=new S(e,t);for(let r=0;r<t;r++)for(let t=0;t<Math.ceil(e/2);t++)s.set(r,t,Math.floor(1e5*Math.random())),s.set(r,e-1-t,s.get(r,t));return s}function _(t,e){let s=new S(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let i=0;i<e;i++)s.set(r,i,Math.floor(1e5*Math.random())),s.set(t-1-r,i,s.get(r,i));return s}function tt(t,e){let s=new S(e,t);for(let r=0;r<t;r++)for(let i=0;i<Math.ceil(e/2);i++)s.set(r,i,Math.floor(1e5*Math.random())),s.set(t-1-r,e-1-i,s.get(r,i));return s}function et(t,e){let s=new S(e,t);for(let r=0;r<Math.ceil(t/2);r++)for(let i=0;i<Math.ceil(e/2);i++)s.set(r,i,Math.floor(1e5*Math.random())),s.set(t-1-r,i,s.get(r,i)),s.set(r,e-1-i,s.get(r,i)),s.set(t-1-r,e-1-i,s.get(r,i));return s}function st(t,e){let s=new S(e,t);for(let r=0;r<t;r++)for(let t=0;t<e;t++)s.set(r,t,Math.floor(1e5*Math.random()));return s}function rt(t){!function(t){let e=t.Ks,s=t.Qs;for(var r=0,i=0,n=0;n<t.Es;n++)for(var h=0;h<t.qs;h++){if(0==t.Zs.get(n,h))continue;r+=1;var a=Math.floor(t.grid.get(n,h)/t.Ps.Ss)%4;let e;if(0==a)e=t.backgroundColor;else if(1==a)e=t._s;else if(2==a)e=t.tr;else{if(3!=a)continue;e=t.er}let o=4*(n*t.qs+h);i+=Math.sqrt((s.data[o+0]-e.r)**2+(s.data[o+1]-e.g)**2+(s.data[o+2]-e.b)**2),s.data[o+0]=e.r,s.data[o+1]=e.g,s.data[o+2]=e.b,s.data[o+3]=e.Ds}t.sr=.8*t.sr+r/(t.Es*t.qs)/5,t.rr=.01*r+.99*t.rr,t.Fs=.01*i/(r+t.Es*t.qs/30)+.99*t.Fs,t.Fs>330&&(t.$s=!0,t.rr,t.Es,t.qs,console.log("Changing rule because suspected oscillation (std of color change: "+t.Fs.toFixed(1)+")."),t.rr=15,t.Fs=10,J(t));t.rr<3&&(t.$s=!0,console.log("Changing rule because not enough cells changed ("+t.rr+")."),t.rr=20,J(t)),e.putImageData(s,t.ir,t.nr)}(t),function(t){var r=[new Uint8Array(e[0]*t.Ps.ws[0].A).fill(0),new Uint8Array(e[1]).fill(0)],i=new Uint8Array(5).fill(0),n=new S(t.qs,t.Es),h=t.grid;const a=t.time,o=t.Ps.ws[0].A;for(var u=0;u<t.Es;u++)for(var l=0;l<t.qs;l++){var c=s(t,u,l,h,r,i,a,o,4);const e=t.grid.get(u,l);var M=e;M="VariableGR"!=t.Cs||0==t.mask.get(u,l)?t.Ps.U(e,M,c,t.time,t.sr):t.Vs.U(e,M,c,t.time,t.sr),Math.floor(M/t.Ps.Ss)%4!=Math.floor(e/t.Ps.Ss)%4?t.Zs.set(u,l,1):t.Zs.set(u,l,0),n.set(u,l,M);for(let t=0;t<r.length;t++)r[t].fill(0);i.fill(0)}t.hr&&K(t,n,t.t),t.grid=n}(t),D(t),t.time=(t.time+1)%166320,t.ar&&function(t){Math.random()<1e-4&&(t.zs=Math.floor(Math.random()*t.qs),console.log("Periodicity shift X: "+t.zs)),Math.random()<1e-4&&(t.Ls=Math.floor(Math.random()*t.Es),console.log("Periodicity shift Y: "+t.Ls)),Math.random()<1e-4&&(t.Xs=!t.Xs,H(t),console.log("Flip X: "+t.Xs)),Math.random()<1e-4&&(t.Ys=!t.Ys,H(t),console.log("Flip Y: "+t.Ys))}(t),"variable"==t.ur&&function(t){Math.random()<1&&(t.er=q(t.er),t.tr=q(t.tr))}(t),setTimeout((function(){requestAnimationFrame((()=>rt(t)))}),t.timeout)}console.log("Loading main.js");var it=document.getElementById("gameCanvas"),nt=it.getContext("2d"),ht=29,at=78,ot=80,ut=!1,lt=-0,ct=!1,Mt=0,ft=0,mt=!1,pt=!1,bt="mouseAnimation",gt="Variable",dt="zero",St=6,wt=new class{constructor(t,e,s=200,r=200,i=20,n=!0,h=-2,a=!0,o=0,u=0,l=!1,c=!1,M="black2",f="VariableGR",m="random",p=6,b=2e4,g=2e3){this.Es=s,this.qs=r,this.ir=0,this.nr=0,this.timeout=i,this.grid=null,this.Zs=null,this.Qs=null,this.canvas=t,this.Ks=e,this.hr=n,this.Js=h,this.ar=a,this.zs=o,this.Ls=u,this.Xs=l,this.Ys=c,this.ur=M,this.Cs=f,this.lr=m,this.cr=p,this.Mr=null,this.mr=null,this.t=null,this.mask=null,this.pr=b,this.br=g,this.Us=-25,this.Os=-25,this.Gs=25/this.pr,this.js=25/this.br,this.canvas.width=this.qs,this.canvas.height=this.Es,this.Qs=e.createImageData(t.width,t.height),this.$s=!0,this.Ws=!1,this.sr=0,this.rr=0,this.Fs=0,this.Hs=!1,this.time=0}}(it,nt,ht,at,ot,ut,lt,ct,Mt,ft,mt,pt,bt,gt,dt,St);window.onload=function(){wt.grid=new S(wt.qs,wt.Es),wt.Zs=new S(wt.qs,wt.Es);const t=document.getElementById("background"),e=t.getContext("2d");wt.gr=t;const s=new Image;s.src="./grWebsiteBackgroundTransp.png?"+(new Date).getTime(),s.onload=function(){e.drawImage(s,0,0,t.width,t.height)},function(t){t.gr.addEventListener("mousemove",(function(e){var s=t.canvas.getBoundingClientRect(),r=e.clientX-s.left,i=e.clientY-s.top,n=s.width/t.qs,h=s.height/t.Es,a=Math.floor(r/n),o=Math.floor(i/h);t.grid.set(o,a,1)}))}(wt),function(t){t.gr.addEventListener("mousedown",(function(e){var s=t.canvas.getBoundingClientRect(),r=e.clientX-s.left,i=e.clientY-s.top,n=s.width/t.qs,h=s.height/t.Es,a=Math.floor(r/n),o=Math.floor(i/h);e.shiftKey||e.ctrlKey?e.shiftKey&&!e.ctrlKey?(t.grid.set(o,(a+1)%t.qs,1),t.grid.set(o,a,1),t.grid.set((o+1)%t.Es,a,1)):!e.shiftKey&&e.ctrlKey?(t.grid.set(o,a,1),t.grid.set((o+1)%t.Es,a,1)):e.shiftKey&&e.ctrlKey&&(t.grid.set(o,a,1),t.grid.set(o,(a+1)%t.qs,1)):(t.grid.set((o+1)%t.Es,(a+1)%t.qs,1),t.grid.set((o-1+t.Es)%t.Es,(a+1)%t.qs,1),t.grid.set((o-1+t.Es)%t.Es,(a-1+t.qs)%t.qs,1),t.grid.set((o+1)%t.Es,(a-1+t.qs)%t.qs,1))}))}(wt),function(t){var e={r:247,g:255,b:28,Ds:255},s={r:13,g:112,b:255,Ds:255},r={r:240,g:239,b:239,Ds:255},i={r:0,g:0,b:0,Ds:255},n={r:240,g:240,b:240,Ds:255},h={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Ds:255},a={r:Math.floor(256*Math.random()),g:Math.floor(256*Math.random()),b:Math.floor(256*Math.random()),Ds:255};"yellow"==t.ur?(t.backgroundColor=e,t._s=i,t.tr=s,t.er=r):"blue"==t.ur?(t.backgroundColor=s,t._s=r,t.tr=i,t.er=e):"blue2"==t.ur?(t.backgroundColor=s,t._s=e,t.tr=i,t.er=r):"grey"==t.ur?(t.backgroundColor=r,t._s=i,t.tr=s,t.er=e):"grey2"==t.ur?(t.backgroundColor=r,t._s=e,t.tr=i,t.er=s):"black"==t.ur?(t.backgroundColor=i,t._s=s,t.tr=e,t.er=r):"black2"==t.ur?(t.backgroundColor=i,t._s=s,t.tr=r,t.er=e):"blackTrace"==t.ur?(t.backgroundColor=i,t._s=r,t.tr=i,t.er=r):"blackTrace2"==t.ur?(t.backgroundColor=i,t._s=i,t.tr=i,t.er=r):"blackTrace3"==t.ur?(t.backgroundColor=i,t._s=i,t.tr=r,t.er=r):"redblue"==t.ur?(t.backgroundColor=i,t._s=n,t.tr={r:221,g:85,b:12,Ds:255},t.er={r:49,g:130,b:189,Ds:255}):"variable"==t.ur?(t.backgroundColor=i,t._s=n,t.tr=h,t.er=a):"mouseAnimation"==t.ur&&(t.backgroundColor={r:0,g:0,b:0,Ds:0},t._s=s,t.tr=i,t.er=e)}(wt),H(wt),function(t){D(t,!0)}(wt),rt(wt)}})();